(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function Lp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var gh={exports:{}},or={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wg;function Q1(){if(wg)return or;wg=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,r,o){var d=null;if(o!==void 0&&(d=""+o),r.key!==void 0&&(d=""+r.key),"key"in r){o={};for(var f in r)f!=="key"&&(o[f]=r[f])}else o=r;return r=o.ref,{$$typeof:c,type:s,key:d,ref:r!==void 0?r:null,props:o}}return or.Fragment=t,or.jsx=n,or.jsxs=n,or}var Ig;function J1(){return Ig||(Ig=1,gh.exports=Q1()),gh.exports}var M=J1(),ph={exports:{}},je={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bg;function ey(){if(Bg)return je;Bg=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),S=Symbol.iterator;function R(P){return P===null||typeof P!="object"?null:(P=S&&P[S]||P["@@iterator"],typeof P=="function"?P:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,N={};function L(P,ee,le){this.props=P,this.context=ee,this.refs=N,this.updater=le||b}L.prototype.isReactComponent={},L.prototype.setState=function(P,ee){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,ee,"setState")},L.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function O(){}O.prototype=L.prototype;function I(P,ee,le){this.props=P,this.context=ee,this.refs=N,this.updater=le||b}var Y=I.prototype=new O;Y.constructor=I,x(Y,L.prototype),Y.isPureReactComponent=!0;var W=Array.isArray;function Z(){}var K={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function me(P,ee,le){var ue=le.ref;return{$$typeof:c,type:P,key:ee,ref:ue!==void 0?ue:null,props:le}}function pe(P,ee){return me(P.type,ee,P.props)}function fe(P){return typeof P=="object"&&P!==null&&P.$$typeof===c}function re(P){var ee={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(le){return ee[le]})}var ce=/\/+/g;function _e(P,ee){return typeof P=="object"&&P!==null&&P.key!=null?re(""+P.key):ee.toString(36)}function Je(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(Z,Z):(P.status="pending",P.then(function(ee){P.status==="pending"&&(P.status="fulfilled",P.value=ee)},function(ee){P.status==="pending"&&(P.status="rejected",P.reason=ee)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function U(P,ee,le,ue,Le){var q=typeof P;(q==="undefined"||q==="boolean")&&(P=null);var be=!1;if(P===null)be=!0;else switch(q){case"bigint":case"string":case"number":be=!0;break;case"object":switch(P.$$typeof){case c:case t:be=!0;break;case m:return be=P._init,U(be(P._payload),ee,le,ue,Le)}}if(be)return Le=Le(P),be=ue===""?"."+_e(P,0):ue,W(Le)?(le="",be!=null&&(le=be.replace(ce,"$&/")+"/"),U(Le,ee,le,"",function(qt){return qt})):Le!=null&&(fe(Le)&&(Le=pe(Le,le+(Le.key==null||P&&P.key===Le.key?"":(""+Le.key).replace(ce,"$&/")+"/")+be)),ee.push(Le)),1;be=0;var he=ue===""?".":ue+":";if(W(P))for(var Be=0;Be<P.length;Be++)ue=P[Be],q=he+_e(ue,Be),be+=U(ue,ee,le,q,Le);else if(Be=R(P),typeof Be=="function")for(P=Be.call(P),Be=0;!(ue=P.next()).done;)ue=ue.value,q=he+_e(ue,Be++),be+=U(ue,ee,le,q,Le);else if(q==="object"){if(typeof P.then=="function")return U(Je(P),ee,le,ue,Le);throw ee=String(P),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return be}function se(P,ee,le){if(P==null)return P;var ue=[],Le=0;return U(P,ue,"","",function(q){return ee.call(le,q,Le++)}),ue}function ye(P){if(P._status===-1){var ee=P._result;ee=ee(),ee.then(function(le){(P._status===0||P._status===-1)&&(P._status=1,P._result=le)},function(le){(P._status===0||P._status===-1)&&(P._status=2,P._result=le)}),P._status===-1&&(P._status=0,P._result=ee)}if(P._status===1)return P._result.default;throw P._result}var $e=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},Ze={map:se,forEach:function(P,ee,le){se(P,function(){ee.apply(this,arguments)},le)},count:function(P){var ee=0;return se(P,function(){ee++}),ee},toArray:function(P){return se(P,function(ee){return ee})||[]},only:function(P){if(!fe(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return je.Activity=_,je.Children=Ze,je.Component=L,je.Fragment=n,je.Profiler=r,je.PureComponent=I,je.StrictMode=s,je.Suspense=p,je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=K,je.__COMPILER_RUNTIME={__proto__:null,c:function(P){return K.H.useMemoCache(P)}},je.cache=function(P){return function(){return P.apply(null,arguments)}},je.cacheSignal=function(){return null},je.cloneElement=function(P,ee,le){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var ue=x({},P.props),Le=P.key;if(ee!=null)for(q in ee.key!==void 0&&(Le=""+ee.key),ee)!Q.call(ee,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&ee.ref===void 0||(ue[q]=ee[q]);var q=arguments.length-2;if(q===1)ue.children=le;else if(1<q){for(var be=Array(q),he=0;he<q;he++)be[he]=arguments[he+2];ue.children=be}return me(P.type,Le,ue)},je.createContext=function(P){return P={$$typeof:d,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:o,_context:P},P},je.createElement=function(P,ee,le){var ue,Le={},q=null;if(ee!=null)for(ue in ee.key!==void 0&&(q=""+ee.key),ee)Q.call(ee,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Le[ue]=ee[ue]);var be=arguments.length-2;if(be===1)Le.children=le;else if(1<be){for(var he=Array(be),Be=0;Be<be;Be++)he[Be]=arguments[Be+2];Le.children=he}if(P&&P.defaultProps)for(ue in be=P.defaultProps,be)Le[ue]===void 0&&(Le[ue]=be[ue]);return me(P,q,Le)},je.createRef=function(){return{current:null}},je.forwardRef=function(P){return{$$typeof:f,render:P}},je.isValidElement=fe,je.lazy=function(P){return{$$typeof:m,_payload:{_status:-1,_result:P},_init:ye}},je.memo=function(P,ee){return{$$typeof:y,type:P,compare:ee===void 0?null:ee}},je.startTransition=function(P){var ee=K.T,le={};K.T=le;try{var ue=P(),Le=K.S;Le!==null&&Le(le,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(Z,$e)}catch(q){$e(q)}finally{ee!==null&&le.types!==null&&(ee.types=le.types),K.T=ee}},je.unstable_useCacheRefresh=function(){return K.H.useCacheRefresh()},je.use=function(P){return K.H.use(P)},je.useActionState=function(P,ee,le){return K.H.useActionState(P,ee,le)},je.useCallback=function(P,ee){return K.H.useCallback(P,ee)},je.useContext=function(P){return K.H.useContext(P)},je.useDebugValue=function(){},je.useDeferredValue=function(P,ee){return K.H.useDeferredValue(P,ee)},je.useEffect=function(P,ee){return K.H.useEffect(P,ee)},je.useEffectEvent=function(P){return K.H.useEffectEvent(P)},je.useId=function(){return K.H.useId()},je.useImperativeHandle=function(P,ee,le){return K.H.useImperativeHandle(P,ee,le)},je.useInsertionEffect=function(P,ee){return K.H.useInsertionEffect(P,ee)},je.useLayoutEffect=function(P,ee){return K.H.useLayoutEffect(P,ee)},je.useMemo=function(P,ee){return K.H.useMemo(P,ee)},je.useOptimistic=function(P,ee){return K.H.useOptimistic(P,ee)},je.useReducer=function(P,ee,le){return K.H.useReducer(P,ee,le)},je.useRef=function(P){return K.H.useRef(P)},je.useState=function(P){return K.H.useState(P)},je.useSyncExternalStore=function(P,ee,le){return K.H.useSyncExternalStore(P,ee,le)},je.useTransition=function(){return K.H.useTransition()},je.version="19.2.0",je}var Fg;function Zh(){return Fg||(Fg=1,ph.exports=ey()),ph.exports}var $=Zh();const ty=Lp($);var mh={exports:{}},cr={},yh={exports:{}},Eh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hg;function ay(){return Hg||(Hg=1,(function(c){function t(U,se){var ye=U.length;U.push(se);e:for(;0<ye;){var $e=ye-1>>>1,Ze=U[$e];if(0<r(Ze,se))U[$e]=se,U[ye]=Ze,ye=$e;else break e}}function n(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var se=U[0],ye=U.pop();if(ye!==se){U[0]=ye;e:for(var $e=0,Ze=U.length,P=Ze>>>1;$e<P;){var ee=2*($e+1)-1,le=U[ee],ue=ee+1,Le=U[ue];if(0>r(le,ye))ue<Ze&&0>r(Le,le)?(U[$e]=Le,U[ue]=ye,$e=ue):(U[$e]=le,U[ee]=ye,$e=ee);else if(ue<Ze&&0>r(Le,ye))U[$e]=Le,U[ue]=ye,$e=ue;else break e}}return se}function r(U,se){var ye=U.sortIndex-se.sortIndex;return ye!==0?ye:U.id-se.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;c.unstable_now=function(){return o.now()}}else{var d=Date,f=d.now();c.unstable_now=function(){return d.now()-f}}var p=[],y=[],m=1,_=null,S=3,R=!1,b=!1,x=!1,N=!1,L=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function Y(U){for(var se=n(y);se!==null;){if(se.callback===null)s(y);else if(se.startTime<=U)s(y),se.sortIndex=se.expirationTime,t(p,se);else break;se=n(y)}}function W(U){if(x=!1,Y(U),!b)if(n(p)!==null)b=!0,Z||(Z=!0,re());else{var se=n(y);se!==null&&Je(W,se.startTime-U)}}var Z=!1,K=-1,Q=5,me=-1;function pe(){return N?!0:!(c.unstable_now()-me<Q)}function fe(){if(N=!1,Z){var U=c.unstable_now();me=U;var se=!0;try{e:{b=!1,x&&(x=!1,O(K),K=-1),R=!0;var ye=S;try{t:{for(Y(U),_=n(p);_!==null&&!(_.expirationTime>U&&pe());){var $e=_.callback;if(typeof $e=="function"){_.callback=null,S=_.priorityLevel;var Ze=$e(_.expirationTime<=U);if(U=c.unstable_now(),typeof Ze=="function"){_.callback=Ze,Y(U),se=!0;break t}_===n(p)&&s(p),Y(U)}else s(p);_=n(p)}if(_!==null)se=!0;else{var P=n(y);P!==null&&Je(W,P.startTime-U),se=!1}}break e}finally{_=null,S=ye,R=!1}se=void 0}}finally{se?re():Z=!1}}}var re;if(typeof I=="function")re=function(){I(fe)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,_e=ce.port2;ce.port1.onmessage=fe,re=function(){_e.postMessage(null)}}else re=function(){L(fe,0)};function Je(U,se){K=L(function(){U(c.unstable_now())},se)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(U){U.callback=null},c.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<U?Math.floor(1e3/U):5},c.unstable_getCurrentPriorityLevel=function(){return S},c.unstable_next=function(U){switch(S){case 1:case 2:case 3:var se=3;break;default:se=S}var ye=S;S=se;try{return U()}finally{S=ye}},c.unstable_requestPaint=function(){N=!0},c.unstable_runWithPriority=function(U,se){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var ye=S;S=U;try{return se()}finally{S=ye}},c.unstable_scheduleCallback=function(U,se,ye){var $e=c.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?$e+ye:$e):ye=$e,U){case 1:var Ze=-1;break;case 2:Ze=250;break;case 5:Ze=1073741823;break;case 4:Ze=1e4;break;default:Ze=5e3}return Ze=ye+Ze,U={id:m++,callback:se,priorityLevel:U,startTime:ye,expirationTime:Ze,sortIndex:-1},ye>$e?(U.sortIndex=ye,t(y,U),n(p)===null&&U===n(y)&&(x?(O(K),K=-1):x=!0,Je(W,ye-$e))):(U.sortIndex=Ze,t(p,U),b||R||(b=!0,Z||(Z=!0,re()))),U},c.unstable_shouldYield=pe,c.unstable_wrapCallback=function(U){var se=S;return function(){var ye=S;S=se;try{return U.apply(this,arguments)}finally{S=ye}}}})(Eh)),Eh}var Gg;function iy(){return Gg||(Gg=1,yh.exports=ay()),yh.exports}var _h={exports:{}},Ma={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yg;function ny(){if(Yg)return Ma;Yg=1;var c=Zh();function t(p){var y="https://react.dev/errors/"+p;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)y+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+p+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(p,y,m){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:_==null?null:""+_,children:p,containerInfo:y,implementation:m}}var d=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,y){if(p==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return Ma.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ma.createPortal=function(p,y){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(t(299));return o(p,y,null,m)},Ma.flushSync=function(p){var y=d.T,m=s.p;try{if(d.T=null,s.p=2,p)return p()}finally{d.T=y,s.p=m,s.d.f()}},Ma.preconnect=function(p,y){typeof p=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,s.d.C(p,y))},Ma.prefetchDNS=function(p){typeof p=="string"&&s.d.D(p)},Ma.preinit=function(p,y){if(typeof p=="string"&&y&&typeof y.as=="string"){var m=y.as,_=f(m,y.crossOrigin),S=typeof y.integrity=="string"?y.integrity:void 0,R=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;m==="style"?s.d.S(p,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:_,integrity:S,fetchPriority:R}):m==="script"&&s.d.X(p,{crossOrigin:_,integrity:S,fetchPriority:R,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},Ma.preinitModule=function(p,y){if(typeof p=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var m=f(y.as,y.crossOrigin);s.d.M(p,{crossOrigin:m,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&s.d.M(p)},Ma.preload=function(p,y){if(typeof p=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var m=y.as,_=f(m,y.crossOrigin);s.d.L(p,m,{crossOrigin:_,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},Ma.preloadModule=function(p,y){if(typeof p=="string")if(y){var m=f(y.as,y.crossOrigin);s.d.m(p,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:m,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else s.d.m(p)},Ma.requestFormReset=function(p){s.d.r(p)},Ma.unstable_batchedUpdates=function(p,y){return p(y)},Ma.useFormState=function(p,y,m){return d.H.useFormState(p,y,m)},Ma.useFormStatus=function(){return d.H.useHostTransitionStatus()},Ma.version="19.2.0",Ma}var Ug;function sy(){if(Ug)return _h.exports;Ug=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),_h.exports=ny(),_h.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zg;function ly(){if(zg)return cr;zg=1;var c=iy(),t=Zh(),n=sy();function s(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)a+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function o(e){var a=e,i=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(i=a.return),e=a.return;while(e)}return a.tag===3?i:null}function d(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function f(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function p(e){if(o(e)!==e)throw Error(s(188))}function y(e){var a=e.alternate;if(!a){if(a=o(e),a===null)throw Error(s(188));return a!==e?null:e}for(var i=e,l=a;;){var u=i.return;if(u===null)break;var h=u.alternate;if(h===null){if(l=u.return,l!==null){i=l;continue}break}if(u.child===h.child){for(h=u.child;h;){if(h===i)return p(u),e;if(h===l)return p(u),a;h=h.sibling}throw Error(s(188))}if(i.return!==l.return)i=u,l=h;else{for(var E=!1,v=u.child;v;){if(v===i){E=!0,i=u,l=h;break}if(v===l){E=!0,l=u,i=h;break}v=v.sibling}if(!E){for(v=h.child;v;){if(v===i){E=!0,i=h,l=u;break}if(v===l){E=!0,l=h,i=u;break}v=v.sibling}if(!E)throw Error(s(189))}}if(i.alternate!==l)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?e:a}function m(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=m(e),a!==null)return a;e=e.sibling}return null}var _=Object.assign,S=Symbol.for("react.element"),R=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),I=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),me=Symbol.for("react.activity"),pe=Symbol.for("react.memo_cache_sentinel"),fe=Symbol.iterator;function re(e){return e===null||typeof e!="object"?null:(e=fe&&e[fe]||e["@@iterator"],typeof e=="function"?e:null)}var ce=Symbol.for("react.client.reference");function _e(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ce?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case x:return"Fragment";case L:return"Profiler";case N:return"StrictMode";case W:return"Suspense";case Z:return"SuspenseList";case me:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case b:return"Portal";case I:return e.displayName||"Context";case O:return(e._context.displayName||"Context")+".Consumer";case Y:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case K:return a=e.displayName||null,a!==null?a:_e(e.type)||"Memo";case Q:a=e._payload,e=e._init;try{return _e(e(a))}catch{}}return null}var Je=Array.isArray,U=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye={pending:!1,data:null,method:null,action:null},$e=[],Ze=-1;function P(e){return{current:e}}function ee(e){0>Ze||(e.current=$e[Ze],$e[Ze]=null,Ze--)}function le(e,a){Ze++,$e[Ze]=e.current,e.current=a}var ue=P(null),Le=P(null),q=P(null),be=P(null);function he(e,a){switch(le(q,a),le(Le,e),le(ue,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?ig(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=ig(a),e=ng(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}ee(ue),le(ue,e)}function Be(){ee(ue),ee(Le),ee(q)}function qt(e){e.memoizedState!==null&&le(be,e);var a=ue.current,i=ng(a,e.type);a!==i&&(le(Le,e),le(ue,i))}function va(e){Le.current===e&&(ee(ue),ee(Le)),be.current===e&&(ee(be),nr._currentValue=ye)}var Rs,Xn;function Qa(e){if(Rs===void 0)try{throw Error()}catch(i){var a=i.stack.trim().match(/\n( *(at )?)/);Rs=a&&a[1]||"",Xn=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Rs+e+Xn}var jn=!1;function $n(e,a){if(!e||jn)return"";jn=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(a){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(j){var X=j}Reflect.construct(e,[],ne)}else{try{ne.call()}catch(j){X=j}e.call(ne.prototype)}}else{try{throw Error()}catch(j){X=j}(ne=e())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(j){if(j&&X&&typeof j.stack=="string")return[j.stack,X.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=l.DetermineComponentFrameRoot(),E=h[0],v=h[1];if(E&&v){var C=E.split(`
`),k=v.split(`
`);for(u=l=0;l<C.length&&!C[l].includes("DetermineComponentFrameRoot");)l++;for(;u<k.length&&!k[u].includes("DetermineComponentFrameRoot");)u++;if(l===C.length||u===k.length)for(l=C.length-1,u=k.length-1;1<=l&&0<=u&&C[l]!==k[u];)u--;for(;1<=l&&0<=u;l--,u--)if(C[l]!==k[u]){if(l!==1||u!==1)do if(l--,u--,0>u||C[l]!==k[u]){var J=`
`+C[l].replace(" at new "," at ");return e.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",e.displayName)),J}while(1<=l&&0<=u);break}}}finally{jn=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?Qa(i):""}function cc(e,a){switch(e.tag){case 26:case 27:case 5:return Qa(e.type);case 16:return Qa("Lazy");case 13:return e.child!==a&&a!==null?Qa("Suspense Fallback"):Qa("Suspense");case 19:return Qa("SuspenseList");case 0:case 15:return $n(e.type,!1);case 11:return $n(e.type.render,!1);case 1:return $n(e.type,!0);case 31:return Qa("Activity");default:return""}}function qn(e){try{var a="",i=null;do a+=cc(e,i),i=e,e=e.return;while(e);return a}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var pl=Object.prototype.hasOwnProperty,hn=c.unstable_scheduleCallback,yr=c.unstable_cancelCallback,ml=c.unstable_shouldYield,Ms=c.unstable_requestPaint,ga=c.unstable_now,uc=c.unstable_getCurrentPriorityLevel,Er=c.unstable_ImmediatePriority,yl=c.unstable_UserBlockingPriority,bs=c.unstable_NormalPriority,hc=c.unstable_LowPriority,_r=c.unstable_IdlePriority,Os=c.log,dc=c.unstable_setDisableYieldValue,pa=null,Da=null;function Ba(e){if(typeof Os=="function"&&dc(e),Da&&typeof Da.setStrictMode=="function")try{Da.setStrictMode(pa,e)}catch{}}var Ca=Math.clz32?Math.clz32:Al,El=Math.log,_l=Math.LN2;function Al(e){return e>>>=0,e===0?32:31-(El(e)/_l|0)|0}var Fa=256,dn=262144,fn=4194304;function Ti(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function gn(e,a,i){var l=e.pendingLanes;if(l===0)return 0;var u=0,h=e.suspendedLanes,E=e.pingedLanes;e=e.warmLanes;var v=l&134217727;return v!==0?(l=v&~h,l!==0?u=Ti(l):(E&=v,E!==0?u=Ti(E):i||(i=v&~e,i!==0&&(u=Ti(i))))):(v=l&~h,v!==0?u=Ti(v):E!==0?u=Ti(E):i||(i=l&~e,i!==0&&(u=Ti(i)))),u===0?0:a!==0&&a!==u&&(a&h)===0&&(h=u&-u,i=a&-a,h>=i||h===32&&(i&4194048)!==0)?a:u}function Zn(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function Ar(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zi(){var e=fn;return fn<<=1,(fn&62914560)===0&&(fn=4194304),e}function Kn(e){for(var a=[],i=0;31>i;i++)a.push(e);return a}function Ni(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function fc(e,a,i,l,u,h){var E=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var v=e.entanglements,C=e.expirationTimes,k=e.hiddenUpdates;for(i=E&~i;0<i;){var J=31-Ca(i),ne=1<<J;v[J]=0,C[J]=-1;var X=k[J];if(X!==null)for(k[J]=null,J=0;J<X.length;J++){var j=X[J];j!==null&&(j.lane&=-536870913)}i&=~ne}l!==0&&Sr(e,l,0),h!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=h&~(E&~a))}function Sr(e,a,i){e.pendingLanes|=a,e.suspendedLanes&=~a;var l=31-Ca(a);e.entangledLanes|=a,e.entanglements[l]=e.entanglements[l]|1073741824|i&261930}function Tr(e,a){var i=e.entangledLanes|=a;for(e=e.entanglements;i;){var l=31-Ca(i),u=1<<l;u&a|e[l]&a&&(e[l]|=a),i&=~u}}function xs(e,a){var i=a&-a;return i=(i&42)!==0?1:Qn(i),(i&(e.suspendedLanes|a))!==0?0:i}function Qn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Jn(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ls(){var e=se.p;return e!==0?e:(e=window.event,e===void 0?32:Og(e.type))}function Ns(e,a){var i=se.p;try{return se.p=e,a()}finally{se.p=i}}var Di=Math.random().toString(36).slice(2),F="__reactFiber$"+Di,g="__reactProps$"+Di,ve="__reactContainer$"+Di,_t="__reactEvents$"+Di,Ue="__reactListeners$"+Di,Pt="__reactHandles$"+Di,pt="__reactResources$"+Di,Ot="__reactMarker$"+Di;function kt(e){delete e[F],delete e[g],delete e[_t],delete e[Ue],delete e[Pt]}function It(e){var a=e[F];if(a)return a;for(var i=e.parentNode;i;){if(a=i[ve]||i[F]){if(i=a.alternate,a.child!==null||i!==null&&i.child!==null)for(e=hg(e);e!==null;){if(i=e[F])return i;e=hg(e)}return a}e=i,i=e.parentNode}return null}function wt(e){if(e=e[F]||e[ve]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function Bt(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(s(33))}function We(e){var a=e[pt];return a||(a=e[pt]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function xt(e){e[Ot]=!0}var vi=new Set,Ri={};function Ft(e,a){Zt(e,a),Zt(e+"Capture",a)}function Zt(e,a){for(Ri[e]=a,e=0;e<a.length;e++)vi.add(a[e])}var ci=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),St={},Ne={};function Ve(e){return pl.call(Ne,e)?!0:pl.call(St,e)?!1:ci.test(e)?Ne[e]=!0:(St[e]=!0,!1)}function Fe(e,a,i){if(Ve(a))if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var l=a.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+i)}}function we(e,a,i){if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+i)}}function Me(e,a,i,l){if(l===null)e.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(a,i,""+l)}}function Oe(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function qe(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ce(e,a,i){var l=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,h=l.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return u.call(this)},set:function(E){i=""+E,h.call(this,E)}}),Object.defineProperty(e,a,{enumerable:l.enumerable}),{getValue:function(){return i},setValue:function(E){i=""+E},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function st(e){if(!e._valueTracker){var a=qe(e)?"checked":"value";e._valueTracker=Ce(e,a,""+e[a])}}function et(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var i=a.getValue(),l="";return e&&(l=qe(e)?e.checked?"true":"false":e.value),e=l,e!==i?(a.setValue(e),!0):!1}function T(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ge=/[\n"\\]/g;function ie(e){return e.replace(ge,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function oe(e,a,i,l,u,h,E,v){e.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?e.type=E:e.removeAttribute("type"),a!=null?E==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+Oe(a)):e.value!==""+Oe(a)&&(e.value=""+Oe(a)):E!=="submit"&&E!=="reset"||e.removeAttribute("value"),a!=null?Ae(e,E,Oe(a)):i!=null?Ae(e,E,Oe(i)):l!=null&&e.removeAttribute("value"),u==null&&h!=null&&(e.defaultChecked=!!h),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.name=""+Oe(v):e.removeAttribute("name")}function de(e,a,i,l,u,h,E,v){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),a!=null||i!=null){if(!(h!=="submit"&&h!=="reset"||a!=null)){st(e);return}i=i!=null?""+Oe(i):"",a=a!=null?""+Oe(a):i,v||a===e.value||(e.value=a),e.defaultValue=a}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=v?e.checked:!!l,e.defaultChecked=!!l,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(e.name=E),st(e)}function Ae(e,a,i){a==="number"&&T(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ze(e,a,i,l){if(e=e.options,a){a={};for(var u=0;u<i.length;u++)a["$"+i[u]]=!0;for(i=0;i<e.length;i++)u=a.hasOwnProperty("$"+e[i].value),e[i].selected!==u&&(e[i].selected=u),u&&l&&(e[i].defaultSelected=!0)}else{for(i=""+Oe(i),a=null,u=0;u<e.length;u++){if(e[u].value===i){e[u].selected=!0,l&&(e[u].defaultSelected=!0);return}a!==null||e[u].disabled||(a=e[u])}a!==null&&(a.selected=!0)}}function Xe(e,a,i){if(a!=null&&(a=""+Oe(a),a!==e.value&&(e.value=a),i==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=i!=null?""+Oe(i):""}function Ye(e,a,i,l){if(a==null){if(l!=null){if(i!=null)throw Error(s(92));if(Je(l)){if(1<l.length)throw Error(s(93));l=l[0]}i=l}i==null&&(i=""),a=i}i=Oe(a),e.defaultValue=i,l=e.textContent,l===i&&l!==""&&l!==null&&(e.value=l),st(e)}function Ke(e,a){if(a){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=a;return}}e.textContent=a}var tt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ke(e,a,i){var l=a.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?l?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":l?e.setProperty(a,i):typeof i!="number"||i===0||tt.has(a)?a==="float"?e.cssFloat=i:e[a]=(""+i).trim():e[a]=i+"px"}function la(e,a,i){if(a!=null&&typeof a!="object")throw Error(s(62));if(e=e.style,i!=null){for(var l in i)!i.hasOwnProperty(l)||a!=null&&a.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var u in a)l=a[u],a.hasOwnProperty(u)&&i[u]!==l&&ke(e,u,l)}else for(var h in a)a.hasOwnProperty(h)&&ke(e,h,a[h])}function Ha(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ua=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ui=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hi(e){return ui.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Ja(){}var Ds=null;function ki(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ct=null,Ra=null;function Ci(e){var a=wt(e);if(a&&(e=a.stateNode)){var i=e[g]||null;e:switch(e=a.stateNode,a.type){case"input":if(oe(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),a=i.name,i.type==="radio"&&a!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ie(""+a)+'"][type="radio"]'),a=0;a<i.length;a++){var l=i[a];if(l!==e&&l.form===e.form){var u=l[g]||null;if(!u)throw Error(s(90));oe(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(a=0;a<i.length;a++)l=i[a],l.form===e.form&&et(l)}break e;case"textarea":Xe(e,i.value,i.defaultValue);break e;case"select":a=i.value,a!=null&&ze(e,!!i.multiple,a,!1)}}}var Vi=!1;function ad(e,a,i){if(Vi)return e(a,i);Vi=!0;try{var l=e(a);return l}finally{if(Vi=!1,(ct!==null||Ra!==null)&&(co(),ct&&(a=ct,e=Ra,Ra=ct=null,Ci(a),e)))for(a=0;a<e.length;a++)Ci(e[a])}}function Sl(e,a){var i=e.stateNode;if(i===null)return null;var l=i[g]||null;if(l===null)return null;i=l[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(s(231,a,typeof i));return i}var Wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gc=!1;if(Wi)try{var Tl={};Object.defineProperty(Tl,"passive",{get:function(){gc=!0}}),window.addEventListener("test",Tl,Tl),window.removeEventListener("test",Tl,Tl)}catch{gc=!1}var pn=null,pc=null,vr=null;function id(){if(vr)return vr;var e,a=pc,i=a.length,l,u="value"in pn?pn.value:pn.textContent,h=u.length;for(e=0;e<i&&a[e]===u[e];e++);var E=i-e;for(l=1;l<=E&&a[i-l]===u[h-l];l++);return vr=u.slice(e,1<l?1-l:void 0)}function Rr(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function Mr(){return!0}function nd(){return!1}function Ga(e){function a(i,l,u,h,E){this._reactName=i,this._targetInst=u,this.type=l,this.nativeEvent=h,this.target=E,this.currentTarget=null;for(var v in e)e.hasOwnProperty(v)&&(i=e[v],this[v]=i?i(h):h[v]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Mr:nd,this.isPropagationStopped=nd,this}return _(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Mr)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Mr)},persist:function(){},isPersistent:Mr}),a}var es={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},br=Ga(es),vl=_({},es,{view:0,detail:0}),Zp=Ga(vl),mc,yc,Rl,Or=_({},vl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_c,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Rl&&(Rl&&e.type==="mousemove"?(mc=e.screenX-Rl.screenX,yc=e.screenY-Rl.screenY):yc=mc=0,Rl=e),mc)},movementY:function(e){return"movementY"in e?e.movementY:yc}}),sd=Ga(Or),Kp=_({},Or,{dataTransfer:0}),Qp=Ga(Kp),Jp=_({},vl,{relatedTarget:0}),Ec=Ga(Jp),em=_({},es,{animationName:0,elapsedTime:0,pseudoElement:0}),tm=Ga(em),am=_({},es,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),im=Ga(am),nm=_({},es,{data:0}),ld=Ga(nm),sm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lm={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function om(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=rm[e])?!!a[e]:!1}function _c(){return om}var cm=_({},vl,{key:function(e){if(e.key){var a=sm[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=Rr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?lm[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_c,charCode:function(e){return e.type==="keypress"?Rr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Rr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),um=Ga(cm),hm=_({},Or,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rd=Ga(hm),dm=_({},vl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_c}),fm=Ga(dm),gm=_({},es,{propertyName:0,elapsedTime:0,pseudoElement:0}),pm=Ga(gm),mm=_({},Or,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ym=Ga(mm),Em=_({},es,{newState:0,oldState:0}),_m=Ga(Em),Am=[9,13,27,32],Ac=Wi&&"CompositionEvent"in window,Ml=null;Wi&&"documentMode"in document&&(Ml=document.documentMode);var Sm=Wi&&"TextEvent"in window&&!Ml,od=Wi&&(!Ac||Ml&&8<Ml&&11>=Ml),cd=" ",ud=!1;function hd(e,a){switch(e){case"keyup":return Am.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Cs=!1;function Tm(e,a){switch(e){case"compositionend":return dd(a);case"keypress":return a.which!==32?null:(ud=!0,cd);case"textInput":return e=a.data,e===cd&&ud?null:e;default:return null}}function vm(e,a){if(Cs)return e==="compositionend"||!Ac&&hd(e,a)?(e=id(),vr=pc=pn=null,Cs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return od&&a.locale!=="ko"?null:a.data;default:return null}}var Rm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fd(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!Rm[e.type]:a==="textarea"}function gd(e,a,i,l){ct?Ra?Ra.push(l):Ra=[l]:ct=l,a=yo(a,"onChange"),0<a.length&&(i=new br("onChange","change",null,i,l),e.push({event:i,listeners:a}))}var bl=null,Ol=null;function Mm(e){K0(e,0)}function xr(e){var a=Bt(e);if(et(a))return e}function pd(e,a){if(e==="change")return a}var md=!1;if(Wi){var Sc;if(Wi){var Tc="oninput"in document;if(!Tc){var yd=document.createElement("div");yd.setAttribute("oninput","return;"),Tc=typeof yd.oninput=="function"}Sc=Tc}else Sc=!1;md=Sc&&(!document.documentMode||9<document.documentMode)}function Ed(){bl&&(bl.detachEvent("onpropertychange",_d),Ol=bl=null)}function _d(e){if(e.propertyName==="value"&&xr(Ol)){var a=[];gd(a,Ol,e,ki(e)),ad(Mm,a)}}function bm(e,a,i){e==="focusin"?(Ed(),bl=a,Ol=i,bl.attachEvent("onpropertychange",_d)):e==="focusout"&&Ed()}function Om(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return xr(Ol)}function xm(e,a){if(e==="click")return xr(a)}function Lm(e,a){if(e==="input"||e==="change")return xr(a)}function Nm(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var ei=typeof Object.is=="function"?Object.is:Nm;function xl(e,a){if(ei(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var i=Object.keys(e),l=Object.keys(a);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var u=i[l];if(!pl.call(a,u)||!ei(e[u],a[u]))return!1}return!0}function Ad(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Sd(e,a){var i=Ad(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=a&&l>=a)return{node:i,offset:a-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Ad(i)}}function Td(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?Td(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function vd(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=T(e.document);a instanceof e.HTMLIFrameElement;){try{var i=typeof a.contentWindow.location.href=="string"}catch{i=!1}if(i)e=a.contentWindow;else break;a=T(e.document)}return a}function vc(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var Dm=Wi&&"documentMode"in document&&11>=document.documentMode,Ps=null,Rc=null,Ll=null,Mc=!1;function Rd(e,a,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Mc||Ps==null||Ps!==T(l)||(l=Ps,"selectionStart"in l&&vc(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Ll&&xl(Ll,l)||(Ll=l,l=yo(Rc,"onSelect"),0<l.length&&(a=new br("onSelect","select",null,a,i),e.push({event:a,listeners:l}),a.target=Ps)))}function ts(e,a){var i={};return i[e.toLowerCase()]=a.toLowerCase(),i["Webkit"+e]="webkit"+a,i["Moz"+e]="moz"+a,i}var ws={animationend:ts("Animation","AnimationEnd"),animationiteration:ts("Animation","AnimationIteration"),animationstart:ts("Animation","AnimationStart"),transitionrun:ts("Transition","TransitionRun"),transitionstart:ts("Transition","TransitionStart"),transitioncancel:ts("Transition","TransitionCancel"),transitionend:ts("Transition","TransitionEnd")},bc={},Md={};Wi&&(Md=document.createElement("div").style,"AnimationEvent"in window||(delete ws.animationend.animation,delete ws.animationiteration.animation,delete ws.animationstart.animation),"TransitionEvent"in window||delete ws.transitionend.transition);function as(e){if(bc[e])return bc[e];if(!ws[e])return e;var a=ws[e],i;for(i in a)if(a.hasOwnProperty(i)&&i in Md)return bc[e]=a[i];return e}var bd=as("animationend"),Od=as("animationiteration"),xd=as("animationstart"),Cm=as("transitionrun"),Pm=as("transitionstart"),wm=as("transitioncancel"),Ld=as("transitionend"),Nd=new Map,Oc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Oc.push("scrollEnd");function Mi(e,a){Nd.set(e,a),Ft(a,[e])}var Lr=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},di=[],Is=0,xc=0;function Nr(){for(var e=Is,a=xc=Is=0;a<e;){var i=di[a];di[a++]=null;var l=di[a];di[a++]=null;var u=di[a];di[a++]=null;var h=di[a];if(di[a++]=null,l!==null&&u!==null){var E=l.pending;E===null?u.next=u:(u.next=E.next,E.next=u),l.pending=u}h!==0&&Dd(i,u,h)}}function Dr(e,a,i,l){di[Is++]=e,di[Is++]=a,di[Is++]=i,di[Is++]=l,xc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Lc(e,a,i,l){return Dr(e,a,i,l),Cr(e)}function is(e,a){return Dr(e,null,null,a),Cr(e)}function Dd(e,a,i){e.lanes|=i;var l=e.alternate;l!==null&&(l.lanes|=i);for(var u=!1,h=e.return;h!==null;)h.childLanes|=i,l=h.alternate,l!==null&&(l.childLanes|=i),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(u=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,u&&a!==null&&(u=31-Ca(i),e=h.hiddenUpdates,l=e[u],l===null?e[u]=[a]:l.push(a),a.lane=i|536870912),h):null}function Cr(e){if(50<Kl)throw Kl=0,Hu=null,Error(s(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var Bs={};function Im(e,a,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(e,a,i,l){return new Im(e,a,i,l)}function Nc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xi(e,a){var i=e.alternate;return i===null?(i=ti(e.tag,a,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=a,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,a=e.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Cd(e,a){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,a=i.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function Pr(e,a,i,l,u,h){var E=0;if(l=e,typeof e=="function")Nc(e)&&(E=1);else if(typeof e=="string")E=Y1(e,i,ue.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case me:return e=ti(31,i,a,u),e.elementType=me,e.lanes=h,e;case x:return ns(i.children,u,h,a);case N:E=8,u|=24;break;case L:return e=ti(12,i,a,u|2),e.elementType=L,e.lanes=h,e;case W:return e=ti(13,i,a,u),e.elementType=W,e.lanes=h,e;case Z:return e=ti(19,i,a,u),e.elementType=Z,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case I:E=10;break e;case O:E=9;break e;case Y:E=11;break e;case K:E=14;break e;case Q:E=16,l=null;break e}E=29,i=Error(s(130,e===null?"null":typeof e,"")),l=null}return a=ti(E,i,a,u),a.elementType=e,a.type=l,a.lanes=h,a}function ns(e,a,i,l){return e=ti(7,e,l,a),e.lanes=i,e}function Dc(e,a,i){return e=ti(6,e,null,a),e.lanes=i,e}function Pd(e){var a=ti(18,null,null,0);return a.stateNode=e,a}function Cc(e,a,i){return a=ti(4,e.children!==null?e.children:[],e.key,a),a.lanes=i,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var wd=new WeakMap;function fi(e,a){if(typeof e=="object"&&e!==null){var i=wd.get(e);return i!==void 0?i:(a={value:e,source:a,stack:qn(a)},wd.set(e,a),a)}return{value:e,source:a,stack:qn(a)}}var Fs=[],Hs=0,wr=null,Nl=0,gi=[],pi=0,mn=null,Pi=1,wi="";function ji(e,a){Fs[Hs++]=Nl,Fs[Hs++]=wr,wr=e,Nl=a}function Id(e,a,i){gi[pi++]=Pi,gi[pi++]=wi,gi[pi++]=mn,mn=e;var l=Pi;e=wi;var u=32-Ca(l)-1;l&=~(1<<u),i+=1;var h=32-Ca(a)+u;if(30<h){var E=u-u%5;h=(l&(1<<E)-1).toString(32),l>>=E,u-=E,Pi=1<<32-Ca(a)+u|i<<u|l,wi=h+e}else Pi=1<<h|i<<u|l,wi=e}function Pc(e){e.return!==null&&(ji(e,1),Id(e,1,0))}function wc(e){for(;e===wr;)wr=Fs[--Hs],Fs[Hs]=null,Nl=Fs[--Hs],Fs[Hs]=null;for(;e===mn;)mn=gi[--pi],gi[pi]=null,wi=gi[--pi],gi[pi]=null,Pi=gi[--pi],gi[pi]=null}function Bd(e,a){gi[pi++]=Pi,gi[pi++]=wi,gi[pi++]=mn,Pi=a.id,wi=a.overflow,mn=e}var ma=null,Ht=null,ft=!1,yn=null,mi=!1,Ic=Error(s(519));function En(e){var a=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Dl(fi(a,e)),Ic}function Fd(e){var a=e.stateNode,i=e.type,l=e.memoizedProps;switch(a[F]=e,a[g]=l,i){case"dialog":ot("cancel",a),ot("close",a);break;case"iframe":case"object":case"embed":ot("load",a);break;case"video":case"audio":for(i=0;i<Jl.length;i++)ot(Jl[i],a);break;case"source":ot("error",a);break;case"img":case"image":case"link":ot("error",a),ot("load",a);break;case"details":ot("toggle",a);break;case"input":ot("invalid",a),de(a,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":ot("invalid",a);break;case"textarea":ot("invalid",a),Ye(a,l.value,l.defaultValue,l.children)}i=l.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||a.textContent===""+i||l.suppressHydrationWarning===!0||tg(a.textContent,i)?(l.popover!=null&&(ot("beforetoggle",a),ot("toggle",a)),l.onScroll!=null&&ot("scroll",a),l.onScrollEnd!=null&&ot("scrollend",a),l.onClick!=null&&(a.onclick=Ja),a=!0):a=!1,a||En(e,!0)}function Hd(e){for(ma=e.return;ma;)switch(ma.tag){case 5:case 31:case 13:mi=!1;return;case 27:case 3:mi=!0;return;default:ma=ma.return}}function Gs(e){if(e!==ma)return!1;if(!ft)return Hd(e),ft=!0,!1;var a=e.tag,i;if((i=a!==3&&a!==27)&&((i=a===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||Ju(e.type,e.memoizedProps)),i=!i),i&&Ht&&En(e),Hd(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Ht=ug(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Ht=ug(e)}else a===27?(a=Ht,Cn(e.type)?(e=nh,nh=null,Ht=e):Ht=a):Ht=ma?Ei(e.stateNode.nextSibling):null;return!0}function ss(){Ht=ma=null,ft=!1}function Bc(){var e=yn;return e!==null&&(ka===null?ka=e:ka.push.apply(ka,e),yn=null),e}function Dl(e){yn===null?yn=[e]:yn.push(e)}var Fc=P(null),ls=null,$i=null;function _n(e,a,i){le(Fc,a._currentValue),a._currentValue=i}function qi(e){e._currentValue=Fc.current,ee(Fc)}function Hc(e,a,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,l!==null&&(l.childLanes|=a)):l!==null&&(l.childLanes&a)!==a&&(l.childLanes|=a),e===i)break;e=e.return}}function Gc(e,a,i,l){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var h=u.dependencies;if(h!==null){var E=u.child;h=h.firstContext;e:for(;h!==null;){var v=h;h=u;for(var C=0;C<a.length;C++)if(v.context===a[C]){h.lanes|=i,v=h.alternate,v!==null&&(v.lanes|=i),Hc(h.return,i,e),l||(E=null);break e}h=v.next}}else if(u.tag===18){if(E=u.return,E===null)throw Error(s(341));E.lanes|=i,h=E.alternate,h!==null&&(h.lanes|=i),Hc(E,i,e),E=null}else E=u.child;if(E!==null)E.return=u;else for(E=u;E!==null;){if(E===e){E=null;break}if(u=E.sibling,u!==null){u.return=E.return,E=u;break}E=E.return}u=E}}function Ys(e,a,i,l){e=null;for(var u=a,h=!1;u!==null;){if(!h){if((u.flags&524288)!==0)h=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var E=u.alternate;if(E===null)throw Error(s(387));if(E=E.memoizedProps,E!==null){var v=u.type;ei(u.pendingProps.value,E.value)||(e!==null?e.push(v):e=[v])}}else if(u===be.current){if(E=u.alternate,E===null)throw Error(s(387));E.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(nr):e=[nr])}u=u.return}e!==null&&Gc(a,e,i,l),a.flags|=262144}function Ir(e){for(e=e.firstContext;e!==null;){if(!ei(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function rs(e){ls=e,$i=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ya(e){return Gd(ls,e)}function Br(e,a){return ls===null&&rs(e),Gd(e,a)}function Gd(e,a){var i=a._currentValue;if(a={context:a,memoizedValue:i,next:null},$i===null){if(e===null)throw Error(s(308));$i=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else $i=$i.next=a;return i}var Bm=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(i,l){e.push(l)}};this.abort=function(){a.aborted=!0,e.forEach(function(i){return i()})}},Fm=c.unstable_scheduleCallback,Hm=c.unstable_NormalPriority,ea={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Yc(){return{controller:new Bm,data:new Map,refCount:0}}function Cl(e){e.refCount--,e.refCount===0&&Fm(Hm,function(){e.controller.abort()})}var Pl=null,Uc=0,Us=0,zs=null;function Gm(e,a){if(Pl===null){var i=Pl=[];Uc=0,Us=Vu(),zs={status:"pending",value:void 0,then:function(l){i.push(l)}}}return Uc++,a.then(Yd,Yd),a}function Yd(){if(--Uc===0&&Pl!==null){zs!==null&&(zs.status="fulfilled");var e=Pl;Pl=null,Us=0,zs=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function Ym(e,a){var i=[],l={status:"pending",value:null,reason:null,then:function(u){i.push(u)}};return e.then(function(){l.status="fulfilled",l.value=a;for(var u=0;u<i.length;u++)(0,i[u])(a)},function(u){for(l.status="rejected",l.reason=u,u=0;u<i.length;u++)(0,i[u])(void 0)}),l}var Ud=U.S;U.S=function(e,a){M0=ga(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&Gm(e,a),Ud!==null&&Ud(e,a)};var os=P(null);function zc(){var e=os.current;return e!==null?e:Ct.pooledCache}function Fr(e,a){a===null?le(os,os.current):le(os,a.pool)}function zd(){var e=zc();return e===null?null:{parent:ea._currentValue,pool:e}}var ks=Error(s(460)),kc=Error(s(474)),Hr=Error(s(542)),Gr={then:function(){}};function kd(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Vd(e,a,i){switch(i=e[i],i===void 0?e.push(a):i!==a&&(a.then(Ja,Ja),a=i),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Xd(e),e;default:if(typeof a.status=="string")a.then(Ja,Ja);else{if(e=Ct,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=a,e.status="pending",e.then(function(l){if(a.status==="pending"){var u=a;u.status="fulfilled",u.value=l}},function(l){if(a.status==="pending"){var u=a;u.status="rejected",u.reason=l}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Xd(e),e}throw us=a,ks}}function cs(e){try{var a=e._init;return a(e._payload)}catch(i){throw i!==null&&typeof i=="object"&&typeof i.then=="function"?(us=i,ks):i}}var us=null;function Wd(){if(us===null)throw Error(s(459));var e=us;return us=null,e}function Xd(e){if(e===ks||e===Hr)throw Error(s(483))}var Vs=null,wl=0;function Yr(e){var a=wl;return wl+=1,Vs===null&&(Vs=[]),Vd(Vs,e,a)}function Il(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function Ur(e,a){throw a.$$typeof===S?Error(s(525)):(e=Object.prototype.toString.call(a),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function jd(e){function a(H,B){if(e){var z=H.deletions;z===null?(H.deletions=[B],H.flags|=16):z.push(B)}}function i(H,B){if(!e)return null;for(;B!==null;)a(H,B),B=B.sibling;return null}function l(H){for(var B=new Map;H!==null;)H.key!==null?B.set(H.key,H):B.set(H.index,H),H=H.sibling;return B}function u(H,B){return H=Xi(H,B),H.index=0,H.sibling=null,H}function h(H,B,z){return H.index=z,e?(z=H.alternate,z!==null?(z=z.index,z<B?(H.flags|=67108866,B):z):(H.flags|=67108866,B)):(H.flags|=1048576,B)}function E(H){return e&&H.alternate===null&&(H.flags|=67108866),H}function v(H,B,z,ae){return B===null||B.tag!==6?(B=Dc(z,H.mode,ae),B.return=H,B):(B=u(B,z),B.return=H,B)}function C(H,B,z,ae){var De=z.type;return De===x?J(H,B,z.props.children,ae,z.key):B!==null&&(B.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===Q&&cs(De)===B.type)?(B=u(B,z.props),Il(B,z),B.return=H,B):(B=Pr(z.type,z.key,z.props,null,H.mode,ae),Il(B,z),B.return=H,B)}function k(H,B,z,ae){return B===null||B.tag!==4||B.stateNode.containerInfo!==z.containerInfo||B.stateNode.implementation!==z.implementation?(B=Cc(z,H.mode,ae),B.return=H,B):(B=u(B,z.children||[]),B.return=H,B)}function J(H,B,z,ae,De){return B===null||B.tag!==7?(B=ns(z,H.mode,ae,De),B.return=H,B):(B=u(B,z),B.return=H,B)}function ne(H,B,z){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Dc(""+B,H.mode,z),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case R:return z=Pr(B.type,B.key,B.props,null,H.mode,z),Il(z,B),z.return=H,z;case b:return B=Cc(B,H.mode,z),B.return=H,B;case Q:return B=cs(B),ne(H,B,z)}if(Je(B)||re(B))return B=ns(B,H.mode,z,null),B.return=H,B;if(typeof B.then=="function")return ne(H,Yr(B),z);if(B.$$typeof===I)return ne(H,Br(H,B),z);Ur(H,B)}return null}function X(H,B,z,ae){var De=B!==null?B.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return De!==null?null:v(H,B,""+z,ae);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case R:return z.key===De?C(H,B,z,ae):null;case b:return z.key===De?k(H,B,z,ae):null;case Q:return z=cs(z),X(H,B,z,ae)}if(Je(z)||re(z))return De!==null?null:J(H,B,z,ae,null);if(typeof z.then=="function")return X(H,B,Yr(z),ae);if(z.$$typeof===I)return X(H,B,Br(H,z),ae);Ur(H,z)}return null}function j(H,B,z,ae,De){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return H=H.get(z)||null,v(B,H,""+ae,De);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case R:return H=H.get(ae.key===null?z:ae.key)||null,C(B,H,ae,De);case b:return H=H.get(ae.key===null?z:ae.key)||null,k(B,H,ae,De);case Q:return ae=cs(ae),j(H,B,z,ae,De)}if(Je(ae)||re(ae))return H=H.get(z)||null,J(B,H,ae,De,null);if(typeof ae.then=="function")return j(H,B,z,Yr(ae),De);if(ae.$$typeof===I)return j(H,B,z,Br(B,ae),De);Ur(B,ae)}return null}function Re(H,B,z,ae){for(var De=null,mt=null,xe=B,at=B=0,ht=null;xe!==null&&at<z.length;at++){xe.index>at?(ht=xe,xe=null):ht=xe.sibling;var yt=X(H,xe,z[at],ae);if(yt===null){xe===null&&(xe=ht);break}e&&xe&&yt.alternate===null&&a(H,xe),B=h(yt,B,at),mt===null?De=yt:mt.sibling=yt,mt=yt,xe=ht}if(at===z.length)return i(H,xe),ft&&ji(H,at),De;if(xe===null){for(;at<z.length;at++)xe=ne(H,z[at],ae),xe!==null&&(B=h(xe,B,at),mt===null?De=xe:mt.sibling=xe,mt=xe);return ft&&ji(H,at),De}for(xe=l(xe);at<z.length;at++)ht=j(xe,H,at,z[at],ae),ht!==null&&(e&&ht.alternate!==null&&xe.delete(ht.key===null?at:ht.key),B=h(ht,B,at),mt===null?De=ht:mt.sibling=ht,mt=ht);return e&&xe.forEach(function(Fn){return a(H,Fn)}),ft&&ji(H,at),De}function Ie(H,B,z,ae){if(z==null)throw Error(s(151));for(var De=null,mt=null,xe=B,at=B=0,ht=null,yt=z.next();xe!==null&&!yt.done;at++,yt=z.next()){xe.index>at?(ht=xe,xe=null):ht=xe.sibling;var Fn=X(H,xe,yt.value,ae);if(Fn===null){xe===null&&(xe=ht);break}e&&xe&&Fn.alternate===null&&a(H,xe),B=h(Fn,B,at),mt===null?De=Fn:mt.sibling=Fn,mt=Fn,xe=ht}if(yt.done)return i(H,xe),ft&&ji(H,at),De;if(xe===null){for(;!yt.done;at++,yt=z.next())yt=ne(H,yt.value,ae),yt!==null&&(B=h(yt,B,at),mt===null?De=yt:mt.sibling=yt,mt=yt);return ft&&ji(H,at),De}for(xe=l(xe);!yt.done;at++,yt=z.next())yt=j(xe,H,at,yt.value,ae),yt!==null&&(e&&yt.alternate!==null&&xe.delete(yt.key===null?at:yt.key),B=h(yt,B,at),mt===null?De=yt:mt.sibling=yt,mt=yt);return e&&xe.forEach(function(K1){return a(H,K1)}),ft&&ji(H,at),De}function Dt(H,B,z,ae){if(typeof z=="object"&&z!==null&&z.type===x&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case R:e:{for(var De=z.key;B!==null;){if(B.key===De){if(De=z.type,De===x){if(B.tag===7){i(H,B.sibling),ae=u(B,z.props.children),ae.return=H,H=ae;break e}}else if(B.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===Q&&cs(De)===B.type){i(H,B.sibling),ae=u(B,z.props),Il(ae,z),ae.return=H,H=ae;break e}i(H,B);break}else a(H,B);B=B.sibling}z.type===x?(ae=ns(z.props.children,H.mode,ae,z.key),ae.return=H,H=ae):(ae=Pr(z.type,z.key,z.props,null,H.mode,ae),Il(ae,z),ae.return=H,H=ae)}return E(H);case b:e:{for(De=z.key;B!==null;){if(B.key===De)if(B.tag===4&&B.stateNode.containerInfo===z.containerInfo&&B.stateNode.implementation===z.implementation){i(H,B.sibling),ae=u(B,z.children||[]),ae.return=H,H=ae;break e}else{i(H,B);break}else a(H,B);B=B.sibling}ae=Cc(z,H.mode,ae),ae.return=H,H=ae}return E(H);case Q:return z=cs(z),Dt(H,B,z,ae)}if(Je(z))return Re(H,B,z,ae);if(re(z)){if(De=re(z),typeof De!="function")throw Error(s(150));return z=De.call(z),Ie(H,B,z,ae)}if(typeof z.then=="function")return Dt(H,B,Yr(z),ae);if(z.$$typeof===I)return Dt(H,B,Br(H,z),ae);Ur(H,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,B!==null&&B.tag===6?(i(H,B.sibling),ae=u(B,z),ae.return=H,H=ae):(i(H,B),ae=Dc(z,H.mode,ae),ae.return=H,H=ae),E(H)):i(H,B)}return function(H,B,z,ae){try{wl=0;var De=Dt(H,B,z,ae);return Vs=null,De}catch(xe){if(xe===ks||xe===Hr)throw xe;var mt=ti(29,xe,null,H.mode);return mt.lanes=ae,mt.return=H,mt}finally{}}}var hs=jd(!0),$d=jd(!1),An=!1;function Vc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wc(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Sn(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Tn(e,a,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(At&2)!==0){var u=l.pending;return u===null?a.next=a:(a.next=u.next,u.next=a),l.pending=a,a=Cr(e),Dd(e,null,i),a}return Dr(e,l,a,i),Cr(e)}function Bl(e,a,i){if(a=a.updateQueue,a!==null&&(a=a.shared,(i&4194048)!==0)){var l=a.lanes;l&=e.pendingLanes,i|=l,a.lanes=i,Tr(e,i)}}function Xc(e,a){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var u=null,h=null;if(i=i.firstBaseUpdate,i!==null){do{var E={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};h===null?u=h=E:h=h.next=E,i=i.next}while(i!==null);h===null?u=h=a:h=h.next=a}else u=h=a;i={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:h,shared:l.shared,callbacks:l.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=a:e.next=a,i.lastBaseUpdate=a}var jc=!1;function Fl(){if(jc){var e=zs;if(e!==null)throw e}}function Hl(e,a,i,l){jc=!1;var u=e.updateQueue;An=!1;var h=u.firstBaseUpdate,E=u.lastBaseUpdate,v=u.shared.pending;if(v!==null){u.shared.pending=null;var C=v,k=C.next;C.next=null,E===null?h=k:E.next=k,E=C;var J=e.alternate;J!==null&&(J=J.updateQueue,v=J.lastBaseUpdate,v!==E&&(v===null?J.firstBaseUpdate=k:v.next=k,J.lastBaseUpdate=C))}if(h!==null){var ne=u.baseState;E=0,J=k=C=null,v=h;do{var X=v.lane&-536870913,j=X!==v.lane;if(j?(ut&X)===X:(l&X)===X){X!==0&&X===Us&&(jc=!0),J!==null&&(J=J.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var Re=e,Ie=v;X=a;var Dt=i;switch(Ie.tag){case 1:if(Re=Ie.payload,typeof Re=="function"){ne=Re.call(Dt,ne,X);break e}ne=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Ie.payload,X=typeof Re=="function"?Re.call(Dt,ne,X):Re,X==null)break e;ne=_({},ne,X);break e;case 2:An=!0}}X=v.callback,X!==null&&(e.flags|=64,j&&(e.flags|=8192),j=u.callbacks,j===null?u.callbacks=[X]:j.push(X))}else j={lane:X,tag:v.tag,payload:v.payload,callback:v.callback,next:null},J===null?(k=J=j,C=ne):J=J.next=j,E|=X;if(v=v.next,v===null){if(v=u.shared.pending,v===null)break;j=v,v=j.next,j.next=null,u.lastBaseUpdate=j,u.shared.pending=null}}while(!0);J===null&&(C=ne),u.baseState=C,u.firstBaseUpdate=k,u.lastBaseUpdate=J,h===null&&(u.shared.lanes=0),On|=E,e.lanes=E,e.memoizedState=ne}}function qd(e,a){if(typeof e!="function")throw Error(s(191,e));e.call(a)}function Zd(e,a){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)qd(i[e],a)}var Ws=P(null),zr=P(0);function Kd(e,a){e=sn,le(zr,e),le(Ws,a),sn=e|a.baseLanes}function $c(){le(zr,sn),le(Ws,Ws.current)}function qc(){sn=zr.current,ee(Ws),ee(zr)}var ai=P(null),yi=null;function vn(e){var a=e.alternate;le(Kt,Kt.current&1),le(ai,e),yi===null&&(a===null||Ws.current!==null||a.memoizedState!==null)&&(yi=e)}function Zc(e){le(Kt,Kt.current),le(ai,e),yi===null&&(yi=e)}function Qd(e){e.tag===22?(le(Kt,Kt.current),le(ai,e),yi===null&&(yi=e)):Rn()}function Rn(){le(Kt,Kt.current),le(ai,ai.current)}function ii(e){ee(ai),yi===e&&(yi=null),ee(Kt)}var Kt=P(0);function kr(e){for(var a=e;a!==null;){if(a.tag===13){var i=a.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||ah(i)||ih(i)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Zi=0,Qe=null,Lt=null,ta=null,Vr=!1,Xs=!1,ds=!1,Wr=0,Gl=0,js=null,Um=0;function Xt(){throw Error(s(321))}function Kc(e,a){if(a===null)return!1;for(var i=0;i<a.length&&i<e.length;i++)if(!ei(e[i],a[i]))return!1;return!0}function Qc(e,a,i,l,u,h){return Zi=h,Qe=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,U.H=e===null||e.memoizedState===null?Bf:fu,ds=!1,h=i(l,u),ds=!1,Xs&&(h=ef(a,i,l,u)),Jd(e),h}function Jd(e){U.H=zl;var a=Lt!==null&&Lt.next!==null;if(Zi=0,ta=Lt=Qe=null,Vr=!1,Gl=0,js=null,a)throw Error(s(300));e===null||aa||(e=e.dependencies,e!==null&&Ir(e)&&(aa=!0))}function ef(e,a,i,l){Qe=e;var u=0;do{if(Xs&&(js=null),Gl=0,Xs=!1,25<=u)throw Error(s(301));if(u+=1,ta=Lt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}U.H=Ff,h=a(i,l)}while(Xs);return h}function zm(){var e=U.H,a=e.useState()[0];return a=typeof a.then=="function"?Yl(a):a,e=e.useState()[0],(Lt!==null?Lt.memoizedState:null)!==e&&(Qe.flags|=1024),a}function Jc(){var e=Wr!==0;return Wr=0,e}function eu(e,a,i){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~i}function tu(e){if(Vr){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}Vr=!1}Zi=0,ta=Lt=Qe=null,Xs=!1,Gl=Wr=0,js=null}function Pa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ta===null?Qe.memoizedState=ta=e:ta=ta.next=e,ta}function Qt(){if(Lt===null){var e=Qe.alternate;e=e!==null?e.memoizedState:null}else e=Lt.next;var a=ta===null?Qe.memoizedState:ta.next;if(a!==null)ta=a,Lt=e;else{if(e===null)throw Qe.alternate===null?Error(s(467)):Error(s(310));Lt=e,e={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},ta===null?Qe.memoizedState=ta=e:ta=ta.next=e}return ta}function Xr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yl(e){var a=Gl;return Gl+=1,js===null&&(js=[]),e=Vd(js,e,a),a=Qe,(ta===null?a.memoizedState:ta.next)===null&&(a=a.alternate,U.H=a===null||a.memoizedState===null?Bf:fu),e}function jr(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Yl(e);if(e.$$typeof===I)return ya(e)}throw Error(s(438,String(e)))}function au(e){var a=null,i=Qe.updateQueue;if(i!==null&&(a=i.memoCache),a==null){var l=Qe.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(a={data:l.data.map(function(u){return u.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),i===null&&(i=Xr(),Qe.updateQueue=i),i.memoCache=a,i=a.data[a.index],i===void 0)for(i=a.data[a.index]=Array(e),l=0;l<e;l++)i[l]=pe;return a.index++,i}function Ki(e,a){return typeof a=="function"?a(e):a}function $r(e){var a=Qt();return iu(a,Lt,e)}function iu(e,a,i){var l=e.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=i;var u=e.baseQueue,h=l.pending;if(h!==null){if(u!==null){var E=u.next;u.next=h.next,h.next=E}a.baseQueue=u=h,l.pending=null}if(h=e.baseState,u===null)e.memoizedState=h;else{a=u.next;var v=E=null,C=null,k=a,J=!1;do{var ne=k.lane&-536870913;if(ne!==k.lane?(ut&ne)===ne:(Zi&ne)===ne){var X=k.revertLane;if(X===0)C!==null&&(C=C.next={lane:0,revertLane:0,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),ne===Us&&(J=!0);else if((Zi&X)===X){k=k.next,X===Us&&(J=!0);continue}else ne={lane:0,revertLane:k.revertLane,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},C===null?(v=C=ne,E=h):C=C.next=ne,Qe.lanes|=X,On|=X;ne=k.action,ds&&i(h,ne),h=k.hasEagerState?k.eagerState:i(h,ne)}else X={lane:ne,revertLane:k.revertLane,gesture:k.gesture,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},C===null?(v=C=X,E=h):C=C.next=X,Qe.lanes|=ne,On|=ne;k=k.next}while(k!==null&&k!==a);if(C===null?E=h:C.next=v,!ei(h,e.memoizedState)&&(aa=!0,J&&(i=zs,i!==null)))throw i;e.memoizedState=h,e.baseState=E,e.baseQueue=C,l.lastRenderedState=h}return u===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function nu(e){var a=Qt(),i=a.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=e;var l=i.dispatch,u=i.pending,h=a.memoizedState;if(u!==null){i.pending=null;var E=u=u.next;do h=e(h,E.action),E=E.next;while(E!==u);ei(h,a.memoizedState)||(aa=!0),a.memoizedState=h,a.baseQueue===null&&(a.baseState=h),i.lastRenderedState=h}return[h,l]}function tf(e,a,i){var l=Qe,u=Qt(),h=ft;if(h){if(i===void 0)throw Error(s(407));i=i()}else i=a();var E=!ei((Lt||u).memoizedState,i);if(E&&(u.memoizedState=i,aa=!0),u=u.queue,ru(sf.bind(null,l,u,e),[e]),u.getSnapshot!==a||E||ta!==null&&ta.memoizedState.tag&1){if(l.flags|=2048,$s(9,{destroy:void 0},nf.bind(null,l,u,i,a),null),Ct===null)throw Error(s(349));h||(Zi&127)!==0||af(l,a,i)}return i}function af(e,a,i){e.flags|=16384,e={getSnapshot:a,value:i},a=Qe.updateQueue,a===null?(a=Xr(),Qe.updateQueue=a,a.stores=[e]):(i=a.stores,i===null?a.stores=[e]:i.push(e))}function nf(e,a,i,l){a.value=i,a.getSnapshot=l,lf(a)&&rf(e)}function sf(e,a,i){return i(function(){lf(a)&&rf(e)})}function lf(e){var a=e.getSnapshot;e=e.value;try{var i=a();return!ei(e,i)}catch{return!0}}function rf(e){var a=is(e,2);a!==null&&Va(a,e,2)}function su(e){var a=Pa();if(typeof e=="function"){var i=e;if(e=i(),ds){Ba(!0);try{i()}finally{Ba(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ki,lastRenderedState:e},a}function of(e,a,i,l){return e.baseState=i,iu(e,Lt,typeof l=="function"?l:Ki)}function km(e,a,i,l,u){if(Kr(e))throw Error(s(485));if(e=a.action,e!==null){var h={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){h.listeners.push(E)}};U.T!==null?i(!0):h.isTransition=!1,l(h),i=a.pending,i===null?(h.next=a.pending=h,cf(a,h)):(h.next=i.next,a.pending=i.next=h)}}function cf(e,a){var i=a.action,l=a.payload,u=e.state;if(a.isTransition){var h=U.T,E={};U.T=E;try{var v=i(u,l),C=U.S;C!==null&&C(E,v),uf(e,a,v)}catch(k){lu(e,a,k)}finally{h!==null&&E.types!==null&&(h.types=E.types),U.T=h}}else try{h=i(u,l),uf(e,a,h)}catch(k){lu(e,a,k)}}function uf(e,a,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(l){hf(e,a,l)},function(l){return lu(e,a,l)}):hf(e,a,i)}function hf(e,a,i){a.status="fulfilled",a.value=i,df(a),e.state=i,a=e.pending,a!==null&&(i=a.next,i===a?e.pending=null:(i=i.next,a.next=i,cf(e,i)))}function lu(e,a,i){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do a.status="rejected",a.reason=i,df(a),a=a.next;while(a!==l)}e.action=null}function df(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function ff(e,a){return a}function gf(e,a){if(ft){var i=Ct.formState;if(i!==null){e:{var l=Qe;if(ft){if(Ht){t:{for(var u=Ht,h=mi;u.nodeType!==8;){if(!h){u=null;break t}if(u=Ei(u.nextSibling),u===null){u=null;break t}}h=u.data,u=h==="F!"||h==="F"?u:null}if(u){Ht=Ei(u.nextSibling),l=u.data==="F!";break e}}En(l)}l=!1}l&&(a=i[0])}}return i=Pa(),i.memoizedState=i.baseState=a,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ff,lastRenderedState:a},i.queue=l,i=Pf.bind(null,Qe,l),l.dispatch=i,l=su(!1),h=du.bind(null,Qe,!1,l.queue),l=Pa(),u={state:a,dispatch:null,action:e,pending:null},l.queue=u,i=km.bind(null,Qe,u,h,i),u.dispatch=i,l.memoizedState=e,[a,i,!1]}function pf(e){var a=Qt();return mf(a,Lt,e)}function mf(e,a,i){if(a=iu(e,a,ff)[0],e=$r(Ki)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var l=Yl(a)}catch(E){throw E===ks?Hr:E}else l=a;a=Qt();var u=a.queue,h=u.dispatch;return i!==a.memoizedState&&(Qe.flags|=2048,$s(9,{destroy:void 0},Vm.bind(null,u,i),null)),[l,h,e]}function Vm(e,a){e.action=a}function yf(e){var a=Qt(),i=Lt;if(i!==null)return mf(a,i,e);Qt(),a=a.memoizedState,i=Qt();var l=i.queue.dispatch;return i.memoizedState=e,[a,l,!1]}function $s(e,a,i,l){return e={tag:e,create:i,deps:l,inst:a,next:null},a=Qe.updateQueue,a===null&&(a=Xr(),Qe.updateQueue=a),i=a.lastEffect,i===null?a.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,a.lastEffect=e),e}function Ef(){return Qt().memoizedState}function qr(e,a,i,l){var u=Pa();Qe.flags|=e,u.memoizedState=$s(1|a,{destroy:void 0},i,l===void 0?null:l)}function Zr(e,a,i,l){var u=Qt();l=l===void 0?null:l;var h=u.memoizedState.inst;Lt!==null&&l!==null&&Kc(l,Lt.memoizedState.deps)?u.memoizedState=$s(a,h,i,l):(Qe.flags|=e,u.memoizedState=$s(1|a,h,i,l))}function _f(e,a){qr(8390656,8,e,a)}function ru(e,a){Zr(2048,8,e,a)}function Wm(e){Qe.flags|=4;var a=Qe.updateQueue;if(a===null)a=Xr(),Qe.updateQueue=a,a.events=[e];else{var i=a.events;i===null?a.events=[e]:i.push(e)}}function Af(e){var a=Qt().memoizedState;return Wm({ref:a,nextImpl:e}),function(){if((At&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}function Sf(e,a){return Zr(4,2,e,a)}function Tf(e,a){return Zr(4,4,e,a)}function vf(e,a){if(typeof a=="function"){e=e();var i=a(e);return function(){typeof i=="function"?i():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function Rf(e,a,i){i=i!=null?i.concat([e]):null,Zr(4,4,vf.bind(null,a,e),i)}function ou(){}function Mf(e,a){var i=Qt();a=a===void 0?null:a;var l=i.memoizedState;return a!==null&&Kc(a,l[1])?l[0]:(i.memoizedState=[e,a],e)}function bf(e,a){var i=Qt();a=a===void 0?null:a;var l=i.memoizedState;if(a!==null&&Kc(a,l[1]))return l[0];if(l=e(),ds){Ba(!0);try{e()}finally{Ba(!1)}}return i.memoizedState=[l,a],l}function cu(e,a,i){return i===void 0||(Zi&1073741824)!==0&&(ut&261930)===0?e.memoizedState=a:(e.memoizedState=i,e=O0(),Qe.lanes|=e,On|=e,i)}function Of(e,a,i,l){return ei(i,a)?i:Ws.current!==null?(e=cu(e,i,l),ei(e,a)||(aa=!0),e):(Zi&42)===0||(Zi&1073741824)!==0&&(ut&261930)===0?(aa=!0,e.memoizedState=i):(e=O0(),Qe.lanes|=e,On|=e,a)}function xf(e,a,i,l,u){var h=se.p;se.p=h!==0&&8>h?h:8;var E=U.T,v={};U.T=v,du(e,!1,a,i);try{var C=u(),k=U.S;if(k!==null&&k(v,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var J=Ym(C,l);Ul(e,a,J,li(e))}else Ul(e,a,l,li(e))}catch(ne){Ul(e,a,{then:function(){},status:"rejected",reason:ne},li())}finally{se.p=h,E!==null&&v.types!==null&&(E.types=v.types),U.T=E}}function Xm(){}function uu(e,a,i,l){if(e.tag!==5)throw Error(s(476));var u=Lf(e).queue;xf(e,u,a,ye,i===null?Xm:function(){return Nf(e),i(l)})}function Lf(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:ye,baseState:ye,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ki,lastRenderedState:ye},next:null};var i={};return a.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ki,lastRenderedState:i},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function Nf(e){var a=Lf(e);a.next===null&&(a=e.alternate.memoizedState),Ul(e,a.next.queue,{},li())}function hu(){return ya(nr)}function Df(){return Qt().memoizedState}function Cf(){return Qt().memoizedState}function jm(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var i=li();e=Sn(i);var l=Tn(a,e,i);l!==null&&(Va(l,a,i),Bl(l,a,i)),a={cache:Yc()},e.payload=a;return}a=a.return}}function $m(e,a,i){var l=li();i={lane:l,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Kr(e)?wf(a,i):(i=Lc(e,a,i,l),i!==null&&(Va(i,e,l),If(i,a,l)))}function Pf(e,a,i){var l=li();Ul(e,a,i,l)}function Ul(e,a,i,l){var u={lane:l,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null};if(Kr(e))wf(a,u);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=a.lastRenderedReducer,h!==null))try{var E=a.lastRenderedState,v=h(E,i);if(u.hasEagerState=!0,u.eagerState=v,ei(v,E))return Dr(e,a,u,0),Ct===null&&Nr(),!1}catch{}finally{}if(i=Lc(e,a,u,l),i!==null)return Va(i,e,l),If(i,a,l),!0}return!1}function du(e,a,i,l){if(l={lane:2,revertLane:Vu(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Kr(e)){if(a)throw Error(s(479))}else a=Lc(e,i,l,2),a!==null&&Va(a,e,2)}function Kr(e){var a=e.alternate;return e===Qe||a!==null&&a===Qe}function wf(e,a){Xs=Vr=!0;var i=e.pending;i===null?a.next=a:(a.next=i.next,i.next=a),e.pending=a}function If(e,a,i){if((i&4194048)!==0){var l=a.lanes;l&=e.pendingLanes,i|=l,a.lanes=i,Tr(e,i)}}var zl={readContext:ya,use:jr,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useLayoutEffect:Xt,useInsertionEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useSyncExternalStore:Xt,useId:Xt,useHostTransitionStatus:Xt,useFormState:Xt,useActionState:Xt,useOptimistic:Xt,useMemoCache:Xt,useCacheRefresh:Xt};zl.useEffectEvent=Xt;var Bf={readContext:ya,use:jr,useCallback:function(e,a){return Pa().memoizedState=[e,a===void 0?null:a],e},useContext:ya,useEffect:_f,useImperativeHandle:function(e,a,i){i=i!=null?i.concat([e]):null,qr(4194308,4,vf.bind(null,a,e),i)},useLayoutEffect:function(e,a){return qr(4194308,4,e,a)},useInsertionEffect:function(e,a){qr(4,2,e,a)},useMemo:function(e,a){var i=Pa();a=a===void 0?null:a;var l=e();if(ds){Ba(!0);try{e()}finally{Ba(!1)}}return i.memoizedState=[l,a],l},useReducer:function(e,a,i){var l=Pa();if(i!==void 0){var u=i(a);if(ds){Ba(!0);try{i(a)}finally{Ba(!1)}}}else u=a;return l.memoizedState=l.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},l.queue=e,e=e.dispatch=$m.bind(null,Qe,e),[l.memoizedState,e]},useRef:function(e){var a=Pa();return e={current:e},a.memoizedState=e},useState:function(e){e=su(e);var a=e.queue,i=Pf.bind(null,Qe,a);return a.dispatch=i,[e.memoizedState,i]},useDebugValue:ou,useDeferredValue:function(e,a){var i=Pa();return cu(i,e,a)},useTransition:function(){var e=su(!1);return e=xf.bind(null,Qe,e.queue,!0,!1),Pa().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,i){var l=Qe,u=Pa();if(ft){if(i===void 0)throw Error(s(407));i=i()}else{if(i=a(),Ct===null)throw Error(s(349));(ut&127)!==0||af(l,a,i)}u.memoizedState=i;var h={value:i,getSnapshot:a};return u.queue=h,_f(sf.bind(null,l,h,e),[e]),l.flags|=2048,$s(9,{destroy:void 0},nf.bind(null,l,h,i,a),null),i},useId:function(){var e=Pa(),a=Ct.identifierPrefix;if(ft){var i=wi,l=Pi;i=(l&~(1<<32-Ca(l)-1)).toString(32)+i,a="_"+a+"R_"+i,i=Wr++,0<i&&(a+="H"+i.toString(32)),a+="_"}else i=Um++,a="_"+a+"r_"+i.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:hu,useFormState:gf,useActionState:gf,useOptimistic:function(e){var a=Pa();a.memoizedState=a.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=i,a=du.bind(null,Qe,!0,i),i.dispatch=a,[e,a]},useMemoCache:au,useCacheRefresh:function(){return Pa().memoizedState=jm.bind(null,Qe)},useEffectEvent:function(e){var a=Pa(),i={impl:e};return a.memoizedState=i,function(){if((At&2)!==0)throw Error(s(440));return i.impl.apply(void 0,arguments)}}},fu={readContext:ya,use:jr,useCallback:Mf,useContext:ya,useEffect:ru,useImperativeHandle:Rf,useInsertionEffect:Sf,useLayoutEffect:Tf,useMemo:bf,useReducer:$r,useRef:Ef,useState:function(){return $r(Ki)},useDebugValue:ou,useDeferredValue:function(e,a){var i=Qt();return Of(i,Lt.memoizedState,e,a)},useTransition:function(){var e=$r(Ki)[0],a=Qt().memoizedState;return[typeof e=="boolean"?e:Yl(e),a]},useSyncExternalStore:tf,useId:Df,useHostTransitionStatus:hu,useFormState:pf,useActionState:pf,useOptimistic:function(e,a){var i=Qt();return of(i,Lt,e,a)},useMemoCache:au,useCacheRefresh:Cf};fu.useEffectEvent=Af;var Ff={readContext:ya,use:jr,useCallback:Mf,useContext:ya,useEffect:ru,useImperativeHandle:Rf,useInsertionEffect:Sf,useLayoutEffect:Tf,useMemo:bf,useReducer:nu,useRef:Ef,useState:function(){return nu(Ki)},useDebugValue:ou,useDeferredValue:function(e,a){var i=Qt();return Lt===null?cu(i,e,a):Of(i,Lt.memoizedState,e,a)},useTransition:function(){var e=nu(Ki)[0],a=Qt().memoizedState;return[typeof e=="boolean"?e:Yl(e),a]},useSyncExternalStore:tf,useId:Df,useHostTransitionStatus:hu,useFormState:yf,useActionState:yf,useOptimistic:function(e,a){var i=Qt();return Lt!==null?of(i,Lt,e,a):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:au,useCacheRefresh:Cf};Ff.useEffectEvent=Af;function gu(e,a,i,l){a=e.memoizedState,i=i(l,a),i=i==null?a:_({},a,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var pu={enqueueSetState:function(e,a,i){e=e._reactInternals;var l=li(),u=Sn(l);u.payload=a,i!=null&&(u.callback=i),a=Tn(e,u,l),a!==null&&(Va(a,e,l),Bl(a,e,l))},enqueueReplaceState:function(e,a,i){e=e._reactInternals;var l=li(),u=Sn(l);u.tag=1,u.payload=a,i!=null&&(u.callback=i),a=Tn(e,u,l),a!==null&&(Va(a,e,l),Bl(a,e,l))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var i=li(),l=Sn(i);l.tag=2,a!=null&&(l.callback=a),a=Tn(e,l,i),a!==null&&(Va(a,e,i),Bl(a,e,i))}};function Hf(e,a,i,l,u,h,E){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,h,E):a.prototype&&a.prototype.isPureReactComponent?!xl(i,l)||!xl(u,h):!0}function Gf(e,a,i,l){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(i,l),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(i,l),a.state!==e&&pu.enqueueReplaceState(a,a.state,null)}function fs(e,a){var i=a;if("ref"in a){i={};for(var l in a)l!=="ref"&&(i[l]=a[l])}if(e=e.defaultProps){i===a&&(i=_({},i));for(var u in e)i[u]===void 0&&(i[u]=e[u])}return i}function Yf(e){Lr(e)}function Uf(e){console.error(e)}function zf(e){Lr(e)}function Qr(e,a){try{var i=e.onUncaughtError;i(a.value,{componentStack:a.stack})}catch(l){setTimeout(function(){throw l})}}function kf(e,a,i){try{var l=e.onCaughtError;l(i.value,{componentStack:i.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function mu(e,a,i){return i=Sn(i),i.tag=3,i.payload={element:null},i.callback=function(){Qr(e,a)},i}function Vf(e){return e=Sn(e),e.tag=3,e}function Wf(e,a,i,l){var u=i.type.getDerivedStateFromError;if(typeof u=="function"){var h=l.value;e.payload=function(){return u(h)},e.callback=function(){kf(a,i,l)}}var E=i.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(e.callback=function(){kf(a,i,l),typeof u!="function"&&(xn===null?xn=new Set([this]):xn.add(this));var v=l.stack;this.componentDidCatch(l.value,{componentStack:v!==null?v:""})})}function qm(e,a,i,l,u){if(i.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(a=i.alternate,a!==null&&Ys(a,i,u,!0),i=ai.current,i!==null){switch(i.tag){case 31:case 13:return yi===null?uo():i.alternate===null&&jt===0&&(jt=3),i.flags&=-257,i.flags|=65536,i.lanes=u,l===Gr?i.flags|=16384:(a=i.updateQueue,a===null?i.updateQueue=new Set([l]):a.add(l),Uu(e,l,u)),!1;case 22:return i.flags|=65536,l===Gr?i.flags|=16384:(a=i.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([l])},i.updateQueue=a):(i=a.retryQueue,i===null?a.retryQueue=new Set([l]):i.add(l)),Uu(e,l,u)),!1}throw Error(s(435,i.tag))}return Uu(e,l,u),uo(),!1}if(ft)return a=ai.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=u,l!==Ic&&(e=Error(s(422),{cause:l}),Dl(fi(e,i)))):(l!==Ic&&(a=Error(s(423),{cause:l}),Dl(fi(a,i))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,l=fi(l,i),u=mu(e.stateNode,l,u),Xc(e,u),jt!==4&&(jt=2)),!1;var h=Error(s(520),{cause:l});if(h=fi(h,i),Zl===null?Zl=[h]:Zl.push(h),jt!==4&&(jt=2),a===null)return!0;l=fi(l,i),i=a;do{switch(i.tag){case 3:return i.flags|=65536,e=u&-u,i.lanes|=e,e=mu(i.stateNode,l,e),Xc(i,e),!1;case 1:if(a=i.type,h=i.stateNode,(i.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(xn===null||!xn.has(h))))return i.flags|=65536,u&=-u,i.lanes|=u,u=Vf(u),Wf(u,e,i,l),Xc(i,u),!1}i=i.return}while(i!==null);return!1}var yu=Error(s(461)),aa=!1;function Ea(e,a,i,l){a.child=e===null?$d(a,null,i,l):hs(a,e.child,i,l)}function Xf(e,a,i,l,u){i=i.render;var h=a.ref;if("ref"in l){var E={};for(var v in l)v!=="ref"&&(E[v]=l[v])}else E=l;return rs(a),l=Qc(e,a,i,E,h,u),v=Jc(),e!==null&&!aa?(eu(e,a,u),Qi(e,a,u)):(ft&&v&&Pc(a),a.flags|=1,Ea(e,a,l,u),a.child)}function jf(e,a,i,l,u){if(e===null){var h=i.type;return typeof h=="function"&&!Nc(h)&&h.defaultProps===void 0&&i.compare===null?(a.tag=15,a.type=h,$f(e,a,h,l,u)):(e=Pr(i.type,null,l,a,a.mode,u),e.ref=a.ref,e.return=a,a.child=e)}if(h=e.child,!Mu(e,u)){var E=h.memoizedProps;if(i=i.compare,i=i!==null?i:xl,i(E,l)&&e.ref===a.ref)return Qi(e,a,u)}return a.flags|=1,e=Xi(h,l),e.ref=a.ref,e.return=a,a.child=e}function $f(e,a,i,l,u){if(e!==null){var h=e.memoizedProps;if(xl(h,l)&&e.ref===a.ref)if(aa=!1,a.pendingProps=l=h,Mu(e,u))(e.flags&131072)!==0&&(aa=!0);else return a.lanes=e.lanes,Qi(e,a,u)}return Eu(e,a,i,l,u)}function qf(e,a,i,l){var u=l.children,h=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((a.flags&128)!==0){if(h=h!==null?h.baseLanes|i:i,e!==null){for(l=a.child=e.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~h}else l=0,a.child=null;return Zf(e,a,h,i,l)}if((i&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&Fr(a,h!==null?h.cachePool:null),h!==null?Kd(a,h):$c(),Qd(a);else return l=a.lanes=536870912,Zf(e,a,h!==null?h.baseLanes|i:i,i,l)}else h!==null?(Fr(a,h.cachePool),Kd(a,h),Rn(),a.memoizedState=null):(e!==null&&Fr(a,null),$c(),Rn());return Ea(e,a,u,i),a.child}function kl(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Zf(e,a,i,l,u){var h=zc();return h=h===null?null:{parent:ea._currentValue,pool:h},a.memoizedState={baseLanes:i,cachePool:h},e!==null&&Fr(a,null),$c(),Qd(a),e!==null&&Ys(e,a,l,!0),a.childLanes=u,null}function Jr(e,a){return a=to({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function Kf(e,a,i){return hs(a,e.child,null,i),e=Jr(a,a.pendingProps),e.flags|=2,ii(a),a.memoizedState=null,e}function Zm(e,a,i){var l=a.pendingProps,u=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(ft){if(l.mode==="hidden")return e=Jr(a,l),a.lanes=536870912,kl(null,e);if(Zc(a),(e=Ht)?(e=cg(e,mi),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:mn!==null?{id:Pi,overflow:wi}:null,retryLane:536870912,hydrationErrors:null},i=Pd(e),i.return=a,a.child=i,ma=a,Ht=null)):e=null,e===null)throw En(a);return a.lanes=536870912,null}return Jr(a,l)}var h=e.memoizedState;if(h!==null){var E=h.dehydrated;if(Zc(a),u)if(a.flags&256)a.flags&=-257,a=Kf(e,a,i);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(s(558));else if(aa||Ys(e,a,i,!1),u=(i&e.childLanes)!==0,aa||u){if(l=Ct,l!==null&&(E=xs(l,i),E!==0&&E!==h.retryLane))throw h.retryLane=E,is(e,E),Va(l,e,E),yu;uo(),a=Kf(e,a,i)}else e=h.treeContext,Ht=Ei(E.nextSibling),ma=a,ft=!0,yn=null,mi=!1,e!==null&&Bd(a,e),a=Jr(a,l),a.flags|=4096;return a}return e=Xi(e.child,{mode:l.mode,children:l.children}),e.ref=a.ref,a.child=e,e.return=a,e}function eo(e,a){var i=a.ref;if(i===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(e===null||e.ref!==i)&&(a.flags|=4194816)}}function Eu(e,a,i,l,u){return rs(a),i=Qc(e,a,i,l,void 0,u),l=Jc(),e!==null&&!aa?(eu(e,a,u),Qi(e,a,u)):(ft&&l&&Pc(a),a.flags|=1,Ea(e,a,i,u),a.child)}function Qf(e,a,i,l,u,h){return rs(a),a.updateQueue=null,i=ef(a,l,i,u),Jd(e),l=Jc(),e!==null&&!aa?(eu(e,a,h),Qi(e,a,h)):(ft&&l&&Pc(a),a.flags|=1,Ea(e,a,i,h),a.child)}function Jf(e,a,i,l,u){if(rs(a),a.stateNode===null){var h=Bs,E=i.contextType;typeof E=="object"&&E!==null&&(h=ya(E)),h=new i(l,h),a.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=pu,a.stateNode=h,h._reactInternals=a,h=a.stateNode,h.props=l,h.state=a.memoizedState,h.refs={},Vc(a),E=i.contextType,h.context=typeof E=="object"&&E!==null?ya(E):Bs,h.state=a.memoizedState,E=i.getDerivedStateFromProps,typeof E=="function"&&(gu(a,i,E,l),h.state=a.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(E=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),E!==h.state&&pu.enqueueReplaceState(h,h.state,null),Hl(a,l,h,u),Fl(),h.state=a.memoizedState),typeof h.componentDidMount=="function"&&(a.flags|=4194308),l=!0}else if(e===null){h=a.stateNode;var v=a.memoizedProps,C=fs(i,v);h.props=C;var k=h.context,J=i.contextType;E=Bs,typeof J=="object"&&J!==null&&(E=ya(J));var ne=i.getDerivedStateFromProps;J=typeof ne=="function"||typeof h.getSnapshotBeforeUpdate=="function",v=a.pendingProps!==v,J||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(v||k!==E)&&Gf(a,h,l,E),An=!1;var X=a.memoizedState;h.state=X,Hl(a,l,h,u),Fl(),k=a.memoizedState,v||X!==k||An?(typeof ne=="function"&&(gu(a,i,ne,l),k=a.memoizedState),(C=An||Hf(a,i,C,l,X,k,E))?(J||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(a.flags|=4194308)):(typeof h.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=l,a.memoizedState=k),h.props=l,h.state=k,h.context=E,l=C):(typeof h.componentDidMount=="function"&&(a.flags|=4194308),l=!1)}else{h=a.stateNode,Wc(e,a),E=a.memoizedProps,J=fs(i,E),h.props=J,ne=a.pendingProps,X=h.context,k=i.contextType,C=Bs,typeof k=="object"&&k!==null&&(C=ya(k)),v=i.getDerivedStateFromProps,(k=typeof v=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(E!==ne||X!==C)&&Gf(a,h,l,C),An=!1,X=a.memoizedState,h.state=X,Hl(a,l,h,u),Fl();var j=a.memoizedState;E!==ne||X!==j||An||e!==null&&e.dependencies!==null&&Ir(e.dependencies)?(typeof v=="function"&&(gu(a,i,v,l),j=a.memoizedState),(J=An||Hf(a,i,J,l,X,j,C)||e!==null&&e.dependencies!==null&&Ir(e.dependencies))?(k||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(l,j,C),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(l,j,C)),typeof h.componentDidUpdate=="function"&&(a.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof h.componentDidUpdate!="function"||E===e.memoizedProps&&X===e.memoizedState||(a.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||E===e.memoizedProps&&X===e.memoizedState||(a.flags|=1024),a.memoizedProps=l,a.memoizedState=j),h.props=l,h.state=j,h.context=C,l=J):(typeof h.componentDidUpdate!="function"||E===e.memoizedProps&&X===e.memoizedState||(a.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||E===e.memoizedProps&&X===e.memoizedState||(a.flags|=1024),l=!1)}return h=l,eo(e,a),l=(a.flags&128)!==0,h||l?(h=a.stateNode,i=l&&typeof i.getDerivedStateFromError!="function"?null:h.render(),a.flags|=1,e!==null&&l?(a.child=hs(a,e.child,null,u),a.child=hs(a,null,i,u)):Ea(e,a,i,u),a.memoizedState=h.state,e=a.child):e=Qi(e,a,u),e}function e0(e,a,i,l){return ss(),a.flags|=256,Ea(e,a,i,l),a.child}var _u={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Au(e){return{baseLanes:e,cachePool:zd()}}function Su(e,a,i){return e=e!==null?e.childLanes&~i:0,a&&(e|=si),e}function t0(e,a,i){var l=a.pendingProps,u=!1,h=(a.flags&128)!==0,E;if((E=h)||(E=e!==null&&e.memoizedState===null?!1:(Kt.current&2)!==0),E&&(u=!0,a.flags&=-129),E=(a.flags&32)!==0,a.flags&=-33,e===null){if(ft){if(u?vn(a):Rn(),(e=Ht)?(e=cg(e,mi),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:mn!==null?{id:Pi,overflow:wi}:null,retryLane:536870912,hydrationErrors:null},i=Pd(e),i.return=a,a.child=i,ma=a,Ht=null)):e=null,e===null)throw En(a);return ih(e)?a.lanes=32:a.lanes=536870912,null}var v=l.children;return l=l.fallback,u?(Rn(),u=a.mode,v=to({mode:"hidden",children:v},u),l=ns(l,u,i,null),v.return=a,l.return=a,v.sibling=l,a.child=v,l=a.child,l.memoizedState=Au(i),l.childLanes=Su(e,E,i),a.memoizedState=_u,kl(null,l)):(vn(a),Tu(a,v))}var C=e.memoizedState;if(C!==null&&(v=C.dehydrated,v!==null)){if(h)a.flags&256?(vn(a),a.flags&=-257,a=vu(e,a,i)):a.memoizedState!==null?(Rn(),a.child=e.child,a.flags|=128,a=null):(Rn(),v=l.fallback,u=a.mode,l=to({mode:"visible",children:l.children},u),v=ns(v,u,i,null),v.flags|=2,l.return=a,v.return=a,l.sibling=v,a.child=l,hs(a,e.child,null,i),l=a.child,l.memoizedState=Au(i),l.childLanes=Su(e,E,i),a.memoizedState=_u,a=kl(null,l));else if(vn(a),ih(v)){if(E=v.nextSibling&&v.nextSibling.dataset,E)var k=E.dgst;E=k,l=Error(s(419)),l.stack="",l.digest=E,Dl({value:l,source:null,stack:null}),a=vu(e,a,i)}else if(aa||Ys(e,a,i,!1),E=(i&e.childLanes)!==0,aa||E){if(E=Ct,E!==null&&(l=xs(E,i),l!==0&&l!==C.retryLane))throw C.retryLane=l,is(e,l),Va(E,e,l),yu;ah(v)||uo(),a=vu(e,a,i)}else ah(v)?(a.flags|=192,a.child=e.child,a=null):(e=C.treeContext,Ht=Ei(v.nextSibling),ma=a,ft=!0,yn=null,mi=!1,e!==null&&Bd(a,e),a=Tu(a,l.children),a.flags|=4096);return a}return u?(Rn(),v=l.fallback,u=a.mode,C=e.child,k=C.sibling,l=Xi(C,{mode:"hidden",children:l.children}),l.subtreeFlags=C.subtreeFlags&65011712,k!==null?v=Xi(k,v):(v=ns(v,u,i,null),v.flags|=2),v.return=a,l.return=a,l.sibling=v,a.child=l,kl(null,l),l=a.child,v=e.child.memoizedState,v===null?v=Au(i):(u=v.cachePool,u!==null?(C=ea._currentValue,u=u.parent!==C?{parent:C,pool:C}:u):u=zd(),v={baseLanes:v.baseLanes|i,cachePool:u}),l.memoizedState=v,l.childLanes=Su(e,E,i),a.memoizedState=_u,kl(e.child,l)):(vn(a),i=e.child,e=i.sibling,i=Xi(i,{mode:"visible",children:l.children}),i.return=a,i.sibling=null,e!==null&&(E=a.deletions,E===null?(a.deletions=[e],a.flags|=16):E.push(e)),a.child=i,a.memoizedState=null,i)}function Tu(e,a){return a=to({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function to(e,a){return e=ti(22,e,null,a),e.lanes=0,e}function vu(e,a,i){return hs(a,e.child,null,i),e=Tu(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function a0(e,a,i){e.lanes|=a;var l=e.alternate;l!==null&&(l.lanes|=a),Hc(e.return,a,i)}function Ru(e,a,i,l,u,h){var E=e.memoizedState;E===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:u,treeForkCount:h}:(E.isBackwards=a,E.rendering=null,E.renderingStartTime=0,E.last=l,E.tail=i,E.tailMode=u,E.treeForkCount=h)}function i0(e,a,i){var l=a.pendingProps,u=l.revealOrder,h=l.tail;l=l.children;var E=Kt.current,v=(E&2)!==0;if(v?(E=E&1|2,a.flags|=128):E&=1,le(Kt,E),Ea(e,a,l,i),l=ft?Nl:0,!v&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&a0(e,i,a);else if(e.tag===19)a0(e,i,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(i=a.child,u=null;i!==null;)e=i.alternate,e!==null&&kr(e)===null&&(u=i),i=i.sibling;i=u,i===null?(u=a.child,a.child=null):(u=i.sibling,i.sibling=null),Ru(a,!1,u,i,h,l);break;case"backwards":case"unstable_legacy-backwards":for(i=null,u=a.child,a.child=null;u!==null;){if(e=u.alternate,e!==null&&kr(e)===null){a.child=u;break}e=u.sibling,u.sibling=i,i=u,u=e}Ru(a,!0,i,null,h,l);break;case"together":Ru(a,!1,null,null,void 0,l);break;default:a.memoizedState=null}return a.child}function Qi(e,a,i){if(e!==null&&(a.dependencies=e.dependencies),On|=a.lanes,(i&a.childLanes)===0)if(e!==null){if(Ys(e,a,i,!1),(i&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(s(153));if(a.child!==null){for(e=a.child,i=Xi(e,e.pendingProps),a.child=i,i.return=a;e.sibling!==null;)e=e.sibling,i=i.sibling=Xi(e,e.pendingProps),i.return=a;i.sibling=null}return a.child}function Mu(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&Ir(e)))}function Km(e,a,i){switch(a.tag){case 3:he(a,a.stateNode.containerInfo),_n(a,ea,e.memoizedState.cache),ss();break;case 27:case 5:qt(a);break;case 4:he(a,a.stateNode.containerInfo);break;case 10:_n(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Zc(a),null;break;case 13:var l=a.memoizedState;if(l!==null)return l.dehydrated!==null?(vn(a),a.flags|=128,null):(i&a.child.childLanes)!==0?t0(e,a,i):(vn(a),e=Qi(e,a,i),e!==null?e.sibling:null);vn(a);break;case 19:var u=(e.flags&128)!==0;if(l=(i&a.childLanes)!==0,l||(Ys(e,a,i,!1),l=(i&a.childLanes)!==0),u){if(l)return i0(e,a,i);a.flags|=128}if(u=a.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),le(Kt,Kt.current),l)break;return null;case 22:return a.lanes=0,qf(e,a,i,a.pendingProps);case 24:_n(a,ea,e.memoizedState.cache)}return Qi(e,a,i)}function n0(e,a,i){if(e!==null)if(e.memoizedProps!==a.pendingProps)aa=!0;else{if(!Mu(e,i)&&(a.flags&128)===0)return aa=!1,Km(e,a,i);aa=(e.flags&131072)!==0}else aa=!1,ft&&(a.flags&1048576)!==0&&Id(a,Nl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var l=a.pendingProps;if(e=cs(a.elementType),a.type=e,typeof e=="function")Nc(e)?(l=fs(e,l),a.tag=1,a=Jf(null,a,e,l,i)):(a.tag=0,a=Eu(null,a,e,l,i));else{if(e!=null){var u=e.$$typeof;if(u===Y){a.tag=11,a=Xf(null,a,e,l,i);break e}else if(u===K){a.tag=14,a=jf(null,a,e,l,i);break e}}throw a=_e(e)||e,Error(s(306,a,""))}}return a;case 0:return Eu(e,a,a.type,a.pendingProps,i);case 1:return l=a.type,u=fs(l,a.pendingProps),Jf(e,a,l,u,i);case 3:e:{if(he(a,a.stateNode.containerInfo),e===null)throw Error(s(387));l=a.pendingProps;var h=a.memoizedState;u=h.element,Wc(e,a),Hl(a,l,null,i);var E=a.memoizedState;if(l=E.cache,_n(a,ea,l),l!==h.cache&&Gc(a,[ea],i,!0),Fl(),l=E.element,h.isDehydrated)if(h={element:l,isDehydrated:!1,cache:E.cache},a.updateQueue.baseState=h,a.memoizedState=h,a.flags&256){a=e0(e,a,l,i);break e}else if(l!==u){u=fi(Error(s(424)),a),Dl(u),a=e0(e,a,l,i);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ht=Ei(e.firstChild),ma=a,ft=!0,yn=null,mi=!0,i=$d(a,null,l,i),a.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(ss(),l===u){a=Qi(e,a,i);break e}Ea(e,a,l,i)}a=a.child}return a;case 26:return eo(e,a),e===null?(i=pg(a.type,null,a.pendingProps,null))?a.memoizedState=i:ft||(i=a.type,e=a.pendingProps,l=Eo(q.current).createElement(i),l[F]=a,l[g]=e,_a(l,i,e),xt(l),a.stateNode=l):a.memoizedState=pg(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return qt(a),e===null&&ft&&(l=a.stateNode=dg(a.type,a.pendingProps,q.current),ma=a,mi=!0,u=Ht,Cn(a.type)?(nh=u,Ht=Ei(l.firstChild)):Ht=u),Ea(e,a,a.pendingProps.children,i),eo(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&ft&&((u=l=Ht)&&(l=O1(l,a.type,a.pendingProps,mi),l!==null?(a.stateNode=l,ma=a,Ht=Ei(l.firstChild),mi=!1,u=!0):u=!1),u||En(a)),qt(a),u=a.type,h=a.pendingProps,E=e!==null?e.memoizedProps:null,l=h.children,Ju(u,h)?l=null:E!==null&&Ju(u,E)&&(a.flags|=32),a.memoizedState!==null&&(u=Qc(e,a,zm,null,null,i),nr._currentValue=u),eo(e,a),Ea(e,a,l,i),a.child;case 6:return e===null&&ft&&((e=i=Ht)&&(i=x1(i,a.pendingProps,mi),i!==null?(a.stateNode=i,ma=a,Ht=null,e=!0):e=!1),e||En(a)),null;case 13:return t0(e,a,i);case 4:return he(a,a.stateNode.containerInfo),l=a.pendingProps,e===null?a.child=hs(a,null,l,i):Ea(e,a,l,i),a.child;case 11:return Xf(e,a,a.type,a.pendingProps,i);case 7:return Ea(e,a,a.pendingProps,i),a.child;case 8:return Ea(e,a,a.pendingProps.children,i),a.child;case 12:return Ea(e,a,a.pendingProps.children,i),a.child;case 10:return l=a.pendingProps,_n(a,a.type,l.value),Ea(e,a,l.children,i),a.child;case 9:return u=a.type._context,l=a.pendingProps.children,rs(a),u=ya(u),l=l(u),a.flags|=1,Ea(e,a,l,i),a.child;case 14:return jf(e,a,a.type,a.pendingProps,i);case 15:return $f(e,a,a.type,a.pendingProps,i);case 19:return i0(e,a,i);case 31:return Zm(e,a,i);case 22:return qf(e,a,i,a.pendingProps);case 24:return rs(a),l=ya(ea),e===null?(u=zc(),u===null&&(u=Ct,h=Yc(),u.pooledCache=h,h.refCount++,h!==null&&(u.pooledCacheLanes|=i),u=h),a.memoizedState={parent:l,cache:u},Vc(a),_n(a,ea,u)):((e.lanes&i)!==0&&(Wc(e,a),Hl(a,null,null,i),Fl()),u=e.memoizedState,h=a.memoizedState,u.parent!==l?(u={parent:l,cache:l},a.memoizedState=u,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=u),_n(a,ea,l)):(l=h.cache,_n(a,ea,l),l!==u.cache&&Gc(a,[ea],i,!0))),Ea(e,a,a.pendingProps.children,i),a.child;case 29:throw a.pendingProps}throw Error(s(156,a.tag))}function Ji(e){e.flags|=4}function bu(e,a,i,l,u){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(D0())e.flags|=8192;else throw us=Gr,kc}else e.flags&=-16777217}function s0(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ag(a))if(D0())e.flags|=8192;else throw us=Gr,kc}function ao(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?zi():536870912,e.lanes|=a,Qs|=a)}function Vl(e,a){if(!ft)switch(e.tailMode){case"hidden":a=e.tail;for(var i=null;a!==null;)a.alternate!==null&&(i=a),a=a.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Gt(e){var a=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(a)for(var u=e.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=l,e.childLanes=i,a}function Qm(e,a,i){var l=a.pendingProps;switch(wc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gt(a),null;case 1:return Gt(a),null;case 3:return i=a.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),qi(ea),Be(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Gs(a)?Ji(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Bc())),Gt(a),null;case 26:var u=a.type,h=a.memoizedState;return e===null?(Ji(a),h!==null?(Gt(a),s0(a,h)):(Gt(a),bu(a,u,null,l,i))):h?h!==e.memoizedState?(Ji(a),Gt(a),s0(a,h)):(Gt(a),a.flags&=-16777217):(e=e.memoizedProps,e!==l&&Ji(a),Gt(a),bu(a,u,e,l,i)),null;case 27:if(va(a),i=q.current,u=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==l&&Ji(a);else{if(!l){if(a.stateNode===null)throw Error(s(166));return Gt(a),null}e=ue.current,Gs(a)?Fd(a):(e=dg(u,l,i),a.stateNode=e,Ji(a))}return Gt(a),null;case 5:if(va(a),u=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==l&&Ji(a);else{if(!l){if(a.stateNode===null)throw Error(s(166));return Gt(a),null}if(h=ue.current,Gs(a))Fd(a);else{var E=Eo(q.current);switch(h){case 1:h=E.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:h=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":h=E.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":h=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":h=E.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof l.is=="string"?E.createElement("select",{is:l.is}):E.createElement("select"),l.multiple?h.multiple=!0:l.size&&(h.size=l.size);break;default:h=typeof l.is=="string"?E.createElement(u,{is:l.is}):E.createElement(u)}}h[F]=a,h[g]=l;e:for(E=a.child;E!==null;){if(E.tag===5||E.tag===6)h.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===a)break e;for(;E.sibling===null;){if(E.return===null||E.return===a)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}a.stateNode=h;e:switch(_a(h,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&Ji(a)}}return Gt(a),bu(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,i),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==l&&Ji(a);else{if(typeof l!="string"&&a.stateNode===null)throw Error(s(166));if(e=q.current,Gs(a)){if(e=a.stateNode,i=a.memoizedProps,l=null,u=ma,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}e[F]=a,e=!!(e.nodeValue===i||l!==null&&l.suppressHydrationWarning===!0||tg(e.nodeValue,i)),e||En(a,!0)}else e=Eo(e).createTextNode(l),e[F]=a,a.stateNode=e}return Gt(a),null;case 31:if(i=a.memoizedState,e===null||e.memoizedState!==null){if(l=Gs(a),i!==null){if(e===null){if(!l)throw Error(s(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[F]=a}else ss(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Gt(a),e=!1}else i=Bc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=i),e=!0;if(!e)return a.flags&256?(ii(a),a):(ii(a),null);if((a.flags&128)!==0)throw Error(s(558))}return Gt(a),null;case 13:if(l=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=Gs(a),l!==null&&l.dehydrated!==null){if(e===null){if(!u)throw Error(s(318));if(u=a.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));u[F]=a}else ss(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Gt(a),u=!1}else u=Bc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return a.flags&256?(ii(a),a):(ii(a),null)}return ii(a),(a.flags&128)!==0?(a.lanes=i,a):(i=l!==null,e=e!==null&&e.memoizedState!==null,i&&(l=a.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),h=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(h=l.memoizedState.cachePool.pool),h!==u&&(l.flags|=2048)),i!==e&&i&&(a.child.flags|=8192),ao(a,a.updateQueue),Gt(a),null);case 4:return Be(),e===null&&$u(a.stateNode.containerInfo),Gt(a),null;case 10:return qi(a.type),Gt(a),null;case 19:if(ee(Kt),l=a.memoizedState,l===null)return Gt(a),null;if(u=(a.flags&128)!==0,h=l.rendering,h===null)if(u)Vl(l,!1);else{if(jt!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(h=kr(e),h!==null){for(a.flags|=128,Vl(l,!1),e=h.updateQueue,a.updateQueue=e,ao(a,e),a.subtreeFlags=0,e=i,i=a.child;i!==null;)Cd(i,e),i=i.sibling;return le(Kt,Kt.current&1|2),ft&&ji(a,l.treeForkCount),a.child}e=e.sibling}l.tail!==null&&ga()>ro&&(a.flags|=128,u=!0,Vl(l,!1),a.lanes=4194304)}else{if(!u)if(e=kr(h),e!==null){if(a.flags|=128,u=!0,e=e.updateQueue,a.updateQueue=e,ao(a,e),Vl(l,!0),l.tail===null&&l.tailMode==="hidden"&&!h.alternate&&!ft)return Gt(a),null}else 2*ga()-l.renderingStartTime>ro&&i!==536870912&&(a.flags|=128,u=!0,Vl(l,!1),a.lanes=4194304);l.isBackwards?(h.sibling=a.child,a.child=h):(e=l.last,e!==null?e.sibling=h:a.child=h,l.last=h)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=ga(),e.sibling=null,i=Kt.current,le(Kt,u?i&1|2:i&1),ft&&ji(a,l.treeForkCount),e):(Gt(a),null);case 22:case 23:return ii(a),qc(),l=a.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(a.flags|=8192):l&&(a.flags|=8192),l?(i&536870912)!==0&&(a.flags&128)===0&&(Gt(a),a.subtreeFlags&6&&(a.flags|=8192)):Gt(a),i=a.updateQueue,i!==null&&ao(a,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),l=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),l!==i&&(a.flags|=2048),e!==null&&ee(os),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),a.memoizedState.cache!==i&&(a.flags|=2048),qi(ea),Gt(a),null;case 25:return null;case 30:return null}throw Error(s(156,a.tag))}function Jm(e,a){switch(wc(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return qi(ea),Be(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return va(a),null;case 31:if(a.memoizedState!==null){if(ii(a),a.alternate===null)throw Error(s(340));ss()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(ii(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(s(340));ss()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return ee(Kt),null;case 4:return Be(),null;case 10:return qi(a.type),null;case 22:case 23:return ii(a),qc(),e!==null&&ee(os),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return qi(ea),null;case 25:return null;default:return null}}function l0(e,a){switch(wc(a),a.tag){case 3:qi(ea),Be();break;case 26:case 27:case 5:va(a);break;case 4:Be();break;case 31:a.memoizedState!==null&&ii(a);break;case 13:ii(a);break;case 19:ee(Kt);break;case 10:qi(a.type);break;case 22:case 23:ii(a),qc(),e!==null&&ee(os);break;case 24:qi(ea)}}function Wl(e,a){try{var i=a.updateQueue,l=i!==null?i.lastEffect:null;if(l!==null){var u=l.next;i=u;do{if((i.tag&e)===e){l=void 0;var h=i.create,E=i.inst;l=h(),E.destroy=l}i=i.next}while(i!==u)}}catch(v){Mt(a,a.return,v)}}function Mn(e,a,i){try{var l=a.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var h=u.next;l=h;do{if((l.tag&e)===e){var E=l.inst,v=E.destroy;if(v!==void 0){E.destroy=void 0,u=a;var C=i,k=v;try{k()}catch(J){Mt(u,C,J)}}}l=l.next}while(l!==h)}}catch(J){Mt(a,a.return,J)}}function r0(e){var a=e.updateQueue;if(a!==null){var i=e.stateNode;try{Zd(a,i)}catch(l){Mt(e,e.return,l)}}}function o0(e,a,i){i.props=fs(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(l){Mt(e,a,l)}}function Xl(e,a){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof i=="function"?e.refCleanup=i(l):i.current=l}}catch(u){Mt(e,a,u)}}function Ii(e,a){var i=e.ref,l=e.refCleanup;if(i!==null)if(typeof l=="function")try{l()}catch(u){Mt(e,a,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(u){Mt(e,a,u)}else i.current=null}function c0(e){var a=e.type,i=e.memoizedProps,l=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":i.autoFocus&&l.focus();break e;case"img":i.src?l.src=i.src:i.srcSet&&(l.srcset=i.srcSet)}}catch(u){Mt(e,e.return,u)}}function Ou(e,a,i){try{var l=e.stateNode;S1(l,e.type,i,a),l[g]=a}catch(u){Mt(e,e.return,u)}}function u0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Cn(e.type)||e.tag===4}function xu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||u0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Cn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Lu(e,a,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,a?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,a):(a=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.appendChild(e),i=i._reactRootContainer,i!=null||a.onclick!==null||(a.onclick=Ja));else if(l!==4&&(l===27&&Cn(e.type)&&(i=e.stateNode,a=null),e=e.child,e!==null))for(Lu(e,a,i),e=e.sibling;e!==null;)Lu(e,a,i),e=e.sibling}function io(e,a,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,a?i.insertBefore(e,a):i.appendChild(e);else if(l!==4&&(l===27&&Cn(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(io(e,a,i),e=e.sibling;e!==null;)io(e,a,i),e=e.sibling}function h0(e){var a=e.stateNode,i=e.memoizedProps;try{for(var l=e.type,u=a.attributes;u.length;)a.removeAttributeNode(u[0]);_a(a,l,i),a[F]=e,a[g]=i}catch(h){Mt(e,e.return,h)}}var en=!1,ia=!1,Nu=!1,d0=typeof WeakSet=="function"?WeakSet:Set,ha=null;function e1(e,a){if(e=e.containerInfo,Ku=Mo,e=vd(e),vc(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var u=l.anchorOffset,h=l.focusNode;l=l.focusOffset;try{i.nodeType,h.nodeType}catch{i=null;break e}var E=0,v=-1,C=-1,k=0,J=0,ne=e,X=null;t:for(;;){for(var j;ne!==i||u!==0&&ne.nodeType!==3||(v=E+u),ne!==h||l!==0&&ne.nodeType!==3||(C=E+l),ne.nodeType===3&&(E+=ne.nodeValue.length),(j=ne.firstChild)!==null;)X=ne,ne=j;for(;;){if(ne===e)break t;if(X===i&&++k===u&&(v=E),X===h&&++J===l&&(C=E),(j=ne.nextSibling)!==null)break;ne=X,X=ne.parentNode}ne=j}i=v===-1||C===-1?null:{start:v,end:C}}else i=null}i=i||{start:0,end:0}}else i=null;for(Qu={focusedElem:e,selectionRange:i},Mo=!1,ha=a;ha!==null;)if(a=ha,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,ha=e;else for(;ha!==null;){switch(a=ha,h=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(i=0;i<e.length;i++)u=e[i],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,i=a,u=h.memoizedProps,h=h.memoizedState,l=i.stateNode;try{var Re=fs(i.type,u);e=l.getSnapshotBeforeUpdate(Re,h),l.__reactInternalSnapshotBeforeUpdate=e}catch(Ie){Mt(i,i.return,Ie)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,i=e.nodeType,i===9)th(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":th(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=a.sibling,e!==null){e.return=a.return,ha=e;break}ha=a.return}}function f0(e,a,i){var l=i.flags;switch(i.tag){case 0:case 11:case 15:an(e,i),l&4&&Wl(5,i);break;case 1:if(an(e,i),l&4)if(e=i.stateNode,a===null)try{e.componentDidMount()}catch(E){Mt(i,i.return,E)}else{var u=fs(i.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(u,a,e.__reactInternalSnapshotBeforeUpdate)}catch(E){Mt(i,i.return,E)}}l&64&&r0(i),l&512&&Xl(i,i.return);break;case 3:if(an(e,i),l&64&&(e=i.updateQueue,e!==null)){if(a=null,i.child!==null)switch(i.child.tag){case 27:case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}try{Zd(e,a)}catch(E){Mt(i,i.return,E)}}break;case 27:a===null&&l&4&&h0(i);case 26:case 5:an(e,i),a===null&&l&4&&c0(i),l&512&&Xl(i,i.return);break;case 12:an(e,i);break;case 31:an(e,i),l&4&&m0(e,i);break;case 13:an(e,i),l&4&&y0(e,i),l&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=c1.bind(null,i),L1(e,i))));break;case 22:if(l=i.memoizedState!==null||en,!l){a=a!==null&&a.memoizedState!==null||ia,u=en;var h=ia;en=l,(ia=a)&&!h?nn(e,i,(i.subtreeFlags&8772)!==0):an(e,i),en=u,ia=h}break;case 30:break;default:an(e,i)}}function g0(e){var a=e.alternate;a!==null&&(e.alternate=null,g0(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&kt(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Yt=null,Ya=!1;function tn(e,a,i){for(i=i.child;i!==null;)p0(e,a,i),i=i.sibling}function p0(e,a,i){if(Da&&typeof Da.onCommitFiberUnmount=="function")try{Da.onCommitFiberUnmount(pa,i)}catch{}switch(i.tag){case 26:ia||Ii(i,a),tn(e,a,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:ia||Ii(i,a);var l=Yt,u=Ya;Cn(i.type)&&(Yt=i.stateNode,Ya=!1),tn(e,a,i),tr(i.stateNode),Yt=l,Ya=u;break;case 5:ia||Ii(i,a);case 6:if(l=Yt,u=Ya,Yt=null,tn(e,a,i),Yt=l,Ya=u,Yt!==null)if(Ya)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(i.stateNode)}catch(h){Mt(i,a,h)}else try{Yt.removeChild(i.stateNode)}catch(h){Mt(i,a,h)}break;case 18:Yt!==null&&(Ya?(e=Yt,rg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),ll(e)):rg(Yt,i.stateNode));break;case 4:l=Yt,u=Ya,Yt=i.stateNode.containerInfo,Ya=!0,tn(e,a,i),Yt=l,Ya=u;break;case 0:case 11:case 14:case 15:Mn(2,i,a),ia||Mn(4,i,a),tn(e,a,i);break;case 1:ia||(Ii(i,a),l=i.stateNode,typeof l.componentWillUnmount=="function"&&o0(i,a,l)),tn(e,a,i);break;case 21:tn(e,a,i);break;case 22:ia=(l=ia)||i.memoizedState!==null,tn(e,a,i),ia=l;break;default:tn(e,a,i)}}function m0(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ll(e)}catch(i){Mt(a,a.return,i)}}}function y0(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ll(e)}catch(i){Mt(a,a.return,i)}}function t1(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new d0),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new d0),a;default:throw Error(s(435,e.tag))}}function no(e,a){var i=t1(e);a.forEach(function(l){if(!i.has(l)){i.add(l);var u=u1.bind(null,e,l);l.then(u,u)}})}function Ua(e,a){var i=a.deletions;if(i!==null)for(var l=0;l<i.length;l++){var u=i[l],h=e,E=a,v=E;e:for(;v!==null;){switch(v.tag){case 27:if(Cn(v.type)){Yt=v.stateNode,Ya=!1;break e}break;case 5:Yt=v.stateNode,Ya=!1;break e;case 3:case 4:Yt=v.stateNode.containerInfo,Ya=!0;break e}v=v.return}if(Yt===null)throw Error(s(160));p0(h,E,u),Yt=null,Ya=!1,h=u.alternate,h!==null&&(h.return=null),u.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)E0(a,e),a=a.sibling}var bi=null;function E0(e,a){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ua(a,e),za(e),l&4&&(Mn(3,e,e.return),Wl(3,e),Mn(5,e,e.return));break;case 1:Ua(a,e),za(e),l&512&&(ia||i===null||Ii(i,i.return)),l&64&&en&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?l:i.concat(l))));break;case 26:var u=bi;if(Ua(a,e),za(e),l&512&&(ia||i===null||Ii(i,i.return)),l&4){var h=i!==null?i.memoizedState:null;if(l=e.memoizedState,i===null)if(l===null)if(e.stateNode===null){e:{l=e.type,i=e.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":h=u.getElementsByTagName("title")[0],(!h||h[Ot]||h[F]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=u.createElement(l),u.head.insertBefore(h,u.querySelector("head > title"))),_a(h,l,i),h[F]=e,xt(h),l=h;break e;case"link":var E=Eg("link","href",u).get(l+(i.href||""));if(E){for(var v=0;v<E.length;v++)if(h=E[v],h.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&h.getAttribute("rel")===(i.rel==null?null:i.rel)&&h.getAttribute("title")===(i.title==null?null:i.title)&&h.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){E.splice(v,1);break t}}h=u.createElement(l),_a(h,l,i),u.head.appendChild(h);break;case"meta":if(E=Eg("meta","content",u).get(l+(i.content||""))){for(v=0;v<E.length;v++)if(h=E[v],h.getAttribute("content")===(i.content==null?null:""+i.content)&&h.getAttribute("name")===(i.name==null?null:i.name)&&h.getAttribute("property")===(i.property==null?null:i.property)&&h.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&h.getAttribute("charset")===(i.charSet==null?null:i.charSet)){E.splice(v,1);break t}}h=u.createElement(l),_a(h,l,i),u.head.appendChild(h);break;default:throw Error(s(468,l))}h[F]=e,xt(h),l=h}e.stateNode=l}else _g(u,e.type,e.stateNode);else e.stateNode=yg(u,l,e.memoizedProps);else h!==l?(h===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):h.count--,l===null?_g(u,e.type,e.stateNode):yg(u,l,e.memoizedProps)):l===null&&e.stateNode!==null&&Ou(e,e.memoizedProps,i.memoizedProps)}break;case 27:Ua(a,e),za(e),l&512&&(ia||i===null||Ii(i,i.return)),i!==null&&l&4&&Ou(e,e.memoizedProps,i.memoizedProps);break;case 5:if(Ua(a,e),za(e),l&512&&(ia||i===null||Ii(i,i.return)),e.flags&32){u=e.stateNode;try{Ke(u,"")}catch(Re){Mt(e,e.return,Re)}}l&4&&e.stateNode!=null&&(u=e.memoizedProps,Ou(e,u,i!==null?i.memoizedProps:u)),l&1024&&(Nu=!0);break;case 6:if(Ua(a,e),za(e),l&4){if(e.stateNode===null)throw Error(s(162));l=e.memoizedProps,i=e.stateNode;try{i.nodeValue=l}catch(Re){Mt(e,e.return,Re)}}break;case 3:if(So=null,u=bi,bi=_o(a.containerInfo),Ua(a,e),bi=u,za(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{ll(a.containerInfo)}catch(Re){Mt(e,e.return,Re)}Nu&&(Nu=!1,_0(e));break;case 4:l=bi,bi=_o(e.stateNode.containerInfo),Ua(a,e),za(e),bi=l;break;case 12:Ua(a,e),za(e);break;case 31:Ua(a,e),za(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,no(e,l)));break;case 13:Ua(a,e),za(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(lo=ga()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,no(e,l)));break;case 22:u=e.memoizedState!==null;var C=i!==null&&i.memoizedState!==null,k=en,J=ia;if(en=k||u,ia=J||C,Ua(a,e),ia=J,en=k,za(e),l&8192)e:for(a=e.stateNode,a._visibility=u?a._visibility&-2:a._visibility|1,u&&(i===null||C||en||ia||gs(e)),i=null,a=e;;){if(a.tag===5||a.tag===26){if(i===null){C=i=a;try{if(h=C.stateNode,u)E=h.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{v=C.stateNode;var ne=C.memoizedProps.style,X=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;v.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(Re){Mt(C,C.return,Re)}}}else if(a.tag===6){if(i===null){C=a;try{C.stateNode.nodeValue=u?"":C.memoizedProps}catch(Re){Mt(C,C.return,Re)}}}else if(a.tag===18){if(i===null){C=a;try{var j=C.stateNode;u?og(j,!0):og(C.stateNode,!1)}catch(Re){Mt(C,C.return,Re)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;i===a&&(i=null),a=a.return}i===a&&(i=null),a.sibling.return=a.return,a=a.sibling}l&4&&(l=e.updateQueue,l!==null&&(i=l.retryQueue,i!==null&&(l.retryQueue=null,no(e,i))));break;case 19:Ua(a,e),za(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,no(e,l)));break;case 30:break;case 21:break;default:Ua(a,e),za(e)}}function za(e){var a=e.flags;if(a&2){try{for(var i,l=e.return;l!==null;){if(u0(l)){i=l;break}l=l.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var u=i.stateNode,h=xu(e);io(e,h,u);break;case 5:var E=i.stateNode;i.flags&32&&(Ke(E,""),i.flags&=-33);var v=xu(e);io(e,v,E);break;case 3:case 4:var C=i.stateNode.containerInfo,k=xu(e);Lu(e,k,C);break;default:throw Error(s(161))}}catch(J){Mt(e,e.return,J)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function _0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;_0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function an(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)f0(e,a.alternate,a),a=a.sibling}function gs(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:Mn(4,a,a.return),gs(a);break;case 1:Ii(a,a.return);var i=a.stateNode;typeof i.componentWillUnmount=="function"&&o0(a,a.return,i),gs(a);break;case 27:tr(a.stateNode);case 26:case 5:Ii(a,a.return),gs(a);break;case 22:a.memoizedState===null&&gs(a);break;case 30:gs(a);break;default:gs(a)}e=e.sibling}}function nn(e,a,i){for(i=i&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var l=a.alternate,u=e,h=a,E=h.flags;switch(h.tag){case 0:case 11:case 15:nn(u,h,i),Wl(4,h);break;case 1:if(nn(u,h,i),l=h,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(k){Mt(l,l.return,k)}if(l=h,u=l.updateQueue,u!==null){var v=l.stateNode;try{var C=u.shared.hiddenCallbacks;if(C!==null)for(u.shared.hiddenCallbacks=null,u=0;u<C.length;u++)qd(C[u],v)}catch(k){Mt(l,l.return,k)}}i&&E&64&&r0(h),Xl(h,h.return);break;case 27:h0(h);case 26:case 5:nn(u,h,i),i&&l===null&&E&4&&c0(h),Xl(h,h.return);break;case 12:nn(u,h,i);break;case 31:nn(u,h,i),i&&E&4&&m0(u,h);break;case 13:nn(u,h,i),i&&E&4&&y0(u,h);break;case 22:h.memoizedState===null&&nn(u,h,i),Xl(h,h.return);break;case 30:break;default:nn(u,h,i)}a=a.sibling}}function Du(e,a){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Cl(i))}function Cu(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Cl(e))}function Oi(e,a,i,l){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)A0(e,a,i,l),a=a.sibling}function A0(e,a,i,l){var u=a.flags;switch(a.tag){case 0:case 11:case 15:Oi(e,a,i,l),u&2048&&Wl(9,a);break;case 1:Oi(e,a,i,l);break;case 3:Oi(e,a,i,l),u&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Cl(e)));break;case 12:if(u&2048){Oi(e,a,i,l),e=a.stateNode;try{var h=a.memoizedProps,E=h.id,v=h.onPostCommit;typeof v=="function"&&v(E,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(C){Mt(a,a.return,C)}}else Oi(e,a,i,l);break;case 31:Oi(e,a,i,l);break;case 13:Oi(e,a,i,l);break;case 23:break;case 22:h=a.stateNode,E=a.alternate,a.memoizedState!==null?h._visibility&2?Oi(e,a,i,l):jl(e,a):h._visibility&2?Oi(e,a,i,l):(h._visibility|=2,qs(e,a,i,l,(a.subtreeFlags&10256)!==0||!1)),u&2048&&Du(E,a);break;case 24:Oi(e,a,i,l),u&2048&&Cu(a.alternate,a);break;default:Oi(e,a,i,l)}}function qs(e,a,i,l,u){for(u=u&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var h=e,E=a,v=i,C=l,k=E.flags;switch(E.tag){case 0:case 11:case 15:qs(h,E,v,C,u),Wl(8,E);break;case 23:break;case 22:var J=E.stateNode;E.memoizedState!==null?J._visibility&2?qs(h,E,v,C,u):jl(h,E):(J._visibility|=2,qs(h,E,v,C,u)),u&&k&2048&&Du(E.alternate,E);break;case 24:qs(h,E,v,C,u),u&&k&2048&&Cu(E.alternate,E);break;default:qs(h,E,v,C,u)}a=a.sibling}}function jl(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var i=e,l=a,u=l.flags;switch(l.tag){case 22:jl(i,l),u&2048&&Du(l.alternate,l);break;case 24:jl(i,l),u&2048&&Cu(l.alternate,l);break;default:jl(i,l)}a=a.sibling}}var $l=8192;function Zs(e,a,i){if(e.subtreeFlags&$l)for(e=e.child;e!==null;)S0(e,a,i),e=e.sibling}function S0(e,a,i){switch(e.tag){case 26:Zs(e,a,i),e.flags&$l&&e.memoizedState!==null&&U1(i,bi,e.memoizedState,e.memoizedProps);break;case 5:Zs(e,a,i);break;case 3:case 4:var l=bi;bi=_o(e.stateNode.containerInfo),Zs(e,a,i),bi=l;break;case 22:e.memoizedState===null&&(l=e.alternate,l!==null&&l.memoizedState!==null?(l=$l,$l=16777216,Zs(e,a,i),$l=l):Zs(e,a,i));break;default:Zs(e,a,i)}}function T0(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function ql(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var l=a[i];ha=l,R0(l,e)}T0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)v0(e),e=e.sibling}function v0(e){switch(e.tag){case 0:case 11:case 15:ql(e),e.flags&2048&&Mn(9,e,e.return);break;case 3:ql(e);break;case 12:ql(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,so(e)):ql(e);break;default:ql(e)}}function so(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var l=a[i];ha=l,R0(l,e)}T0(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:Mn(8,a,a.return),so(a);break;case 22:i=a.stateNode,i._visibility&2&&(i._visibility&=-3,so(a));break;default:so(a)}e=e.sibling}}function R0(e,a){for(;ha!==null;){var i=ha;switch(i.tag){case 0:case 11:case 15:Mn(8,i,a);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var l=i.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Cl(i.memoizedState.cache)}if(l=i.child,l!==null)l.return=i,ha=l;else e:for(i=e;ha!==null;){l=ha;var u=l.sibling,h=l.return;if(g0(l),l===i){ha=null;break e}if(u!==null){u.return=h,ha=u;break e}ha=h}}}var a1={getCacheForType:function(e){var a=ya(ea),i=a.data.get(e);return i===void 0&&(i=e(),a.data.set(e,i)),i},cacheSignal:function(){return ya(ea).controller.signal}},i1=typeof WeakMap=="function"?WeakMap:Map,At=0,Ct=null,rt=null,ut=0,Rt=0,ni=null,bn=!1,Ks=!1,Pu=!1,sn=0,jt=0,On=0,ps=0,wu=0,si=0,Qs=0,Zl=null,ka=null,Iu=!1,lo=0,M0=0,ro=1/0,oo=null,xn=null,ra=0,Ln=null,Js=null,ln=0,Bu=0,Fu=null,b0=null,Kl=0,Hu=null;function li(){return(At&2)!==0&&ut!==0?ut&-ut:U.T!==null?Vu():Ls()}function O0(){if(si===0)if((ut&536870912)===0||ft){var e=dn;dn<<=1,(dn&3932160)===0&&(dn=262144),si=e}else si=536870912;return e=ai.current,e!==null&&(e.flags|=32),si}function Va(e,a,i){(e===Ct&&(Rt===2||Rt===9)||e.cancelPendingCommit!==null)&&(el(e,0),Nn(e,ut,si,!1)),Ni(e,i),((At&2)===0||e!==Ct)&&(e===Ct&&((At&2)===0&&(ps|=i),jt===4&&Nn(e,ut,si,!1)),Bi(e))}function x0(e,a,i){if((At&6)!==0)throw Error(s(327));var l=!i&&(a&127)===0&&(a&e.expiredLanes)===0||Zn(e,a),u=l?l1(e,a):Yu(e,a,!0),h=l;do{if(u===0){Ks&&!l&&Nn(e,a,0,!1);break}else{if(i=e.current.alternate,h&&!n1(i)){u=Yu(e,a,!1),h=!1;continue}if(u===2){if(h=a,e.errorRecoveryDisabledLanes&h)var E=0;else E=e.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){a=E;e:{var v=e;u=Zl;var C=v.current.memoizedState.isDehydrated;if(C&&(el(v,E).flags|=256),E=Yu(v,E,!1),E!==2){if(Pu&&!C){v.errorRecoveryDisabledLanes|=h,ps|=h,u=4;break e}h=ka,ka=u,h!==null&&(ka===null?ka=h:ka.push.apply(ka,h))}u=E}if(h=!1,u!==2)continue}}if(u===1){el(e,0),Nn(e,a,0,!0);break}e:{switch(l=e,h=u,h){case 0:case 1:throw Error(s(345));case 4:if((a&4194048)!==a)break;case 6:Nn(l,a,si,!bn);break e;case 2:ka=null;break;case 3:case 5:break;default:throw Error(s(329))}if((a&62914560)===a&&(u=lo+300-ga(),10<u)){if(Nn(l,a,si,!bn),gn(l,0,!0)!==0)break e;ln=a,l.timeoutHandle=sg(L0.bind(null,l,i,ka,oo,Iu,a,si,ps,Qs,bn,h,"Throttled",-0,0),u);break e}L0(l,i,ka,oo,Iu,a,si,ps,Qs,bn,h,null,-0,0)}}break}while(!0);Bi(e)}function L0(e,a,i,l,u,h,E,v,C,k,J,ne,X,j){if(e.timeoutHandle=-1,ne=a.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ja},S0(a,h,ne);var Re=(h&62914560)===h?lo-ga():(h&4194048)===h?M0-ga():0;if(Re=z1(ne,Re),Re!==null){ln=h,e.cancelPendingCommit=Re(F0.bind(null,e,a,h,i,l,u,E,v,C,J,ne,null,X,j)),Nn(e,h,E,!k);return}}F0(e,a,h,i,l,u,E,v,C)}function n1(e){for(var a=e;;){var i=a.tag;if((i===0||i===11||i===15)&&a.flags&16384&&(i=a.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var l=0;l<i.length;l++){var u=i[l],h=u.getSnapshot;u=u.value;try{if(!ei(h(),u))return!1}catch{return!1}}if(i=a.child,a.subtreeFlags&16384&&i!==null)i.return=a,a=i;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Nn(e,a,i,l){a&=~wu,a&=~ps,e.suspendedLanes|=a,e.pingedLanes&=~a,l&&(e.warmLanes|=a),l=e.expirationTimes;for(var u=a;0<u;){var h=31-Ca(u),E=1<<h;l[h]=-1,u&=~E}i!==0&&Sr(e,i,a)}function co(){return(At&6)===0?(Ql(0),!1):!0}function Gu(){if(rt!==null){if(Rt===0)var e=rt.return;else e=rt,$i=ls=null,tu(e),Vs=null,wl=0,e=rt;for(;e!==null;)l0(e.alternate,e),e=e.return;rt=null}}function el(e,a){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,R1(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),ln=0,Gu(),Ct=e,rt=i=Xi(e.current,null),ut=a,Rt=0,ni=null,bn=!1,Ks=Zn(e,a),Pu=!1,Qs=si=wu=ps=On=jt=0,ka=Zl=null,Iu=!1,(a&8)!==0&&(a|=a&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=a;0<l;){var u=31-Ca(l),h=1<<u;a|=e[u],l&=~h}return sn=a,Nr(),i}function N0(e,a){Qe=null,U.H=zl,a===ks||a===Hr?(a=Wd(),Rt=3):a===kc?(a=Wd(),Rt=4):Rt=a===yu?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,ni=a,rt===null&&(jt=1,Qr(e,fi(a,e.current)))}function D0(){var e=ai.current;return e===null?!0:(ut&4194048)===ut?yi===null:(ut&62914560)===ut||(ut&536870912)!==0?e===yi:!1}function C0(){var e=U.H;return U.H=zl,e===null?zl:e}function P0(){var e=U.A;return U.A=a1,e}function uo(){jt=4,bn||(ut&4194048)!==ut&&ai.current!==null||(Ks=!0),(On&134217727)===0&&(ps&134217727)===0||Ct===null||Nn(Ct,ut,si,!1)}function Yu(e,a,i){var l=At;At|=2;var u=C0(),h=P0();(Ct!==e||ut!==a)&&(oo=null,el(e,a)),a=!1;var E=jt;e:do try{if(Rt!==0&&rt!==null){var v=rt,C=ni;switch(Rt){case 8:Gu(),E=6;break e;case 3:case 2:case 9:case 6:ai.current===null&&(a=!0);var k=Rt;if(Rt=0,ni=null,tl(e,v,C,k),i&&Ks){E=0;break e}break;default:k=Rt,Rt=0,ni=null,tl(e,v,C,k)}}s1(),E=jt;break}catch(J){N0(e,J)}while(!0);return a&&e.shellSuspendCounter++,$i=ls=null,At=l,U.H=u,U.A=h,rt===null&&(Ct=null,ut=0,Nr()),E}function s1(){for(;rt!==null;)w0(rt)}function l1(e,a){var i=At;At|=2;var l=C0(),u=P0();Ct!==e||ut!==a?(oo=null,ro=ga()+500,el(e,a)):Ks=Zn(e,a);e:do try{if(Rt!==0&&rt!==null){a=rt;var h=ni;t:switch(Rt){case 1:Rt=0,ni=null,tl(e,a,h,1);break;case 2:case 9:if(kd(h)){Rt=0,ni=null,I0(a);break}a=function(){Rt!==2&&Rt!==9||Ct!==e||(Rt=7),Bi(e)},h.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:kd(h)?(Rt=0,ni=null,I0(a)):(Rt=0,ni=null,tl(e,a,h,7));break;case 5:var E=null;switch(rt.tag){case 26:E=rt.memoizedState;case 5:case 27:var v=rt;if(E?Ag(E):v.stateNode.complete){Rt=0,ni=null;var C=v.sibling;if(C!==null)rt=C;else{var k=v.return;k!==null?(rt=k,ho(k)):rt=null}break t}}Rt=0,ni=null,tl(e,a,h,5);break;case 6:Rt=0,ni=null,tl(e,a,h,6);break;case 8:Gu(),jt=6;break e;default:throw Error(s(462))}}r1();break}catch(J){N0(e,J)}while(!0);return $i=ls=null,U.H=l,U.A=u,At=i,rt!==null?0:(Ct=null,ut=0,Nr(),jt)}function r1(){for(;rt!==null&&!ml();)w0(rt)}function w0(e){var a=n0(e.alternate,e,sn);e.memoizedProps=e.pendingProps,a===null?ho(e):rt=a}function I0(e){var a=e,i=a.alternate;switch(a.tag){case 15:case 0:a=Qf(i,a,a.pendingProps,a.type,void 0,ut);break;case 11:a=Qf(i,a,a.pendingProps,a.type.render,a.ref,ut);break;case 5:tu(a);default:l0(i,a),a=rt=Cd(a,sn),a=n0(i,a,sn)}e.memoizedProps=e.pendingProps,a===null?ho(e):rt=a}function tl(e,a,i,l){$i=ls=null,tu(a),Vs=null,wl=0;var u=a.return;try{if(qm(e,u,a,i,ut)){jt=1,Qr(e,fi(i,e.current)),rt=null;return}}catch(h){if(u!==null)throw rt=u,h;jt=1,Qr(e,fi(i,e.current)),rt=null;return}a.flags&32768?(ft||l===1?e=!0:Ks||(ut&536870912)!==0?e=!1:(bn=e=!0,(l===2||l===9||l===3||l===6)&&(l=ai.current,l!==null&&l.tag===13&&(l.flags|=16384))),B0(a,e)):ho(a)}function ho(e){var a=e;do{if((a.flags&32768)!==0){B0(a,bn);return}e=a.return;var i=Qm(a.alternate,a,sn);if(i!==null){rt=i;return}if(a=a.sibling,a!==null){rt=a;return}rt=a=e}while(a!==null);jt===0&&(jt=5)}function B0(e,a){do{var i=Jm(e.alternate,e);if(i!==null){i.flags&=32767,rt=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!a&&(e=e.sibling,e!==null)){rt=e;return}rt=e=i}while(e!==null);jt=6,rt=null}function F0(e,a,i,l,u,h,E,v,C){e.cancelPendingCommit=null;do fo();while(ra!==0);if((At&6)!==0)throw Error(s(327));if(a!==null){if(a===e.current)throw Error(s(177));if(h=a.lanes|a.childLanes,h|=xc,fc(e,i,h,E,v,C),e===Ct&&(rt=Ct=null,ut=0),Js=a,Ln=e,ln=i,Bu=h,Fu=u,b0=l,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,h1(bs,function(){return z0(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||l){l=U.T,U.T=null,u=se.p,se.p=2,E=At,At|=4;try{e1(e,a,i)}finally{At=E,se.p=u,U.T=l}}ra=1,H0(),G0(),Y0()}}function H0(){if(ra===1){ra=0;var e=Ln,a=Js,i=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||i){i=U.T,U.T=null;var l=se.p;se.p=2;var u=At;At|=4;try{E0(a,e);var h=Qu,E=vd(e.containerInfo),v=h.focusedElem,C=h.selectionRange;if(E!==v&&v&&v.ownerDocument&&Td(v.ownerDocument.documentElement,v)){if(C!==null&&vc(v)){var k=C.start,J=C.end;if(J===void 0&&(J=k),"selectionStart"in v)v.selectionStart=k,v.selectionEnd=Math.min(J,v.value.length);else{var ne=v.ownerDocument||document,X=ne&&ne.defaultView||window;if(X.getSelection){var j=X.getSelection(),Re=v.textContent.length,Ie=Math.min(C.start,Re),Dt=C.end===void 0?Ie:Math.min(C.end,Re);!j.extend&&Ie>Dt&&(E=Dt,Dt=Ie,Ie=E);var H=Sd(v,Ie),B=Sd(v,Dt);if(H&&B&&(j.rangeCount!==1||j.anchorNode!==H.node||j.anchorOffset!==H.offset||j.focusNode!==B.node||j.focusOffset!==B.offset)){var z=ne.createRange();z.setStart(H.node,H.offset),j.removeAllRanges(),Ie>Dt?(j.addRange(z),j.extend(B.node,B.offset)):(z.setEnd(B.node,B.offset),j.addRange(z))}}}}for(ne=[],j=v;j=j.parentNode;)j.nodeType===1&&ne.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<ne.length;v++){var ae=ne[v];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}Mo=!!Ku,Qu=Ku=null}finally{At=u,se.p=l,U.T=i}}e.current=a,ra=2}}function G0(){if(ra===2){ra=0;var e=Ln,a=Js,i=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||i){i=U.T,U.T=null;var l=se.p;se.p=2;var u=At;At|=4;try{f0(e,a.alternate,a)}finally{At=u,se.p=l,U.T=i}}ra=3}}function Y0(){if(ra===4||ra===3){ra=0,Ms();var e=Ln,a=Js,i=ln,l=b0;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ra=5:(ra=0,Js=Ln=null,U0(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(xn=null),Jn(i),a=a.stateNode,Da&&typeof Da.onCommitFiberRoot=="function")try{Da.onCommitFiberRoot(pa,a,void 0,(a.current.flags&128)===128)}catch{}if(l!==null){a=U.T,u=se.p,se.p=2,U.T=null;try{for(var h=e.onRecoverableError,E=0;E<l.length;E++){var v=l[E];h(v.value,{componentStack:v.stack})}}finally{U.T=a,se.p=u}}(ln&3)!==0&&fo(),Bi(e),u=e.pendingLanes,(i&261930)!==0&&(u&42)!==0?e===Hu?Kl++:(Kl=0,Hu=e):Kl=0,Ql(0)}}function U0(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,Cl(a)))}function fo(){return H0(),G0(),Y0(),z0()}function z0(){if(ra!==5)return!1;var e=Ln,a=Bu;Bu=0;var i=Jn(ln),l=U.T,u=se.p;try{se.p=32>i?32:i,U.T=null,i=Fu,Fu=null;var h=Ln,E=ln;if(ra=0,Js=Ln=null,ln=0,(At&6)!==0)throw Error(s(331));var v=At;if(At|=4,v0(h.current),A0(h,h.current,E,i),At=v,Ql(0,!1),Da&&typeof Da.onPostCommitFiberRoot=="function")try{Da.onPostCommitFiberRoot(pa,h)}catch{}return!0}finally{se.p=u,U.T=l,U0(e,a)}}function k0(e,a,i){a=fi(i,a),a=mu(e.stateNode,a,2),e=Tn(e,a,2),e!==null&&(Ni(e,2),Bi(e))}function Mt(e,a,i){if(e.tag===3)k0(e,e,i);else for(;a!==null;){if(a.tag===3){k0(a,e,i);break}else if(a.tag===1){var l=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(xn===null||!xn.has(l))){e=fi(i,e),i=Vf(2),l=Tn(a,i,2),l!==null&&(Wf(i,l,a,e),Ni(l,2),Bi(l));break}}a=a.return}}function Uu(e,a,i){var l=e.pingCache;if(l===null){l=e.pingCache=new i1;var u=new Set;l.set(a,u)}else u=l.get(a),u===void 0&&(u=new Set,l.set(a,u));u.has(i)||(Pu=!0,u.add(i),e=o1.bind(null,e,a,i),a.then(e,e))}function o1(e,a,i){var l=e.pingCache;l!==null&&l.delete(a),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ct===e&&(ut&i)===i&&(jt===4||jt===3&&(ut&62914560)===ut&&300>ga()-lo?(At&2)===0&&el(e,0):wu|=i,Qs===ut&&(Qs=0)),Bi(e)}function V0(e,a){a===0&&(a=zi()),e=is(e,a),e!==null&&(Ni(e,a),Bi(e))}function c1(e){var a=e.memoizedState,i=0;a!==null&&(i=a.retryLane),V0(e,i)}function u1(e,a){var i=0;switch(e.tag){case 31:case 13:var l=e.stateNode,u=e.memoizedState;u!==null&&(i=u.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(s(314))}l!==null&&l.delete(a),V0(e,i)}function h1(e,a){return hn(e,a)}var go=null,al=null,zu=!1,po=!1,ku=!1,Dn=0;function Bi(e){e!==al&&e.next===null&&(al===null?go=al=e:al=al.next=e),po=!0,zu||(zu=!0,f1())}function Ql(e,a){if(!ku&&po){ku=!0;do for(var i=!1,l=go;l!==null;){if(e!==0){var u=l.pendingLanes;if(u===0)var h=0;else{var E=l.suspendedLanes,v=l.pingedLanes;h=(1<<31-Ca(42|e)+1)-1,h&=u&~(E&~v),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(i=!0,$0(l,h))}else h=ut,h=gn(l,l===Ct?h:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(h&3)===0||Zn(l,h)||(i=!0,$0(l,h));l=l.next}while(i);ku=!1}}function d1(){W0()}function W0(){po=zu=!1;var e=0;Dn!==0&&v1()&&(e=Dn);for(var a=ga(),i=null,l=go;l!==null;){var u=l.next,h=X0(l,a);h===0?(l.next=null,i===null?go=u:i.next=u,u===null&&(al=i)):(i=l,(e!==0||(h&3)!==0)&&(po=!0)),l=u}ra!==0&&ra!==5||Ql(e),Dn!==0&&(Dn=0)}function X0(e,a){for(var i=e.suspendedLanes,l=e.pingedLanes,u=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var E=31-Ca(h),v=1<<E,C=u[E];C===-1?((v&i)===0||(v&l)!==0)&&(u[E]=Ar(v,a)):C<=a&&(e.expiredLanes|=v),h&=~v}if(a=Ct,i=ut,i=gn(e,e===a?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,i===0||e===a&&(Rt===2||Rt===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&yr(l),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||Zn(e,i)){if(a=i&-i,a===e.callbackPriority)return a;switch(l!==null&&yr(l),Jn(i)){case 2:case 8:i=yl;break;case 32:i=bs;break;case 268435456:i=_r;break;default:i=bs}return l=j0.bind(null,e),i=hn(i,l),e.callbackPriority=a,e.callbackNode=i,a}return l!==null&&l!==null&&yr(l),e.callbackPriority=2,e.callbackNode=null,2}function j0(e,a){if(ra!==0&&ra!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(fo()&&e.callbackNode!==i)return null;var l=ut;return l=gn(e,e===Ct?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(x0(e,l,a),X0(e,ga()),e.callbackNode!=null&&e.callbackNode===i?j0.bind(null,e):null)}function $0(e,a){if(fo())return null;x0(e,a,!0)}function f1(){M1(function(){(At&6)!==0?hn(Er,d1):W0()})}function Vu(){if(Dn===0){var e=Us;e===0&&(e=Fa,Fa<<=1,(Fa&261888)===0&&(Fa=256)),Dn=e}return Dn}function q0(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:hi(""+e)}function Z0(e,a){var i=a.ownerDocument.createElement("input");return i.name=a.name,i.value=a.value,e.id&&i.setAttribute("form",e.id),a.parentNode.insertBefore(i,a),e=new FormData(e),i.parentNode.removeChild(i),e}function g1(e,a,i,l,u){if(a==="submit"&&i&&i.stateNode===u){var h=q0((u[g]||null).action),E=l.submitter;E&&(a=(a=E[g]||null)?q0(a.formAction):E.getAttribute("formAction"),a!==null&&(h=a,E=null));var v=new br("action","action",null,l,u);e.push({event:v,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Dn!==0){var C=E?Z0(u,E):new FormData(u);uu(i,{pending:!0,data:C,method:u.method,action:h},null,C)}}else typeof h=="function"&&(v.preventDefault(),C=E?Z0(u,E):new FormData(u),uu(i,{pending:!0,data:C,method:u.method,action:h},h,C))},currentTarget:u}]})}}for(var Wu=0;Wu<Oc.length;Wu++){var Xu=Oc[Wu],p1=Xu.toLowerCase(),m1=Xu[0].toUpperCase()+Xu.slice(1);Mi(p1,"on"+m1)}Mi(bd,"onAnimationEnd"),Mi(Od,"onAnimationIteration"),Mi(xd,"onAnimationStart"),Mi("dblclick","onDoubleClick"),Mi("focusin","onFocus"),Mi("focusout","onBlur"),Mi(Cm,"onTransitionRun"),Mi(Pm,"onTransitionStart"),Mi(wm,"onTransitionCancel"),Mi(Ld,"onTransitionEnd"),Zt("onMouseEnter",["mouseout","mouseover"]),Zt("onMouseLeave",["mouseout","mouseover"]),Zt("onPointerEnter",["pointerout","pointerover"]),Zt("onPointerLeave",["pointerout","pointerover"]),Ft("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ft("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ft("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ft("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ft("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ft("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),y1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jl));function K0(e,a){a=(a&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],u=l.event;l=l.listeners;e:{var h=void 0;if(a)for(var E=l.length-1;0<=E;E--){var v=l[E],C=v.instance,k=v.currentTarget;if(v=v.listener,C!==h&&u.isPropagationStopped())break e;h=v,u.currentTarget=k;try{h(u)}catch(J){Lr(J)}u.currentTarget=null,h=C}else for(E=0;E<l.length;E++){if(v=l[E],C=v.instance,k=v.currentTarget,v=v.listener,C!==h&&u.isPropagationStopped())break e;h=v,u.currentTarget=k;try{h(u)}catch(J){Lr(J)}u.currentTarget=null,h=C}}}}function ot(e,a){var i=a[_t];i===void 0&&(i=a[_t]=new Set);var l=e+"__bubble";i.has(l)||(Q0(a,e,2,!1),i.add(l))}function ju(e,a,i){var l=0;a&&(l|=4),Q0(i,e,l,a)}var mo="_reactListening"+Math.random().toString(36).slice(2);function $u(e){if(!e[mo]){e[mo]=!0,vi.forEach(function(i){i!=="selectionchange"&&(y1.has(i)||ju(i,!1,e),ju(i,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[mo]||(a[mo]=!0,ju("selectionchange",!1,a))}}function Q0(e,a,i,l){switch(Og(a)){case 2:var u=W1;break;case 8:u=X1;break;default:u=ch}i=u.bind(null,a,i,e),u=void 0,!gc||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(u=!0),l?u!==void 0?e.addEventListener(a,i,{capture:!0,passive:u}):e.addEventListener(a,i,!0):u!==void 0?e.addEventListener(a,i,{passive:u}):e.addEventListener(a,i,!1)}function qu(e,a,i,l,u){var h=l;if((a&1)===0&&(a&2)===0&&l!==null)e:for(;;){if(l===null)return;var E=l.tag;if(E===3||E===4){var v=l.stateNode.containerInfo;if(v===u)break;if(E===4)for(E=l.return;E!==null;){var C=E.tag;if((C===3||C===4)&&E.stateNode.containerInfo===u)return;E=E.return}for(;v!==null;){if(E=It(v),E===null)return;if(C=E.tag,C===5||C===6||C===26||C===27){l=h=E;continue e}v=v.parentNode}}l=l.return}ad(function(){var k=h,J=ki(i),ne=[];e:{var X=Nd.get(e);if(X!==void 0){var j=br,Re=e;switch(e){case"keypress":if(Rr(i)===0)break e;case"keydown":case"keyup":j=um;break;case"focusin":Re="focus",j=Ec;break;case"focusout":Re="blur",j=Ec;break;case"beforeblur":case"afterblur":j=Ec;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=sd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=Qp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=fm;break;case bd:case Od:case xd:j=tm;break;case Ld:j=pm;break;case"scroll":case"scrollend":j=Zp;break;case"wheel":j=ym;break;case"copy":case"cut":case"paste":j=im;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=rd;break;case"toggle":case"beforetoggle":j=_m}var Ie=(a&4)!==0,Dt=!Ie&&(e==="scroll"||e==="scrollend"),H=Ie?X!==null?X+"Capture":null:X;Ie=[];for(var B=k,z;B!==null;){var ae=B;if(z=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||z===null||H===null||(ae=Sl(B,H),ae!=null&&Ie.push(er(B,ae,z))),Dt)break;B=B.return}0<Ie.length&&(X=new j(X,Re,null,i,J),ne.push({event:X,listeners:Ie}))}}if((a&7)===0){e:{if(X=e==="mouseover"||e==="pointerover",j=e==="mouseout"||e==="pointerout",X&&i!==Ds&&(Re=i.relatedTarget||i.fromElement)&&(It(Re)||Re[ve]))break e;if((j||X)&&(X=J.window===J?J:(X=J.ownerDocument)?X.defaultView||X.parentWindow:window,j?(Re=i.relatedTarget||i.toElement,j=k,Re=Re?It(Re):null,Re!==null&&(Dt=o(Re),Ie=Re.tag,Re!==Dt||Ie!==5&&Ie!==27&&Ie!==6)&&(Re=null)):(j=null,Re=k),j!==Re)){if(Ie=sd,ae="onMouseLeave",H="onMouseEnter",B="mouse",(e==="pointerout"||e==="pointerover")&&(Ie=rd,ae="onPointerLeave",H="onPointerEnter",B="pointer"),Dt=j==null?X:Bt(j),z=Re==null?X:Bt(Re),X=new Ie(ae,B+"leave",j,i,J),X.target=Dt,X.relatedTarget=z,ae=null,It(J)===k&&(Ie=new Ie(H,B+"enter",Re,i,J),Ie.target=z,Ie.relatedTarget=Dt,ae=Ie),Dt=ae,j&&Re)t:{for(Ie=E1,H=j,B=Re,z=0,ae=H;ae;ae=Ie(ae))z++;ae=0;for(var De=B;De;De=Ie(De))ae++;for(;0<z-ae;)H=Ie(H),z--;for(;0<ae-z;)B=Ie(B),ae--;for(;z--;){if(H===B||B!==null&&H===B.alternate){Ie=H;break t}H=Ie(H),B=Ie(B)}Ie=null}else Ie=null;j!==null&&J0(ne,X,j,Ie,!1),Re!==null&&Dt!==null&&J0(ne,Dt,Re,Ie,!0)}}e:{if(X=k?Bt(k):window,j=X.nodeName&&X.nodeName.toLowerCase(),j==="select"||j==="input"&&X.type==="file")var mt=pd;else if(fd(X))if(md)mt=Lm;else{mt=Om;var xe=bm}else j=X.nodeName,!j||j.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?k&&Ha(k.elementType)&&(mt=pd):mt=xm;if(mt&&(mt=mt(e,k))){gd(ne,mt,i,J);break e}xe&&xe(e,X,k),e==="focusout"&&k&&X.type==="number"&&k.memoizedProps.value!=null&&Ae(X,"number",X.value)}switch(xe=k?Bt(k):window,e){case"focusin":(fd(xe)||xe.contentEditable==="true")&&(Ps=xe,Rc=k,Ll=null);break;case"focusout":Ll=Rc=Ps=null;break;case"mousedown":Mc=!0;break;case"contextmenu":case"mouseup":case"dragend":Mc=!1,Rd(ne,i,J);break;case"selectionchange":if(Dm)break;case"keydown":case"keyup":Rd(ne,i,J)}var at;if(Ac)e:{switch(e){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else Cs?hd(e,i)&&(ht="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ht="onCompositionStart");ht&&(od&&i.locale!=="ko"&&(Cs||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&Cs&&(at=id()):(pn=J,pc="value"in pn?pn.value:pn.textContent,Cs=!0)),xe=yo(k,ht),0<xe.length&&(ht=new ld(ht,e,null,i,J),ne.push({event:ht,listeners:xe}),at?ht.data=at:(at=dd(i),at!==null&&(ht.data=at)))),(at=Sm?Tm(e,i):vm(e,i))&&(ht=yo(k,"onBeforeInput"),0<ht.length&&(xe=new ld("onBeforeInput","beforeinput",null,i,J),ne.push({event:xe,listeners:ht}),xe.data=at)),g1(ne,e,k,i,J)}K0(ne,a)})}function er(e,a,i){return{instance:e,listener:a,currentTarget:i}}function yo(e,a){for(var i=a+"Capture",l=[];e!==null;){var u=e,h=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||h===null||(u=Sl(e,i),u!=null&&l.unshift(er(e,u,h)),u=Sl(e,a),u!=null&&l.push(er(e,u,h))),e.tag===3)return l;e=e.return}return[]}function E1(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function J0(e,a,i,l,u){for(var h=a._reactName,E=[];i!==null&&i!==l;){var v=i,C=v.alternate,k=v.stateNode;if(v=v.tag,C!==null&&C===l)break;v!==5&&v!==26&&v!==27||k===null||(C=k,u?(k=Sl(i,h),k!=null&&E.unshift(er(i,k,C))):u||(k=Sl(i,h),k!=null&&E.push(er(i,k,C)))),i=i.return}E.length!==0&&e.push({event:a,listeners:E})}var _1=/\r\n?/g,A1=/\u0000|\uFFFD/g;function eg(e){return(typeof e=="string"?e:""+e).replace(_1,`
`).replace(A1,"")}function tg(e,a){return a=eg(a),eg(e)===a}function Nt(e,a,i,l,u,h){switch(i){case"children":typeof l=="string"?a==="body"||a==="textarea"&&l===""||Ke(e,l):(typeof l=="number"||typeof l=="bigint")&&a!=="body"&&Ke(e,""+l);break;case"className":we(e,"class",l);break;case"tabIndex":we(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":we(e,i,l);break;case"style":la(e,l,h);break;case"data":if(a!=="object"){we(e,"data",l);break}case"src":case"href":if(l===""&&(a!=="a"||i!=="href")){e.removeAttribute(i);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=hi(""+l),e.setAttribute(i,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(i==="formAction"?(a!=="input"&&Nt(e,a,"name",u.name,u,null),Nt(e,a,"formEncType",u.formEncType,u,null),Nt(e,a,"formMethod",u.formMethod,u,null),Nt(e,a,"formTarget",u.formTarget,u,null)):(Nt(e,a,"encType",u.encType,u,null),Nt(e,a,"method",u.method,u,null),Nt(e,a,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=hi(""+l),e.setAttribute(i,l);break;case"onClick":l!=null&&(e.onclick=Ja);break;case"onScroll":l!=null&&ot("scroll",e);break;case"onScrollEnd":l!=null&&ot("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(i=l.__html,i!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}i=hi(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""+l):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":l===!0?e.setAttribute(i,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,l):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(i,l):e.removeAttribute(i);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(i):e.setAttribute(i,l);break;case"popover":ot("beforetoggle",e),ot("toggle",e),Fe(e,"popover",l);break;case"xlinkActuate":Me(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Me(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Me(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Me(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Me(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Me(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Me(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Me(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Me(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Fe(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=ua.get(i)||i,Fe(e,i,l))}}function Zu(e,a,i,l,u,h){switch(i){case"style":la(e,l,h);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(i=l.__html,i!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"children":typeof l=="string"?Ke(e,l):(typeof l=="number"||typeof l=="bigint")&&Ke(e,""+l);break;case"onScroll":l!=null&&ot("scroll",e);break;case"onScrollEnd":l!=null&&ot("scrollend",e);break;case"onClick":l!=null&&(e.onclick=Ja);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ri.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(u=i.endsWith("Capture"),a=i.slice(2,u?i.length-7:void 0),h=e[g]||null,h=h!=null?h[i]:null,typeof h=="function"&&e.removeEventListener(a,h,u),typeof l=="function")){typeof h!="function"&&h!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(a,l,u);break e}i in e?e[i]=l:l===!0?e.setAttribute(i,""):Fe(e,i,l)}}}function _a(e,a,i){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ot("error",e),ot("load",e);var l=!1,u=!1,h;for(h in i)if(i.hasOwnProperty(h)){var E=i[h];if(E!=null)switch(h){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:Nt(e,a,h,E,i,null)}}u&&Nt(e,a,"srcSet",i.srcSet,i,null),l&&Nt(e,a,"src",i.src,i,null);return;case"input":ot("invalid",e);var v=h=E=u=null,C=null,k=null;for(l in i)if(i.hasOwnProperty(l)){var J=i[l];if(J!=null)switch(l){case"name":u=J;break;case"type":E=J;break;case"checked":C=J;break;case"defaultChecked":k=J;break;case"value":h=J;break;case"defaultValue":v=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,a));break;default:Nt(e,a,l,J,i,null)}}de(e,h,v,C,k,E,u,!1);return;case"select":ot("invalid",e),l=E=h=null;for(u in i)if(i.hasOwnProperty(u)&&(v=i[u],v!=null))switch(u){case"value":h=v;break;case"defaultValue":E=v;break;case"multiple":l=v;default:Nt(e,a,u,v,i,null)}a=h,i=E,e.multiple=!!l,a!=null?ze(e,!!l,a,!1):i!=null&&ze(e,!!l,i,!0);return;case"textarea":ot("invalid",e),h=u=l=null;for(E in i)if(i.hasOwnProperty(E)&&(v=i[E],v!=null))switch(E){case"value":l=v;break;case"defaultValue":u=v;break;case"children":h=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:Nt(e,a,E,v,i,null)}Ye(e,l,u,h);return;case"option":for(C in i)if(i.hasOwnProperty(C)&&(l=i[C],l!=null))switch(C){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Nt(e,a,C,l,i,null)}return;case"dialog":ot("beforetoggle",e),ot("toggle",e),ot("cancel",e),ot("close",e);break;case"iframe":case"object":ot("load",e);break;case"video":case"audio":for(l=0;l<Jl.length;l++)ot(Jl[l],e);break;case"image":ot("error",e),ot("load",e);break;case"details":ot("toggle",e);break;case"embed":case"source":case"link":ot("error",e),ot("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(k in i)if(i.hasOwnProperty(k)&&(l=i[k],l!=null))switch(k){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:Nt(e,a,k,l,i,null)}return;default:if(Ha(a)){for(J in i)i.hasOwnProperty(J)&&(l=i[J],l!==void 0&&Zu(e,a,J,l,i,void 0));return}}for(v in i)i.hasOwnProperty(v)&&(l=i[v],l!=null&&Nt(e,a,v,l,i,null))}function S1(e,a,i,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,h=null,E=null,v=null,C=null,k=null,J=null;for(j in i){var ne=i[j];if(i.hasOwnProperty(j)&&ne!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":C=ne;default:l.hasOwnProperty(j)||Nt(e,a,j,null,l,ne)}}for(var X in l){var j=l[X];if(ne=i[X],l.hasOwnProperty(X)&&(j!=null||ne!=null))switch(X){case"type":h=j;break;case"name":u=j;break;case"checked":k=j;break;case"defaultChecked":J=j;break;case"value":E=j;break;case"defaultValue":v=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(s(137,a));break;default:j!==ne&&Nt(e,a,X,j,l,ne)}}oe(e,E,v,C,k,J,h,u);return;case"select":j=E=v=X=null;for(h in i)if(C=i[h],i.hasOwnProperty(h)&&C!=null)switch(h){case"value":break;case"multiple":j=C;default:l.hasOwnProperty(h)||Nt(e,a,h,null,l,C)}for(u in l)if(h=l[u],C=i[u],l.hasOwnProperty(u)&&(h!=null||C!=null))switch(u){case"value":X=h;break;case"defaultValue":v=h;break;case"multiple":E=h;default:h!==C&&Nt(e,a,u,h,l,C)}a=v,i=E,l=j,X!=null?ze(e,!!i,X,!1):!!l!=!!i&&(a!=null?ze(e,!!i,a,!0):ze(e,!!i,i?[]:"",!1));return;case"textarea":j=X=null;for(v in i)if(u=i[v],i.hasOwnProperty(v)&&u!=null&&!l.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:Nt(e,a,v,null,l,u)}for(E in l)if(u=l[E],h=i[E],l.hasOwnProperty(E)&&(u!=null||h!=null))switch(E){case"value":X=u;break;case"defaultValue":j=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(s(91));break;default:u!==h&&Nt(e,a,E,u,l,h)}Xe(e,X,j);return;case"option":for(var Re in i)if(X=i[Re],i.hasOwnProperty(Re)&&X!=null&&!l.hasOwnProperty(Re))switch(Re){case"selected":e.selected=!1;break;default:Nt(e,a,Re,null,l,X)}for(C in l)if(X=l[C],j=i[C],l.hasOwnProperty(C)&&X!==j&&(X!=null||j!=null))switch(C){case"selected":e.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:Nt(e,a,C,X,l,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ie in i)X=i[Ie],i.hasOwnProperty(Ie)&&X!=null&&!l.hasOwnProperty(Ie)&&Nt(e,a,Ie,null,l,X);for(k in l)if(X=l[k],j=i[k],l.hasOwnProperty(k)&&X!==j&&(X!=null||j!=null))switch(k){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(s(137,a));break;default:Nt(e,a,k,X,l,j)}return;default:if(Ha(a)){for(var Dt in i)X=i[Dt],i.hasOwnProperty(Dt)&&X!==void 0&&!l.hasOwnProperty(Dt)&&Zu(e,a,Dt,void 0,l,X);for(J in l)X=l[J],j=i[J],!l.hasOwnProperty(J)||X===j||X===void 0&&j===void 0||Zu(e,a,J,X,l,j);return}}for(var H in i)X=i[H],i.hasOwnProperty(H)&&X!=null&&!l.hasOwnProperty(H)&&Nt(e,a,H,null,l,X);for(ne in l)X=l[ne],j=i[ne],!l.hasOwnProperty(ne)||X===j||X==null&&j==null||Nt(e,a,ne,X,l,j)}function ag(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function T1(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,i=performance.getEntriesByType("resource"),l=0;l<i.length;l++){var u=i[l],h=u.transferSize,E=u.initiatorType,v=u.duration;if(h&&v&&ag(E)){for(E=0,v=u.responseEnd,l+=1;l<i.length;l++){var C=i[l],k=C.startTime;if(k>v)break;var J=C.transferSize,ne=C.initiatorType;J&&ag(ne)&&(C=C.responseEnd,E+=J*(C<v?1:(v-k)/(C-k)))}if(--l,a+=8*(h+E)/(u.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Ku=null,Qu=null;function Eo(e){return e.nodeType===9?e:e.ownerDocument}function ig(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ng(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function Ju(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var eh=null;function v1(){var e=window.event;return e&&e.type==="popstate"?e===eh?!1:(eh=e,!0):(eh=null,!1)}var sg=typeof setTimeout=="function"?setTimeout:void 0,R1=typeof clearTimeout=="function"?clearTimeout:void 0,lg=typeof Promise=="function"?Promise:void 0,M1=typeof queueMicrotask=="function"?queueMicrotask:typeof lg<"u"?function(e){return lg.resolve(null).then(e).catch(b1)}:sg;function b1(e){setTimeout(function(){throw e})}function Cn(e){return e==="head"}function rg(e,a){var i=a,l=0;do{var u=i.nextSibling;if(e.removeChild(i),u&&u.nodeType===8)if(i=u.data,i==="/$"||i==="/&"){if(l===0){e.removeChild(u),ll(a);return}l--}else if(i==="$"||i==="$?"||i==="$~"||i==="$!"||i==="&")l++;else if(i==="html")tr(e.ownerDocument.documentElement);else if(i==="head"){i=e.ownerDocument.head,tr(i);for(var h=i.firstChild;h;){var E=h.nextSibling,v=h.nodeName;h[Ot]||v==="SCRIPT"||v==="STYLE"||v==="LINK"&&h.rel.toLowerCase()==="stylesheet"||i.removeChild(h),h=E}}else i==="body"&&tr(e.ownerDocument.body);i=u}while(i);ll(a)}function og(e,a){var i=e;e=0;do{var l=i.nextSibling;if(i.nodeType===1?a?(i._stashedDisplay=i.style.display,i.style.display="none"):(i.style.display=i._stashedDisplay||"",i.getAttribute("style")===""&&i.removeAttribute("style")):i.nodeType===3&&(a?(i._stashedText=i.nodeValue,i.nodeValue=""):i.nodeValue=i._stashedText||""),l&&l.nodeType===8)if(i=l.data,i==="/$"){if(e===0)break;e--}else i!=="$"&&i!=="$?"&&i!=="$~"&&i!=="$!"||e++;i=l}while(i)}function th(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var i=a;switch(a=a.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":th(i),kt(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function O1(e,a,i,l){for(;e.nodeType===1;){var u=i;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Ot])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var h=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=Ei(e.nextSibling),e===null)break}return null}function x1(e,a,i){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Ei(e.nextSibling),e===null))return null;return e}function cg(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Ei(e.nextSibling),e===null))return null;return e}function ah(e){return e.data==="$?"||e.data==="$~"}function ih(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function L1(e,a){var i=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||i.readyState!=="loading")a();else{var l=function(){a(),i.removeEventListener("DOMContentLoaded",l)};i.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Ei(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var nh=null;function ug(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"||i==="/&"){if(a===0)return Ei(e.nextSibling);a--}else i!=="$"&&i!=="$!"&&i!=="$?"&&i!=="$~"&&i!=="&"||a++}e=e.nextSibling}return null}function hg(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"){if(a===0)return e;a--}else i!=="/$"&&i!=="/&"||a++}e=e.previousSibling}return null}function dg(e,a,i){switch(a=Eo(i),e){case"html":if(e=a.documentElement,!e)throw Error(s(452));return e;case"head":if(e=a.head,!e)throw Error(s(453));return e;case"body":if(e=a.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function tr(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);kt(e)}var _i=new Map,fg=new Set;function _o(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var rn=se.d;se.d={f:N1,r:D1,D:C1,C:P1,L:w1,m:I1,X:F1,S:B1,M:H1};function N1(){var e=rn.f(),a=co();return e||a}function D1(e){var a=wt(e);a!==null&&a.tag===5&&a.type==="form"?Nf(a):rn.r(e)}var il=typeof document>"u"?null:document;function gg(e,a,i){var l=il;if(l&&typeof a=="string"&&a){var u=ie(a);u='link[rel="'+e+'"][href="'+u+'"]',typeof i=="string"&&(u+='[crossorigin="'+i+'"]'),fg.has(u)||(fg.add(u),e={rel:e,crossOrigin:i,href:a},l.querySelector(u)===null&&(a=l.createElement("link"),_a(a,"link",e),xt(a),l.head.appendChild(a)))}}function C1(e){rn.D(e),gg("dns-prefetch",e,null)}function P1(e,a){rn.C(e,a),gg("preconnect",e,a)}function w1(e,a,i){rn.L(e,a,i);var l=il;if(l&&e&&a){var u='link[rel="preload"][as="'+ie(a)+'"]';a==="image"&&i&&i.imageSrcSet?(u+='[imagesrcset="'+ie(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(u+='[imagesizes="'+ie(i.imageSizes)+'"]')):u+='[href="'+ie(e)+'"]';var h=u;switch(a){case"style":h=nl(e);break;case"script":h=sl(e)}_i.has(h)||(e=_({rel:"preload",href:a==="image"&&i&&i.imageSrcSet?void 0:e,as:a},i),_i.set(h,e),l.querySelector(u)!==null||a==="style"&&l.querySelector(ar(h))||a==="script"&&l.querySelector(ir(h))||(a=l.createElement("link"),_a(a,"link",e),xt(a),l.head.appendChild(a)))}}function I1(e,a){rn.m(e,a);var i=il;if(i&&e){var l=a&&typeof a.as=="string"?a.as:"script",u='link[rel="modulepreload"][as="'+ie(l)+'"][href="'+ie(e)+'"]',h=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=sl(e)}if(!_i.has(h)&&(e=_({rel:"modulepreload",href:e},a),_i.set(h,e),i.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(ir(h)))return}l=i.createElement("link"),_a(l,"link",e),xt(l),i.head.appendChild(l)}}}function B1(e,a,i){rn.S(e,a,i);var l=il;if(l&&e){var u=We(l).hoistableStyles,h=nl(e);a=a||"default";var E=u.get(h);if(!E){var v={loading:0,preload:null};if(E=l.querySelector(ar(h)))v.loading=5;else{e=_({rel:"stylesheet",href:e,"data-precedence":a},i),(i=_i.get(h))&&sh(e,i);var C=E=l.createElement("link");xt(C),_a(C,"link",e),C._p=new Promise(function(k,J){C.onload=k,C.onerror=J}),C.addEventListener("load",function(){v.loading|=1}),C.addEventListener("error",function(){v.loading|=2}),v.loading|=4,Ao(E,a,l)}E={type:"stylesheet",instance:E,count:1,state:v},u.set(h,E)}}}function F1(e,a){rn.X(e,a);var i=il;if(i&&e){var l=We(i).hoistableScripts,u=sl(e),h=l.get(u);h||(h=i.querySelector(ir(u)),h||(e=_({src:e,async:!0},a),(a=_i.get(u))&&lh(e,a),h=i.createElement("script"),xt(h),_a(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(u,h))}}function H1(e,a){rn.M(e,a);var i=il;if(i&&e){var l=We(i).hoistableScripts,u=sl(e),h=l.get(u);h||(h=i.querySelector(ir(u)),h||(e=_({src:e,async:!0,type:"module"},a),(a=_i.get(u))&&lh(e,a),h=i.createElement("script"),xt(h),_a(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(u,h))}}function pg(e,a,i,l){var u=(u=q.current)?_o(u):null;if(!u)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(a=nl(i.href),i=We(u).hoistableStyles,l=i.get(a),l||(l={type:"style",instance:null,count:0,state:null},i.set(a,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=nl(i.href);var h=We(u).hoistableStyles,E=h.get(e);if(E||(u=u.ownerDocument||u,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,E),(h=u.querySelector(ar(e)))&&!h._p&&(E.instance=h,E.state.loading=5),_i.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},_i.set(e,i),h||G1(u,e,i,E.state))),a&&l===null)throw Error(s(528,""));return E}if(a&&l!==null)throw Error(s(529,""));return null;case"script":return a=i.async,i=i.src,typeof i=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=sl(i),i=We(u).hoistableScripts,l=i.get(a),l||(l={type:"script",instance:null,count:0,state:null},i.set(a,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function nl(e){return'href="'+ie(e)+'"'}function ar(e){return'link[rel="stylesheet"]['+e+"]"}function mg(e){return _({},e,{"data-precedence":e.precedence,precedence:null})}function G1(e,a,i,l){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?l.loading=1:(a=e.createElement("link"),l.preload=a,a.addEventListener("load",function(){return l.loading|=1}),a.addEventListener("error",function(){return l.loading|=2}),_a(a,"link",i),xt(a),e.head.appendChild(a))}function sl(e){return'[src="'+ie(e)+'"]'}function ir(e){return"script[async]"+e}function yg(e,a,i){if(a.count++,a.instance===null)switch(a.type){case"style":var l=e.querySelector('style[data-href~="'+ie(i.href)+'"]');if(l)return a.instance=l,xt(l),l;var u=_({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),xt(l),_a(l,"style",u),Ao(l,i.precedence,e),a.instance=l;case"stylesheet":u=nl(i.href);var h=e.querySelector(ar(u));if(h)return a.state.loading|=4,a.instance=h,xt(h),h;l=mg(i),(u=_i.get(u))&&sh(l,u),h=(e.ownerDocument||e).createElement("link"),xt(h);var E=h;return E._p=new Promise(function(v,C){E.onload=v,E.onerror=C}),_a(h,"link",l),a.state.loading|=4,Ao(h,i.precedence,e),a.instance=h;case"script":return h=sl(i.src),(u=e.querySelector(ir(h)))?(a.instance=u,xt(u),u):(l=i,(u=_i.get(h))&&(l=_({},i),lh(l,u)),e=e.ownerDocument||e,u=e.createElement("script"),xt(u),_a(u,"link",l),e.head.appendChild(u),a.instance=u);case"void":return null;default:throw Error(s(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(l=a.instance,a.state.loading|=4,Ao(l,i.precedence,e));return a.instance}function Ao(e,a,i){for(var l=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,h=u,E=0;E<l.length;E++){var v=l[E];if(v.dataset.precedence===a)h=v;else if(h!==u)break}h?h.parentNode.insertBefore(e,h.nextSibling):(a=i.nodeType===9?i.head:i,a.insertBefore(e,a.firstChild))}function sh(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function lh(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var So=null;function Eg(e,a,i){if(So===null){var l=new Map,u=So=new Map;u.set(i,l)}else u=So,l=u.get(i),l||(l=new Map,u.set(i,l));if(l.has(e))return l;for(l.set(e,null),i=i.getElementsByTagName(e),u=0;u<i.length;u++){var h=i[u];if(!(h[Ot]||h[F]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var E=h.getAttribute(a)||"";E=e+E;var v=l.get(E);v?v.push(h):l.set(E,[h])}}return l}function _g(e,a,i){e=e.ownerDocument||e,e.head.insertBefore(i,a==="title"?e.querySelector("head > title"):null)}function Y1(e,a,i){if(i===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ag(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function U1(e,a,i,l){if(i.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var u=nl(l.href),h=a.querySelector(ar(u));if(h){a=h._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=To.bind(e),a.then(e,e)),i.state.loading|=4,i.instance=h,xt(h);return}h=a.ownerDocument||a,l=mg(l),(u=_i.get(u))&&sh(l,u),h=h.createElement("link"),xt(h);var E=h;E._p=new Promise(function(v,C){E.onload=v,E.onerror=C}),_a(h,"link",l),i.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(i,a),(a=i.state.preload)&&(i.state.loading&3)===0&&(e.count++,i=To.bind(e),a.addEventListener("load",i),a.addEventListener("error",i))}}var rh=0;function z1(e,a){return e.stylesheets&&e.count===0&&Ro(e,e.stylesheets),0<e.count||0<e.imgCount?function(i){var l=setTimeout(function(){if(e.stylesheets&&Ro(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+a);0<e.imgBytes&&rh===0&&(rh=62500*T1());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Ro(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>rh?50:800)+a);return e.unsuspend=i,function(){e.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function To(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ro(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var vo=null;function Ro(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,vo=new Map,a.forEach(k1,e),vo=null,To.call(e))}function k1(e,a){if(!(a.state.loading&4)){var i=vo.get(e);if(i)var l=i.get(null);else{i=new Map,vo.set(e,i);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<u.length;h++){var E=u[h];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(i.set(E.dataset.precedence,E),l=E)}l&&i.set(null,l)}u=a.instance,E=u.getAttribute("data-precedence"),h=i.get(E)||l,h===l&&i.set(null,u),i.set(E,u),this.count++,l=To.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),h?h.parentNode.insertBefore(u,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),a.state.loading|=4}}var nr={$$typeof:I,Provider:null,Consumer:null,_currentValue:ye,_currentValue2:ye,_threadCount:0};function V1(e,a,i,l,u,h,E,v,C){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Kn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kn(0),this.hiddenUpdates=Kn(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=h,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=C,this.incompleteTransitions=new Map}function Sg(e,a,i,l,u,h,E,v,C,k,J,ne){return e=new V1(e,a,i,E,C,k,J,ne,v),a=1,h===!0&&(a|=24),h=ti(3,null,null,a),e.current=h,h.stateNode=e,a=Yc(),a.refCount++,e.pooledCache=a,a.refCount++,h.memoizedState={element:l,isDehydrated:i,cache:a},Vc(h),e}function Tg(e){return e?(e=Bs,e):Bs}function vg(e,a,i,l,u,h){u=Tg(u),l.context===null?l.context=u:l.pendingContext=u,l=Sn(a),l.payload={element:i},h=h===void 0?null:h,h!==null&&(l.callback=h),i=Tn(e,l,a),i!==null&&(Va(i,e,a),Bl(i,e,a))}function Rg(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<a?i:a}}function oh(e,a){Rg(e,a),(e=e.alternate)&&Rg(e,a)}function Mg(e){if(e.tag===13||e.tag===31){var a=is(e,67108864);a!==null&&Va(a,e,67108864),oh(e,67108864)}}function bg(e){if(e.tag===13||e.tag===31){var a=li();a=Qn(a);var i=is(e,a);i!==null&&Va(i,e,a),oh(e,a)}}var Mo=!0;function W1(e,a,i,l){var u=U.T;U.T=null;var h=se.p;try{se.p=2,ch(e,a,i,l)}finally{se.p=h,U.T=u}}function X1(e,a,i,l){var u=U.T;U.T=null;var h=se.p;try{se.p=8,ch(e,a,i,l)}finally{se.p=h,U.T=u}}function ch(e,a,i,l){if(Mo){var u=uh(l);if(u===null)qu(e,a,l,bo,i),xg(e,l);else if($1(u,e,a,i,l))l.stopPropagation();else if(xg(e,l),a&4&&-1<j1.indexOf(e)){for(;u!==null;){var h=wt(u);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var E=Ti(h.pendingLanes);if(E!==0){var v=h;for(v.pendingLanes|=2,v.entangledLanes|=2;E;){var C=1<<31-Ca(E);v.entanglements[1]|=C,E&=~C}Bi(h),(At&6)===0&&(ro=ga()+500,Ql(0))}}break;case 31:case 13:v=is(h,2),v!==null&&Va(v,h,2),co(),oh(h,2)}if(h=uh(l),h===null&&qu(e,a,l,bo,i),h===u)break;u=h}u!==null&&l.stopPropagation()}else qu(e,a,l,null,i)}}function uh(e){return e=ki(e),hh(e)}var bo=null;function hh(e){if(bo=null,e=It(e),e!==null){var a=o(e);if(a===null)e=null;else{var i=a.tag;if(i===13){if(e=d(a),e!==null)return e;e=null}else if(i===31){if(e=f(a),e!==null)return e;e=null}else if(i===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return bo=e,null}function Og(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(uc()){case Er:return 2;case yl:return 8;case bs:case hc:return 32;case _r:return 268435456;default:return 32}default:return 32}}var dh=!1,Pn=null,wn=null,In=null,sr=new Map,lr=new Map,Bn=[],j1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xg(e,a){switch(e){case"focusin":case"focusout":Pn=null;break;case"dragenter":case"dragleave":wn=null;break;case"mouseover":case"mouseout":In=null;break;case"pointerover":case"pointerout":sr.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":lr.delete(a.pointerId)}}function rr(e,a,i,l,u,h){return e===null||e.nativeEvent!==h?(e={blockedOn:a,domEventName:i,eventSystemFlags:l,nativeEvent:h,targetContainers:[u]},a!==null&&(a=wt(a),a!==null&&Mg(a)),e):(e.eventSystemFlags|=l,a=e.targetContainers,u!==null&&a.indexOf(u)===-1&&a.push(u),e)}function $1(e,a,i,l,u){switch(a){case"focusin":return Pn=rr(Pn,e,a,i,l,u),!0;case"dragenter":return wn=rr(wn,e,a,i,l,u),!0;case"mouseover":return In=rr(In,e,a,i,l,u),!0;case"pointerover":var h=u.pointerId;return sr.set(h,rr(sr.get(h)||null,e,a,i,l,u)),!0;case"gotpointercapture":return h=u.pointerId,lr.set(h,rr(lr.get(h)||null,e,a,i,l,u)),!0}return!1}function Lg(e){var a=It(e.target);if(a!==null){var i=o(a);if(i!==null){if(a=i.tag,a===13){if(a=d(i),a!==null){e.blockedOn=a,Ns(e.priority,function(){bg(i)});return}}else if(a===31){if(a=f(i),a!==null){e.blockedOn=a,Ns(e.priority,function(){bg(i)});return}}else if(a===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Oo(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var i=uh(e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);Ds=l,i.target.dispatchEvent(l),Ds=null}else return a=wt(i),a!==null&&Mg(a),e.blockedOn=i,!1;a.shift()}return!0}function Ng(e,a,i){Oo(e)&&i.delete(a)}function q1(){dh=!1,Pn!==null&&Oo(Pn)&&(Pn=null),wn!==null&&Oo(wn)&&(wn=null),In!==null&&Oo(In)&&(In=null),sr.forEach(Ng),lr.forEach(Ng)}function xo(e,a){e.blockedOn===a&&(e.blockedOn=null,dh||(dh=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,q1)))}var Lo=null;function Dg(e){Lo!==e&&(Lo=e,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){Lo===e&&(Lo=null);for(var a=0;a<e.length;a+=3){var i=e[a],l=e[a+1],u=e[a+2];if(typeof l!="function"){if(hh(l||i)===null)continue;break}var h=wt(i);h!==null&&(e.splice(a,3),a-=3,uu(h,{pending:!0,data:u,method:i.method,action:l},l,u))}}))}function ll(e){function a(C){return xo(C,e)}Pn!==null&&xo(Pn,e),wn!==null&&xo(wn,e),In!==null&&xo(In,e),sr.forEach(a),lr.forEach(a);for(var i=0;i<Bn.length;i++){var l=Bn[i];l.blockedOn===e&&(l.blockedOn=null)}for(;0<Bn.length&&(i=Bn[0],i.blockedOn===null);)Lg(i),i.blockedOn===null&&Bn.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(l=0;l<i.length;l+=3){var u=i[l],h=i[l+1],E=u[g]||null;if(typeof h=="function")E||Dg(i);else if(E){var v=null;if(h&&h.hasAttribute("formAction")){if(u=h,E=h[g]||null)v=E.formAction;else if(hh(u)!==null)continue}else v=E.action;typeof v=="function"?i[l+1]=v:(i.splice(l,3),l-=3),Dg(i)}}}function Cg(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(E){return u=E})},focusReset:"manual",scroll:"manual"})}function a(){u!==null&&(u(),u=null),l||setTimeout(i,20)}function i(){if(!l&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(i,100),function(){l=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),u!==null&&(u(),u=null)}}}function fh(e){this._internalRoot=e}No.prototype.render=fh.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(s(409));var i=a.current,l=li();vg(i,l,e,a,null,null)},No.prototype.unmount=fh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;vg(e.current,2,null,e,null,null),co(),a[ve]=null}};function No(e){this._internalRoot=e}No.prototype.unstable_scheduleHydration=function(e){if(e){var a=Ls();e={blockedOn:null,target:e,priority:a};for(var i=0;i<Bn.length&&a!==0&&a<Bn[i].priority;i++);Bn.splice(i,0,e),i===0&&Lg(e)}};var Pg=t.version;if(Pg!=="19.2.0")throw Error(s(527,Pg,"19.2.0"));se.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=y(a),e=e!==null?m(e):null,e=e===null?null:e.stateNode,e};var Z1={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Do=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Do.isDisabled&&Do.supportsFiber)try{pa=Do.inject(Z1),Da=Do}catch{}}return cr.createRoot=function(e,a){if(!r(e))throw Error(s(299));var i=!1,l="",u=Yf,h=Uf,E=zf;return a!=null&&(a.unstable_strictMode===!0&&(i=!0),a.identifierPrefix!==void 0&&(l=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(h=a.onCaughtError),a.onRecoverableError!==void 0&&(E=a.onRecoverableError)),a=Sg(e,1,!1,null,null,i,l,null,u,h,E,Cg),e[ve]=a.current,$u(e),new fh(a)},cr.hydrateRoot=function(e,a,i){if(!r(e))throw Error(s(299));var l=!1,u="",h=Yf,E=Uf,v=zf,C=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(h=i.onUncaughtError),i.onCaughtError!==void 0&&(E=i.onCaughtError),i.onRecoverableError!==void 0&&(v=i.onRecoverableError),i.formState!==void 0&&(C=i.formState)),a=Sg(e,1,!0,a,i??null,l,u,C,h,E,v,Cg),a.context=Tg(null),i=a.current,l=li(),l=Qn(l),u=Sn(l),u.callback=null,Tn(i,u,l),i=l,a.current.lanes=i,Ni(a,i),Bi(a),e[ve]=a.current,$u(e),new No(a)},cr.version="19.2.0",cr}var kg;function ry(){if(kg)return mh.exports;kg=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),mh.exports=ly(),mh.exports}var oy=ry();const cy=Lp(oy),uy="modulepreload",hy=function(c){return"/"+c},Vg={},zt=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){let d=function(y){return Promise.all(y.map(m=>Promise.resolve(m).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));r=d(n.map(y=>{if(y=hy(y),y in Vg)return;Vg[y]=!0;const m=y.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${_}`))return;const S=document.createElement("link");if(S.rel=m?"stylesheet":uy,m||(S.as="script"),S.crossOrigin="",S.href=y,p&&S.setAttribute("nonce",p),document.head.appendChild(S),m)return new Promise((R,b)=>{S.addEventListener("load",R),S.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${y}`)))})}))}function o(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return r.then(d=>{for(const f of d||[])f.status==="rejected"&&o(f.reason);return t().catch(o)})},He=(c,t={})=>({type:c,params:{speedMultiplier:1,amplitude:1,frequency:.03,trackingStrength:0,phaseShift:0,...t}}),Ge=(c,t)=>({type:c,params:{bulletCount:3,spreadAngle:.3,fireRate:30,bulletSpeed:1,aimAtPlayer:!0,...t}}),jo={SCOUT_WING:{variantId:"SCOUT_WING",displayName:"SCOUT WING",subtitle:"Reconnaissance Unit",spriteKey:"bossScoutWing",baseBossType:"ACE_SQUADRON",hpMultiplier:.75,size:{width:180,height:180},phases:[{hpThreshold:1,movementPattern:He("sine",{speedMultiplier:.7,frequency:.02}),attackPattern:Ge("spread",{bulletCount:3,spreadAngle:.25,fireRate:40}),fireRateMultiplier:.8,speedMultiplier:.7},{hpThreshold:.5,movementPattern:He("sine",{speedMultiplier:.9,frequency:.03}),attackPattern:Ge("spread",{bulletCount:4,spreadAngle:.3,fireRate:35}),fireRateMultiplier:.9,speedMultiplier:.9}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{}},PATROL_FORTRESS:{variantId:"PATROL_FORTRESS",displayName:"PATROL FORTRESS",subtitle:"Defensive Outpost",spriteKey:"bossPatrolFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:.8,size:{width:220,height:220},phases:[{hpThreshold:1,movementPattern:He("sweep",{speedMultiplier:.6}),attackPattern:Ge("spread",{bulletCount:2,spreadAngle:.2,fireRate:50}),fireRateMultiplier:.7,speedMultiplier:.6},{hpThreshold:.4,movementPattern:He("sweep",{speedMultiplier:.8}),attackPattern:Ge("spread",{bulletCount:3,spreadAngle:.3,fireRate:40}),fireRateMultiplier:.85,speedMultiplier:.8}],turretConfig:{count:2,fireRateMultiplier:.8,hpMultiplier:.8},specialMechanics:{}},COASTAL_CRUISER:{variantId:"COASTAL_CRUISER",displayName:"COASTAL CRUISER",subtitle:"Naval Patrol",spriteKey:"bossCoastalCruiser",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:.85,size:{width:200,height:260},phases:[{hpThreshold:1,movementPattern:He("erratic",{speedMultiplier:.5}),attackPattern:Ge("spread",{bulletCount:3,spreadAngle:.35,fireRate:55}),fireRateMultiplier:.75,speedMultiplier:.5},{hpThreshold:.6,movementPattern:He("erratic",{speedMultiplier:.7}),attackPattern:Ge("barrage",{bulletCount:4,spreadAngle:.3,fireRate:45,burstCount:2,burstDelay:8}),fireRateMultiplier:.85,speedMultiplier:.7},{hpThreshold:.3,movementPattern:He("erratic",{speedMultiplier:.9}),attackPattern:Ge("barrage",{bulletCount:5,spreadAngle:.35,fireRate:40,burstCount:3,burstDelay:6}),fireRateMultiplier:.95,speedMultiplier:.9}],turretConfig:{count:3,fireRateMultiplier:.85,hpMultiplier:.85},specialMechanics:{}},RECON_AIRSHIP:{variantId:"RECON_AIRSHIP",displayName:"RECON AIRSHIP",subtitle:"Scout Carrier",spriteKey:"bossReconAirship",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:.9,size:{width:230,height:200},phases:[{hpThreshold:1,movementPattern:He("figure8",{speedMultiplier:.8}),attackPattern:Ge("spread",{bulletCount:4,spreadAngle:.3,fireRate:45}),fireRateMultiplier:.85,speedMultiplier:.8},{hpThreshold:.4,movementPattern:He("figure8",{speedMultiplier:1}),attackPattern:Ge("spiral",{bulletCount:5,spreadAngle:.4,fireRate:35,spiralSpeed:.04}),fireRateMultiplier:.95,speedMultiplier:1}],turretConfig:{count:2,fireRateMultiplier:.9,hpMultiplier:.9},specialMechanics:{hasMinions:!0,minionSpawnRate:300,minionCount:2}},PROTOTYPE_WEAPON:{variantId:"PROTOTYPE_WEAPON",displayName:"PROTOTYPE WEAPON",subtitle:"Experimental Unit",spriteKey:"bossPrototypeWeapon",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:.95,size:{width:260,height:260},phases:[{hpThreshold:1,movementPattern:He("sine",{speedMultiplier:.7}),attackPattern:Ge("spiral",{bulletCount:4,spreadAngle:.5,fireRate:50,spiralSpeed:.03}),fireRateMultiplier:.8,speedMultiplier:.7},{hpThreshold:.6,movementPattern:He("sine",{speedMultiplier:.9}),attackPattern:Ge("spiral",{bulletCount:5,spreadAngle:.6,fireRate:40,spiralSpeed:.04}),fireRateMultiplier:.9,speedMultiplier:.9},{hpThreshold:.3,movementPattern:He("aggressive",{speedMultiplier:1,trackingStrength:.3}),attackPattern:Ge("mixed",{bulletCount:5,spreadAngle:.5,fireRate:35}),fireRateMultiplier:1,speedMultiplier:1}],turretConfig:{count:3,fireRateMultiplier:.9,hpMultiplier:.9},specialMechanics:{hasFlareSpray:!0,flareSprayInterval:300,flareDuration:90,flareDeflectRadius:120}},ACE_VETERANS:{variantId:"ACE_VETERANS",displayName:"ACE VETERANS",subtitle:"Elite Squadron",spriteKey:"bossAceVeterans",baseBossType:"ACE_SQUADRON",hpMultiplier:1,size:{width:195,height:195},phases:[{hpThreshold:1,movementPattern:He("sine",{speedMultiplier:1}),attackPattern:Ge("spread",{bulletCount:4,spreadAngle:.3,fireRate:30}),fireRateMultiplier:1,speedMultiplier:1},{hpThreshold:.6,movementPattern:He("sine",{speedMultiplier:1.2,frequency:.04}),attackPattern:Ge("spiral",{bulletCount:5,spreadAngle:.4,fireRate:25,spiralSpeed:.05}),fireRateMultiplier:1.1,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:He("aggressive",{speedMultiplier:1.4,trackingStrength:.4}),attackPattern:Ge("spiral",{bulletCount:6,spreadAngle:.5,fireRate:20,spiralSpeed:.06}),fireRateMultiplier:1.2,speedMultiplier:1.4}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.5,enrageFireRateBoost:1.25}},IRON_FORTRESS:{variantId:"IRON_FORTRESS",displayName:"IRON FORTRESS",subtitle:"Armored Bastion",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.05,size:{width:234,height:234},phases:[{hpThreshold:1,movementPattern:He("sweep",{speedMultiplier:.8}),attackPattern:Ge("mixed",{bulletCount:4,spreadAngle:.35,fireRate:40}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.5,movementPattern:He("sweep",{speedMultiplier:1}),attackPattern:Ge("barrage",{bulletCount:5,spreadAngle:.4,fireRate:30,burstCount:3,burstDelay:5}),fireRateMultiplier:1.1,speedMultiplier:1}],turretConfig:{count:4,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{}},DREADNOUGHT:{variantId:"DREADNOUGHT",displayName:"DREADNOUGHT",subtitle:"Assault Cruiser",spriteKey:"bossDreadnought",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.1,size:{width:195,height:273},phases:[{hpThreshold:1,movementPattern:He("aggressive",{speedMultiplier:.8,trackingStrength:.3}),attackPattern:Ge("barrage",{bulletCount:4,spreadAngle:.3,fireRate:45,burstCount:3,burstDelay:6}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.6,movementPattern:He("aggressive",{speedMultiplier:1,trackingStrength:.4}),attackPattern:Ge("barrage",{bulletCount:5,spreadAngle:.35,fireRate:35,burstCount:4,burstDelay:5}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.3,movementPattern:He("aggressive",{speedMultiplier:1.3,trackingStrength:.5}),attackPattern:Ge("barrage",{bulletCount:6,spreadAngle:.4,fireRate:28,burstCount:5,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.3}],turretConfig:{count:5,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.4,enrageFireRateBoost:1.2}},DREADNOUGHT_ELITE:{variantId:"DREADNOUGHT_ELITE",displayName:"DREADNOUGHT ELITE",subtitle:"Command Vessel",spriteKey:"bossDreadnoughtElite",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.15,size:{width:210,height:290},phases:[{hpThreshold:1,movementPattern:He("aggressive",{speedMultiplier:.9,trackingStrength:.35}),attackPattern:Ge("barrage",{bulletCount:5,spreadAngle:.35,fireRate:40,burstCount:4,burstDelay:5}),fireRateMultiplier:1.05,speedMultiplier:.9},{hpThreshold:.6,movementPattern:He("aggressive",{speedMultiplier:1.1,trackingStrength:.45}),attackPattern:Ge("mixed",{bulletCount:6,spreadAngle:.4,fireRate:32}),fireRateMultiplier:1.15,speedMultiplier:1.1},{hpThreshold:.3,movementPattern:He("chase",{speedMultiplier:1.4,trackingStrength:.55}),attackPattern:Ge("barrage",{bulletCount:7,spreadAngle:.45,fireRate:25,burstCount:5,burstDelay:4}),fireRateMultiplier:1.3,speedMultiplier:1.4}],turretConfig:{count:6,fireRateMultiplier:1.1,hpMultiplier:1.1},specialMechanics:{hasArmorPlating:!0,armorPlateCount:2,armorPlateHP:35,hasSmokeScreen:!0,smokeScreenInterval:420,smokeScreenDuration:120}},STORM_CARRIER:{variantId:"STORM_CARRIER",displayName:"STORM CARRIER",subtitle:"Fighter Bay",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.1,size:{width:234,height:195},phases:[{hpThreshold:1,movementPattern:He("orbit",{speedMultiplier:.9,amplitude:.8}),attackPattern:Ge("mixed",{bulletCount:4,spreadAngle:.35,fireRate:45}),fireRateMultiplier:1,speedMultiplier:.9},{hpThreshold:.5,movementPattern:He("orbit",{speedMultiplier:1.1,amplitude:1}),attackPattern:Ge("missiles",{bulletCount:3,spreadAngle:.5,fireRate:60,aimAtPlayer:!0}),fireRateMultiplier:1.1,speedMultiplier:1.1}],turretConfig:{count:3,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasMinions:!0,minionSpawnRate:180,minionCount:4}},JUGGERNAUT:{variantId:"JUGGERNAUT",displayName:"JUGGERNAUT",subtitle:"Super Weapon",spriteKey:"bossJuggernaut",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:1.2,size:{width:273,height:273},phases:[{hpThreshold:1,movementPattern:He("sine",{speedMultiplier:.8}),attackPattern:Ge("spiral",{bulletCount:5,spreadAngle:.6,fireRate:50,spiralSpeed:.04}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.7,movementPattern:He("aggressive",{speedMultiplier:1,trackingStrength:.4}),attackPattern:Ge("mixed",{bulletCount:6,spreadAngle:.5,fireRate:40}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.5,movementPattern:He("chase",{speedMultiplier:1.2,trackingStrength:.5}),attackPattern:Ge("spiral",{bulletCount:6,spreadAngle:.7,fireRate:35,spiralSpeed:.05}),fireRateMultiplier:1.2,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:He("chase",{speedMultiplier:1.4,trackingStrength:.6}),attackPattern:Ge("barrage",{bulletCount:7,spreadAngle:.5,fireRate:28,burstCount:4,burstDelay:4}),fireRateMultiplier:1.35,speedMultiplier:1.4}],turretConfig:{count:5,fireRateMultiplier:1.1,hpMultiplier:1.1},specialMechanics:{hasArmorPlating:!0,armorPlateCount:3,armorPlateHP:40,hasFlareSpray:!0,flareSprayInterval:240,flareDuration:75,flareDeflectRadius:150,hasMinions:!0,minionSpawnRate:240,minionCount:3}},DEATH_SQUADRON:{variantId:"DEATH_SQUADRON",displayName:"DEATH SQUADRON",subtitle:"Hunter-Killer",spriteKey:"bossDeathSquadron",baseBossType:"ACE_SQUADRON",hpMultiplier:1.1,size:{width:195,height:195},phases:[{hpThreshold:1,movementPattern:He("chase",{speedMultiplier:1.1,trackingStrength:.45}),attackPattern:Ge("aimed",{bulletCount:2,spreadAngle:.1,fireRate:25,bulletSpeed:1.2}),fireRateMultiplier:1.1,speedMultiplier:1.1},{hpThreshold:.6,movementPattern:He("chase",{speedMultiplier:1.3,trackingStrength:.55}),attackPattern:Ge("aimed",{bulletCount:3,spreadAngle:.15,fireRate:20,bulletSpeed:1.3}),fireRateMultiplier:1.25,speedMultiplier:1.3},{hpThreshold:.3,movementPattern:He("chase",{speedMultiplier:1.5,trackingStrength:.65}),attackPattern:Ge("mixed",{bulletCount:4,spreadAngle:.2,fireRate:18,bulletSpeed:1.4}),fireRateMultiplier:1.4,speedMultiplier:1.5}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.6,enrageFireRateBoost:1.3,hasMinions:!0,minionSpawnRate:240,minionCount:2}},SKY_FORTRESS:{variantId:"SKY_FORTRESS",displayName:"SKY FORTRESS",subtitle:"Aerial Stronghold",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.15,size:{width:234,height:234},phases:[{hpThreshold:1,movementPattern:He("orbit",{speedMultiplier:1,amplitude:.9}),attackPattern:Ge("mixed",{bulletCount:5,spreadAngle:.4,fireRate:35}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.5,movementPattern:He("aggressive",{speedMultiplier:1.2,trackingStrength:.45}),attackPattern:Ge("barrage",{bulletCount:6,spreadAngle:.45,fireRate:28,burstCount:4,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.2}],turretConfig:{count:4,fireRateMultiplier:1.15,hpMultiplier:1.1},specialMechanics:{hasSmokeScreen:!0,smokeScreenInterval:360,smokeScreenDuration:100,hasFlareSpray:!0,flareSprayInterval:270,flareDuration:60,flareDeflectRadius:100}},SKY_FORTRESS_OMEGA:{variantId:"SKY_FORTRESS_OMEGA",displayName:"SKY FORTRESS OMEGA",subtitle:"Command Citadel",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.25,size:{width:250,height:250},phases:[{hpThreshold:1,movementPattern:He("aggressive",{speedMultiplier:1.1,trackingStrength:.5}),attackPattern:Ge("spiral",{bulletCount:6,spreadAngle:.5,fireRate:35,spiralSpeed:.05}),fireRateMultiplier:1.15,speedMultiplier:1.1},{hpThreshold:.5,movementPattern:He("chase",{speedMultiplier:1.3,trackingStrength:.55}),attackPattern:Ge("mixed",{bulletCount:7,spreadAngle:.55,fireRate:28}),fireRateMultiplier:1.3,speedMultiplier:1.3}],turretConfig:{count:6,fireRateMultiplier:1.2,hpMultiplier:1.15},specialMechanics:{hasMinions:!0,minionSpawnRate:150,minionCount:4}},LEVIATHAN:{variantId:"LEVIATHAN",displayName:"LEVIATHAN",subtitle:"Sea Monster",spriteKey:"bossDreadnoughtElite",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.3,size:{width:220,height:300},phases:[{hpThreshold:1,movementPattern:He("orbit",{speedMultiplier:1,amplitude:1}),attackPattern:Ge("barrage",{bulletCount:6,spreadAngle:.4,fireRate:38,burstCount:4,burstDelay:5}),fireRateMultiplier:1.15,speedMultiplier:1},{hpThreshold:.6,movementPattern:He("orbit",{speedMultiplier:1.2,amplitude:1.2}),attackPattern:Ge("barrage",{bulletCount:7,spreadAngle:.45,fireRate:30,burstCount:5,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:He("aggressive",{speedMultiplier:1.4,trackingStrength:.5}),attackPattern:Ge("barrage",{bulletCount:8,spreadAngle:.5,fireRate:25,burstCount:6,burstDelay:3}),fireRateMultiplier:1.4,speedMultiplier:1.4}],turretConfig:{count:6,fireRateMultiplier:1.2,hpMultiplier:1.2},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.5,enrageFireRateBoost:1.3}},APOCALYPSE_CARRIER:{variantId:"APOCALYPSE_CARRIER",displayName:"APOCALYPSE CARRIER",subtitle:"Doom Bringer",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.25,size:{width:234,height:195},phases:[{hpThreshold:1,movementPattern:He("erratic",{speedMultiplier:1.1}),attackPattern:Ge("missiles",{bulletCount:4,spreadAngle:.6,fireRate:50,aimAtPlayer:!0}),fireRateMultiplier:1.15,speedMultiplier:1.1},{hpThreshold:.5,movementPattern:He("erratic",{speedMultiplier:1.3}),attackPattern:Ge("missiles",{bulletCount:5,spreadAngle:.7,fireRate:40,aimAtPlayer:!0}),fireRateMultiplier:1.3,speedMultiplier:1.3}],turretConfig:{count:3,fireRateMultiplier:1.15,hpMultiplier:1.15},specialMechanics:{hasMinions:!0,minionSpawnRate:120,minionCount:6}},APOCALYPSE_OMEGA:{variantId:"APOCALYPSE_OMEGA",displayName:"APOCALYPSE OMEGA",subtitle:"Final Carrier",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.35,size:{width:250,height:210},phases:[{hpThreshold:1,movementPattern:He("erratic",{speedMultiplier:1.2}),attackPattern:Ge("missiles",{bulletCount:5,spreadAngle:.65,fireRate:45,aimAtPlayer:!0}),fireRateMultiplier:1.2,speedMultiplier:1.2},{hpThreshold:.5,movementPattern:He("erratic",{speedMultiplier:1.4}),attackPattern:Ge("mixed",{bulletCount:6,spreadAngle:.7,fireRate:35}),fireRateMultiplier:1.35,speedMultiplier:1.4}],turretConfig:{count:4,fireRateMultiplier:1.2,hpMultiplier:1.2},specialMechanics:{hasArmorPlating:!0,armorPlateCount:2,armorPlateHP:45,hasFlareSpray:!0,flareSprayInterval:180,flareDuration:90,flareDeflectRadius:140,hasMinions:!0,minionSpawnRate:100,minionCount:8}},EXTINCTION_ENGINE:{variantId:"EXTINCTION_ENGINE",displayName:"EXTINCTION ENGINE",subtitle:"World Ender",spriteKey:"bossExtinctionEngine",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:1.5,size:{width:300,height:300},phases:[{hpThreshold:1,movementPattern:He("sine",{speedMultiplier:.9}),attackPattern:Ge("spiral",{bulletCount:6,spreadAngle:.7,fireRate:45,spiralSpeed:.05}),fireRateMultiplier:1.1,speedMultiplier:.9},{hpThreshold:.8,movementPattern:He("orbit",{speedMultiplier:1.1,amplitude:1}),attackPattern:Ge("barrage",{bulletCount:7,spreadAngle:.5,fireRate:38,burstCount:4,burstDelay:4}),fireRateMultiplier:1.2,speedMultiplier:1.1},{hpThreshold:.6,movementPattern:He("aggressive",{speedMultiplier:1.3,trackingStrength:.5}),attackPattern:Ge("mixed",{bulletCount:8,spreadAngle:.6,fireRate:32}),fireRateMultiplier:1.3,speedMultiplier:1.3},{hpThreshold:.4,movementPattern:He("chase",{speedMultiplier:1.5,trackingStrength:.6}),attackPattern:Ge("spiral",{bulletCount:8,spreadAngle:.8,fireRate:28,spiralSpeed:.06}),fireRateMultiplier:1.4,speedMultiplier:1.5},{hpThreshold:.2,movementPattern:He("chase",{speedMultiplier:1.7,trackingStrength:.7}),attackPattern:Ge("barrage",{bulletCount:10,spreadAngle:.6,fireRate:22,burstCount:6,burstDelay:3}),fireRateMultiplier:1.6,speedMultiplier:1.7}],turretConfig:{count:6,fireRateMultiplier:1.3,hpMultiplier:1.3},specialMechanics:{hasArmorPlating:!0,armorPlateCount:4,armorPlateHP:50,hasFlareSpray:!0,flareSprayInterval:150,flareDuration:100,flareDeflectRadius:180,hasSmokeScreen:!0,smokeScreenInterval:300,smokeScreenDuration:90,hasMinions:!0,minionSpawnRate:150,minionCount:4,hasEnrage:!0,enrageThreshold:.2,enrageSpeedBoost:1.7,enrageFireRateBoost:1.5}}},dy={DAWN_PATROL:["SCOUT_WING","PATROL_FORTRESS","COASTAL_CRUISER","RECON_AIRSHIP","PROTOTYPE_WEAPON"],STEEL_VANGUARD:["ACE_VETERANS","IRON_FORTRESS","DREADNOUGHT","DREADNOUGHT_ELITE","STORM_CARRIER","JUGGERNAUT"],HELLFIRE_HORIZON:["DEATH_SQUADRON","SKY_FORTRESS","SKY_FORTRESS_OMEGA","LEVIATHAN","APOCALYPSE_CARRIER","APOCALYPSE_OMEGA","EXTINCTION_ENGINE"]};function fy(c,t){const n=dy[c];if(!n||t<1||t>n.length)return null;const s=n[t-1];return jo[s]||null}var Ee=(c=>(c.DAWN_PATROL="DAWN_PATROL",c.STEEL_VANGUARD="STEEL_VANGUARD",c.HELLFIRE_HORIZON="HELLFIRE_HORIZON",c))(Ee||{});const Ah={DAWN_PATROL:{speed:.6,spawn:.63,fireRate:.63,bulletSpeed:.83,enemyHP:.41,bulletCount:.68},STEEL_VANGUARD:{speed:.68,spawn:.72,fireRate:.096,bulletSpeed:.92,enemyHP:.44,bulletCount:.77},HELLFIRE_HORIZON:{speed:.75,spawn:.71,fireRate:.094,bulletSpeed:1.01,enemyHP:.39,bulletCount:.75}},kn={DAWN_PATROL:{id:"DAWN_PATROL",displayName:"Dawn Patrol",subtitle:"Rookie Training",levelCount:5,baseMultiplier:Ah.DAWN_PATROL,levelProgression:[.85,.9,.95,1,1.05],storyText:["December 1941. The Pacific erupts in flames. You've been assigned to the carrier USS Wasp.","INTEL: Japanese forces fortifying island chains. Atolls crawling with enemy fighters.","OBJECTIVE: Clear the skies. Support beach landings. Push inland to the fortress.","From carrier deck to jungle canopy - this is the road to Tokyo.","PACIFIC INFERNO - Launch from the carrier!"],victoryText:["VICTORY! The island fortress has fallen. The Pacific campaign is secure. From carrier strikes to jungle warfare, you've proven yourself in every theater.","But Europe calls. Intelligence reports a massive industrial complex. Iron Sky Blitz needs aces like you. The bombing campaign awaits."],endingText:["The enemy fortress crumbles into the volcanic rock.","From coral atolls to jungle highlands - every island secured.","The Pacific sky belongs to the Allies.","The carriers sail home. You've earned your place among legends.","PACIFIC INFERNO COMPLETE - The Rising Sun sets!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,3,4,5]},STEEL_VANGUARD:{id:"STEEL_VANGUARD",displayName:"Steel Vanguard",subtitle:"Veterans Only",levelCount:6,baseMultiplier:Ah.STEEL_VANGUARD,levelProgression:[.85,.9,.95,1,1.05,1.1],storyText:["1944. The bombing campaign over Europe intensifies. Tonight, we hit the Reich's industrial heart.","INTEL: Six strategic targets - factories, refineries, rail yards. Heavy flak expected.","OBJECTIVE: Cripple enemy production. From dusk to midnight, we fly through the searchlights.","The twilight sky will burn with steel and fire.","IRON SKY BLITZ - All squadrons, form up!"],victoryText:["VICTORY! The industrial heartland lies in ruins. Refineries burn. Rail yards shattered. The Reich's war machine grinds to a halt.","But the desert war rages on. Rommel's Afrika Korps threatens our supply lines. Desert Thunder awaits - sandstorms and tank battles ahead."],endingText:["The searchlights fall silent. The factories burn.","Six strategic targets reduced to rubble and ash.","From dusk patrol to midnight bombing - victory in the European sky.","The Iron Sky belongs to us. The Reich trembles.","IRON SKY BLITZ COMPLETE - The darkness serves the brave!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","SUPER_BATTLESHIP","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,3,3,4,5]},HELLFIRE_HORIZON:{id:"HELLFIRE_HORIZON",displayName:"Hellfire Horizon",subtitle:"No Mercy",levelCount:7,baseMultiplier:Ah.HELLFIRE_HORIZON,levelProgression:[.9,.95,1,1.05,1.1,1.15,1.2],storyText:["1942. North Africa. Rommel's Afrika Korps controls the desert. We're taking it back.","INTEL: Seven fortified positions from oasis outposts to the mountain fortress.","OBJECTIVE: Air superiority over the sand. Support our tanks. Destroy their oil supply.","Sandstorms are coming. Visibility will be zero. Trust your instruments.","DESERT THUNDER - Into the storm!"],victoryText:["VICTORY! The desert fortress has fallen. Rommel's supply lines are cut. From sandstorm to sandstorm, you've conquered the Afrika Korps.","The war is won. The desert thunder fades to silence. Legends will speak of the aces who ruled the burning sands. Welcome home, hero."],endingText:["The sandstorm clears. The fortress lies in ruins.","Seven positions destroyed. The Afrika Korps is broken.","Through blinding dust and burning oil - you prevailed.","The desert wind carries tales of your victory.","DESERT THUNDER COMPLETE - The sands remember the brave!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","FLYING_FORTRESS","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,2,3,4,4,5]}};function fl(c){return kn[c]}function Kh(c){return kn[c].levelCount}function gy(c,t){const n=kn[c];return t<1||t>n.levelCount?null:n.bossSequence[t-1]}function gr(c,t){const n=kn[c],s=n.baseMultiplier,r=Math.min(Math.max(t-1,0),n.levelProgression.length-1),o=n.levelProgression[r];return{speed:s.speed*o,spawn:s.spawn*o,fireRate:s.fireRate*o,bulletSpeed:s.bulletSpeed*o,enemyHP:s.enemyHP*o,bulletCount:s.bulletCount*o}}function Wg(c,t){const o=["DAWN_PATROL","STEEL_VANGUARD","HELLFIRE_HORIZON"].indexOf(c),p=((o===0?0:o===1?5:11)+t-1)/17;return(1.1+(1.4-1.1)*p)*(c==="DAWN_PATROL"?1.4:c==="STEEL_VANGUARD"?1.2:1.1)}const py=["DAWN_PATROL","STEEL_VANGUARD","HELLFIRE_HORIZON"];function my(c){return kn[c].victoryText}const bt={MAP_WIDTH:640,MAP_WIDTH_EXTENDED:960,PLAYER_PARALLAX_MAX:.15,SLICE_HEIGHT:1280,SLICE_COUNT:4,TILE_SIZE:64,TERRAIN_SCALE:2,get TERRAIN_IMAGE_WIDTH(){return this.MAP_WIDTH*this.TERRAIN_SCALE},get TERRAIN_IMAGE_WIDTH_EXTENDED(){return this.MAP_WIDTH_EXTENDED*this.TERRAIN_SCALE},get TERRAIN_IMAGE_HEIGHT(){return this.TOTAL_MAP_HEIGHT*this.TERRAIN_SCALE},get MAX_PARALLAX_OFFSET(){return(this.MAP_WIDTH_EXTENDED-this.MAP_WIDTH)/2},LEVEL_DURATION:1800,SCREEN_HEIGHT:960,get TOTAL_MAP_HEIGHT(){return this.SLICE_HEIGHT*this.SLICE_COUNT},get MAP_HEIGHT_TILES(){return this.TOTAL_MAP_HEIGHT/this.TILE_SIZE},get SCROLL_SPEED(){return(this.TOTAL_MAP_HEIGHT-this.SCREEN_HEIGHT)/this.LEVEL_DURATION},get TOTAL_SCROLL_DISTANCE(){return this.SCROLL_SPEED*this.LEVEL_DURATION},get SCROLL_BUFFER(){return this.TOTAL_MAP_HEIGHT-this.TOTAL_SCROLL_DISTANCE}};function ic(c,t=600){const n=t/2;return(c-n)/n*bt.MAX_PARALLAX_OFFSET}function gl(c,t,n,s=600){const r=Math.floor((c-s)/2),o=r-t,d=n-r-s,f=Math.max(o,d,0);return Math.max(f,bt.MAX_PARALLAX_OFFSET)}const yy={mapWidthExtended:960},Ey={DAWN_PATROL_1:{mapWidthExtended:960},DAWN_PATROL_2:{mapWidthExtended:960},DAWN_PATROL_3:{mapWidthExtended:1024},DAWN_PATROL_4:{mapWidthExtended:1024},DAWN_PATROL_5:{mapWidthExtended:780},STEEL_VANGUARD_1:{mapWidthExtended:960},STEEL_VANGUARD_2:{mapWidthExtended:960},STEEL_VANGUARD_3:{mapWidthExtended:960},STEEL_VANGUARD_4:{mapWidthExtended:960},STEEL_VANGUARD_5:{mapWidthExtended:960},STEEL_VANGUARD_6:{mapWidthExtended:960},HELLFIRE_HORIZON_1:{mapWidthExtended:960},HELLFIRE_HORIZON_2:{mapWidthExtended:960},HELLFIRE_HORIZON_3:{mapWidthExtended:960},HELLFIRE_HORIZON_4:{mapWidthExtended:960},HELLFIRE_HORIZON_5:{mapWidthExtended:960},HELLFIRE_HORIZON_6:{mapWidthExtended:960},HELLFIRE_HORIZON_7:{mapWidthExtended:960}};function ca(c,t){const n=`${c}_${t}`;return Ey[n]||yy}typeof window<"u"&&console.log("[TERRAIN_CONFIG] Loaded:",{slices:bt.SLICE_COUNT,totalHeight:bt.TOTAL_MAP_HEIGHT,scrollSpeed:bt.SCROLL_SPEED.toFixed(3),scrollDistance:bt.TOTAL_SCROLL_DISTANCE.toFixed(0),buffer:bt.SCROLL_BUFFER.toFixed(0),maxParallaxOffset:bt.MAX_PARALLAX_OFFSET});const _y={};var Ay={};const Si=(typeof _y<"u"?"false":Ay.VITE_DESIGN_TIME)==="true",w=600,G=880,Sy=60,ur=6,Co=12,Po=3,Sh=.8,Th=1.05,vh=1,oa=bt.SCROLL_SPEED,Xg=83,Ty=83,nt={WHITE:"#e8e6d9",RED:"#8b2e1f",ORANGE:"#d4743e",GREY:"#7a8085",YELLOW:"#c9a961",GREEN:"#4a5f3a"},Aa={LEFT:["ArrowLeft","a"],RIGHT:["ArrowRight","d"],UP:["ArrowUp","w"],DOWN:["ArrowDown","s"],FIRE:["z"," ","Control"],EVADE:["Alt"],BOMB:["b","v"],COIN:["5","c"],START:["1","Enter"]},lt={NORMAL:1,CALM_THRESHOLD:.15,MODERATE_THRESHOLD:.35,INTENSE_THRESHOLD:.6,CALM_ZOOM:1,MODERATE_ZOOM:1.15,INTENSE_ZOOM:1.3,EXTREME_ZOOM:1.5,CALM_TIMESCALE:1,MODERATE_TIMESCALE:.95,INTENSE_TIMESCALE:.85,EXTREME_TIMESCALE:.75,SMOOTH_DURATION:30,HYSTERESIS:.1,FAST_TRANSITION:15,ENEMY_WEIGHT:.3,BULLET_WEIGHT:.25,BOSS_WEIGHT:.2,HEALTH_WEIGHT:.15,COMBO_WEIGHT:.1,ENEMY_RADIUS:400,BULLET_RADIUS:350,MAX_ENEMIES_NORMALIZE:5,MAX_BULLETS_NORMALIZE:20,BOSS_VULNERABLE_ZOOM:1.3,BOSS_VULNERABLE_TIMESCALE:.7,BOSS_VULNERABLE_DURATION:180,NEAR_DEATH_ZOOM:1.25,NEAR_DEATH_TIMESCALE:.8,NEAR_DEATH_THRESHOLD:.2,NEAR_DEATH_RELEASE:.3,BULLET_HELL_ZOOM:1.3,BULLET_HELL_TIMESCALE:.75,BULLET_HELL_THRESHOLD:30,BULLET_HELL_RELEASE:20};var Wa=(c=>(c.CALM="CALM",c.MODERATE="MODERATE",c.INTENSE="INTENSE",c.EXTREME="EXTREME",c))(Wa||{}),Oa=(c=>(c.NONE="NONE",c.BOSS_VULNERABLE="BOSS_VULNERABLE",c.NEAR_DEATH="NEAR_DEATH",c.BULLET_HELL="BULLET_HELL",c.BOSS_INTRO="BOSS_INTRO",c.PLAYER_DEATH="PLAYER_DEATH",c.DIVE_BOMB="DIVE_BOMB",c.CLIMB_UP="CLIMB_UP",c.SEA_LEVEL_ATTACK="SEA_LEVEL_ATTACK",c.GROUND_ATTACK="GROUND_ATTACK",c))(Oa||{});const Xa={HIGH_ALTITUDE:1,LOW_ALTITUDE:1.15,SEA_LEVEL:1.35,DIVE_TRANSITION_FRAMES:45,CLIMB_TRANSITION_FRAMES:60,DIVE_TIME_SCALE:.85,CLIMB_TIME_SCALE:.95,DIVE_ROTATION_MAX:-.08,DIVE_SHAKE_INTENSITY:3,SEA_ATTACK_MULTIPLIER:2,GROUND_ATTACK_MULTIPLIER:1.5,PARALLAX_SEA_LEVEL:.3};var Ut=(c=>(c.COLD="COLD",c.WARM="WARM",c.HOT="HOT",c.ON_FIRE="ON_FIRE",c.BLAZING="BLAZING",c))(Ut||{});const ms={THRESHOLDS:{WARM:5,HOT:15,ON_FIRE:30,BLAZING:50},MULTIPLIERS:{COLD:1,WARM:1.25,HOT:1.5,ON_FIRE:2,BLAZING:3},HEAT_PER_KILL:1,HEAT_PER_COMBO_POINT:.5,HEAT_PER_TARGET:2,DECAY_DELAY:180,DECAY_PER_FRAME:.5/60},vy=[{score:5e4,bonus:5e3,label:"50K BONUS!"},{score:1e5,bonus:1e4,label:"100K JACKPOT!"},{score:25e4,bonus:25e3,label:"QUARTER MILLION!"},{score:5e5,bonus:5e4,label:"HALF MILLION!"},{score:1e6,bonus:1e5,label:"MILLIONAIRE!"}],Ry=[{combo:3,bonus:500,label:"NICE!"},{combo:5,bonus:1e3,label:"SUPER COMBO!"},{combo:8,bonus:5e3,label:"MEGA COMBO!"},{combo:10,bonus:1e4,label:"UNSTOPPABLE!"},{combo:15,bonus:25e3,label:"LEGENDARY!"}],Tt={VILLAGE:{width:160,height:120,hp:50,score:1e3},FORTRESS:{width:200,height:200,hp:200,score:5e3},AA_EMPLACEMENT:{width:64,height:64,hp:30,score:500,turretFireRate:45},RADAR_STATION:{width:80,height:80,hp:40,score:750},FUEL_DEPOT:{width:100,height:80,hp:25,score:600},AIRFIELD:{width:300,height:150,hp:100,score:3e3},SUPPLY_CONVOY:{width:120,height:40,hp:35,score:400}},na={AIRCRAFT_CARRIER:{width:180,height:400,hp:300,score:1e4},DESTROYER:{width:100,height:250,hp:120,score:4e3},SUPPLY_SHIP:{width:80,height:180,hp:80,score:2e3},SUBMARINE:{width:60,height:150,hp:60,score:1500},PT_BOAT:{width:50,height:80,hp:20,score:300}},qa={JOYSTICK_DEAD_ZONE:.2,JOYSTICK_MAX_DISTANCE:150,DOUBLE_TAP_WINDOW:300,DOUBLE_TAP_DISTANCE:50,CIRCLE_MIN_POINTS:8,CIRCLE_MIN_ANGLE:270,CIRCLE_MIN_RADIUS:25,CIRCLE_MAX_RADIUS:80,CIRCLE_MAX_DURATION:1e3,CIRCLE_SAMPLE_INTERVAL:16},Et={DROP_DURATION:60,INITIAL_FORWARD_FRAMES:23,COOLDOWN:60,MAX_BOMBS:9,TIERS:{1:{radius:200,damage:120,clusters:0,name:"Standard"},2:{radius:240,damage:160,clusters:3,name:"Heavy"},3:{radius:280,damage:220,clusters:6,name:"Cluster"},4:{radius:340,damage:320,clusters:9,name:"Mega"}},CLUSTER_SPREAD_BASE:60,CLUSTER_SPREAD_PER_TIER:20,CLUSTER_DELAY_FRAMES:3,CLUSTER_DAMAGE_RATIO:.25,CLUSTER_RADIUS:60,INITIAL_VELOCITY:-3,INITIAL_SCALE:1.4,SHRINK_FACTOR:.7,SHADOW_MAX_ALPHA:.4,SCREEN_SHAKE_BASE:30,SCREEN_SHAKE_PER_TIER:10,SCREEN_SHAKE_ROTATION:.03,TIER_THRESHOLDS:{HEAVY:3,CLUSTER:5,MEGA:7}},oi={BULLETS_PER_POWERUP:75,MAX_STACKS:4,TIERS:{1:{bullets:4,damageMultiplier:1,name:"Standard",offsets:[-15,15,-30,30]},2:{bullets:6,damageMultiplier:2,name:"Enhanced",offsets:[-10,10,-25,25,-40,40]}},TIER_THRESHOLDS:{ENHANCED:3},ENHANCED_CHANCE:{BEGINNER:0,NORMAL:.3,VETERAN:.6}},wo={BASE_SIZE:64,CANNON_SIZE:105,COLLISION_RADIUS:32,SCALE_FACTOR:1.3},Hn={WIDTH:4,HEIGHT:12,BASE_SPEED:7.5,DAMAGE:10,PARALLEL_OFFSET:8,BURST_DELAY:3,BURST_COUNT:2},Vt=[{x:.65,y:-.65},{x:-.65,y:-.65},{x:-.65,y:.65},{x:.65,y:.65}],Np={ACE_SQUADRON:{positions:Vt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},FLYING_FORTRESS:{positions:Vt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.14,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},SUPER_BATTLESHIP:{positions:Vt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.12,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},EXPERIMENTAL_AIRSHIP:{positions:Vt,bladeCount:6,bladeLength:22,bladeWidth:5,hubRadius:7,baseRotationSpeed:.13,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},ULTIMATE_WEAPON:{positions:Vt,bladeCount:6,bladeLength:27,bladeWidth:6,hubRadius:8,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.5},SCOUT_WING:{positions:Vt,bladeCount:4,bladeLength:14,bladeWidth:3,hubRadius:4,baseRotationSpeed:.18,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2},PATROL_FORTRESS:{positions:Vt,bladeCount:4,bladeLength:16,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},COASTAL_CRUISER:{positions:Vt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.14,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},RECON_AIRSHIP:{positions:Vt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.16,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},PROTOTYPE_WEAPON:{positions:Vt,bladeCount:4,bladeLength:19,bladeWidth:4,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},ACE_VETERANS:{positions:Vt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},IRON_FORTRESS:{positions:Vt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.12,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:1.8},DREADNOUGHT:{positions:Vt,bladeCount:6,bladeLength:20,bladeWidth:5,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2},DREADNOUGHT_ELITE:{positions:Vt,bladeCount:6,bladeLength:21,bladeWidth:5,hubRadius:7,baseRotationSpeed:.12,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},STORM_CARRIER:{positions:Vt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.11,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:1.8},JUGGERNAUT:{positions:Vt,bladeCount:6,bladeLength:25,bladeWidth:6,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.5},DEATH_SQUADRON:{positions:Vt,bladeCount:4,bladeLength:19,bladeWidth:4,hubRadius:6,baseRotationSpeed:.16,attackSpeedMultiplier:1.8,damagedSpeedMultiplier:2.5},SKY_FORTRESS:{positions:Vt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.12,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},SKY_FORTRESS_OMEGA:{positions:Vt,bladeCount:6,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},LEVIATHAN:{positions:Vt,bladeCount:6,bladeLength:22,bladeWidth:5,hubRadius:7,baseRotationSpeed:.11,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},APOCALYPSE_CARRIER:{positions:Vt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:2},APOCALYPSE_OMEGA:{positions:Vt,bladeCount:6,bladeLength:24,bladeWidth:6,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.2},EXTINCTION_ENGINE:{positions:Vt,bladeCount:6,bladeLength:30,bladeWidth:7,hubRadius:9,baseRotationSpeed:.08,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:3}};var Wt=(c=>(c[c.SEA_LEVEL=0]="SEA_LEVEL",c[c.LOW_ALTITUDE=1]="LOW_ALTITUDE",c[c.HIGH_ALTITUDE=2]="HIGH_ALTITUDE",c))(Wt||{}),A=(c=>(c.PLAYER="PLAYER",c.ENEMY_SMALL="ENEMY_SMALL",c.ENEMY_RED="ENEMY_RED",c.ENEMY_BIG="ENEMY_BIG",c.ENEMY_BATTLESHIP="ENEMY_BATTLESHIP",c.ENEMY_HELICOPTER="ENEMY_HELICOPTER",c.BOSS="BOSS",c.SUPPORT_FIGHTER="SUPPORT_FIGHTER",c.BULLET_PLAYER="BULLET_PLAYER",c.BULLET_ENEMY="BULLET_ENEMY",c.BULLET_CANNON="BULLET_CANNON",c.BULLET_TURRET="BULLET_TURRET",c.BULLET_BOMB="BULLET_BOMB",c.EXPLOSION="EXPLOSION",c.EXPLOSION_SMALL="EXPLOSION_SMALL",c.EXPLOSION_MEDIUM="EXPLOSION_MEDIUM",c.EXPLOSION_LARGE="EXPLOSION_LARGE",c.EXPLOSION_MASSIVE="EXPLOSION_MASSIVE",c.BOMB_DROPPED="BOMB_DROPPED",c.BLAST_WAVE="BLAST_WAVE",c.POWERUP="POWERUP",c.ISLAND="ISLAND",c.PARTICLE="PARTICLE",c.SMOKE="SMOKE",c.WAKE="WAKE",c.CRASHING_AIRCRAFT="CRASHING_AIRCRAFT",c.VILLAGE="VILLAGE",c.FORTRESS="FORTRESS",c.AA_EMPLACEMENT="AA_EMPLACEMENT",c.RADAR_STATION="RADAR_STATION",c.FUEL_DEPOT="FUEL_DEPOT",c.AIRFIELD="AIRFIELD",c.SUPPLY_CONVOY="SUPPLY_CONVOY",c.ENEMY_TANK="ENEMY_TANK",c.ENEMY_LARGE_TANK="ENEMY_LARGE_TANK",c.AIRCRAFT_CARRIER="AIRCRAFT_CARRIER",c.DESTROYER="DESTROYER",c.SUPPLY_SHIP="SUPPLY_SHIP",c.SUBMARINE="SUBMARINE",c.PT_BOAT="PT_BOAT",c))(A||{}),da=(c=>(c.FIREPOWER="FIREPOWER",c.BOMB="BOMB",c.INVINCIBILITY="INVINCIBILITY",c.SPREAD="SPREAD",c))(da||{}),fa=(c=>(c[c.STANDARD=1]="STANDARD",c[c.HEAVY=2]="HEAVY",c[c.CLUSTER=3]="CLUSTER",c[c.MEGA=4]="MEGA",c))(fa||{}),$a=(c=>(c[c.STANDARD=1]="STANDARD",c[c.ENHANCED=2]="ENHANCED",c))($a||{}),te=(c=>(c.ATTRACT="ATTRACT",c.STORY="STORY",c.POWERUP_LEGEND="POWERUP_LEGEND",c.PLAYING="PLAYING",c.PAUSED="PAUSED",c.DESIGN_MODE="DESIGN_MODE",c.BOSS_INTRO="BOSS_INTRO",c.BOSS_BATTLE="BOSS_BATTLE",c.LEVEL_COMPLETE="LEVEL_COMPLETE",c.MISSION_DEBRIEF="MISSION_DEBRIEF",c.GAME_OVER="GAME_OVER",c.VICTORY="VICTORY",c.ENDING="ENDING",c))(te||{}),gt=(c=>(c.BEGINNER="BEGINNER",c.NORMAL="NORMAL",c.VETERAN="VETERAN",c))(gt||{}),Na=(c=>(c.ACE_SQUADRON="ACE_SQUADRON",c.FLYING_FORTRESS="FLYING_FORTRESS",c.SUPER_BATTLESHIP="SUPER_BATTLESHIP",c.EXPERIMENTAL_AIRSHIP="EXPERIMENTAL_AIRSHIP",c.ULTIMATE_WEAPON="ULTIMATE_WEAPON",c))(Na||{});function My(c,t,n,s){switch(c){case"v_formation":return jg(t,n,s,32,38);case"line_abreast":return by(t,n,s,32);case"echelon_left":return $g(t,n,s,32,38,-1);case"echelon_right":return $g(t,n,s,32,38,1);case"diamond":return Oy(t,n,s,32,38);case"trail":return xy(t,n,s,38);default:return jg(t,n,s,32,38)}}function jg(c,t,n,s,r){const o=[];o.push({x:t,y:n});for(let d=1;d<c;d++){const f=Math.ceil(d/2),p=d%2===1?1:-1;o.push({x:t+p*f*s,y:n-f*r})}return o}function by(c,t,n,s){const r=[],o=-(c-1)*s/2;for(let d=0;d<c;d++)r.push({x:t+o+d*s,y:n});return r}function $g(c,t,n,s,r,o){const d=[];for(let f=0;f<c;f++)d.push({x:t+f*s*o,y:n-f*r});return d}function Oy(c,t,n,s,r){const o=[],d=Math.min(c,5);d>=1&&o.push({x:t,y:n}),d>=2&&o.push({x:t-s,y:n-r}),d>=3&&o.push({x:t+s,y:n-r}),d>=4&&o.push({x:t,y:n-r*2}),d>=5&&o.push({x:t,y:n-r});for(let f=5;f<c;f++)o.push({x:t,y:n-r*(f-2)});return o}function xy(c,t,n,s){const r=[];for(let o=0;o<c;o++)r.push({x:t,y:n-o*s});return r}function Ly(c,t,n){switch(c){case"straight_dive":return qg(t,n);case"sweep_left":return Zg(t,n,-1);case"sweep_right":return Zg(t,n,1);case"loop_back":return Ny(t,n);case"figure_8":return Dy(t,n);case"pincer_attack":return Cy(t,n);default:return qg(t,n)}}function qg(c,t){return[{x:c,y:120,speed:t},{x:c,y:320,speed:t*1.05},{x:c,y:G+150,speed:t*1.1}]}function Zg(c,t,n){const s=n>0?w+120:-120,r=Math.max(50,Math.min(w-50,c+n*180));return[{x:c,y:140,speed:t},{x:r,y:320,speed:t*.9},{x:s,y:480,speed:t*1.2}]}function Ny(c,t){const s=c>w/2?-1:1;return[{x:c,y:160,speed:t},{x:c+140*s,y:280,speed:t*.85},{x:c+140*1.8*s,y:160,speed:t*.7},{x:c+280*s,y:-80,speed:t*.6},{x:c+140*1.5*s,y:-150,speed:t*.6},{x:c+140*.5*s,y:80,speed:t*.9},{x:c,y:300,speed:t*1},{x:c,y:G+150,speed:t*1.15}]}function Dy(c,t){const s=Math.max(170,Math.min(w-120-50,c));return[{x:s,y:100,speed:t},{x:s+120,y:180,speed:t*.85},{x:s,y:260,speed:t*.85},{x:s-120,y:340,speed:t*.85},{x:s,y:420,speed:t*.9},{x:s+120*.5,y:500,speed:t*.95},{x:s,y:G+150,speed:t*1.1}]}function Cy(c,t){const n=c>w/2?1:-1,s=n>0?w-80:80,r=w/2;return[{x:c,y:100,speed:t},{x:s,y:220,speed:t*.9},{x:s,y:380,speed:t*.95},{x:r+n*60,y:500,speed:t*1},{x:r,y:G+150,speed:t*1.1}]}function Dp(c){switch(c){case Ee.DAWN_PATROL:return{min:2,max:3};case Ee.STEEL_VANGUARD:return{min:3,max:4};case Ee.HELLFIRE_HORIZON:return{min:3,max:6};default:return{min:2,max:4}}}function Py(c){const t=Dp(c);return t.min+Math.floor(Math.random()*(t.max-t.min+1))}function wy(c){const t=Dp(c),n=["v_formation","line_abreast","echelon_left","echelon_right","diamond","trail"],s=["straight_dive","sweep_left","sweep_right","loop_back","figure_8","pincer_attack"],r=Math.random()<.4;let o;r?o=3+Math.floor(Math.random()*3):o=Math.floor(Math.random()*3);const d=n[Math.floor(Math.random()*n.length)],f=s[o];return{type:d,movementPattern:f,squadronSize:t,spawnDelay:120+Math.floor(Math.random()*80)}}function Kg(c,t,n){const s=t.x-c.x,r=t.y-c.y,o=Math.sqrt(s*s+r*r);if(o<1)return{vx:0,vy:n*t.speed};const d=n*t.speed,f=s/o*d*.7;let p=r/o*d;return p=Math.max(oa*.8,p),{vx:f,vy:p}}function Qg(c){return Math.atan2(c.vy,c.vx)-Math.PI/2}function Iy(c,t,n=.12){let s=t-c;for(;s>Math.PI;)s-=Math.PI*2;for(;s<-Math.PI;)s+=Math.PI*2;return c+s*n}function By(c,t,n=25){const s=t.x-c.x,r=t.y-c.y;return Math.sqrt(s*s+r*r)<n}function Fy(c,t,n){return{waypoints:c,currentWaypointIndex:0,waypointProgress:0,leaderId:t,offsetFromLeader:n}}const Yi={tileSize:bt.TILE_SIZE,mapWidthTiles:Math.ceil(bt.MAP_WIDTH_EXTENDED/bt.TILE_SIZE),mapHeightTiles:bt.MAP_HEIGHT_TILES,chunkSize:4};var Gi=(c=>(c[c.BACKGROUND=0]="BACKGROUND",c[c.TERRAIN=1]="TERRAIN",c[c.COLLISION=2]="COLLISION",c[c.DECORATION=3]="DECORATION",c[c.ENTITY=4]="ENTITY",c))(Gi||{}),As=(c=>(c[c.OCEAN_DEEP=0]="OCEAN_DEEP",c[c.OCEAN_MEDIUM=1]="OCEAN_MEDIUM",c[c.OCEAN_SHALLOW=2]="OCEAN_SHALLOW",c[c.OCEAN_WAVES_1=3]="OCEAN_WAVES_1",c[c.OCEAN_WAVES_2=4]="OCEAN_WAVES_2",c[c.OCEAN_REEF=5]="OCEAN_REEF",c[c.SAND_LIGHT=10]="SAND_LIGHT",c[c.SAND_DARK=11]="SAND_DARK",c[c.SAND_WET=12]="SAND_WET",c[c.SAND_ROCKY=13]="SAND_ROCKY",c[c.SAND_DEBRIS=14]="SAND_DEBRIS",c[c.GRASS_LIGHT=20]="GRASS_LIGHT",c[c.GRASS_DARK=21]="GRASS_DARK",c[c.GRASS_TALL=22]="GRASS_TALL",c[c.DIRT_PATH=23]="DIRT_PATH",c[c.ROAD_HORIZONTAL=24]="ROAD_HORIZONTAL",c[c.ROAD_VERTICAL=25]="ROAD_VERTICAL",c[c.ROAD_INTERSECTION=26]="ROAD_INTERSECTION",c[c.CONCRETE_LIGHT=30]="CONCRETE_LIGHT",c[c.CONCRETE_DARK=31]="CONCRETE_DARK",c[c.CONCRETE_CRACKED=32]="CONCRETE_CRACKED",c[c.STONE_GREY=33]="STONE_GREY",c[c.STONE_MOSSY=34]="STONE_MOSSY",c[c.RUNWAY_CENTER=35]="RUNWAY_CENTER",c[c.RUNWAY_EDGE=36]="RUNWAY_EDGE",c[c.JUNGLE_DENSE=40]="JUNGLE_DENSE",c[c.JUNGLE_SPARSE=41]="JUNGLE_SPARSE",c[c.JUNGLE_CLEARING=42]="JUNGLE_CLEARING",c[c.JUNGLE_PATH=43]="JUNGLE_PATH",c[c.JUNGLE_RIVER=44]="JUNGLE_RIVER",c[c.TRANS_OCEAN_SAND_N=50]="TRANS_OCEAN_SAND_N",c[c.TRANS_OCEAN_SAND_S=51]="TRANS_OCEAN_SAND_S",c[c.TRANS_OCEAN_SAND_E=52]="TRANS_OCEAN_SAND_E",c[c.TRANS_OCEAN_SAND_W=53]="TRANS_OCEAN_SAND_W",c[c.TRANS_OCEAN_SAND_NE=54]="TRANS_OCEAN_SAND_NE",c[c.TRANS_OCEAN_SAND_NW=55]="TRANS_OCEAN_SAND_NW",c[c.TRANS_OCEAN_SAND_SE=56]="TRANS_OCEAN_SAND_SE",c[c.TRANS_OCEAN_SAND_SW=57]="TRANS_OCEAN_SAND_SW",c[c.TRANS_OCEAN_SAND_INNER_NE=58]="TRANS_OCEAN_SAND_INNER_NE",c[c.TRANS_OCEAN_SAND_INNER_NW=59]="TRANS_OCEAN_SAND_INNER_NW",c[c.TRANS_SAND_GRASS_N=60]="TRANS_SAND_GRASS_N",c[c.TRANS_SAND_GRASS_S=61]="TRANS_SAND_GRASS_S",c[c.TRANS_SAND_GRASS_E=62]="TRANS_SAND_GRASS_E",c[c.TRANS_SAND_GRASS_W=63]="TRANS_SAND_GRASS_W",c[c.TRANS_SAND_GRASS_NE=64]="TRANS_SAND_GRASS_NE",c[c.TRANS_SAND_GRASS_NW=65]="TRANS_SAND_GRASS_NW",c[c.TRANS_SAND_GRASS_SE=66]="TRANS_SAND_GRASS_SE",c[c.TRANS_SAND_GRASS_SW=67]="TRANS_SAND_GRASS_SW",c[c.TRANS_GRASS_JUNGLE_N=70]="TRANS_GRASS_JUNGLE_N",c[c.TRANS_GRASS_JUNGLE_S=71]="TRANS_GRASS_JUNGLE_S",c[c.TRANS_GRASS_JUNGLE_E=72]="TRANS_GRASS_JUNGLE_E",c[c.TRANS_GRASS_JUNGLE_W=73]="TRANS_GRASS_JUNGLE_W",c[c.TRANS_GRASS_CONCRETE_N=80]="TRANS_GRASS_CONCRETE_N",c[c.TRANS_GRASS_CONCRETE_S=81]="TRANS_GRASS_CONCRETE_S",c[c.TRANS_GRASS_CONCRETE_E=82]="TRANS_GRASS_CONCRETE_E",c[c.TRANS_GRASS_CONCRETE_W=83]="TRANS_GRASS_CONCRETE_W",c[c.FORTRESS_TL=100]="FORTRESS_TL",c[c.FORTRESS_TC=101]="FORTRESS_TC",c[c.FORTRESS_TR=102]="FORTRESS_TR",c[c.FORTRESS_ML=103]="FORTRESS_ML",c[c.FORTRESS_MC=104]="FORTRESS_MC",c[c.FORTRESS_MR=105]="FORTRESS_MR",c[c.FORTRESS_BL=106]="FORTRESS_BL",c[c.FORTRESS_BC=107]="FORTRESS_BC",c[c.FORTRESS_BR=108]="FORTRESS_BR",c[c.FORTRESS_TURRET=109]="FORTRESS_TURRET",c[c.BUNKER_SMALL=120]="BUNKER_SMALL",c[c.BUNKER_LARGE_L=121]="BUNKER_LARGE_L",c[c.BUNKER_LARGE_R=122]="BUNKER_LARGE_R",c[c.BUNKER_AA=123]="BUNKER_AA",c[c.AIRFIELD_RUNWAY_START=130]="AIRFIELD_RUNWAY_START",c[c.AIRFIELD_RUNWAY_MID=131]="AIRFIELD_RUNWAY_MID",c[c.AIRFIELD_RUNWAY_END=132]="AIRFIELD_RUNWAY_END",c[c.AIRFIELD_HANGAR_L=133]="AIRFIELD_HANGAR_L",c[c.AIRFIELD_HANGAR_R=134]="AIRFIELD_HANGAR_R",c[c.AIRFIELD_TOWER=135]="AIRFIELD_TOWER",c[c.AIRFIELD_APRON=136]="AIRFIELD_APRON",c[c.BUILDING_SMALL=150]="BUILDING_SMALL",c[c.BUILDING_MEDIUM_TL=151]="BUILDING_MEDIUM_TL",c[c.BUILDING_MEDIUM_TR=152]="BUILDING_MEDIUM_TR",c[c.BUILDING_MEDIUM_BL=153]="BUILDING_MEDIUM_BL",c[c.BUILDING_MEDIUM_BR=154]="BUILDING_MEDIUM_BR",c[c.BUILDING_LARGE_1=155]="BUILDING_LARGE_1",c[c.BUILDING_LARGE_2=156]="BUILDING_LARGE_2",c[c.BUILDING_FACTORY=157]="BUILDING_FACTORY",c[c.BUILDING_WAREHOUSE=158]="BUILDING_WAREHOUSE",c[c.BUILDING_RUINS=159]="BUILDING_RUINS",c[c.WALL_H=180]="WALL_H",c[c.WALL_V=181]="WALL_V",c[c.WALL_CORNER_NE=182]="WALL_CORNER_NE",c[c.WALL_CORNER_NW=183]="WALL_CORNER_NW",c[c.WALL_CORNER_SE=184]="WALL_CORNER_SE",c[c.WALL_CORNER_SW=185]="WALL_CORNER_SW",c[c.SANDBAG=186]="SANDBAG",c[c.BARRICADE=187]="BARRICADE",c[c.TANK_TRAP=188]="TANK_TRAP",c[c.CRATE_WOOD=200]="CRATE_WOOD",c[c.CRATE_METAL=201]="CRATE_METAL",c[c.BARREL_FUEL=202]="BARREL_FUEL",c[c.BARREL_WATER=203]="BARREL_WATER",c[c.TREE_PALM=204]="TREE_PALM",c[c.TREE_DECIDUOUS=205]="TREE_DECIDUOUS",c[c.FENCE=206]="FENCE",c[c.TURRET_MG=220]="TURRET_MG",c[c.TURRET_AA=221]="TURRET_AA",c[c.TURRET_CANNON=222]="TURRET_CANNON",c[c.TURRET_MISSILE=223]="TURRET_MISSILE",c[c.SPAWN_TANK=240]="SPAWN_TANK",c[c.SPAWN_TRUCK=241]="SPAWN_TRUCK",c[c.SPAWN_AA_VEHICLE=242]="SPAWN_AA_VEHICLE",c[c.SPAWN_INFANTRY=243]="SPAWN_INFANTRY",c))(As||{});const Jg={fortress_small:{id:"fortress_small",name:"Small Fortress",widthTiles:3,heightTiles:3,tiles:[[100,101,102],[103,104,105],[106,107,108]],collisionMask:[[!0,!0,!0],[!0,!1,!0],[!0,!0,!0]],destructible:!0,hp:200,scoreValue:500,turretPositions:[{x:1,y:0,fireRate:90,turretType:"cannon"}]},bunker_aa:{id:"bunker_aa",name:"AA Bunker",widthTiles:2,heightTiles:2,tiles:[[123,123],[31,31]],collisionMask:[[!0,!0],[!0,!0]],destructible:!0,hp:100,scoreValue:200,turretPositions:[{x:.5,y:0,fireRate:45,turretType:"aa"}]},airfield:{id:"airfield",name:"Airfield",widthTiles:6,heightTiles:3,tiles:[[133,134,null,null,135,null],[136,136,130,131,131,132],[20,20,20,20,20,20]],collisionMask:[[!0,!0,!1,!1,!0,!1],[!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1]],destructible:!0,hp:300,scoreValue:1e3,entityType:A.AIRFIELD},fuel_depot:{id:"fuel_depot",name:"Fuel Depot",widthTiles:2,heightTiles:2,tiles:[[202,202],[202,202]],collisionMask:[[!0,!0],[!0,!0]],destructible:!0,hp:50,scoreValue:300,dropsPowerup:!0}},Hy=[{tileId:200,type:"destroyable",hp:10,scoreValue:10},{tileId:201,type:"destroyable",hp:25,scoreValue:25},{tileId:202,type:"explosive",hp:15,explosionRadius:64,scoreValue:50},{tileId:204,type:"destroyable",hp:5,scoreValue:5},{tileId:205,type:"destroyable",hp:5,scoreValue:5},{tileId:206,type:"destroyable",hp:5,scoreValue:5},{tileId:220,type:"turret_mount",hp:50,fireRate:30,scoreValue:100},{tileId:221,type:"turret_mount",hp:75,fireRate:45,scoreValue:150},{tileId:222,type:"turret_mount",hp:100,fireRate:90,scoreValue:200},{tileId:223,type:"turret_mount",hp:80,fireRate:120,scoreValue:250},{tileId:240,type:"spawn_point",entityType:A.SUPPLY_CONVOY},{tileId:241,type:"spawn_point",entityType:A.SUPPLY_CONVOY},{tileId:242,type:"spawn_point",entityType:A.AA_EMPLACEMENT}],Ai=Yi.tileSize,Un=bt.TOTAL_MAP_HEIGHT,Gy=!0;async function Cp(c){const t=await fetch(c);if(!t.ok)throw new Error(`Failed to load image: ${c} (${t.status})`);const n=await t.blob(),s=new Image;return new Promise((r,o)=>{s.onload=()=>r(s),s.onerror=()=>o(new Error(`Failed to decode image: ${c}`)),s.src=URL.createObjectURL(n)})}function Pp(c){return c.startsWith("campaigns/")?`/dist-assets/progressive/graphics/${c}.webp`:`/dist-assets/progressive/graphics/terrain/${c}.webp`}async function Yy(c){const t=Pp(c);console.log(`[TerrainSpriteGenerator] Loading terrain from path: ${c}`),console.log(`[TerrainSpriteGenerator] Full URL: ${t}`),console.log(`[TerrainSpriteGenerator] USE_COMPRESSED: ${Gy}`);const n=await Cp(t);console.log(`[TerrainSpriteGenerator] Loaded terrain: ${n.width}${n.height} (source resolution)`);const s=n.width,r=n.height,o=n.width/n.height,d=Math.round(Un*o);console.log(`[TerrainSpriteGenerator] Using full source: ${s}${r}`),console.log(`[TerrainSpriteGenerator] Scaling to game resolution: ${d}${Un} (actual aspect ratio: ${o.toFixed(4)})`);const f=document.createElement("canvas");f.width=d,f.height=Un;const p=f.getContext("2d");return p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(n,0,0,s,r,0,0,d,Un),{canvas:f,detectedWidthGamePixels:d}}async function Uy(c){console.log(`[TerrainSpriteGenerator] Loading terrain for level ${c}...`);const t=Pp(`terrainLevel${c}`);console.log(`[TerrainSpriteGenerator] Full URL: ${t}`);const n=await Cp(t);console.log(`[TerrainSpriteGenerator] Loaded terrain: ${n.width}${n.height} (source resolution)`);const s=n.width,r=n.height,o=n.width/n.height,d=Math.round(Un*o);console.log(`[TerrainSpriteGenerator] Using full source: ${s}${r}`),console.log(`[TerrainSpriteGenerator] Scaling to game resolution: ${d}${Un} (actual aspect ratio: ${o.toFixed(4)})`);const f=document.createElement("canvas");f.width=d,f.height=Un;const p=f.getContext("2d");return p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(n,0,0,s,r,0,0,d,Un),{canvas:f,detectedWidthGamePixels:d}}function wp(c,t){const n=c.width,s=c.height,r=Math.floor(n/Ai),o=Math.floor(s/Ai),d=r*o,f=document.createElement("canvas");f.width=r*Ai,f.height=o*Ai;const p=f.getContext("2d"),y=[];for(let m=0;m<o;m++){y[m]=[];for(let _=0;_<r;_++){const S=_*Ai,R=m*Ai,b=m*r+_;y[m][_]=b;const x=_*Ai,N=m*Ai;p.drawImage(c,S,R,Ai,Ai,x,N,Ai,Ai)}}return{tileset:f,tileGrid:y,tileCount:d,detectedWidthGamePixels:t,fullTerrainCanvas:c}}async function zy(c){const{canvas:t,detectedWidthGamePixels:n}=await Uy(c);return wp(t,n)}async function ky(c){const{canvas:t,detectedWidthGamePixels:n}=await Yy(c);return wp(t,n)}class Vy{constructor(){this.cachedTerrains=new Map,this.loadingPromises=new Map,this.campaignTerrainCache=new Map,this.campaignLoadingPromises=new Map}async generateForLevelAsync(t){if(this.cachedTerrains.has(t))return this.cachedTerrains.get(t);if(this.loadingPromises.has(t))return this.loadingPromises.get(t);const n=zy(t).then(s=>(this.cachedTerrains.set(t,s),this.loadingPromises.delete(t),console.log(`[TerrainSpriteGenerator] Level ${t} terrain ready: ${s.tileCount} tiles`),s));return this.loadingPromises.set(t,n),n}async generateForCampaignAsync(t,n){const s=`${t}_${n}`,o=`campaigns/${t.toLowerCase().replace(/_/g,"-")}-${n}`;if(console.log("[TerrainSpriteGenerator] generateForCampaignAsync called:"),console.log(`[TerrainSpriteGenerator]   campaign: "${t}"`),console.log(`[TerrainSpriteGenerator]   level: ${n}`),console.log(`[TerrainSpriteGenerator]   cacheKey: "${s}"`),console.log(`[TerrainSpriteGenerator]   terrainPath: "${o}"`),this.campaignTerrainCache.has(s))return this.campaignTerrainCache.get(s);if(this.campaignLoadingPromises.has(s))return this.campaignLoadingPromises.get(s);console.log(`[TerrainSpriteGenerator] Loading campaign terrain: ${o}`);const d=ky(o).then(f=>(this.campaignTerrainCache.set(s,f),this.campaignLoadingPromises.delete(s),console.log(`[TerrainSpriteGenerator] Campaign terrain ${s} ready: ${f.tileCount} tiles`),f)).catch(f=>(console.warn(`[TerrainSpriteGenerator] Campaign terrain not found: ${o}`),console.warn("[TerrainSpriteGenerator] Error details:",f),console.warn(`[TerrainSpriteGenerator] Falling back to legacy terrainLevel${Math.min(n,5)}.png`),this.campaignLoadingPromises.delete(s),this.generateForLevelAsync(Math.min(n,5))));return this.campaignLoadingPromises.set(s,d),d}hasCached(t){return this.cachedTerrains.has(t)}hasCampaignCached(t,n){return this.campaignTerrainCache.has(`${t}_${n}`)}getCached(t){return this.cachedTerrains.get(t)||null}getCampaignCached(t,n){return this.campaignTerrainCache.get(`${t}_${n}`)||null}getDetectedTerrainWidth(t,n){const s=this.campaignTerrainCache.get(`${t}_${n}`);return(s==null?void 0:s.detectedWidthGamePixels)??null}getDetectedTerrainWidthLegacy(t){const n=this.cachedTerrains.get(t);return(n==null?void 0:n.detectedWidthGamePixels)??null}clearCache(){this.cachedTerrains.clear(),this.loadingPromises.clear(),this.campaignTerrainCache.clear(),this.campaignLoadingPromises.clear()}}const Ta=new Vy,Wy=new Map([["DAWN_PATROL-1",{campaign:"DAWN_PATROL",level:1,entityOverrides:{Enemy_Heli_Pad_1_L2:{x:611.373262334117,y:188.3957366667288},Enemy_Heli_Pad_0_L2:{x:543.5324583794784,y:758.3987233845414},Enemy_Landing_Strip_0_L1:{x:363.99331662489556,y:1644.812030075188},added_turret_DAWN_PATROL_1_1766182104410_rhjy:{x:601.9537358818419,y:2287.1827637802876},added_turret_DAWN_PATROL_1_1766182630987_2xpq:{x:665.698639752628,y:663.7481344876729},added_turret_DAWN_PATROL_1_1766182075631_8odw:{x:497.97428564533243,y:4674.550571966406},added_game_target_DAWN_PATROL_1_1766182620863_qybj:{x:720.352428084255,y:291.42689267732055},added_game_target_DAWN_PATROL_1_1766182092809_nxyb:{x:821.2337254858951,y:3652.8005364841338},left_boundary:{x:0,y:0},added_game_target_DAWN_PATROL_1_1766255279987_jeex:{x:779.819657348963,y:3682.0811541929666},added_game_target_DAWN_PATROL_1_1766255267475_90cs:{x:546.7620979861737,y:335.49187205690816},added_turret_DAWN_PATROL_1_1766350019087_0r2k:{x:587.0486111111111,y:2518.9236111111104},added_turret_DAWN_PATROL_1_1766350045503_yyvl:{x:449.9143026004727,y:3438.222222222222},added_game_target_DAWN_PATROL_1_1766350075327_b9ch:{x:806.6097813238771,y:2076.8594858156025},added_game_target_DAWN_PATROL_1_1766349974178_6gv5:{x:451.07638888888897,y:356.7361111111111},turret_2_1:{x:255.3059398674809,y:2088.2957321841645},added_turret_DAWN_PATROL_1_1766349995386_kl7g:{x:101.00694444444446,y:1449.0972222222222},turret_1_0:{x:372.88026622744326,y:1598.7123043779213},turret_X_0:{x:491.4047218285068,y:760.4288784009278},added_game_target_DAWN_PATROL_1_1766362767550_oehm:{x:711.0992907801419,y:2060.283687943262},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:709.5390070921985,y:3632.7304964539017}},pathOverrides:{battleship_path_3:{horizontalOffset:-242.22974101921477}},deletedEntities:["added_game_target_DAWN_PATROL_1_1766182620863_qybj","added_turret_DAWN_PATROL_1_1766182630987_2xpq","Enemy_Heli_Pad_0_L2","added_game_target_DAWN_PATROL_1_1766255279987_jeex","added_turret_DAWN_PATROL_1_1766182104410_rhjy","added_turret_DAWN_PATROL_1_1766254791882_2yhs","added_game_target_DAWN_PATROL_1_1766255267475_90cs","turret_3_5","added_turret_DAWN_PATROL_1_1766350045503_yyvl","added_turret_DAWN_PATROL_1_1766350019087_0r2k","added_game_target_DAWN_PATROL_1_1766349960650_zbh5","added_game_target_DAWN_PATROL_1_1766349974178_6gv5","turret_3_8","turret_3_9","turret_2_1","turret_2_0","added_turret_DAWN_PATROL_1_1766349995386_kl7g","turret_7_8","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452913488_2co7"],terrainBoundaries:{leftX:634.6107784431135,rightX:1544.3455945252354},terrainHorizontalOffset:0,addedEntities:[{id:"added_turret_DAWN_PATROL_1_1766360227953_kq2n",entityType:"turret",x:514.5390070921987,y:4085.9929078014193,hp:30,fireRate:1.5},{id:"added_game_target_DAWN_PATROL_1_1766360232002_k1ct",entityType:"game-target",x:709.5390070921985,y:3632.7304964539017,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766362767550_oehm",entityType:"game-target",x:711.0992907801419,y:2060.283687943262,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766367288051_q86i",entityType:"game-target",x:405.7240788346186,y:2403.149842902028,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766367444098_6fmq",entityType:"game-target",x:479.6229648671808,y:287.30077120822625,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_1_1766681075483_uvvf",pathId:"path_1766681075483_uvvf",entityType:"battleship",waypoints:[{x:621.132075471698,y:2491.9248577418393},{x:633.7825696316261,y:2724.3776879305187},{x:531.7879604672056,y:2841.3947589098534},{x:644.8517520215632,y:3112.589727463313},{x:530.2066486972146,y:3345.427553159629},{x:381.56334231805914,y:3531.2316861335735},{x:357.84366576819394,y:3742.280203653789},{x:360.21563342318046,y:3838.911829889189},{x:353.0997304582209,y:3917.429350104822}],speed:.002,direction:"down",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1,spawnPoint:"top"},{id:"added_path_DAWN_PATROL_1_1766688948290_xpzp",pathId:"path_1766688948290_xpzp",entityType:"battleship",waypoints:[{x:119.50398582816655,y:1850.25206180494},{x:94.56155890168293,y:1579.0031689794307},{x:115.60673162090347,y:1409.8623363842137},{x:207.5819309123118,y:1150.4004231866938},{x:135.8724534986714,y:875.2542761539214},{x:202.1257750221435,y:568.440281468359},{x:158.47652790079718,y:388.38713709280546},{x:156.1381753764394,y:158.22852081488043}],speed:.002,direction:"up",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{Enemy_Landing_Strip_0_L1:{points:1e4}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_1_1766360315981_8f56",cropArea:{x:545.7078378531179,y:1829.0229496594204,width:239.50354609929082,height:462.6241134751774},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766362767550_oehm",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766360315981_8f56.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766367297838_x3dc",cropArea:{x:343.13624678663234,y:2282.498600399886,width:193.0419880034276,height:282.02227934875737},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766367288051_q86i",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766367297838_x3dc.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766367450382_fwjt",cropArea:{x:358.97172236503854,y:181.73093401885183,width:263.9245929734361,height:259.40017137960587},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766367444098_6fmq",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766367450382_fwjt.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766371172980_lxrl",cropArea:{x:575.7778717055045,y:3452.640255267844,width:368.7403598971722,height:337.06940874035945},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766360232002_k1ct",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766371172980_lxrl.png"}]}],["DAWN_PATROL-2",{campaign:"DAWN_PATROL",level:2,entityOverrides:{turret_2_1:{x:324.99214947829444,y:4626.485441872181},turret_3_1:{x:674.3779209068659,y:4553.1698219089485},turret_0_0:{x:292.7579428571429,y:897.5835497835498},Enemy_Heli_Pad_0_L2:{x:218.92322961135557,y:702.7666156891426},Enemy_Heli_Pad_1_L2:{x:716.4390620895429,y:486.00848146145256},turret_1_0:{x:543.5000000000001,y:1561.6580086580086},turret_1_1:{x:683.9285714285713,y:2148.4735426751067},turret_2_Y:{x:545.7820163042063,y:2773.2384642770567},turret_2_x:{x:675.8998869227764,y:3355.1340498008663},turret_3_0:{x:299.81339795285857,y:3658.7483713939387},turret_3_2:{x:678.5355094948491,y:4554.9016364463805},added_game_target_DAWN_PATROL_1_1766255267475_90cs:{x:611.6847783985447,y:188.06131650135262},added_game_target_DAWN_PATROL_1_1766367444098_6fmq:{x:479.6229648671808,y:286.5467009425879},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:709.5390070921985,y:3632.7304964539017},added_game_target_DAWN_PATROL_2_1766372135981_09eh:{x:221.5998286203942,y:693.7952013710368},added_game_target_DAWN_PATROL_4_1766254547372_saqq:{x:628.5554676647777,y:3717.5834084761036},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:388.004697204319,y:2594.9799320463344}},pathOverrides:{tank_path_1:{horizontalOffset:240.4328223624887}},deletedEntities:["turret_0_0","Enemy_Landing_Strip_0_L1","turret_3_1","added_game_target_DAWN_PATROL_1_1766182620863_qybj","added_game_target_DAWN_PATROL_1_1766255267475_90cs","added_game_target_DAWN_PATROL_1_1766367444098_6fmq","Enemy_Heli_Pad_0_L2","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452913488_2co7","tank_path_1"],terrainBoundaries:{leftX:689.9401197604789,rightX:1489.7690333618475},terrainHorizontalOffset:-1,addedEntities:[{id:"added_game_target_DAWN_PATROL_2_1766372144389_3oub",entityType:"game-target",x:724.8500428449015,y:467.5235646958012,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372166154_wccr",entityType:"game-target",x:725.6041131105399,y:1464.4044558697517,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372183570_t6wy",entityType:"game-target",x:736.9151670951157,y:2978.063410454156,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372352579_3411",entityType:"game-target",x:217.0522707797772,y:694.8757497857752,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_2_1766688993649_4n8r",pathId:"path_1766688993649_4n8r",entityType:"battleship",waypoints:[{x:445.53498671390616,y:3557.9805137289636},{x:453.32949512843237,y:3298.4233835252435},{x:401.8857395925598,y:3090.3100088573965},{x:385.51727192205493,y:2792.8454384410984},{x:370.7077059344554,y:2633.0580159433125},{x:390.9734278122233,y:2247.900354295837},{x:391.75287865367596,y:2129.42382639504},{x:395.65013286093887,y:1841.189105403012},{x:379.2816651904341,y:1657.2453498671393},{x:426.0487156775908,y:1525.5181576616474},{x:394.8706820194863,y:1245.4769707705946},{x:421.3720106288751,y:985.9579273693538},{x:396.42958370239154,y:762.8976970770599},{x:432.2843224092117,y:478.88662533215285},{x:423.710363153233,y:335.46767050487193}],speed:.004,direction:"down",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1},{id:"added_path_DAWN_PATROL_2_1766697447395_rhg0",pathId:"path_1766697447395_rhg0",entityType:"tank",waypoints:[{x:745.9956483899042,y:4416.654917319408},{x:742.166231505657,y:4157.02045256745},{x:747.5274151436031,y:3969.3790252393383},{x:738.3368146214099,y:3717.942993907746},{x:728.3803307223673,y:3542.5557006092254},{x:740.6344647519583,y:3486.5487380330724},{x:783.5239338555266,y:3449.02045256745},{x:804.9686684073106,y:3403.067449956484},{x:821.0522193211489,y:3341.0308964316796},{x:803.4369016536118,y:3277.4625761531765},{x:764.3768494342906,y:3244.5295909486513},{x:725.3167972149695,y:3216.191906005222},{x:728.3803307223673,y:2852.046127067015},{x:720.7214969538729,y:2466.3250652741517},{x:723.0191470844212,y:2334.8851174934725},{x:732.2097476066144,y:2308.845082680592},{x:774.3333333333333,y:2288.1662315056574},{x:819.52045256745,y:2253.7014795474324},{x:839.4334203655353,y:2198.5578764142733},{x:844.7946040034813,y:2123.697127937337},{x:830.242819843342,y:2063.1923411662315},{x:790.4168842471714,y:2022.6005221932114},{x:743.6979982593559,y:1998.858137510879},{x:721.4873803307223,y:1966.6910356832027},{x:726.8485639686685,y:1877.7902523933856},{x:719.189730200174,y:1749.1218450826805},{x:729.1462140992166,y:1617.389904264578},{x:739.8685813751088,y:1157.3720626631853},{x:742.9321148825065,y:1011.0522193211489},{x:745.2297650130548,y:850.7193211488251},{x:742.9321148825065,y:784.0874673629244}],speed:.001,direction:"down",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{turret_2_1:{fireRate:40},turret_3_1:{fireRate:40},turret_3_2:{fireRate:40},turret_3_0:{fireRate:40},turret_2_x:{fireRate:40},turret_2_Y:{fireRate:40},turret_1_1:{fireRate:40},turret_1_0:{fireRate:40}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_2_1766372211306_wd28",cropArea:{x:656.4755784061697,y:2807.64353041988,width:220.94258783204793,height:318.97172236503866},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372183570_t6wy",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372211306_wd28.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372221429_g03l",cropArea:{x:579.2982005141388,y:1349.2463581833763,width:292.5792630676949,height:370.248500428449},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372166154_wccr",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372221429_g03l.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372231422_laxz",cropArea:{x:640.3941730934018,y:378.5432733504713,width:192.28791773778926,height:202.09083119108834},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372144389_3oub",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372231422_laxz.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372358470_p3ab",cropArea:{x:130.07197943444726,y:528.2262210796913,width:176.45244215938305,height:344.6101113967437},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372352579_3411",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372358470_p3ab.png"}]}],["DAWN_PATROL-3",{campaign:"DAWN_PATROL",level:3,entityOverrides:{turret_3_2:{x:577.2894185374073,y:3277.9377518472897},turret_3_0:{x:706.92696122633,y:4906.891922011429},turret_3_1:{x:638.7554000545406,y:4221.6692319880585},Enemy_Heli_Pad_0_L2:{x:384.37801513241703,y:364.1124546577357},turret_0_0:{x:393.63669460324,y:350.46095721991355},Enemy_Heli_Pad_1_L2:{x:808.9652117739433,y:207.4623168680846},turret_2_0:{x:262.39127729657196,y:3027.863641908902},turret_2_1:{x:652.8394656581678,y:2734.5176228553687},turret_1_0:{x:668.9816396242529,y:2012.6554874103979},turret_1_1:{x:641.3428571428573,y:1439.4345816361456},Enemy_Landing_Strip_0_L1:{x:329.01136218966394,y:1458.7301737963787},added_game_target_DAWN_PATROL_3_1766202395078_1zfn:{x:372.8813132047665,y:502.4679794835995},added_game_target_DAWN_PATROL_1_1766182092809_nxyb:{x:823.614248479583,y:3664.7031514525734},added_game_target_DAWN_PATROL_2_1766372144389_3oub:{x:724.8500428449015,y:466.7694944301628},added_game_target_DAWN_PATROL_3_1766374240674_kgq5:{x:293.8270588054505,y:3760.36732203633},added_game_target_DAWN_PATROL_3_1766374223298_esk9:{x:515.2989769179039,y:649.0194554636213},added_turret_DAWN_PATROL_3_1766452875789_9lto:{x:398.82152006831757,y:384.38941076003437},added_game_target_DAWN_PATROL_3_1766452913488_2co7:{x:502.31298145070224,y:640.2771146701729}},pathOverrides:{},deletedEntities:["added_game_target_DAWN_PATROL_3_1766202395078_1zfn","added_game_target_DAWN_PATROL_1_1766182620863_qybj","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_1_1766182092809_nxyb","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_3_1766202380146_mfti","turret_3_0","turret_1_1","added_game_target_DAWN_PATROL_3_1766374240674_kgq5","added_game_target_DAWN_PATROL_3_1766374223298_esk9","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367444098_6fmq"],terrainBoundaries:{leftX:689.1873396065014,rightX:1491.6509837467922},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_3_1766452462996_1d7t",entityType:"game-target",x:388.7549103330487,y:2595.730145175064,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452492754_thml",entityType:"game-target",x:321.8719043552519,y:1411.3748932536294,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452800297_hs2a",entityType:"game-target",x:270.69171648163956,y:3761.229718189582,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452913488_2co7",entityType:"game-target",x:504.5636208368916,y:642.5277540563621,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_3_1766698464629_eopp",pathId:"path_1766698464629_eopp",entityType:"tank",waypoints:[{x:525.9026473099914,y:4405.704526046115},{x:516.8847139197267,y:4101.34927412468},{x:490.58240819812124,y:3956.3108454312555},{x:492.0853970964987,y:3579.4188727583264},{x:477.05550811272417,y:3418.8134073441506},{x:485.32194705380016,y:3353.4333902647313},{x:482.31596925704525,y:3303.834756618275},{x:466.53458582408194,y:3242.2122117847994},{x:453.00768573868487,y:3027.3825789923144},{x:443.2382578992314,y:2910.9009393680617},{x:445.4927412467976,y:2752.2032450896672},{x:416.1844577284372,y:2455.8082835183604},{x:416.1844577284372,y:2455.8082835183604},{x:410.92399658411614,y:2249.4188727583264},{x:390.6336464560205,y:2115.00853970965},{x:386.87617421007684,y:1978.8048676345006},{x:386.87617421007684,y:1818.5802732707089},{x:368.0888129803587,y:1723.8919726729293},{x:385.3731853116994,y:1620.5264730999147},{x:366.58582408198123,y:1558.1524338172503},{x:344.7924850555081,y:1205.1643894107601},{x:345.54397950469684,y:1061.9039282664392},{x:320.7446626814688,y:909.1370623398806},{x:322.999146029035,y:748.8795900939369},{x:310.22374039282664,y:578.9632792485057},{x:316.9871904355252,y:458.7241673783093},{x:294.4423569598634,y:296.84030742954747},{x:295.19385140905206,y:84.91887275832619}],speed:.002,direction:"up",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{turret_1_1:{fireRate:50},turret_1_0:{fireRate:50},turret_2_1:{fireRate:50},turret_2_0:{fireRate:50},turret_3_2:{fireRate:50},turret_3_1:{fireRate:50},turret_3_0:{fireRate:50},turret_0_0:{fireRate:50}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_3_1766452500126_46uh",cropArea:{x:287.3031596925705,y:1298.65072587532,width:150.2988898377455,height:238.22374039282658},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452492754_thml",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452500126_46uh.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766452765765_11f7",cropArea:{x:339.82920580700255,y:2392.7583262169087,width:177.35269000853964,height:394.5345858240821},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452462996_1d7t",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452765765_11f7.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766452806820_scda",cropArea:{x:113.25362937660103,y:3635.7301451750636,width:471.93851409052104,height:292.33134073441533},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452800297_hs2a",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452806820_scda.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766453243291_3xxi",cropArea:{x:348.0956447480786,y:566.2510674637067,width:422.3398804440649,height:202.90350128095633},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452913488_2co7",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766453243291_3xxi.png"}]}],["DAWN_PATROL-4",{campaign:"DAWN_PATROL",level:4,entityOverrides:{turret_3_5:{x:268.6285714285714,y:4575.909090909091},turret_3_0:{x:371.7714285714286,y:4254.480519480519},turret_3_6:{x:668.5285714285717,y:4403.285714285715},turret_3_4:{x:331.79999999999995,y:3658.686147186148},turret_3_2:{x:544.7,y:4033.9458874458874},turret_3_3:{x:834.6714285714286,y:4125.967532467533},turret_3_1:{x:285.061045987376,y:4078.458579743071},turret_2_2:{x:394.98571428571415,y:3336.8259751970304},turret_2_1:{x:733.4857142857143,y:3475.54329004329},turret_2_3:{x:728.2714285714285,y:2963.004329004329},turret_2_0:{x:246.30000000000007,y:3021.835497835498},turret_1_1:{x:714.4569236390209,y:1990.5743348722885},turret_1_0:{x:207.65714285714284,y:1548.8809523809527},Enemy_Heli_Pad_0_L2:{x:423.1777703816764,y:634.9287952588966},turret_0_0:{x:157.17142857142858,y:426.13419913419926},Enemy_Heli_Pad_1_L2:{x:420.2247763752571,y:495.48759591425096},added_game_target_DAWN_PATROL_4_1766254479099_m2wy:{x:412.4147880973851,y:627.6645626690713},added_game_target_DAWN_PATROL_3_1766452800297_hs2a:{x:270.69171648163956,y:3761.229718189582},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:388.7549103330487,y:2594.9799320463344}},pathOverrides:{},deletedEntities:["turret_2_2","turret_2_1","turret_3_1","turret_3_6","turret_3_5","Enemy_Landing_Strip_0_L1","added_game_target_DAWN_PATROL_4_1766254479099_m2wy","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_3_1766202380146_mfti","added_game_target_DAWN_PATROL_1_1766367444098_6fmq","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","turret_2_3","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_3_1766452913488_2co7","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452462996_1d7t"],terrainBoundaries:{leftX:616.1676646706587,rightX:1616.2360992301114},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_4_1766533189224_bwym",entityType:"game-target",x:661.6675191815862,y:3696.845694799659,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_4_1766533197600_bjqs",entityType:"game-target",x:453.1082693947151,y:633.7254901960787,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_4_1766533501122_jjty",cropArea:{x:549.5106564364877,y:3550.5541346973573,width:225.06393861892593,height:292.5831202046038},linkedTargetId:"added_game_target_DAWN_PATROL_4_1766533189224_bwym",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_4_1766533501122_jjty.png"},{id:"destroyed_overlay_DAWN_PATROL_4_1766533527580_m3l7",cropArea:{x:337.95055413469765,y:465.30264279624953,width:253.5720375106564,height:321.84143222506395},linkedTargetId:"added_game_target_DAWN_PATROL_4_1766533197600_bjqs",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_4_1766533527580_m3l7.png"}]}],["DAWN_PATROL-5",{campaign:"DAWN_PATROL",level:5,entityOverrides:{Enemy_Heli_Pad_0_L2:{x:263.76485011889133,y:1336.9528514115682},turret_1_0:{x:432.7714285714285,y:1660.385214347692},turret_3_4:{x:565.8285714285714,y:4567.3744588744585},turret_3_0:{x:260.0631206538978,y:4491.893394109448},turret_3_6:{x:73.6464560204953,y:3157.2032025759613},turret_2_3:{x:287.7857142857143,y:3683.4069264069262},turret_2_2:{x:406.69238876788904,y:3317.712503933814},turret_2_0:{x:579.0285714285712,y:3078.5064935064934},turret_0_0:{x:346.308661705502,y:924.9762718067586},Enemy_Heli_Pad_1_L2:{x:685.7962049466857,y:1160.9875959142514},Enemy_Landing_Strip_0_L1:{x:504.4110275689223,y:2277.059314954052},added_game_target_DAWN_PATROL_5_1766254439163_33ri:{x:464.9233543733093,y:406.27592425608657},added_game_target_DAWN_PATROL_5_1766254462632_p2gw:{x:583.5527502254283,y:169.01713255184836},turret_2_1:{x:491.94842015371484,y:3265.950159149135},turret_3_3:{x:525.7417591801878,y:4490.541210568538},turret_3_5:{x:349.4814688300596,y:3595.7382190823696},added_game_target_DAWN_PATROL_5_1766254421122_vgdp:{x:584.1927741273748,y:2791.4098676528065},added_game_target_DAWN_PATROL_5_1766254413284_77ml:{x:575.2629329628944,y:2181.7018887610593},turret_1_1:{x:482.26671273775486,y:2355.873684020383},added_game_target_DAWN_PATROL_4_1766254547372_saqq:{x:960,y:3880.9367018892767},added_game_target_DAWN_PATROL_3_1766452800297_hs2a:{x:486.73962067325624,y:3701.7600860253388},added_game_target_DAWN_PATROL_5_1766508221572_vo2e:{x:527.7587681779299,y:3474.584687767322},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:640.2832329262446,y:3621.4387941442355},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:369.93540648360477,y:2753.0611973564155}},pathOverrides:{},deletedEntities:["turret_3_4","turret_2_3","turret_2_0","added_game_target_DAWN_PATROL_4_1766254479099_m2wy","turret_3_1","turret_3_2","turret_3_5","turret_2_1","added_game_target_DAWN_PATROL_5_1766254421122_vgdp","added_game_target_DAWN_PATROL_5_1766254413284_77ml","turret_1_0","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_3_1766452913488_2co7","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_1_1766367444098_6fmq"],terrainBoundaries:{leftX:405.96071733561075,rightX:1765.7899231426131},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_5_1766508221572_vo2e",entityType:"game-target",x:527.0059880239521,y:3474.584687767322,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508765654_b0ey",entityType:"game-target",x:370.8041060735671,y:2762.0782720273733,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508899787_euan",entityType:"game-target",x:97.54491017964074,y:2448.221129170231,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508995635_pu5m",entityType:"game-target",x:580.4533789563732,y:1192.0273738237815,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766509112159_nf8g",entityType:"game-target",x:489.36698032506433,y:337.245508982036,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_5_1766508794665_3ohd",cropArea:{x:250.35928143712556,y:2361.2228400342174,width:242.39520958083833,height:710.6244653550043},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508765654_b0ey",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766508794665_3ohd.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766508910661_kqwp",cropArea:{x:-24.029084687767437,y:2249.1107784431138,width:261.2147134302823,height:337.245508982036},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508899787_euan",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766508910661_kqwp.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509013371_1089",cropArea:{x:371.1804961505562,y:998.562874251497,width:343.267750213858,height:388.43455945252333},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508995635_pu5m",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509013371_1089.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509119226_3tq2",cropArea:{x:243.960650128315,y:157.33105218135165,width:407.25406330196745,height:328.9649272882805},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766509112159_nf8g",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509119226_3tq2.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509511164_axg2",cropArea:{x:380.2138579982892,y:3223.9572664195416,width:389.940119760479,height:378.64841745081276},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508221572_vo2e",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509511164_axg2.png"}]}],["STEEL_VANGUARD-1",{campaign:"STEEL_VANGUARD",level:1,entityOverrides:{turret_1_0:{x:132.1991393826006,y:1541.8317884173823},turret_2_2:{x:287.1301777362021,y:2758.9897100093544},turret_2_3:{x:525.0787652011227,y:2623.5650423788875},turret_2_1:{x:168.6774929840974,y:3760.7016469654454},turret_3_5:{x:771.6800000000001,y:4237.575757575758},turret_3_3:{x:656.9977174929841,y:4115.651104118831},turret_3_0:{x:412.4292609915809,y:4677.038070130681},turret_3_1:{x:194.50469597754915,y:4794.551464126769},turret_3_6:{x:680.9080636108513,y:4621.505003259915},turret_3_2:{x:549.2776028732144,y:3748.185143824606},turret_1_1:{x:511.93541627689433,y:1626.4820704708452},turret_0_0:{x:488.2322170252572,y:933.8612693823176}},pathOverrides:{},deletedEntities:["turret_3_5","turret_3_4","turret_3_1","turret_2_0"],terrainBoundaries:{leftX:683.4714661984196,rightX:1490.4600526777874},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_1_1766247667040_ay7u",entityType:"game-target",x:217.6800748362956,y:1817.2123479887746,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_1_1766247683222_2w4s",entityType:"game-target",x:260.07483629560335,y:3411.33769878391,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_1_1766247688552_zi39",entityType:"game-target",x:680.5799812909261,y:3483.77923292797,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628526424_xhnl",cropArea:{x:133.48551360842836,y:3294.282255389718,width:281.2291483757682,height:394.8024582967514},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247683222_2w4s",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628526424_xhnl.png"},{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628589455_hbjm",cropArea:{x:447.9367866549602,y:3229.383221149156,width:279.6839332748026,height:480.5618964003511},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247688552_zi39",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628589455_hbjm.png"},{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628673711_06ny",cropArea:{x:93.69622475856022,y:1672.5790069261532,width:317.5417032484636,height:476.69885864793673},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247667040_ay7u",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628673711_06ny.png"}]}],["STEEL_VANGUARD-2",{campaign:"STEEL_VANGUARD",level:2,entityOverrides:{turret_3_1:{x:323.302265144864,y:4554.2418389336735},turret_3_6:{x:758.4306935908694,y:4488.143666693271},turret_3_2:{x:536.3928358208956,y:3987.5910288131536},turret_3_5:{x:762.4691132572432,y:3737.09207970841},turret_2_0:{x:268.41882352941184,y:3381.3409955569746},turret_2_3:{x:724.7912906057945,y:3300.4219543991276},turret_2_2:{x:796.6400000000001,y:3608.2424242424245},turret_1_0:{x:268.6836874451273,y:1972.7178013674938},turret_1_1:{x:640.2197014925374,y:1683.3156144411632},turret_0_0:{x:592.6149956101845,y:881.6835608055976},added_game_target_STEEL_VANGUARD_2_1766607888648_3zww:{x:254.52677787532912,y:4304.126426690079}},pathOverrides:{},deletedEntities:["turret_3_4","turret_3_0","turret_3_2","turret_3_3","turret_2_1","turret_2_2","turret_3_5"],terrainBoundaries:{leftX:690.5531167690958,rightX:1485.5662862159788},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_2_1766607888648_3zww",entityType:"game-target",x:254.52677787532915,y:4304.126426690079,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607900135_hr5h",entityType:"game-target",x:715.0008779631253,y:2247.8314310798946,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607906746_ds7s",entityType:"game-target",x:317.49429323968377,y:1277.8226514486391,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607912700_8uvx",entityType:"game-target",x:690.2774363476733,y:631.9929762949956,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_2_1766628982172_lbvs",cropArea:{x:97.55926251097446,y:3991.6066725197543,width:283.54697102721684,height:463.5645302897274},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607888648_3zww",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766628982172_lbvs.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629035391_rz1z",cropArea:{x:537.9455662862158,y:1942.2651448639149,width:336.0842844600528,height:424.1615452151009},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607900135_hr5h",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629035391_rz1z.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629098597_x7b1",cropArea:{x:107.21685689201036,y:1141.45741878841,width:321.404741000878,height:221.73836698858645},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607906746_ds7s",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629098597_x7b1.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629180316_pvo6",cropArea:{x:553.011413520632,y:386.2335381913948,width:237.1905179982441,height:336.0842844600527},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607912700_8uvx",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629180316_pvo6.png"}]}],["STEEL_VANGUARD-3",{campaign:"STEEL_VANGUARD",level:3,entityOverrides:{turret_3_6:{x:482.755118525022,y:4557.1649772527735},turret_3_1:{x:537.3158208955225,y:4884.442386995504},turret_3_0:{x:708.2657769973661,y:4259.656157714104},turret_3_3:{x:57.19999999999999,y:4472.242424242424},turret_3_4:{x:318.90697102721685,y:3775.6922340170804},turret_3_5:{x:723.84,y:3944.727272727273},turret_2_1:{x:365.4987181738367,y:3202.340809322372},turret_2_0:{x:749.80790166813,y:3199.243568254982},turret_2_2:{x:451.58138718173836,y:2421.32481975151},turret_1_0:{x:783.0312906057945,y:1698.7592518689976},turret_1_1:{x:451.7338015803337,y:1629.3131135765022}},pathOverrides:{},deletedEntities:["turret_3_3","turret_3_2","turret_3_5","turret_2_3"],terrainBoundaries:{leftX:687.8489903424056,rightX:1483.6347673397718},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_3_1766629419577_0rpo",entityType:"game-target",x:704.4424934152762,y:2815.6979806848112,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_3_1766629433608_c0fk",entityType:"game-target",x:392.6953467954341,y:2871.3257243195785,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_3_1766629489318_mxmx",entityType:"game-target",x:490.81650570676,y:937.1027216856893,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629525244_g2hm",cropArea:{x:264.44249341527615,y:2692.467076382792,width:278.91132572431957,height:317.54170324846336},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629433608_c0fk",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629525244_g2hm.png"},{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629569376_296f",cropArea:{x:568.4635645302894,y:2548.3757682177343,width:285.8647936786655,height:493.6962247585602},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629419577_0rpo",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629569376_296f.png"},{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629636725_5uw4",cropArea:{x:349.42932396839285,y:573.5908691834936,width:236.4179104477612,height:533.0992098331869},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629489318_mxmx",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629636725_5uw4.png"}]}],["STEEL_VANGUARD-4",{campaign:"STEEL_VANGUARD",level:4,entityOverrides:{turret_3_1:{x:187.4724495171203,y:4177.712932662888},turret_3_7:{x:300.0340649692713,y:4295.6771224093445},turret_3_2:{x:708.24,y:4345.409210631335},turret_2_2:{x:726.1290254609307,y:3502.6020698645807},turret_2_4:{x:723.5405092186128,y:2862.43520366084},turret_1_1:{x:246.75294117647053,y:1936.41290871844},turret_0_1:{x:149.28737489025448,y:998.2200228802509},turret_0_0:{x:488.7860930640913,y:553.7906190970282}},pathOverrides:{},deletedEntities:["turret_3_3","turret_3_4","turret_3_6","turret_3_2","turret_3_5","turret_2_3","turret_3_0","turret_2_0","turret_2_1","turret_2_5","turret_1_3"],terrainBoundaries:{leftX:693.643546971027,rightX:1486.7251975417032},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_4_1766630292763_tul3",entityType:"game-target",x:276.4179104477612,y:3453.5557506584723,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_4_1766630341802_txrj",entityType:"game-target",x:402.3529411764704,y:2920.070237050044,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_4_1766630398236_s2ry",entityType:"game-target",x:209.973661106233,y:1706.3037752414402,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630312217_t7x7",cropArea:{x:151.25548726953463,y:3251.905179982441,width:269.6400351185251,height:376.2598770851623},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630292763_tul3",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630312217_t7x7.png"},{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630356641_ik0o",cropArea:{x:254.01229148375745,y:2842.809482001756,width:409.4820017559262,height:183.88059701492512},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630341802_txrj",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630356641_ik0o.png"},{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630407761_cl70",cropArea:{x:101.42230026338831,y:1518.9464442493418,width:238.73573309920994,height:332.22124670763833},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630398236_s2ry",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630407761_cl70.png"}]}],["STEEL_VANGUARD-5",{campaign:"STEEL_VANGUARD",level:5,entityOverrides:{turret_3_3:{x:515.8293942054434,y:4707.871551334239},turret_3_4:{x:508.25116769095695,y:4492.969164870833},turret_3_0:{x:744.64,y:4198.787878787879},turret_3_7:{x:363.1505531167692,y:3884.5741346742225},turret_3_2:{x:158.11209833187007,y:3508.3304333945252},turret_2_1:{x:40.56,y:3653.818181818182},added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7:{x:221.9490781387184,y:3844.0386303775244},turret_2_5:{x:315.30928884986827,y:3339.1791842924417},turret_2_4:{x:149.0791220368743,y:2949.983345305558},turret_2_2:{x:382.76474100087796,y:2323.3845744539335},turret_2_3:{x:40.56,y:2749.287998510123},turret_2_0:{x:575.3206672519755,y:2118.7533987814936},turret_1_2:{x:632.2545390693591,y:1369.2351078830445},turret_0_1:{x:530.4806321334505,y:652.8572112698542},turret_1_0:{x:367.10433713784016,y:731.5346263335728}},pathOverrides:{},deletedEntities:["turret_3_1","turret_3_5","turret_3_0","turret_2_1","turret_3_6","turret_2_3","turret_1_1","turret_1_3","turret_0_0"],terrainBoundaries:{leftX:692.4846356453031,rightX:1483.6347673397718},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_5_1766630548636_i2x0",entityType:"game-target",x:756.593503072871,y:3589.850746268657,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7",entityType:"game-target",x:224.266900790167,y:3875.7155399473227,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630771918_2rt9",entityType:"game-target",x:496.22475856014046,y:3100.4038630377518,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630847899_nmfs",entityType:"game-target",x:533.3099209833188,y:1735.5926251097453,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630928676_fvcn",entityType:"game-target",x:197.99824407374877,y:1230.763827919227,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630554201_nuza",cropArea:{x:581.9841966637402,y:3385.882352941177,width:288.95522388059703,height:331.4486391571554},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630548636_i2x0",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630554201_nuza.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630680675_0l7v",cropArea:{x:113.01141352063243,y:3685.267778753292,width:240.2809482001757,height:370.85162423178235},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630680675_0l7v.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630783412_rdih",cropArea:{x:291.48375768217727,y:2816.084284460053,width:335.3116769095699,height:435.7506584723442},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630771918_2rt9",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630783412_rdih.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630856577_6a1e",cropArea:{x:415.87357330992097,y:1591.8876207199296,width:401.75592625109755,height:281.2291483757681},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630847899_nmfs",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630856577_6a1e.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630937210_196u",cropArea:{x:102.19490781387168,y:871.5013169446879,width:294.36347673397717,height:587.1817383669886},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630928676_fvcn",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630937210_196u.png"}]}],["STEEL_VANGUARD-6",{campaign:"STEEL_VANGUARD",level:6,entityOverrides:{turret_3_3:{x:215.07856014047408,y:4939.849628861043},turret_3_2:{x:229.04337137840201,y:4237.826908239551},turret_3_1:{x:408.974258121159,y:4710.495862931333},turret_3_0:{x:659.3549429323967,y:3901.9499294969005},turret_2_2:{x:139.2725548726953,y:3594.902918562269},turret_3_6:{x:785.9746444249341,y:3637.8684119509408},turret_2_1:{x:35.62739244951712,y:3240.727272727273},turret_2_4:{x:294.41805092186127,y:2756.7382339638707},turret_2_3:{x:74.88000000000002,y:2784.969696969697},turret_1_2:{x:816.0464266900791,y:2553.916194428925},turret_1_0:{x:173.68302019315183,y:1655.5724053529148},turret_0_1:{x:709.28,y:1274.9633649932157}},pathOverrides:{},deletedEntities:["turret_3_7","turret_3_4","turret_3_5","turret_2_1","turret_2_5","turret_2_0","turret_2_3","turret_1_3"],terrainBoundaries:{leftX:595.13608428446,rightX:1586.0052677787533},terrainHorizontalOffset:0,addedEntities:[{id:"added_turret_STEEL_VANGUARD_6_1766631100074_heu7",entityType:"turret",x:708.305531167691,y:4266.654960491659,hp:30,fireRate:1.5},{id:"added_game_target_STEEL_VANGUARD_6_1766631112271_ji6a",entityType:"game-target",x:267.53292361720827,y:3228.6567164179105,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_6_1766631186163_pfhu",entityType:"game-target",x:719.5083406496929,y:1792.3792800702372,points:5e3,label:"New Target"},{id:"added_turret_STEEL_VANGUARD_6_1766631227579_sl6v",entityType:"turret",x:771.6593503072872,y:498.26163301141406,hp:30,fireRate:1.5},{id:"added_game_target_STEEL_VANGUARD_6_1766631232649_kqpg",entityType:"game-target",x:405.8296751536436,y:370.0790166812994,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631120611_t7ol",cropArea:{x:175.97892888498697,y:3105.812115891133,width:282.7743634767339,height:249.55223880596986},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631112271_ji6a",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631120611_t7ol.png"},{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631191302_1hr7",cropArea:{x:593.5733099209835,y:1631.6769095697982,width:257.2783143107989,height:357.7172958735732},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631186163_pfhu",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631191302_1hr7.png"},{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631245129_qp6y",cropArea:{x:233.5381913959615,y:117.43634767339722,width:385.531167690957,height:575.5926251097454},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631232649_kqpg",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631245129_qp6y.png"}]}]]);function Ui(c,t){const n=`${c.toUpperCase().replace(/-/g,"_")}-${t}`;return Wy.get(n)}function Xy(c,t,n){const s=Ui(c,t);return s!=null&&s.pathOverrides[n]?s.pathOverrides[n].horizontalOffset:0}function Uh(c,t,n){const s=Ui(c,t);return s==null?void 0:s.entityOverrides[n]}function Li(c,t,n){const s=Ui(c,t);return(s==null?void 0:s.deletedEntities.includes(n))??!1}function Vn(c,t){const n=Ui(c,t);return n==null?void 0:n.terrainBoundaries}function Ip(c,t){const n=Ui(c,t);return(n==null?void 0:n.addedEntities)??[]}function jy(c,t){const n=Ui(c,t);return(n==null?void 0:n.addedPaths)??[]}function zh(c,t,n){var r;const s=Ui(c,t);return(r=s==null?void 0:s.entityMetadataOverrides)==null?void 0:r[n]}function $y(c,t,n){var r;const s=Ui(c,t);return(r=s==null?void 0:s.pathMetadataOverrides)==null?void 0:r[n]}function Bp(c,t){const n=Ui(c,t);return(n==null?void 0:n.destroyedOverlays)??[]}function ep(c,t,n){return Bp(c,t).find(r=>r.linkedTargetId===n)}function rl(){return Si?V:null}class qy{constructor(){this.turrets=new Map,this.structures=new Map,this.totalMapHeight=0,this.currentLevel=0,this.currentCampaign="DAWN_PATROL",this.turretSprite=null,this.structureSprites=new Map,this.turretSprites=new Map,this.horizontalOffset=0,this._isDesignMode=!1,this.reset()}getEffectiveAdjustments(){if(this._isDesignMode){const n=rl();if(n)return n.getEffectiveTerrainAdjustments()}const t=rl();return t&&t.isEnabled()?t.getEffectiveTerrainAdjustments():ca(this.currentCampaign,this.currentLevel)}getEntityOverride(t){if(this._isDesignMode){const s=rl();if(s){const r=s.getPendingChanges().entityOverrides;if(r[t])return r[t]}}return Uh(this.currentCampaign,this.currentLevel,t)||null}isDesignModeActive(){if(this._isDesignMode)return!0;const t=rl();return t?t.isEnabled():!1}getEffectiveHorizontalOffset(){return this._isDesignMode||this.isDesignModeActive()?0:this.horizontalOffset}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n,console.log(`[TERRAIN OVERLAY] setLevelContext: campaign=${t}, level=${n}`)}getDynamicParallaxOffset(t){const n=Vn(this.currentCampaign,this.currentLevel);if(n){const s=Ta.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel),r=ca(this.currentCampaign,this.currentLevel),o=s??r.mapWidthExtended,d=gl(o,n.leftX,n.rightX,w),f=w/2,p=(t-f)/f;return Math.floor(p*d)}return ic(t,w)}reset(){this.turrets.clear(),this.structures.clear(),this.totalMapHeight=0,this.currentLevel=0}loadFromMetadata(t,n,s,r){const o=n*s;this.totalMapHeight=r;for(const d of t){if(Li(this.currentCampaign,this.currentLevel,d.id))continue;const f=Uh(this.currentCampaign,this.currentLevel,d.id);d.type==="turret"&&console.log(`[OVERLAY LOAD] turret ${d.id}: campaign=${this.currentCampaign}, level=${this.currentLevel}, override=`,f);const p=(f==null?void 0:f.x)??d.x,y=(f==null?void 0:f.y)??d.y+o,m=f?y:d.y+o;if(d.type==="turret"){const R=zh(this.currentCampaign,this.currentLevel,d.id),b=(R==null?void 0:R.hp)??d.hp??30,x=(R==null?void 0:R.fireRate)??d.fireRate??100,N=Math.max(60,x),L={metadata:{...d,x:p,y:m,hp:b,fireRate:N},hp:b,maxHp:b,cooldown:120,fireRate:N,angle:0,destroyed:!1,hitFlash:0,lastFireFrame:0,turretType:"aa",burstPending:0,burstNextFrame:0};this.turrets.set(d.id,L)}if(d.type==="structure"){const _={metadata:{...d,y:m},hp:d.hp||100,maxHp:d.hp||100,destroyed:!1,hitFlash:0};this.structures.set(d.id,_)}}console.log(`[OVERLAY] Loaded ${this.turrets.size} turrets, ${this.structures.size} structures`)}loadAddedTurrets(){const n=Ip(this.currentCampaign,this.currentLevel).filter(s=>s.entityType==="turret");if(n.length!==0){for(const s of n){const r=zh(this.currentCampaign,this.currentLevel,s.id),o=(r==null?void 0:r.hp)??s.hp??30,d=(r==null?void 0:r.fireRate)??s.fireRate??100,f=Math.max(60,d),p={metadata:{id:s.id,type:"turret",shape:"circle",label:s.label||"added_turret",x:s.x,y:s.y,radius:8,hp:o,fireRate:f},hp:o,maxHp:o,cooldown:120,fireRate:f,angle:0,destroyed:!1,hitFlash:0,lastFireFrame:0,turretType:"aa",burstPending:0,burstNextFrame:0};this.turrets.set(s.id,p)}console.log(`[OVERLAY] Loaded ${n.length} added turrets from design overrides`)}}setTurretSprite(t){this.turretSprite=t}setTurretSprites(t,n,s){this.turretSprites.set(t,{base:n,cannon:s})}hasTurretSprites(t){return this.turretSprites.has(t)}setStructureSprite(t,n){this.structureSprites.set(t,n)}setTotalMapHeight(t){this.totalMapHeight=t}getTotalMapHeight(){return this.totalMapHeight}update(t,n,s=1){const r=this.getDynamicParallaxOffset(n.x),o=this.getEffectiveAdjustments(),d=Math.floor((o.mapWidthExtended-w)/2);for(const f of this.turrets.values()){if(f.destroyed)continue;f.hitFlash>0&&(f.hitFlash-=s),f.cooldown>0&&(f.cooldown-=s);const p=this.getScreenY(f.metadata.y,t);if(p<-100||p>G+100)continue;const y=f.metadata.x-d-r,m=n.x-y,_=n.y-p;f.angle=Math.atan2(_,m)}}getFiringTurrets(t,n,s=1){const r=[];for(const o of this.turrets.values()){if(o.destroyed||o.cooldown>0)continue;const d=this.getScreenY(o.metadata.y,t);d<0||d>G||o.angle<0||o.angle>Math.PI||(o.cooldown=Math.max(30,Math.floor(6e3/(o.fireRate*s))),o.lastFireFrame=n,r.push(o))}return r}damageTurret(t,n){const s=this.turrets.get(t);return!s||s.destroyed?!1:(s.hp-=n,s.hitFlash=5,s.hp<=0?(s.destroyed=!0,!0):!1)}damageStructure(t,n){const s=this.structures.get(t);return!s||s.destroyed?!1:(s.hp-=n,s.hitFlash=5,s.hp<=0?(s.destroyed=!0,!0):!1)}getTurret(t){return this.turrets.get(t)}getTurrets(){return this.turrets}getActiveTurrets(){return Array.from(this.turrets.values()).filter(t=>!t.destroyed)}getVisibleTurrets(t){return this.getActiveTurrets().filter(n=>{const s=this.getScreenY(n.metadata.y,t);return s>=-50&&s<=G+50})}getTurretScreenPosition(t,n,s=w/2){const r=this.turrets.get(t);if(!r||r.destroyed)return null;const o=this.getEffectiveAdjustments(),d=Math.floor((o.mapWidthExtended-w)/2),f=this.getDynamicParallaxOffset(s);return{x:r.metadata.x-d-f,y:this.getScreenY(r.metadata.y,n)}}applyBombDamage(t,n,s,r,o,d=w/2){const f=[],p=[],y=this.getEffectiveAdjustments(),m=Math.floor((y.mapWidthExtended-w)/2),_=this.getDynamicParallaxOffset(d);for(const S of this.turrets.values()){if(S.destroyed)continue;const R=this.getScreenY(S.metadata.y,o);if(R<-100||R>G+100)continue;const x=S.metadata.x-m-_-t,N=R-n,L=Math.sqrt(x*x+N*N);if(L>s)continue;const O=Math.pow(1-L/s,2),I=Math.floor(r*O);S.hp-=I,S.hitFlash=5,S.hp<=0?(S.destroyed=!0,f.push(S.metadata.id)):p.push(S.metadata.id)}return{destroyed:f,damaged:p}}getActiveStructures(){return Array.from(this.structures.values()).filter(t=>!t.destroyed)}getScreenY(t,n){const s=this.totalMapHeight-n;return G-(s-t)}render(t,n,s=w/2,r=!1){this._isDesignMode=r,this.horizontalOffset=this.getDynamicParallaxOffset(s),!r&&(this.renderStructures(t,n),this.renderTurrets(t,n))}renderStructures(t,n){for(const[s,r]of this.structures.entries()){if(r.destroyed)continue;const o=this.getEntityOverride(s),d=(o==null?void 0:o.x)??r.metadata.x,f=(o==null?void 0:o.y)??r.metadata.y,p=this.getScreenY(f,n);if(p<-100||p>G+100)continue;const y=this.getEffectiveAdjustments(),m=Math.floor((y.mapWidthExtended-w)/2);let _;if(this._isDesignMode){const L=rl(),O=(L==null?void 0:L.getDesignScrollX())??0;_=d-m-O}else _=d-m-this.getEffectiveHorizontalOffset();const S=r.metadata.width||40,R=r.metadata.height||30,b=this.structureSprites.get(r.metadata.label),x=Math.round(_-S/2),N=Math.round(p-R/2);b&&b.complete?t.drawImage(b,x,N,S,R):(t.fillStyle=r.hitFlash>0?"#ffffff":"#606060",t.fillRect(x,N,S,R),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(x+3,N+3,S,R))}}renderTurrets(t,n){const s=wo.BASE_SIZE,r=wo.CANNON_SIZE,o=s/2;for(const[d,f]of this.turrets.entries()){if(f.destroyed)continue;const p=this.getEntityOverride(d),y=(p==null?void 0:p.x)??f.metadata.x,m=(p==null?void 0:p.y)??f.metadata.y,_=this.getScreenY(m,n);if(_<-50||_>G+50)continue;const S=this.getEffectiveAdjustments(),R=Math.floor((S.mapWidthExtended-w)/2);let b;if(this._isDesignMode){const N=rl(),L=(N==null?void 0:N.getDesignScrollX())??0;b=y-R-L}else b=y-R-this.getEffectiveHorizontalOffset();const x=this.turretSprites.get(f.turretType);if(t.save(),t.translate(Math.round(b),Math.round(_)),x&&x.base&&x.cannon)f.hitFlash>0&&(t.filter="brightness(2)"),t.drawImage(x.base,-o,-o,s,s),t.save(),t.rotate(f.angle+Math.PI/2),t.drawImage(x.cannon,-52.5,-52.5,r,r),t.restore(),f.hitFlash>0&&(t.filter="none");else{const N=(f.metadata.radius||8)*wo.SCALE_FACTOR;t.fillStyle=f.hitFlash>0?"#ffffff":"#444444",t.fillRect(-N*1.2,-N*1.2,N*2.4,N*2.4),t.fillStyle=f.hitFlash>0?"#ffffff":"#222222",t.rotate(f.angle),t.fillRect(0,-3,N*2.5,6),t.fillStyle="#ff4444",t.beginPath(),t.arc(N*2.5,0,3,0,Math.PI*2),t.fill()}if(t.restore(),f.hp<f.maxHp){const O=f.hp/f.maxHp,I=_-o-10;t.fillStyle="#333333",t.fillRect(b-30/2,I,30,3),t.fillStyle=O>.5?"#44ff44":O>.25?"#ffff44":"#ff4444",t.fillRect(b-30/2,I,30*O,3)}}}getDebugInfo(){return{totalTurrets:this.turrets.size,activeTurrets:this.getActiveTurrets().length,totalStructures:this.structures.size,activeStructures:this.getActiveStructures().length}}checkBulletCollision(t,n,s,r,o=w/2){const d=this.getEffectiveAdjustments(),f=Math.floor((d.mapWidthExtended-w)/2),p=this.getDynamicParallaxOffset(o);for(const y of this.turrets.values()){if(y.destroyed)continue;const m=this.getScreenY(y.metadata.y,r);if(m<-50||m>G+50)continue;const _=y.metadata.x-f-p,S=wo.COLLISION_RADIUS,R=t-_,b=n-m;if(Math.sqrt(R*R+b*b)<s+S)return y.metadata.id}return null}}const dt=new qy;function Zy(){return Si?V:null}const Ky=32,Qy=15,Jy=60,eE=100,tp=1.5;class tE{constructor(){this.targets=new Map,this.floatingScores=[],this.crosshairsFlashFrame=0,this.totalMapHeight=0,this.currentCampaign="DAWN_PATROL",this.currentLevel=1,this.progress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0},this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0}}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n}getDynamicParallaxOffsetForPlayer(t){const n=Vn(this.currentCampaign,this.currentLevel);if(n){const s=Ta.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel),r=ca(this.currentCampaign,this.currentLevel),o=s??r.mapWidthExtended,d=gl(o,n.leftX,n.rightX,w),f=w/2,p=(t-f)/f;return Math.floor(p*d)}return ic(t,w)}getBaseOffsetX(){const t=ca(this.currentCampaign,this.currentLevel);return Math.floor((t.mapWidthExtended-w)/2)}reset(){this.targets.clear(),this.floatingScores=[],this.crosshairsFlashFrame=0,this.totalMapHeight=0,this.progress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0},this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0}}loadFromMetadata(t,n,s=0){this.totalMapHeight=n;const r=`_L${s}`;for(const d of this.targets.keys())d.endsWith(r)&&this.targets.delete(d);this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0};const o=t.filter(d=>d.type==="target"&&d.targetType);for(const d of o){const f=`${d.id}_L${s}`;if(Li(this.currentCampaign,this.currentLevel,f)||Li(this.currentCampaign,this.currentLevel,d.id))continue;const p=d.targetType,y=d.scoreValue||eE,m=(d.radius||20)*tp,_=Uh(this.currentCampaign,this.currentLevel,f),S=(_==null?void 0:_.x)??d.x,R=(_==null?void 0:_.y)??d.y,b={id:f,targetType:p,points:y,x:S,y:R,radius:m,destroyed:!1,hitFlash:0};this.targets.set(f,b),p==="game-target"?(this.progress.totalGameTargets++,this.levelProgress.totalGameTargets++):(this.progress.totalPointsTargets++,this.levelProgress.totalPointsTargets++)}}loadAddedTargets(){const t=`added_game_target_${this.currentCampaign}_`;for(const r of this.targets.keys())r.startsWith(t)&&this.targets.delete(r);const s=Ip(this.currentCampaign,this.currentLevel).filter(r=>r.entityType==="game-target"&&!Li(this.currentCampaign,this.currentLevel,r.id));if(s.length!==0){for(const r of s){const o=zh(this.currentCampaign,this.currentLevel,r.id),d=(o==null?void 0:o.points)??r.points??5e3,f="game-target",p=20*tp,y={id:r.id,targetType:f,points:d,x:r.x,y:r.y,radius:p,destroyed:!1,hitFlash:0};this.targets.set(r.id,y),this.progress.totalGameTargets++,this.levelProgress.totalGameTargets++}console.log(`[TARGETS] Loaded ${s.length} added targets from design overrides`)}}update(t=1){this.crosshairsFlashFrame+=t;for(let n=this.floatingScores.length-1;n>=0;n--){const s=this.floatingScores[n];s.frame+=t,s.frame>=s.maxFrames&&this.floatingScores.splice(n,1)}for(const n of this.targets.values())n.hitFlash>0&&(n.hitFlash-=t)}applyBombDamage(t,n,s,r,o){const d=[];let f=0;const p=this.getBaseOffsetX(),y=this.getDynamicParallaxOffsetForPlayer(o);for(const m of this.targets.values()){if(m.destroyed)continue;const _=this.getScreenY(m.y,r),S=m.x-p-y;if(_<-200||_>G+200)continue;const R=S-t,b=_-n;Math.sqrt(R*R+b*b)<=s+m.radius&&(m.destroyed=!0,d.push(m.id),f+=m.points,m.targetType==="game-target"?(this.progress.destroyedGameTargets++,this.levelProgress.destroyedGameTargets++):(this.progress.destroyedPointsTargets++,this.levelProgress.destroyedPointsTargets++),this.progress.pointsEarned+=m.points,this.levelProgress.pointsEarned+=m.points,this.spawnFloatingScore(S,_,m.points))}return{destroyed:d,pointsAwarded:f}}allGameTargetsDestroyed(){return this.progress.destroyedGameTargets>=this.progress.totalGameTargets}getProgress(){return{...this.progress}}getLevelProgress(){return{...this.levelProgress}}getTarget(t){return this.targets.get(t)}getTargetScreenPosition(t,n,s){const r=this.targets.get(t);if(!r)return null;const o=this.getBaseOffsetX(),d=this.getDynamicParallaxOffsetForPlayer(s);return{x:r.x-o-d,y:this.getScreenY(r.y,n)}}getVisibleTargets(t){const n=[];for(const s of this.targets.values()){if(s.destroyed)continue;const r=this.getScreenY(s.y,t);r>=-50&&r<=G+50&&n.push(s)}return n}getAllTargetsForDesignMode(t){return Array.from(this.targets.values())}getAllTargetsForMiniMap(){return Array.from(this.targets.values()).map(t=>({id:t.id,x:t.x,y:t.y,targetType:t.targetType,destroyed:t.destroyed}))}getTotalMapHeight(){return this.totalMapHeight}spawnFloatingScore(t,n,s){this.floatingScores.push({x:t,y:n,points:s,frame:0,maxFrames:Jy})}getFloatingScores(){return this.floatingScores}renderCrosshairs(t,n,s){const r=Zy();if(((r==null?void 0:r.isEnabled())??!1)||!(Math.floor(this.crosshairsFlashFrame/Qy)%2===0))return;const f=this.getBaseOffsetX(),p=this.getDynamicParallaxOffsetForPlayer(s);for(const y of this.targets.values()){if(y.destroyed)continue;const m=this.getScreenY(y.y,n);if(m<-50||m>G+50)continue;const _=y.x-f-p,S=Ky;t.save();const R=y.targetType==="game-target"?"#ff0000":"#ffaa00";t.strokeStyle=R,t.lineWidth=2,t.globalAlpha=.85,t.beginPath(),t.moveTo(_-S,m),t.lineTo(_-S/3,m),t.moveTo(_+S/3,m),t.lineTo(_+S,m),t.moveTo(_,m-S),t.lineTo(_,m-S/3),t.moveTo(_,m+S/3),t.lineTo(_,m+S),t.moveTo(_-S,m-S*.6),t.lineTo(_-S,m-S),t.lineTo(_-S*.6,m-S),t.moveTo(_+S,m-S*.6),t.lineTo(_+S,m-S),t.lineTo(_+S*.6,m-S),t.moveTo(_-S,m+S*.6),t.lineTo(_-S,m+S),t.lineTo(_-S*.6,m+S),t.moveTo(_+S,m+S*.6),t.lineTo(_+S,m+S),t.lineTo(_+S*.6,m+S),t.stroke(),t.fillStyle=R,t.beginPath(),t.arc(_,m,3,0,Math.PI*2),t.fill(),y.targetType==="game-target"&&(t.font='10px "Black Ops One", monospace',t.fillStyle=R,t.textAlign="center",t.fillText("TARGET",_,m-S-8)),t.restore()}}renderFloatingScores(t){for(const n of this.floatingScores){const s=n.frame/n.maxFrames,r=-50*s,o=1-s*.8,d=1+s*.4;t.save(),t.globalAlpha=o,t.font=`bold ${Math.floor(18*d)}px "Black Ops One", monospace`,t.textAlign="center",t.strokeStyle="#000000",t.lineWidth=3,t.fillStyle="#ffff00";const f=`+${n.points}`;t.strokeText(f,n.x,n.y+r),t.fillText(f,n.x,n.y+r),t.restore()}}getScreenY(t,n){const s=this.totalMapHeight-n;return G-(s-t)}}const $t=new tE,Fi="#00BFFF",Io="#FFA500",aE="#FFFF00",ol="#88FF88",cl="#8888FF",Bo=8,ba=30,Rh="#44FF88",Mh="#FF88FF",hr="#88FFFF",iE="#FFA500",nE="#FF4444",bh="#FF6600",ap="rgba(0, 0, 0, 0.85)",Fo="#00BFFF",Gn="rgba(50, 50, 50, 0.9)",sE="rgba(0, 191, 255, 0.5)",ja=90,xa=w-ja-30,Jt=280,kh=192,vt=xa,ys=Jt+kh+10,Sa=ja,Oh=215,on=140,xh=130,xi=24;class lE{constructor(){this.overlayImageCache=new Map,this.loadingImages=new Set}clearOverlayImageCache(t){this.overlayImageCache.delete(t),this.loadingImages.delete(t)}shouldRender(){return Si&&V.isEnabled()}render(t){var o,d;if(!this.shouldRender())return;const n=V.getState(),s=n.designScrollX,r=n.designScrollY;this.renderGrid(t,r),this.renderBoundaries(t,s,n.pendingChanges.terrainBoundaries,n.selectedElement),this.renderEntityPaths(t,s,r,n.pendingChanges.pathOverrides,n.selectedElement),this.renderSelectableElements(t,s,r,n.pendingChanges.entityOverrides),this.renderAddedEntities(t,s,r),this.renderAddedPaths(t,s,r),this.renderDestroyedOverlays(t,s,r),this.renderDestroySelectionPreview(t,s,r),this.renderPlacementPreview(t,s,r),this.renderPathDrawingPreview(t,s,r),n.selectedElement&&this.renderSelection(t,n.selectedElement,s,r),this.renderHeader(t),this.renderEntityPalette(t),this.renderScrollIndicator(t,r),n.selectedElement&&this.renderCoordinateDisplay(t,n.selectedElement),((o=n.selectedElement)==null?void 0:o.type)==="destroyed-overlay"&&this.renderOverlayActionPanel(t,n.selectedElement,s,r),n.isSelectingLinkTarget&&this.renderTargetSelectionMode(t,s,r),this.renderHelpOverlay(t),((d=n.selectedElement)==null?void 0:d.type)==="added-path"&&this.renderPathEditor(t)}getTotalMapHeight(){const t=dt.getTotalMapHeight();return t>0?t:bt.TOTAL_MAP_HEIGHT}getBaseOffsetX(){const t=V.getLevelInfo(),n=ca(t.campaign,t.level);return Math.floor((n.mapWidthExtended-w)/2)}getTerrainHorizontalOffset(){return V.getTerrainHorizontalOffset()}renderGrid(t,n){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=1;const s=100,r=this.getTotalMapHeight()-n;for(let d=0;d<=w;d+=s)t.beginPath(),t.moveTo(d,0),t.lineTo(d,G),t.stroke();const o=Math.floor((r-G)/s)*s;for(let d=o;d<=r;d+=s){const f=G-(r-d);t.beginPath(),t.moveTo(0,f),t.lineTo(w,f),t.stroke()}t.restore()}renderBoundaries(t,n,s,r){t.save();const o=(r==null?void 0:r.id)==="left_boundary",d=(r==null?void 0:r.id)==="right_boundary",f=V.getBaseOffsetXForPanning(),p=this.getTerrainHorizontalOffset(),y=s.leftX-f-n+p,m=s.rightX-f-n+p,_="#FF6600",S=Fi;y>=-50&&y<=w+50&&(t.strokeStyle=o?S:_,t.lineWidth=o?4:2,t.setLineDash(o?[]:[8,4]),t.globalAlpha=o?1:.7,t.beginPath(),t.moveTo(y,0),t.lineTo(y,G),t.stroke(),t.setLineDash([]),t.fillStyle=o?S:_,t.font="10px monospace",t.textAlign="center",t.fillText("LEFT",y,55),t.fillText(`${Math.round(s.leftX)}`,y,68)),m>=-50&&m<=w+50&&(t.strokeStyle=d?S:_,t.lineWidth=d?4:2,t.setLineDash(d?[]:[8,4]),t.globalAlpha=d?1:.7,t.beginPath(),t.moveTo(m,0),t.lineTo(m,G),t.stroke(),t.setLineDash([]),t.fillStyle=d?S:_,t.font="10px monospace",t.textAlign="center",t.fillText("RIGHT",m,55),t.fillText(`${Math.round(s.rightX)}`,m,68)),y<0&&(t.fillStyle=_,t.font="10px monospace",t.textAlign="left",t.fillText(` LEFT: ${Math.round(s.leftX)}`,5,55)),m>w&&(t.fillStyle=_,t.font="10px monospace",t.textAlign="right",t.fillText(`RIGHT: ${Math.round(s.rightX)} `,w-5,55)),t.restore()}renderEntityPaths(t,n,s,r,o){var m;const d=V.getEntityPaths();if(d.length===0)return;const f=this.getTotalMapHeight()-s,p=this.getBaseOffsetX(),y=this.getTerrainHorizontalOffset();for(const _ of d){if(_.waypoints.length<2)continue;const S=((m=r[_.id])==null?void 0:m.horizontalOffset)??0,R=(o==null?void 0:o.id)===_.id,b=S!==0;let x;_.entityType===A.ENEMY_BATTLESHIP?x=cl:_.entityType===A.ENEMY_TANK||_.entityType===A.ENEMY_LARGE_TANK?x=ol:x=aE,b&&!R&&(x=Io),R&&(x=Fi),t.save(),t.strokeStyle=x,t.lineWidth=R?3:2,t.setLineDash(R?[]:[8,4]),t.globalAlpha=R?1:.6,t.beginPath();let N=!0,L=!1;for(let O=0;O<_.waypoints.length;O++){const I=_.waypoints[O],Y=I.x+S-p-n+y,W=G-(f-I.y);if(W<-500||W>G+500){N=!0;continue}L=!0,N?(t.moveTo(Y,W),N=!1):t.lineTo(Y,W)}if(L&&t.stroke(),R){t.fillStyle=x;for(let O=0;O<_.waypoints.length;O+=Math.max(1,Math.floor(_.waypoints.length/20))){const I=_.waypoints[O],Y=I.x+S-p-n+y,W=G-(f-I.y);W>=-50&&W<=G+50&&(t.beginPath(),t.arc(Y,W,4,0,Math.PI*2),t.fill())}}for(let O=0;O<_.waypoints.length;O++){const I=_.waypoints[O],Y=G-(f-I.y);if(Y>=0&&Y<=G){const W=I.x+S-p-n+y;t.fillStyle=x,t.font="10px monospace",t.textAlign="left",t.fillText(_.id,W+10,Y-5);const Z=_.entityType.replace("ENEMY_","");t.fillText(Z,W+10,Y+10);break}}t.restore()}}renderSelectableElements(t,n,s,r){const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=V.getState(),y=p.pendingChanges.deletedEntities,m=p.currentCampaign,_=p.currentLevel,S=dt.getTurrets();for(const[b,x]of S){if(y.includes(b)||m&&Li(m,_,b))continue;const N=r[b],L=(N==null?void 0:N.x)??x.metadata.x,O=(N==null?void 0:N.y)??x.metadata.y,I=L-d-n+f,Y=G-(o-O);Y>=-50&&Y<=G+50&&I>=-50&&I<=w+50&&this.renderElementMarker(t,I,Y,"turret",!!N)}const R=$t.getAllTargetsForDesignMode(s);for(const b of R){if(y.includes(b.id)||m&&Li(m,_,b.id))continue;const x=r[b.id],N=(x==null?void 0:x.x)??b.x,L=(x==null?void 0:x.y)??b.y,O=N-d-n+f,I=G-(o-L);if(I>=-50&&I<=G+50&&O>=-50&&O<=w+50){const Y=b.targetType==="game-target";this.renderElementMarker(t,O,I,Y?"game-target":"target",!!x)}}}renderElementMarker(t,n,s,r,o){t.save();let d;if(o?d=Io:r==="turret"?d="#4488FF":r==="game-target"?d="#FF4444":d="#FFAA44",t.strokeStyle=d,t.lineWidth=2,t.setLineDash([4,4]),r==="game-target"){const f=ba;t.strokeRect(n-f,s-f,f*2,f*2),t.setLineDash([]);const p=f*.6;t.strokeRect(n-p,s-p,p*2,p*2),t.beginPath(),t.moveTo(n-12,s),t.lineTo(n+12,s),t.moveTo(n,s-12),t.lineTo(n,s+12),t.stroke(),t.lineWidth=3;const y=8;t.beginPath(),t.moveTo(n-f,s-f+y),t.lineTo(n-f,s-f),t.lineTo(n-f+y,s-f),t.stroke(),t.beginPath(),t.moveTo(n+f-y,s-f),t.lineTo(n+f,s-f),t.lineTo(n+f,s-f+y),t.stroke(),t.beginPath(),t.moveTo(n-f,s+f-y),t.lineTo(n-f,s+f),t.lineTo(n-f+y,s+f),t.stroke(),t.beginPath(),t.moveTo(n+f-y,s+f),t.lineTo(n+f,s+f),t.lineTo(n+f,s+f-y),t.stroke(),t.fillStyle=d,t.font="bold 8px monospace",t.textAlign="center",t.fillText("TARGET",n,s-f-5)}else t.beginPath(),t.arc(n,s,ba,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.beginPath(),t.arc(n,s,ba*.6,0,Math.PI*2),t.stroke(),t.beginPath(),t.moveTo(n-10,s),t.lineTo(n+10,s),t.moveTo(n,s-10),t.lineTo(n,s+10),t.stroke(),r==="turret"&&(t.fillStyle=d,t.font="8px monospace",t.textAlign="center",t.fillText("TURRET",n,s-ba-5));t.restore()}renderSelection(t,n,s,r){if(n.type==="path"||n.type==="added-path"||n.type==="boundary"||n.type==="destroyed-overlay")return;const o=this.getTotalMapHeight()-r,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=G-(o-n.currentPosition.y),y=n.currentPosition.x-d-s+f;t.save(),t.strokeStyle=Fi,t.lineWidth=3,t.setLineDash([]);const m=ba*2;t.strokeRect(y-m/2,p-m/2,m,m),t.fillStyle=Fi;const _=[{x:y-m/2,y:p-m/2},{x:y+m/2,y:p-m/2},{x:y-m/2,y:p+m/2},{x:y+m/2,y:p+m/2}];for(const S of _)t.fillRect(S.x-Bo/2,S.y-Bo/2,Bo,Bo);t.fillStyle=Fi,t.font="bold 12px monospace",t.textAlign="center",t.fillText(n.type.toUpperCase(),y,p-m/2-8),t.restore()}renderHeader(t){t.save(),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,w,40),t.fillStyle="#00FF00",t.font="bold 16px monospace",t.textAlign="left",t.fillText("DESIGN MODE",10,26);const n=V.getLevelInfo();t.fillStyle="#FFFFFF",t.font="14px monospace",t.textAlign="center",t.fillText(`${n.campaign} - Level ${n.level}`,w/2,26),V.hasUnsavedChanges()&&(t.fillStyle="#FFA500",t.textAlign="right",t.fillText("* UNSAVED",w-10,26)),t.restore()}renderScrollIndicator(t,n){t.save();const s=this.getTotalMapHeight(),r=200,o=20,d=w-o-10,f=50;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(d,f,o,r);const p=n/(s-G),y=Math.max(20,G/s*r),m=f+(1-p)*(r-y),_=t.createLinearGradient(d,m,d+o,m);_.addColorStop(0,"rgba(0, 191, 255, 0.9)"),_.addColorStop(.5,"rgba(100, 220, 255, 0.95)"),_.addColorStop(1,"rgba(0, 191, 255, 0.9)"),t.fillStyle=_,t.fillRect(d,m,o,y),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1;const S=m+y/2;for(let b=-2;b<=2;b++)t.beginPath(),t.moveTo(d+4,S+b*4),t.lineTo(d+o-4,S+b*4),t.stroke();t.strokeStyle="#00BFFF",t.lineWidth=2,t.strokeRect(d,f,o,r),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="9px monospace",t.textAlign="left",t.fillText("TOP",d+o+4,f+8),t.fillText("END",d+o+4,f+r),t.fillStyle="#FFFFFF",t.font="10px monospace",t.textAlign="center";const R=Math.round(n/(s-G)*100);t.fillText(`${R}%`,d+o/2,f+r+15),t.restore()}renderCoordinateDisplay(t,n){t.save();let s=60;n.type==="path"||n.type==="added-path"||n.type==="boundary"?s=75:n.type==="turret"?s=110:n.type==="target"&&(s=90);const r=220,o=10,d=G-s-10;if(t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(o,d,r,s),t.strokeStyle=Fi,t.lineWidth=1,t.strokeRect(o,d,r,s),t.fillStyle="#FFFFFF",t.font="12px monospace",t.textAlign="left",t.fillText(`ID: ${n.id}`,o+10,d+20),n.type==="path"||n.type==="added-path")if(n.type==="added-path"){const f=V.getAddedPath(n.id);t.fillText("Type: ADDED PATH",o+10,d+36),f&&(t.fillText(`Entity: ${f.entityType}`,o+10,d+52),n.selectedVertexIndex!==void 0&&t.fillText(`Vertex: ${n.selectedVertexIndex+1}`,o+10,d+68))}else{const f=V.getPathOffset(n.id);t.fillText("Type: PATH",o+10,d+36),t.fillText(`H-Offset: ${f}px`,o+10,d+52),f!==0?(t.fillStyle=Io,t.fillText("Drag left/right to adjust",o+10,d+68)):(t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillText("Drag left/right to adjust",o+10,d+68))}else if(n.type==="boundary"){const f=n.id==="left_boundary"?"LEFT":"RIGHT";t.fillText(`Type: ${f} BOUNDARY`,o+10,d+36),t.fillText(`X: ${Math.round(n.currentPosition.x)}px`,o+10,d+52),t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillText("Drag left/right to adjust",o+10,d+68)}else if(n.type==="turret"){t.fillText(`X: ${Math.round(n.currentPosition.x)}`,o+10,d+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,o+100,d+36);const f=V.getEntityMetadata(n.id),p=(f==null?void 0:f.hp)??30,y=(f==null?void 0:f.fireRate)??1.5;t.fillStyle="#88FF88",t.fillText(`HP: ${p}`,o+10,d+56),t.fillText("[/] to adjust",o+100,d+56),t.fillStyle="#FFFF88",t.fillText(`Fire Rate: ${y.toFixed(1)}`,o+10,d+72),t.fillText("[,/.] to adjust",o+140,d+72),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="10px monospace",t.fillText("[ ] = HP 10, , . = Rate 0.1",o+10,d+90),t.fillText("+Shift for 1 / 0.5",o+10,d+102)}else if(n.type==="target"){t.fillText(`X: ${Math.round(n.currentPosition.x)}`,o+10,d+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,o+100,d+36);const f=V.getEntityMetadata(n.id),p=(f==null?void 0:f.points)??5e3;t.fillStyle="#FF88FF",t.fillText(`Points: ${p}`,o+10,d+56),t.fillText("[/] to adjust",o+130,d+56),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="10px monospace",t.fillText("[ ] = 1000, +Shift = 100",o+10,d+74)}else{t.fillText(`X: ${Math.round(n.currentPosition.x)}`,o+10,d+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,o+100,d+36);const f=Math.round(n.currentPosition.x-n.originalPosition.x),p=Math.round(n.currentPosition.y-n.originalPosition.y);(f!==0||p!==0)&&(t.fillStyle=Io,t.fillText(`Delta: (${f>0?"+":""}${f}, ${p>0?"+":""}${p})`,o+10,d+52))}t.restore()}renderHelpOverlay(t){t.save();const n=["D: Exit","ESC: Exit","Arrows: Nudge","+Shift: x10","Ctrl+/: Bounds","Ctrl+Shift+/: L","Ctrl+Alt+/: R","Del: Delete","Drag: Move","Pan: Scroll","Scrollbar: Jump"],s=10,r=50,o=14;t.font="10px monospace",t.textAlign="left";for(let d=0;d<n.length;d++)t.fillStyle="rgba(255, 255, 255, 0.6)",t.fillText(n[d],s,r+d*o);t.restore()}renderAddedEntities(t,n,s){var R;const r=V.getAddedEntities();if(r.length===0)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=V.getState(),y=(R=p.selectedElement)==null?void 0:R.id,m=p.pendingChanges.deletedEntities,_=p.currentCampaign,S=p.currentLevel;for(const b of r){if(m.includes(b.id)||_&&Li(_,S,b.id))continue;const x=b.x-d-n+f,N=G-(o-b.y);if(N<-50||N>G+50||x<-50||x>w+50)continue;const L=y===b.id;this.renderAddedEntityMarker(t,x,N,b,L)}}renderAddedEntityMarker(t,n,s,r,o){t.save();const d=r.entityType==="turret"?Rh:Mh;if(t.strokeStyle=o?Fi:d,t.lineWidth=o?3:2,t.setLineDash([6,3]),r.entityType==="turret")t.beginPath(),t.arc(n,s,ba,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.beginPath(),t.arc(n,s,ba*.6,0,Math.PI*2),t.stroke();else{const f=ba;t.strokeRect(n-f,s-f,f*2,f*2),t.setLineDash([]);const p=f*.6;t.strokeRect(n-p,s-p,p*2,p*2)}t.setLineDash([]),t.beginPath(),t.moveTo(n-10,s),t.lineTo(n+10,s),t.moveTo(n,s-10),t.lineTo(n,s+10),t.stroke(),t.fillStyle=d,t.font="bold 8px monospace",t.textAlign="center",t.fillText("NEW",n,s-ba-12),t.fillText(r.entityType.toUpperCase(),n,s-ba-3),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="7px monospace",r.entityType==="turret"?t.fillText(`HP:${r.hp??30} FR:${r.fireRate??1.5}`,n,s+ba+10):t.fillText(`${r.points??5e3} pts`,n,s+ba+10),t.restore()}renderAddedPaths(t,n,s){const r=V.getAddedPaths();if(r.length===0)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=V.getState().selectedElement,y=p==null?void 0:p.id,m=p==null?void 0:p.selectedVertexIndex;for(const _ of r){if(_.waypoints.length<1)continue;const S=y===_.id,R=S?Fi:hr;if(t.save(),t.strokeStyle=R,t.lineWidth=S?3:2,t.setLineDash([8,4]),_.waypoints.length>=2){t.beginPath();let L=!0;for(const O of _.waypoints){const I=O.x-d-n+f,Y=G-(o-O.y);L?(t.moveTo(I,Y),L=!1):t.lineTo(I,Y)}t.stroke()}t.setLineDash([]);for(let L=0;L<_.waypoints.length;L++){const O=_.waypoints[L],I=O.x-d-n+f,Y=G-(o-O.y),W=S&&m===L,Z=W?10:S?6:4,K=W?"#FFFF00":R;t.fillStyle=K,t.beginPath(),t.arc(I,Y,Z,0,Math.PI*2),t.fill(),W&&(t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()),S&&(t.fillStyle="#000000",t.font="bold 8px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(String(L+1),I,Y))}const b=_.waypoints[0],x=b.x-d-n+f,N=G-(o-b.y);t.fillStyle=R,t.font="bold 9px monospace",t.textAlign="center",t.textBaseline="alphabetic",t.fillText("NEW PATH",x,N-20),t.font="8px monospace",t.fillText(`${_.entityType} | ${_.direction}`,x,N-10),t.restore()}}renderPlacementPreview(t,n,s){const r=V.getState();if(r.placementMode==="none"||r.placementMode==="path"||!r.placementPreview)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=r.placementPreview.x-d-n+f,y=G-(o-r.placementPreview.y);t.save(),t.globalAlpha=.6;const m=r.placementMode==="turret"?Rh:Mh;if(t.strokeStyle=m,t.lineWidth=2,t.setLineDash([4,4]),r.placementMode==="turret")t.beginPath(),t.arc(p,y,ba,0,Math.PI*2),t.stroke();else{const _=ba;t.strokeRect(p-_,y-_,_*2,_*2)}t.setLineDash([]),t.beginPath(),t.moveTo(p-15,y),t.lineTo(p+15,y),t.moveTo(p,y-15),t.lineTo(p,y+15),t.stroke(),t.globalAlpha=1,t.fillStyle="#FFFFFF",t.font="bold 10px monospace",t.textAlign="center",t.fillText(`PLACE ${r.placementMode.toUpperCase()}`,p,y-ba-8),t.restore()}renderPathDrawingPreview(t,n,s){const r=V.getPathDrawingPoints();if(r.length===0)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset();t.save(),t.strokeStyle=hr,t.lineWidth=3,t.setLineDash([6,3]),t.beginPath();let p=!0;for(const S of r){const R=S.x-d-n+f,b=G-(o-S.y);p?(t.moveTo(R,b),p=!1):t.lineTo(R,b)}t.stroke(),t.setLineDash([]),t.fillStyle=hr;for(let S=0;S<r.length;S++){const R=r[S],b=R.x-d-n+f,x=G-(o-R.y);t.beginPath(),t.arc(b,x,S===0?8:5,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.font="bold 8px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(String(S+1),b,x),t.fillStyle=hr}const y=r[r.length-1],m=y.x-d-n+f,_=G-(o-y.y);t.fillStyle="#FFFFFF",t.font="10px monospace",t.textAlign="left",t.fillText("Click to add point",m+15,_),t.fillText("Enter to finish",m+15,_+12),t.fillText("ESC to cancel",m+15,_+24),t.restore()}renderEntityPalette(t){const s=V.getState().placementMode;t.save(),t.fillStyle=ap,t.strokeStyle=Fo,t.lineWidth=2,t.beginPath(),t.roundRect(xa,Jt,ja,kh,4),t.fill(),t.stroke(),t.fillStyle=Fo,t.font="bold 10px monospace",t.textAlign="center",t.fillText("ADD ENTITY",xa+ja/2,Jt+14);const r=[{mode:"turret",label:"Turret",color:Rh,y:Jt+28},{mode:"game-target",label:"Target",color:Mh,y:Jt+60},{mode:"path",label:"Path",color:hr,y:Jt+92},{mode:"destroy-select",label:"Destroy",color:bh,y:Jt+124}];for(const o of r){const d=s===o.mode;t.fillStyle=d?sE:Gn,t.strokeStyle=o.color,t.lineWidth=d?2:1,t.beginPath(),t.roundRect(xa+6,o.y,ja-12,26,3),t.fill(),t.stroke(),t.fillStyle=o.color;const f=xa+20,p=o.y+13;o.mode==="turret"?(t.beginPath(),t.arc(f,p,6,0,Math.PI*2),t.fill()):o.mode==="game-target"?t.fillRect(f-6,p-6,12,12):o.mode==="path"?(t.strokeStyle=o.color,t.lineWidth=2,t.beginPath(),t.moveTo(f-6,p),t.quadraticCurveTo(f-2,p-5,f+2,p),t.quadraticCurveTo(f+6,p+5,f+10,p),t.stroke()):o.mode==="destroy-select"&&(t.strokeStyle=o.color,t.lineWidth=2,t.beginPath(),t.moveTo(f,p-6),t.lineTo(f,p+6),t.moveTo(f-6,p),t.lineTo(f+6,p),t.moveTo(f-4,p-4),t.lineTo(f+4,p+4),t.moveTo(f+4,p-4),t.lineTo(f-4,p+4),t.stroke()),t.fillStyle=d?"#FFFFFF":o.color,t.font="10px monospace",t.textAlign="left",t.fillText(o.label,xa+34,o.y+17)}s!=="none"?(t.fillStyle="#FFFFFF",t.font="8px monospace",t.textAlign="center",s==="path"?V.isDrawingPath()?(t.fillText("Click to add points",xa+ja/2,Jt+167),t.fillText("Enter to finish",xa+ja/2,Jt+179)):t.fillText("Click to start path",xa+ja/2,Jt+172):s==="destroy-select"?V.isDestroySelecting()?(t.fillText("Drag to select area",xa+ja/2,Jt+167),t.fillText("Release to confirm",xa+ja/2,Jt+179)):t.fillText("Click+drag to select",xa+ja/2,Jt+172):t.fillText("Click to place",xa+ja/2,Jt+172)):(t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="8px monospace",t.textAlign="center",t.fillText("Press N to cycle",xa+ja/2,Jt+172)),t.restore()}isPointInPalette(t,n){return t>=xa&&t<=xa+ja&&n>=Jt&&n<=Jt+kh}handlePaletteClick(t,n){if(!this.isPointInPalette(t,n))return null;const s=[{mode:"turret",y:Jt+28},{mode:"game-target",y:Jt+60},{mode:"path",y:Jt+92},{mode:"destroy-select",y:Jt+124}];for(const r of s)if(n>=r.y&&n<=r.y+26)return r.mode;return null}isPointInPathEditor(t,n){var r;return((r=V.getState().selectedElement)==null?void 0:r.type)!=="added-path"?!1:t>=vt&&t<=vt+Sa&&n>=ys&&n<=ys+Oh}handlePathEditorClick(t,n){const s=V.getState();if(!s.selectedElement||s.selectedElement.type!=="added-path"||!this.isPointInPathEditor(t,n))return!1;const r=V.getAddedPath(s.selectedElement.id);if(!r)return!1;const o=20,d=4,f=ys+26,p=(Sa-18)/2,y=(Sa-20)/3;if(n>=f&&n<f+o){const R=t-(vt+6);if(R>=0&&R<p)return V.updateAddedPathAttribute(r.id,{entityType:"tank"}),!0;if(R>=p+6&&R<Sa-12)return V.updateAddedPathAttribute(r.id,{entityType:"battleship"}),!0}const m=f+o+d+12;if(n>=m&&n<m+o){const R=t-(vt+6);if(R>=0&&R<y)return V.updateAddedPathAttribute(r.id,{direction:"up"}),!0;if(R>=y+4&&R<y*2+4)return V.updateAddedPathAttribute(r.id,{direction:"down"}),!0;if(R>=y*2+8)return V.updateAddedPathAttribute(r.id,{direction:"random"}),!0}const _=m+o+d+12;if(n>=_&&n<_+o){const R=t-(vt+6),b=24;if(R>=0&&R<b){const x=Math.max(.001,(r.speed??.004)-.001);return V.updateAddedPathAttribute(r.id,{speed:parseFloat(x.toFixed(3))}),!0}else if(R>=Sa-12-b&&R<Sa-12){const x=Math.min(.02,(r.speed??.004)+.001);return V.updateAddedPathAttribute(r.id,{speed:parseFloat(x.toFixed(3))}),!0}}const S=_+o+d+12;if(n>=S&&n<S+o){const R=t-(vt+6);if(R>=0&&R<p)return V.updateAddedPathAttribute(r.id,{spawnPoint:"top"}),!0;if(R>=p+6&&R<Sa-12)return V.updateAddedPathAttribute(r.id,{spawnPoint:"bottom"}),!0}return!0}renderPathEditor(t){const n=V.getState();if(!n.selectedElement||n.selectedElement.type!=="added-path")return;const s=V.getAddedPath(n.selectedElement.id);if(!s)return;t.save(),t.fillStyle=ap,t.strokeStyle=Fo,t.lineWidth=2,t.beginPath(),t.roundRect(vt,ys,Sa,Oh,4),t.fill(),t.stroke(),t.fillStyle=Fo,t.font="bold 10px monospace",t.textAlign="center",t.fillText("PATH EDITOR",vt+Sa/2,ys+14);const r=20,o=4,d=ys+26,f=(Sa-18)/2,p=(Sa-20)/3;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Entity:",vt+6,d-2);const y=s.entityType==="tank";t.fillStyle=y?"rgba(0, 191, 255, 0.5)":Gn,t.strokeStyle=ol,t.lineWidth=y?2:1,t.beginPath(),t.roundRect(vt+6,d,f,r,3),t.fill(),t.stroke(),t.fillStyle=y?"#FFFFFF":ol,t.font="9px monospace",t.textAlign="center",t.fillText("Tank",vt+6+f/2,d+13);const m=s.entityType==="battleship";t.fillStyle=m?"rgba(0, 191, 255, 0.5)":Gn,t.strokeStyle=cl,t.lineWidth=m?2:1,t.beginPath(),t.roundRect(vt+6+f+6,d,f,r,3),t.fill(),t.stroke(),t.fillStyle=m?"#FFFFFF":cl,t.fillText("Ship",vt+6+f+6+f/2,d+13);const _=d+r+o+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Direction:",vt+6,_-2);const S=[{label:"Up",value:"up"},{label:"Down",value:"down"},{label:"Rnd",value:"random"}];for(let Z=0;Z<S.length;Z++){const K=S[Z],Q=s.direction===K.value,me=vt+6+(p+4)*Z;t.fillStyle=Q?"rgba(0, 191, 255, 0.5)":Gn,t.strokeStyle="#FFFF88",t.lineWidth=Q?2:1,t.beginPath(),t.roundRect(me,_,p,r,3),t.fill(),t.stroke(),t.fillStyle=Q?"#FFFFFF":"#FFFF88",t.font="9px monospace",t.textAlign="center",t.fillText(K.label,me+p/2,_+13)}const R=_+r+o+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Speed:",vt+6,R-2);const b=24,x=s.speed??.004;t.fillStyle=Gn,t.strokeStyle="#FF8888",t.lineWidth=1,t.beginPath(),t.roundRect(vt+6,R,b,r,3),t.fill(),t.stroke(),t.fillStyle="#FF8888",t.font="bold 14px monospace",t.textAlign="center",t.fillText("-",vt+6+b/2,R+15),t.fillStyle="#FFFFFF",t.font="10px monospace",t.fillText(x.toFixed(3),vt+Sa/2,R+14),t.fillStyle=Gn,t.strokeStyle="#88FF88",t.lineWidth=1,t.beginPath(),t.roundRect(vt+Sa-6-b,R,b,r,3),t.fill(),t.stroke(),t.fillStyle="#88FF88",t.font="bold 14px monospace",t.textAlign="center",t.fillText("+",vt+Sa-6-b/2,R+15);const N=R+r+o+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Spawn:",vt+6,N-2);const O=(s.spawnPoint??"top")==="top";t.fillStyle=O?ol:Gn,t.strokeStyle=ol,t.lineWidth=1,t.beginPath(),t.roundRect(vt+6,N,f,r,3),t.fill(),t.stroke(),t.fillStyle=O?"#FFFFFF":ol,t.font="9px monospace",t.textAlign="center",t.fillText("Top",vt+6+f/2,N+13),t.fillStyle=O?Gn:cl,t.strokeStyle=cl,t.lineWidth=1,t.beginPath(),t.roundRect(vt+6+f+6,N,f,r,3),t.fill(),t.stroke(),t.fillStyle=O?cl:"#FFFFFF",t.fillText("Bottom",vt+6+f+6+f/2,N+13);const I=N+r+o+8;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Path ID:",vt+6,I),t.fillStyle="#FFFFFF",t.font="8px monospace",t.textAlign="center";const Y=s.pathId.length>12?s.pathId.slice(0,12)+"...":s.pathId;t.fillText(Y,vt+Sa/2,I+12);const W=I+24;t.fillStyle="#888888",t.font="8px monospace",t.textAlign="center",t.fillText(`${s.waypoints.length} vertices`,vt+Sa/2,W),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="7px monospace",t.textAlign="center",t.fillText("Del = remove vertex",vt+Sa/2,ys+Oh-10),t.restore()}renderDestroyedOverlays(t,n,s){var y;const r=V.getDestroyedOverlays();if(r.length===0)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=(y=V.getState().selectedElement)==null?void 0:y.id;for(const m of r){const{cropArea:_,linkedTargetId:S,showInDesignMode:R,imageGenerated:b,id:x}=m,N=p===x,L=_.x-d-n+f,O=L+_.width,I=G-(o-_.y),Y=G-(o-(_.y+_.height)),W=Math.min(I,Y),Z=Math.max(I,Y);if(O<-50||L>w+50||W>G+50||Z<-50)continue;const K=_.width,Q=Z-W;t.save();const me=N?Fi:S?nE:iE;t.strokeStyle=me,t.lineWidth=N?4:2,t.setLineDash(N?[]:[8,4]),t.strokeRect(L,W,K,Q),t.setLineDash([]),t.lineWidth=3;const pe=10;t.beginPath(),t.moveTo(L,W+pe),t.lineTo(L,W),t.lineTo(L+pe,W),t.stroke(),t.beginPath(),t.moveTo(O-pe,W),t.lineTo(O,W),t.lineTo(O,W+pe),t.stroke(),t.beginPath(),t.moveTo(L,Z-pe),t.lineTo(L,Z),t.lineTo(L+pe,Z),t.stroke(),t.beginPath(),t.moveTo(O-pe,Z),t.lineTo(O,Z),t.lineTo(O,Z-pe),t.stroke(),t.fillStyle=me,t.font="bold 10px monospace",t.textAlign="center";const fe=(L+O)/2;let re="DESTROY OVERLAY";if(S?re=`LINKED: ${S.slice(0,15)}...`:b||(re="DESTROY (no image)"),t.fillText(re,fe,W-8),t.font="8px monospace",t.fillStyle="rgba(255, 255, 255, 0.7)",t.fillText(x.slice(-20),fe,W-20),b&&R&&m.imagePath){const ce=this.overlayImageCache.get(x);if(!ce&&!this.loadingImages.has(x)){this.loadingImages.add(x);const _e=new Image,Je=m.imageTimestamp?`?t=${m.imageTimestamp}`:"";_e.src=`/game-assets/${m.imagePath}${Je}`,_e.onload=()=>{this.overlayImageCache.set(x,_e),this.loadingImages.delete(x)},_e.onerror=()=>{console.warn(`Failed to load overlay image: ${m.imagePath}`),this.loadingImages.delete(x)}}ce&&ce.complete?(t.globalAlpha=.9,t.drawImage(ce,L,W,K,Q),t.globalAlpha=1):(t.fillStyle="rgba(0, 100, 0, 0.3)",t.fillRect(L+2,W+2,K-4,Q-4),t.fillStyle="#00FF00",t.font="bold 10px monospace",t.fillText("Loading...",fe,(W+Z)/2))}else b&&(t.fillStyle="rgba(100, 100, 100, 0.3)",t.fillRect(L+2,W+2,K-4,Q-4),t.fillStyle="#888888",t.font="bold 12px monospace",t.fillText("IMAGE HIDDEN",fe,(W+Z)/2));t.restore()}}renderDestroySelectionPreview(t,n,s){const r=V.getDestroySelectionBounds();if(!r)return;const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=r.start.x-d-n+f,y=r.end.x-d-n+f,m=G-(o-r.start.y),_=G-(o-r.end.y),S=Math.min(p,y),R=Math.max(p,y),b=Math.min(m,_),x=Math.max(m,_),N=R-S,L=x-b;t.save(),t.fillStyle="rgba(255, 102, 0, 0.2)",t.fillRect(S,b,N,L),t.strokeStyle=bh,t.lineWidth=2;const O=Date.now()/100;t.setLineDash([8,4]),t.lineDashOffset=-O%12,t.strokeRect(S,b,N,L),t.setLineDash([]),t.fillStyle="#FFFFFF",t.font="bold 12px monospace",t.textAlign="center",t.fillText(`${Math.round(N)} x ${Math.round(L)}`,(S+R)/2,b-10),t.fillStyle=bh,t.font="bold 14px monospace",t.fillText("DESTROY SELECTION",(S+R)/2,(b+x)/2),t.restore()}renderOverlayActionPanel(t,n,s,r){const o=V.getDestroyedOverlays().find(I=>I.id===n.id);if(!o)return;const d=this.getTotalMapHeight()-r,f=this.getBaseOffsetX(),p=this.getTerrainHorizontalOffset(),y=o.cropArea.x-f-s+p,m=G-(d-(o.cropArea.y+o.cropArea.height));let _=y+o.cropArea.width+10;_+on>w-30&&(_=y-on-10);const S=Math.max(50,Math.min(G-xh-50,m-20));t.save(),t.fillStyle="rgba(0, 0, 0, 0.9)",t.strokeStyle=Fi,t.lineWidth=2,t.beginPath(),t.roundRect(_,S,on,xh,6),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.font="bold 11px monospace",t.textAlign="center",t.fillText("OVERLAY ACTIONS",_+on/2,S+16);const R=S+26,b=V.isGeneratingOverlay(),x=V.getState().isSelectingLinkTarget,N=o.linkedTargetId?`Unlink: ${o.linkedTargetId.slice(0,10)}...`:x?"Click Target...":"Link to Target",L=o.linkedTargetId?"#FF8844":x?"#FFFF00":"#44FFFF",O=[{id:"generate",label:b?"Generating...":o.imageGenerated?"Regenerate":"Generate",color:b?"#888888":"#44FF44",y:R,disabled:b},{id:"toggle",label:o.showInDesignMode?"Hide Image":"Show Image",color:"#FFFF44",y:R+xi+2,disabled:!o.imageGenerated||b},{id:"link",label:N,color:L,y:R+(xi+2)*2,disabled:b},{id:"delete",label:"Delete",color:"#FF4444",y:R+(xi+2)*3,disabled:b}];for(const I of O){const Y=I.disabled??!1,W=Y?"#666666":I.color;t.fillStyle=Y?"rgba(30, 30, 30, 0.9)":"rgba(50, 50, 50, 0.9)",t.strokeStyle=W,t.lineWidth=1,t.beginPath(),t.roundRect(_+6,I.y,on-12,xi-2,3),t.fill(),t.stroke(),t.fillStyle=W,t.font="10px monospace",t.textAlign="center",t.fillText(I.label,_+on/2,I.y+14)}t.restore()}getOverlayPanelButtons(t,n,s){const r=V.getDestroyedOverlays().find(x=>x.id===t.id);if(!r)return[];const o=this.getTotalMapHeight()-s,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=r.cropArea.x-d-n+f,y=G-(o-(r.cropArea.y+r.cropArea.height));let m=p+r.cropArea.width+10;m+on>w-30&&(m=p-on-10);const S=Math.max(50,Math.min(G-xh-50,y-20))+26,R=m+6,b=on-12;return[{id:"generate",x:R,y:S,width:b,height:xi-2,disabled:!1},{id:"toggle",x:R,y:S+xi+2,width:b,height:xi-2,disabled:!r.imageGenerated},{id:"link",x:R,y:S+(xi+2)*2,width:b,height:xi-2,disabled:!1},{id:"delete",x:R,y:S+(xi+2)*3,width:b,height:xi-2,disabled:!1}]}renderTargetSelectionMode(t,n,s){t.save(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,w,G);const r=50;t.fillStyle="rgba(0, 100, 200, 0.9)",t.fillRect(0,0,w,r),t.strokeStyle="#00FFFF",t.lineWidth=2,t.strokeRect(0,0,w,r),t.fillStyle="#FFFFFF",t.font="bold 16px monospace",t.textAlign="center",t.fillText("TARGET SELECTION MODE",w/2,20),t.font="12px monospace",t.fillStyle="#CCFFFF",t.fillText("Click a game-target marker to link | Click elsewhere to cancel",w/2,38);const o=V.getState(),d=o.pendingChanges.deletedEntities,f=o.currentCampaign,p=o.currentLevel,y=$t.getAllTargetsForDesignMode(s).filter(b=>b.targetType==="game-target").filter(b=>!d.includes(b.id)&&!(f&&Li(f,p,b.id))),m=this.getTotalMapHeight()-s,_=this.getBaseOffsetX(),S=this.getTerrainHorizontalOffset(),R=Math.sin(Date.now()/200)*.3+.7;for(const b of y){const x=b.x-_-n+S,N=G-(m-b.y);if(x<-50||x>w+50||N<r||N>G+50)continue;t.globalAlpha=R,t.strokeStyle="#00FFFF",t.lineWidth=4,t.beginPath(),t.arc(x,N,45,0,Math.PI*2),t.stroke(),t.globalAlpha=R*.4,t.fillStyle="rgba(0, 255, 255, 0.3)",t.beginPath(),t.arc(x,N,40,0,Math.PI*2),t.fill(),t.globalAlpha=1;const L="#FF4444",O=ba;t.strokeStyle=L,t.lineWidth=2,t.setLineDash([4,4]),t.strokeRect(x-O,N-O,O*2,O*2),t.setLineDash([]);const I=O*.6;t.strokeRect(x-I,N-I,I*2,I*2),t.beginPath(),t.moveTo(x-12,N),t.lineTo(x+12,N),t.moveTo(x,N-12),t.lineTo(x,N+12),t.stroke(),t.lineWidth=3;const Y=8;t.beginPath(),t.moveTo(x-O,N-O+Y),t.lineTo(x-O,N-O),t.lineTo(x-O+Y,N-O),t.stroke(),t.beginPath(),t.moveTo(x+O-Y,N-O),t.lineTo(x+O,N-O),t.lineTo(x+O,N-O+Y),t.stroke(),t.beginPath(),t.moveTo(x-O,N+O-Y),t.lineTo(x-O,N+O),t.lineTo(x-O+Y,N+O),t.stroke(),t.beginPath(),t.moveTo(x+O-Y,N+O),t.lineTo(x+O,N+O),t.lineTo(x+O,N+O-Y),t.stroke(),t.fillStyle="#FFFFFF",t.font="bold 10px monospace",t.textAlign="center",t.fillText(b.id.slice(-12),x,N+O+14)}t.restore()}}const Vh=new lE,Lh=40,ip=25,rE=12,np=1.5,Fp=20,sp=200,Ho=140,lp=100,Go=24,rp=w-Fp-10,Nh=50;function oE(){return{enabled:!1,previousGameState:te.PLAYING,selectedElement:null,pendingChanges:fr(),isDirty:!1,designScrollX:0,designScrollY:0,isPanning:!1,isDragging:!1,placementMode:"none",placementPreview:null,pathDrawingPoints:[],isDrawingPath:!1,destroySelectionStart:null,destroySelectionEnd:null,isSelectingDestroyArea:!1,currentCampaign:"DAWN_PATROL",currentLevel:1,isSelectingLinkTarget:!1,linkingOverlayId:null}}function fr(){return{terrainAdjustments:{mapWidthExtended:bt.MAP_WIDTH_EXTENDED,terrainHorizontalOffset:0},entityOverrides:{},pathOverrides:{},deletedEntities:[],terrainBoundaries:{leftX:50,rightX:w-50},addedEntities:[],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[]}}class cE{constructor(){this.state=oE(),this.campaign="DAWN_PATROL",this.level=1,this.entityPaths=[],this.panStartX=0,this.panStartY=0,this.scrollXAtPanStart=0,this.scrollYAtPanStart=0,this.dragStartX=0,this.dragStartY=0,this.dragOffsetX=0,this.dragOffsetY=0,this.pathDragStartX=0,this.pathOriginalOffset=0,this.isDraggingScrollBar=!1,this.scrollBarDragStartY=0,this.scrollYAtScrollBarDragStart=0,this.addedEntitiesCache=new Map,this.addedPathsCache=new Map,this.terrainCaptureCallback=null,this.isGenerating=!1}isAvailable(){return Si}isEnabled(){return this.state.enabled}getState(){return this.state}getDesignScrollY(){return this.state.designScrollY}getDesignScrollX(){return this.state.designScrollX}getTerrainHorizontalOffset(){return this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset??0}adjustTerrainHorizontalOffset(t){const n=this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset??0;this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset=n+t,this.state.isDirty=!0,console.log(`[DESIGN MODE] Terrain horizontal offset: ${this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset}`)}setLevelContext(t,n){this.campaign=t,this.level=n,this.state.currentCampaign=t,this.state.currentLevel=n;const s=Vn(t,n);s&&(this.state.pendingChanges.terrainBoundaries={...s})}setEntityPaths(t){this.entityPaths=t}getEntityPaths(){return this.entityPaths}getPathOffset(t){var n;return((n=this.state.pendingChanges.pathOverrides[t])==null?void 0:n.horizontalOffset)??0}setPlacementMode(t){this.state.placementMode=t,this.state.placementPreview=null,this.state.selectedElement=null,t==="path"&&(this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1),this.cancelDestroySelection(),console.log(`[DESIGN MODE] Placement mode: ${t}`)}getPlacementMode(){return this.state.placementMode}updatePlacementPreview(t,n){if(this.state.placementMode==="none"){this.state.placementPreview=null;return}const s=this.screenToWorld(t,n);this.state.placementPreview=s}screenToWorld(t,n){const s=this.getBaseOffsetX(),r=t+s+this.state.designScrollX-this.getTerrainHorizontalOffset(),f=this.getTotalMapHeight()-this.state.designScrollY-(G-n);return{x:r,y:f}}placeEntity(){if(this.state.placementMode==="none"||this.state.placementMode==="path"||this.state.placementMode==="destroy-select"||!this.state.placementPreview)return null;const{x:t,y:n}=this.state.placementPreview,s=this.state.placementMode,r=Date.now(),o=Math.random().toString(36).substring(2,6),d=`added_${s.replace("-","_")}_${this.campaign}_${this.level}_${r}_${o}`,f={id:d,entityType:s,x:t,y:n,...s==="turret"?{hp:30,fireRate:1.5}:{points:5e3,label:"New Target"}};return this.state.pendingChanges.addedEntities.push(f),this.addedEntitiesCache.set(d,f),this.state.isDirty=!0,this.state.placementMode="none",this.state.placementPreview=null,this.state.selectedElement={id:d,type:s==="turret"?"turret":"target",originalPosition:{x:t,y:n},currentPosition:{x:t,y:n}},console.log(`[DESIGN MODE] Placed new ${s} at (${t.toFixed(1)}, ${n.toFixed(1)})`),f}getAddedEntities(){return this.state.pendingChanges.addedEntities}getAddedEntity(t){return this.addedEntitiesCache.get(t)}isAddedEntity(t){return t.startsWith("added_")}startPathDrawing(t,n){if(this.state.placementMode!=="path")return;const s=this.screenToWorld(t,n);this.state.pathDrawingPoints=[s],this.state.isDrawingPath=!0,console.log(`[DESIGN MODE] Started path drawing at (${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}addPathWaypoint(t,n){if(!this.state.isDrawingPath)return;const s=this.screenToWorld(t,n);this.state.pathDrawingPoints.push(s),console.log(`[DESIGN MODE] Added waypoint (${s.x.toFixed(1)}, ${s.y.toFixed(1)}), total: ${this.state.pathDrawingPoints.length}`)}finishPathDrawing(){if(!this.state.isDrawingPath||this.state.pathDrawingPoints.length<2)return this.cancelPathDrawing(),null;const t=Date.now(),n=Math.random().toString(36).substring(2,6),s=`added_path_${this.campaign}_${this.level}_${t}_${n}`,r=`path_${t}_${n}`,o={id:s,pathId:r,entityType:"tank",waypoints:[...this.state.pathDrawingPoints],speed:.0035,direction:"down",spawnPoint:"top",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1};return this.state.pendingChanges.addedPaths.push(o),this.addedPathsCache.set(s,o),this.state.isDirty=!0,this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1,this.state.placementMode="none",this.state.selectedElement={id:s,type:"path",originalPosition:{x:0,y:0},currentPosition:{x:0,y:0}},console.log(`[DESIGN MODE] Finished path with ${o.waypoints.length} waypoints`),o}cancelPathDrawing(){this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1,this.state.placementMode="none",console.log("[DESIGN MODE] Path drawing cancelled")}getPathDrawingPoints(){return this.state.pathDrawingPoints}isDrawingPath(){return this.state.isDrawingPath}getAddedPaths(){return this.state.pendingChanges.addedPaths}getAddedPath(t){return this.addedPathsCache.get(t)}updateEntityMetadata(t,n){const s=this.addedEntitiesCache.get(t);if(s){Object.assign(s,n);const r=this.state.pendingChanges.addedEntities.findIndex(o=>o.id===t);r>=0&&Object.assign(this.state.pendingChanges.addedEntities[r],n)}else this.state.pendingChanges.entityMetadataOverrides[t]||(this.state.pendingChanges.entityMetadataOverrides[t]={}),Object.assign(this.state.pendingChanges.entityMetadataOverrides[t],n);this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated metadata for ${t}:`,n)}getEntityMetadata(t){const n=this.addedEntitiesCache.get(t);if(n)return{hp:n.hp,fireRate:n.fireRate,points:n.points,label:n.label};const s=this.state.pendingChanges.entityMetadataOverrides[t];return s?{...s}:{}}updatePathMetadata(t,n){const s=this.addedPathsCache.get(t);if(s){n.speed!==void 0&&(s.speed=n.speed),n.direction!==void 0&&(s.direction=n.direction),n.entityType!==void 0&&(s.entityType=n.entityType),n.spawnPoint!==void 0&&(s.spawnPoint=n.spawnPoint);const r=this.state.pendingChanges.addedPaths.findIndex(o=>o.id===t);if(r>=0){const o=this.state.pendingChanges.addedPaths[r];n.speed!==void 0&&(o.speed=n.speed),n.direction!==void 0&&(o.direction=n.direction),n.entityType!==void 0&&(o.entityType=n.entityType),n.spawnPoint!==void 0&&(o.spawnPoint=n.spawnPoint)}}else this.state.pendingChanges.pathMetadataOverrides[t]||(this.state.pendingChanges.pathMetadataOverrides[t]={}),Object.assign(this.state.pendingChanges.pathMetadataOverrides[t],n);this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated path metadata for ${t}:`,n)}getPathMetadata(t){const n=this.addedPathsCache.get(t);if(n)return{speed:n.speed,direction:n.direction,entityType:n.entityType,spawnPoint:n.spawnPoint};const s=this.state.pendingChanges.pathMetadataOverrides[t];return s?{...s}:{}}deleteAddedEntity(t){var s;const n=this.state.pendingChanges.addedEntities.findIndex(r=>r.id===t);return n>=0?(this.state.pendingChanges.addedEntities.splice(n,1),this.addedEntitiesCache.delete(t),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted added entity: ${t}`),!0):!1}deleteAddedPath(t){var s;const n=this.state.pendingChanges.addedPaths.findIndex(r=>r.id===t);return n>=0?(this.state.pendingChanges.addedPaths.splice(n,1),this.addedPathsCache.delete(t),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted added path: ${t}`),!0):!1}deleteSelectedVertex(){const t=this.state.selectedElement;if(!t||t.type!=="path"&&t.type!=="added-path"||t.selectedVertexIndex===void 0)return!1;const n=this.addedPathsCache.get(t.id);if(!n)return!1;const s=t.selectedVertexIndex;if(n.waypoints.length<=2)return console.log(`[DESIGN MODE] Deleting entire path (only ${n.waypoints.length} vertices)`),this.deleteAddedPath(t.id);n.waypoints.splice(s,1);const r=this.state.pendingChanges.addedPaths.findIndex(f=>f.id===t.id);r>=0&&this.state.pendingChanges.addedPaths[r].waypoints.splice(s,1),console.log(`[DESIGN MODE] Deleted vertex ${s} from path ${t.id}`);const o=s>=n.waypoints.length?n.waypoints.length-1:s,d=n.waypoints[o];return this.state.selectedElement={id:t.id,type:t.type,originalPosition:{x:d.x,y:d.y},currentPosition:{x:d.x,y:d.y},selectedVertexIndex:o,originalWaypoints:n.waypoints.map(f=>({x:f.x,y:f.y}))},this.state.isDirty=!0,!0}updateAddedPathAttribute(t,n){const s=this.addedPathsCache.get(t);if(!s)return!1;n.entityType!==void 0&&(s.entityType=n.entityType),n.direction!==void 0&&(s.direction=n.direction),n.spawnPoint!==void 0&&(s.spawnPoint=n.spawnPoint),n.pathId!==void 0&&(s.pathId=n.pathId),n.speed!==void 0&&(s.speed=n.speed);const r=this.state.pendingChanges.addedPaths.findIndex(o=>o.id===t);if(r>=0){const o=this.state.pendingChanges.addedPaths[r];n.entityType!==void 0&&(o.entityType=n.entityType),n.direction!==void 0&&(o.direction=n.direction),n.spawnPoint!==void 0&&(o.spawnPoint=n.spawnPoint),n.pathId!==void 0&&(o.pathId=n.pathId),n.speed!==void 0&&(o.speed=n.speed)}return this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated path ${t} attributes:`,n),!0}enterDesignMode(t,n){return Si?t!==te.PLAYING&&t!==te.BOSS_INTRO&&t!==te.BOSS_BATTLE?(console.warn("[DESIGN MODE] Can only enter from gameplay states"),!1):(this.state.enabled=!0,this.state.previousGameState=t,this.state.designScrollY=n,this.state.selectedElement=null,this.state.isPanning=!1,this.state.isDragging=!1,this.loadCompiledOverrides(),console.log(`[DESIGN MODE] Entered for ${this.campaign} level ${this.level}`),!0):(console.warn("[DESIGN MODE] Not available - VITE_DESIGN_TIME not set"),!1)}exitDesignMode(){if(!this.state.enabled)return te.PLAYING;const t=this.state.previousGameState;return this.state.enabled=!1,this.state.selectedElement=null,this.state.isPanning=!1,this.state.isDragging=!1,console.log("[DESIGN MODE] Exited"),t}toggleDesignMode(t,n){return this.state.enabled?this.exitDesignMode():this.enterDesignMode(t,n)?te.DESIGN_MODE:t}onMouseDown(t,n,s=!1){var f,p;if(!this.state.enabled)return!1;if(s)return this.state.selectedElement=null,this.startPan(t,n),!0;if(this.state.isSelectingLinkTarget){const y=this.screenToWorldY(n),m=this.findElementAt(t,y);return m&&m.type==="target"?(this.completeTargetSelection(m.id),!0):(this.cancelTargetSelection(),!0)}if(this.isClickOnScrollIndicator(t,n))return this.startScrollBarDrag(n),!0;const r=this.handlePaletteClick(t,n);if(r!==null)return r===this.state.placementMode?this.setPlacementMode("none"):this.setPlacementMode(r),!0;if(((f=this.state.selectedElement)==null?void 0:f.type)==="destroyed-overlay"&&this.handleOverlayPanelClick(t,n)||((p=this.state.selectedElement)==null?void 0:p.type)==="added-path"&&Vh.handlePathEditorClick(t,n))return!0;if(this.state.placementMode==="turret"||this.state.placementMode==="game-target"){this.updatePlacementPreview(t,n);const y=this.placeEntity();if(y)return console.log(`[DESIGN MODE] Placed ${y.entityType} at (${y.x.toFixed(1)}, ${y.y.toFixed(1)})`),!0}if(this.state.placementMode==="path")return this.state.isDrawingPath?this.addPathWaypoint(t,n):this.startPathDrawing(t,n),!0;if(this.state.placementMode==="destroy-select")return this.startDestroySelection(t,n),console.log("[DESIGN MODE] Started destroy selection"),!0;const o=this.screenToWorldY(n),d=this.findElementAt(t,o);return d?(this.selectElement(d),this.startDrag(t,n,d),!0):(this.state.selectedElement=null,this.startPan(t,n),!0)}getPalettePosition(){return{x:w-90-30,y:280,width:90,height:192}}isPointInPalette(t,n){const s=this.getPalettePosition();return t>=s.x&&t<=s.x+s.width&&n>=s.y&&n<=s.y+s.height}handlePaletteClick(t,n){if(!this.isPointInPalette(t,n))return null;const s=this.getPalettePosition(),r=[{mode:"turret",y:s.y+28},{mode:"game-target",y:s.y+60},{mode:"path",y:s.y+92},{mode:"destroy-select",y:s.y+124}];for(const o of r)if(n>=o.y&&n<=o.y+26)return o.mode;return null}handleOverlayPanelClick(t,n){if(!this.state.selectedElement||this.state.selectedElement.type!=="destroyed-overlay")return!1;const s=this.state.pendingChanges.destroyedOverlays.find(x=>x.id===this.state.selectedElement.id);if(!s)return!1;const r=this.getTotalMapHeight()-this.state.designScrollY,o=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),f=s.cropArea.x-o-this.state.designScrollX+d,p=G-(r-(s.cropArea.y+s.cropArea.height));let y=f+s.cropArea.width+10;y+Ho>w-30&&(y=f-Ho-10);const m=Math.max(50,Math.min(G-lp-50,p-20));if(t<y||t>y+Ho||n<m||n>m+lp)return!1;const _=m+26,S=y+6,R=Ho-12,b=[{id:"generate",y:_,disabled:this.isGenerating},{id:"toggle",y:_+Go+2,disabled:!s.imageGenerated||this.isGenerating},{id:"link",y:_+(Go+2)*2,disabled:this.isGenerating},{id:"delete",y:_+(Go+2)*3,disabled:this.isGenerating}];for(const x of b)if(!x.disabled&&t>=S&&t<=S+R&&n>=x.y&&n<=x.y+Go-2)return x.id==="generate"?this.triggerOverlayGeneration(s.id):x.id==="toggle"?this.toggleOverlayVisibility(s.id):x.id==="link"?s.linkedTargetId?this.unlinkOverlayFromTarget(s.id):(this.state.isSelectingLinkTarget=!0,this.state.linkingOverlayId=s.id,console.log("[DesignMode] Entering target selection mode for overlay:",s.id)):x.id==="delete"&&this.deleteSelected(),!0;return!1}setTerrainCaptureCallback(t){this.terrainCaptureCallback=t}isGeneratingOverlay(){return this.isGenerating}async triggerOverlayGeneration(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);if(!n){console.error("[DESIGN MODE] Overlay not found:",t);return}if(this.isGenerating){console.log("[DESIGN MODE] Generation already in progress");return}if(!this.terrainCaptureCallback){console.error("[DESIGN MODE] Terrain capture callback not set");return}console.log(`[DESIGN MODE] Triggering generation for overlay: ${t}`),console.log(`[DESIGN MODE] Crop area: ${JSON.stringify(n.cropArea)}`),this.isGenerating=!0;try{const s=await this.terrainCaptureCallback(n.cropArea);if(!s){console.error("[DESIGN MODE] Failed to capture terrain area"),this.isGenerating=!1;return}console.log("[DESIGN MODE] Captured terrain area, sending to API...");const{generateDestroyedOverlay:r}=await zt(async()=>{const{generateDestroyedOverlay:d}=await Promise.resolve().then(()=>G_);return{generateDestroyedOverlay:d}},void 0),o=await r(t,s,n.cropArea.width,n.cropArea.height,n.imageGenerated);o.success?(Vh.clearOverlayImageCache(t),n.imageGenerated=!0,n.imagePath=o.imagePath||`destroyed-overlays/${t}.png`,n.imageTimestamp=Date.now(),n.showInDesignMode=!0,this.state.isDirty=!0,console.log(`[DESIGN MODE] Overlay generated successfully: ${n.imagePath}`)):console.error("[DESIGN MODE] Generation failed:",o.error)}catch(s){console.error("[DESIGN MODE] Generation error:",s)}finally{this.isGenerating=!1}}isClickOnScrollIndicator(t,n){return t>=rp&&t<=rp+Fp&&n>=Nh&&n<=Nh+sp}startScrollBarDrag(t){this.isDraggingScrollBar=!0,this.scrollBarDragStartY=t,this.scrollYAtScrollBarDragStart=this.state.designScrollY}onMouseMove(t,n){return this.state.enabled?this.isDraggingScrollBar?(this.updateScrollBarDrag(n),!0):this.state.isPanning?(this.updatePan(t,n),!0):this.state.isDragging&&this.state.selectedElement?(this.updateDrag(t,n),!0):this.state.isSelectingDestroyArea?(this.updateDestroySelection(t,n),!0):this.state.placementMode!=="none"?(this.updatePlacementPreview(t,n),!0):!1:!1}updateScrollBarDrag(t){const s=this.getTotalMapHeight()-G,r=(t-Nh)/sp,o=Math.max(0,Math.min(1,r));this.state.designScrollY=s*(1-o)}onMouseUp(){if(this.state.isSelectingDestroyArea){const t=this.completeDestroySelection();t&&console.log(`[DESIGN MODE] Created destroy overlay: ${t.id}`)}this.state.isPanning=!1,this.state.isDragging=!1,this.isDraggingScrollBar=!1}onWheel(t){if(!this.state.enabled)return;const n=t*.5;this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-G,this.state.designScrollY+n))}nudgeSelected(t,n){if(!this.state.selectedElement)return;const s=this.state.selectedElement,r=Math.max(0,Math.min(bt.MAP_WIDTH_EXTENDED,s.currentPosition.x+t)),o=this.getTotalMapHeight(),d=Math.max(0,Math.min(o,s.currentPosition.y+n));s.currentPosition={x:r,y:d},this.state.pendingChanges.entityOverrides[s.id]={x:r,y:d},this.state.isDirty=!0}updatePathOffset(t,n){this.state.pendingChanges.pathOverrides[t]={horizontalOffset:n},this.state.isDirty=!0}deleteSelected(){if(!this.state.selectedElement)return;const t=this.state.selectedElement.id;if(this.state.selectedElement.type==="destroyed-overlay"){this.deleteDestroyedOverlay(t),this.state.selectedElement=null,this.state.isDirty=!0;return}this.deleteAddedEntity(t)||this.deleteAddedPath(t)||(this.state.pendingChanges.deletedEntities.includes(t)||this.state.pendingChanges.deletedEntities.push(t),this.state.selectedElement=null,this.state.isDirty=!0)}jumpToY(t){this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-G,t))}jumpToTop(){this.state.designScrollY=this.getTotalMapHeight()-G}jumpToBottom(){this.state.designScrollY=0}pageScroll(t){const n=G*.8;this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-G,this.state.designScrollY+n*t))}getPendingChanges(){return this.state.pendingChanges}getTerrainBoundaries(){return this.state.pendingChanges.terrainBoundaries}adjustBoundaryWidth(t){const n=this.state.pendingChanges.terrainBoundaries,s=100,r=0,d=this.getTerrainWidthForPanning();let f=n.leftX-t,p=n.rightX+t;p-f<s||(f=Math.max(r,Math.min(f,d-s)),p=Math.max(r+s,Math.min(p,d)),this.state.pendingChanges.terrainBoundaries.leftX=f,this.state.pendingChanges.terrainBoundaries.rightX=p,this.state.isDirty=!0,console.log(`[DESIGN MODE] Boundary width adjusted: leftX=${f.toFixed(0)}, rightX=${p.toFixed(0)}`))}adjustSingleBoundary(t,n){const s=this.state.pendingChanges.terrainBoundaries,r=100,o=0,f=this.getTerrainWidthForPanning();if(t==="left"){let p=s.leftX+n;p=Math.max(o,Math.min(p,s.rightX-r)),this.state.pendingChanges.terrainBoundaries.leftX=p,console.log(`[DESIGN MODE] Left boundary adjusted: leftX=${p.toFixed(0)}`)}else{let p=s.rightX+n;p=Math.max(s.leftX+r,Math.min(p,f)),this.state.pendingChanges.terrainBoundaries.rightX=p,console.log(`[DESIGN MODE] Right boundary adjusted: rightX=${p.toFixed(0)}`)}this.state.isDirty=!0}hasUnsavedChanges(){return this.state.isDirty}markSaved(){this.state.isDirty=!1}loadOverrides(t){const n=fr();this.state.pendingChanges={terrainAdjustments:t.terrainAdjustments??n.terrainAdjustments,entityOverrides:t.entityOverrides??n.entityOverrides,pathOverrides:t.pathOverrides??n.pathOverrides,deletedEntities:t.deletedEntities??n.deletedEntities,terrainBoundaries:t.terrainBoundaries??n.terrainBoundaries,addedEntities:t.addedEntities??n.addedEntities,addedPaths:t.addedPaths??n.addedPaths,entityMetadataOverrides:t.entityMetadataOverrides??n.entityMetadataOverrides,pathMetadataOverrides:t.pathMetadataOverrides??n.pathMetadataOverrides,destroyedOverlays:t.destroyedOverlays??n.destroyedOverlays},this.addedEntitiesCache.clear();for(const s of this.state.pendingChanges.addedEntities)this.addedEntitiesCache.set(s.id,s);this.addedPathsCache.clear();for(const s of this.state.pendingChanges.addedPaths)this.addedPathsCache.set(s.id,s);console.log("[DESIGN MODE] Loaded overrides:",`${this.state.pendingChanges.addedEntities.length} added entities,`,`${this.state.pendingChanges.addedPaths.length} added paths,`,`${this.state.pendingChanges.destroyedOverlays.length} destroyed overlays`),this.state.isDirty=!1}resetToDefaults(){this.state.pendingChanges=fr(),this.state.selectedElement=null,this.state.isDirty=!0}loadCompiledOverrides(){const t=Ui(this.campaign,this.level),n=fr();if(t){const s=(t.destroyedOverlays??[]).map(r=>({id:r.id,cropArea:r.cropArea,linkedTargetId:r.linkedTargetId,imageGenerated:!0,imagePath:r.imagePath,showInDesignMode:!1}));this.state.pendingChanges={terrainAdjustments:{mapWidthExtended:n.terrainAdjustments.mapWidthExtended,terrainHorizontalOffset:t.terrainHorizontalOffset??0},entityOverrides:t.entityOverrides??{},pathOverrides:t.pathOverrides??{},deletedEntities:t.deletedEntities??[],terrainBoundaries:t.terrainBoundaries??n.terrainBoundaries,addedEntities:t.addedEntities??[],addedPaths:t.addedPaths??[],entityMetadataOverrides:t.entityMetadataOverrides??{},pathMetadataOverrides:t.pathMetadataOverrides??{},destroyedOverlays:s},this.addedEntitiesCache.clear();for(const r of this.state.pendingChanges.addedEntities)this.addedEntitiesCache.set(r.id,r);this.addedPathsCache.clear();for(const r of this.state.pendingChanges.addedPaths)this.addedPathsCache.set(r.id,r);console.log(`[DESIGN MODE] Loaded compiled overrides for ${this.campaign} level ${this.level}:`,`${Object.keys(t.entityOverrides||{}).length} entity positions,`,`${Object.keys(t.pathOverrides||{}).length} path offsets,`,`${(t.addedEntities||[]).length} added entities,`,`${(t.addedPaths||[]).length} added paths,`,`${s.length} destroyed overlays`)}else this.state.pendingChanges=n,this.addedEntitiesCache.clear(),this.addedPathsCache.clear(),console.log(`[DESIGN MODE] No compiled overrides for ${this.campaign} level ${this.level}, using defaults`);this.state.isDirty=!1}getTotalMapHeight(){const t=dt.getTotalMapHeight();return t>0?t:bt.TOTAL_MAP_HEIGHT}getBaseOffsetX(){const t=ca(this.campaign,this.level);return Math.floor((t.mapWidthExtended-w)/2)}getTerrainWidthForPanning(){const t=Ta.getDetectedTerrainWidth(this.campaign,this.level);return t!==null?t:ca(this.campaign,this.level).mapWidthExtended}getBaseOffsetXForPanning(){const t=this.getTerrainWidthForPanning();return Math.floor((t-w)/2)}screenToWorldY(t){return this.getTotalMapHeight()-this.state.designScrollY-(G-t)}screenToWorldX(t){const n=this.getBaseOffsetX();return t+n+this.state.designScrollX-this.getTerrainHorizontalOffset()}worldToScreenY(t){const n=this.getTotalMapHeight()-this.state.designScrollY;return G-(n-t)}findElementAt(t,n){const s=this.state.pendingChanges.entityOverrides,r=this.worldToScreenY(n),o=this.state.designScrollX,d=this.getBaseOffsetX(),f=this.getTerrainHorizontalOffset(),p=this.state.pendingChanges.deletedEntities,y=this.state.currentCampaign,m=this.state.currentLevel;for(const O of this.state.pendingChanges.addedEntities){if(p.includes(O.id)||y&&Li(y,m,O.id))continue;const I=O.x-d-o+f,Y=this.worldToScreenY(O.y),W=t-I,Z=r-Y;if(Math.sqrt(W*W+Z*Z)<Lh)return{id:O.id,type:O.entityType==="turret"?"turret":"target",originalPosition:{x:O.x,y:O.y},currentPosition:{x:O.x,y:O.y}}}for(const O of this.state.pendingChanges.addedPaths)if(!(O.waypoints.length<1))for(let I=0;I<O.waypoints.length;I++){const Y=O.waypoints[I],W=Y.x-d-o+f,Z=this.worldToScreenY(Y.y),K=t-W,Q=r-Z;if(Math.sqrt(K*K+Q*Q)<rE)return{id:O.id,type:"added-path",originalPosition:{x:Y.x,y:Y.y},currentPosition:{x:Y.x,y:Y.y},selectedVertexIndex:I,originalWaypoints:O.waypoints.map(pe=>({x:pe.x,y:pe.y}))}}for(const O of this.state.pendingChanges.addedPaths)if(!(O.waypoints.length<2))for(let I=0;I<O.waypoints.length-1;I++){const Y=O.waypoints[I],W=O.waypoints[I+1],Z=Y.x-d-o+f,K=this.worldToScreenY(Y.y),Q=W.x-d-o+f,me=this.worldToScreenY(W.y);if(this.pointToSegmentDistance(t,r,Z,K,Q,me)<ip){const fe=Math.min(...O.waypoints.map(se=>se.x)),re=Math.max(...O.waypoints.map(se=>se.x)),ce=Math.min(...O.waypoints.map(se=>se.y)),_e=Math.max(...O.waypoints.map(se=>se.y)),Je=(fe+re)/2,U=(ce+_e)/2;return{id:O.id,type:"added-path",originalPosition:{x:Je,y:U},currentPosition:{x:Je,y:U},isLineDrag:!0,originalWaypoints:O.waypoints.map(se=>({x:se.x,y:se.y}))}}}for(const O of this.state.pendingChanges.destroyedOverlays){const{cropArea:I,id:Y}=O,W=I.x-d-o+f,Z=W+I.width,K=this.worldToScreenY(I.y),Q=this.worldToScreenY(I.y+I.height),me=Math.min(K,Q),pe=Math.max(K,Q);if(t>=W&&t<=Z&&r>=me&&r<=pe){const fe=I.x+I.width/2,re=I.y+I.height/2;return{id:Y,type:"destroyed-overlay",originalPosition:{x:fe,y:re},currentPosition:{x:fe,y:re}}}}const _=dt.getTurrets();for(const[O,I]of _){if(p.includes(O)||y&&Li(y,m,O))continue;const Y=s[O],W=(Y==null?void 0:Y.x)??I.metadata.x,Z=(Y==null?void 0:Y.y)??I.metadata.y,K=W-d-o,Q=this.worldToScreenY(Z),me=t-K,pe=r-Q;if(Math.sqrt(me*me+pe*pe)<Lh)return{id:O,type:"turret",originalPosition:{x:I.metadata.x,y:I.metadata.y},currentPosition:{x:W,y:Z}}}const S=$t.getAllTargetsForDesignMode(this.state.designScrollY);for(const O of S){if(p.includes(O.id)||y&&Li(y,m,O.id))continue;const I=s[O.id],Y=(I==null?void 0:I.x)??O.x,W=(I==null?void 0:I.y)??O.y,Z=Y-d-o,K=this.worldToScreenY(W),Q=t-Z,me=r-K;if(Math.sqrt(Q*Q+me*me)<Lh)return{id:O.id,type:"target",originalPosition:{x:O.x,y:O.y},currentPosition:{x:Y,y:W}}}for(const O of this.entityPaths){if(O.waypoints.length<2)continue;const I=this.getPathOffset(O.id);for(let Y=0;Y<O.waypoints.length-1;Y++){const W=O.waypoints[Y],Z=O.waypoints[Y+1],K=W.x+I-d-o,Q=this.worldToScreenY(W.y),me=Z.x+I-d-o,pe=this.worldToScreenY(Z.y);if(Q<-100&&pe<-100||Q>G+100&&pe>G+100)continue;if(this.pointToSegmentDistance(t,r,K,Q,me,pe)<ip){const re=Math.min(...O.waypoints.map(ye=>ye.x)),ce=Math.max(...O.waypoints.map(ye=>ye.x)),_e=Math.min(...O.waypoints.map(ye=>ye.y)),Je=Math.max(...O.waypoints.map(ye=>ye.y)),U=(re+ce)/2,se=(_e+Je)/2;return{id:O.id,type:"path",originalPosition:{x:U,y:se},currentPosition:{x:U+I,y:se}}}}}const R=this.state.pendingChanges.terrainBoundaries,b=20,x=this.getBaseOffsetXForPanning(),N=R.leftX-x-this.state.designScrollX+f,L=R.rightX-x-this.state.designScrollX+f;return N>=-b&&N<=w+b&&Math.abs(t-N)<b?{id:"left_boundary",type:"boundary",originalPosition:{x:R.leftX,y:0},currentPosition:{x:R.leftX,y:0}}:L>=-b&&L<=w+b&&Math.abs(t-L)<b?{id:"right_boundary",type:"boundary",originalPosition:{x:R.rightX,y:0},currentPosition:{x:R.rightX,y:0}}:null}pointToSegmentDistance(t,n,s,r,o,d){const f=o-s,p=d-r,y=f*f+p*p;if(y===0)return Math.sqrt((t-s)*(t-s)+(n-r)*(n-r));let m=((t-s)*f+(n-r)*p)/y;m=Math.max(0,Math.min(1,m));const _=s+m*f,S=r+m*p;return Math.sqrt((t-_)*(t-_)+(n-S)*(n-S))}selectElement(t){this.state.selectedElement=t}startDrag(t,n,s){if(this.state.isDragging=!0,this.dragStartX=t,this.dragStartY=n,s.type==="path"||s.type==="added-path")this.addedPathsCache.get(s.id)&&(s.selectedVertexIndex!==void 0||s.isLineDrag)?(this.pathDragStartX=t,this.dragStartY=n):(this.pathDragStartX=t,this.pathOriginalOffset=this.getPathOffset(s.id));else{const r=this.getBaseOffsetX(),o=s.currentPosition.x-r-this.state.designScrollX;this.dragOffsetX=t-o,this.dragOffsetY=n-this.worldToScreenY(s.currentPosition.y)}}updateDrag(t,n){if(this.state.selectedElement)if(this.state.selectedElement.type==="path"||this.state.selectedElement.type==="added-path"){const s=this.state.selectedElement,r=this.addedPathsCache.get(s.id);if(r&&s.originalWaypoints){const o=t-this.pathDragStartX,d=n-this.dragStartY;if(this.getBaseOffsetX(),this.getTerrainHorizontalOffset(),s.selectedVertexIndex!==void 0){const f=s.selectedVertexIndex,p=s.originalWaypoints[f],y=p.x+o,m=p.y-d;r.waypoints[f]={x:y,y:m};const _=this.state.pendingChanges.addedPaths.findIndex(S=>S.id===s.id);_>=0&&(this.state.pendingChanges.addedPaths[_].waypoints[f]={x:y,y:m}),s.currentPosition={x:y,y:m},this.state.isDirty=!0}else if(s.isLineDrag){const f=s.originalWaypoints.map(R=>({x:R.x+o,y:R.y-d}));r.waypoints=f;const p=this.state.pendingChanges.addedPaths.findIndex(R=>R.id===s.id);p>=0&&(this.state.pendingChanges.addedPaths[p].waypoints=f);const y=Math.min(...f.map(R=>R.x)),m=Math.max(...f.map(R=>R.x)),_=Math.min(...f.map(R=>R.y)),S=Math.max(...f.map(R=>R.y));s.currentPosition={x:(y+m)/2,y:(_+S)/2},this.state.isDirty=!0}}else{const o=t-this.pathDragStartX,d=this.pathOriginalOffset+o;this.state.pendingChanges.pathOverrides[s.id]={horizontalOffset:d},s.currentPosition={x:s.originalPosition.x+d,y:s.originalPosition.y},this.state.isDirty=!0}}else if(this.state.selectedElement.type==="boundary"){const s=this.getBaseOffsetXForPanning(),r=this.getTerrainHorizontalOffset(),o=t+s+this.state.designScrollX-r,d=this.getTerrainWidthForPanning(),f=Math.max(0,Math.min(d,o));if(this.state.selectedElement.id==="left_boundary"){const p=this.state.pendingChanges.terrainBoundaries.rightX,y=Math.min(f,p-50);this.state.pendingChanges.terrainBoundaries.leftX=y,this.state.selectedElement.currentPosition={x:y,y:0},this.state.selectedElement.originalPosition={x:y,y:0}}else if(this.state.selectedElement.id==="right_boundary"){const p=this.state.pendingChanges.terrainBoundaries.leftX,y=Math.max(f,p+50);this.state.pendingChanges.terrainBoundaries.rightX=y,this.state.selectedElement.currentPosition={x:y,y:0},this.state.selectedElement.originalPosition={x:y,y:0}}this.state.isDirty=!0}else if(this.state.selectedElement.type==="destroyed-overlay"){const s=this.getTerrainHorizontalOffset(),r=this.getBaseOffsetX(),d=t-this.dragOffsetX+r+this.state.designScrollX-s,f=n-this.dragOffsetY,p=this.screenToWorldY(f),y=this.state.pendingChanges.destroyedOverlays.find(m=>m.id===this.state.selectedElement.id);if(y){const m=y.cropArea.x+y.cropArea.width/2,_=y.cropArea.y+y.cropArea.height/2,S=d-m,R=p-_;y.cropArea.x+=S,y.cropArea.y+=R,this.state.selectedElement.currentPosition={x:d,y:p},this.state.isDirty=!0}}else{const s=this.getBaseOffsetX(),o=t-this.dragOffsetX+s+this.state.designScrollX,d=Math.max(0,Math.min(bt.MAP_WIDTH_EXTENDED,o)),f=n-this.dragOffsetY,p=this.screenToWorldY(f);this.state.selectedElement.currentPosition={x:d,y:p},this.state.pendingChanges.entityOverrides[this.state.selectedElement.id]={x:d,y:p},this.state.isDirty=!0}}startPan(t,n){this.state.isPanning=!0,this.panStartX=t,this.panStartY=n,this.scrollXAtPanStart=this.state.designScrollX,this.scrollYAtPanStart=this.state.designScrollY}updatePan(t,n){const s=(t-this.panStartX)*np,r=(n-this.panStartY)*np,o=this.getTerrainWidthForPanning(),d=this.getBaseOffsetXForPanning(),f=this.getTerrainHorizontalOffset(),p=-d+f,y=o-d-w+f;this.state.designScrollX=Math.max(p,Math.min(y,this.scrollXAtPanStart-s)),this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-G,this.scrollYAtPanStart-r))}getTurretsForRendering(){return dt.getTurrets()}getLevelInfo(){return{campaign:this.campaign,level:this.level}}getEffectiveTerrainAdjustments(){return ca(this.campaign,this.level)}resetForLevelSwitch(){this.state.pendingChanges=fr(),this.state.selectedElement=null,this.state.isDirty=!1,this.state.designScrollX=0,this.state.designScrollY=0,this.state.isPanning=!1,this.state.isDragging=!1,this.entityPaths=[],this.cancelDestroySelection(),console.log("[DESIGN MODE] State reset for level switch")}startDestroySelection(t,n){const s=this.screenToWorld(t,n);this.state.destroySelectionStart=s,this.state.destroySelectionEnd=null,this.state.isSelectingDestroyArea=!0,console.log(`[DESIGN MODE] Started destroy selection at world (${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}updateDestroySelection(t,n){this.state.isSelectingDestroyArea&&(this.state.destroySelectionEnd=this.screenToWorld(t,n))}completeDestroySelection(){if(!this.state.destroySelectionStart||!this.state.destroySelectionEnd)return this.cancelDestroySelection(),null;const t=Math.min(this.state.destroySelectionStart.x,this.state.destroySelectionEnd.x),n=Math.min(this.state.destroySelectionStart.y,this.state.destroySelectionEnd.y),s=Math.max(this.state.destroySelectionStart.x,this.state.destroySelectionEnd.x),r=Math.max(this.state.destroySelectionStart.y,this.state.destroySelectionEnd.y),o=s-t,d=r-n;if(o<10||d<10)return console.log("[DESIGN MODE] Destroy selection too small, canceling"),this.cancelDestroySelection(),null;const f=Date.now(),p=Math.random().toString(36).substring(2,6),y=`destroyed_overlay_${this.campaign}_${this.level}_${f}_${p}`,m={id:y,cropArea:{x:t,y:n,width:o,height:d},linkedTargetId:null,imageGenerated:!1,imagePath:null,showInDesignMode:!0};return this.state.pendingChanges.destroyedOverlays.push(m),this.state.isDirty=!0,console.log(`[DESIGN MODE] Created destroy overlay: ${y} at (${t.toFixed(1)}, ${n.toFixed(1)}) size ${o.toFixed(0)}x${d.toFixed(0)}`),this.cancelDestroySelection(),m}cancelDestroySelection(){this.state.destroySelectionStart=null,this.state.destroySelectionEnd=null,this.state.isSelectingDestroyArea=!1}getDestroyedOverlays(){return this.state.pendingChanges.destroyedOverlays}getDestroyedOverlay(t){return this.state.pendingChanges.destroyedOverlays.find(n=>n.id===t)}linkOverlayToTarget(t,n){const s=this.state.pendingChanges.destroyedOverlays.find(r=>r.id===t);s&&(s.linkedTargetId=n,this.state.isDirty=!0,console.log(`[DESIGN MODE] Linked overlay ${t} to target ${n??"none"}`))}unlinkOverlayFromTarget(t){this.linkOverlayToTarget(t,null),console.log(`[DESIGN MODE] Unlinked overlay ${t} from target`)}cancelTargetSelection(){this.state.isSelectingLinkTarget=!1,this.state.linkingOverlayId=null,console.log("[DesignMode] Cancelled target selection mode")}completeTargetSelection(t){this.state.linkingOverlayId&&(this.linkOverlayToTarget(this.state.linkingOverlayId,t),console.log(`[DesignMode] Linked overlay ${this.state.linkingOverlayId} to target ${t}`)),this.state.isSelectingLinkTarget=!1,this.state.linkingOverlayId=null}toggleOverlayVisibility(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);n&&(n.showInDesignMode=!n.showInDesignMode,console.log(`[DESIGN MODE] Toggled overlay ${t} visibility: ${n.showInDesignMode}`))}markOverlayImageGenerated(t,n){const s=this.state.pendingChanges.destroyedOverlays.find(r=>r.id===t);s&&(s.imageGenerated=!0,s.imagePath=n,this.state.isDirty=!0,console.log(`[DESIGN MODE] Marked overlay ${t} as generated: ${n}`))}clearOverlayImage(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);n&&(n.imageGenerated=!1,n.imagePath=null,this.state.isDirty=!0,console.log(`[DESIGN MODE] Cleared overlay ${t} for regeneration`))}deleteDestroyedOverlay(t){var s;const n=this.state.pendingChanges.destroyedOverlays.findIndex(r=>r.id===t);n>=0&&(this.state.pendingChanges.destroyedOverlays.splice(n,1),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted overlay ${t}`))}isDestroySelecting(){return this.state.isSelectingDestroyArea}getDestroySelectionBounds(){return!this.state.destroySelectionStart||!this.state.destroySelectionEnd?null:{start:this.state.destroySelectionStart,end:this.state.destroySelectionEnd}}}const V=new cE;function Wn(c){{const n=c.includes("title-page.mp3")||c.includes("dawn-patrol/")&&(c.includes("story.mp3")||c.includes("level/track-1.mp3")||c.includes("boss/track-1.mp3"))?"/dist-assets/initial/audio":"/dist-assets/progressive/audio",s=c.replace("/assets-audio/","");return`${n}/${s}`}}Ee.DAWN_PATROL+"",Ee.STEEL_VANGUARD+"",Ee.HELLFIRE_HORIZON+"";const nc={[Ee.DAWN_PATROL]:{campaign:Ee.DAWN_PATROL,folderName:"dawn-patrol",levelCount:kn[Ee.DAWN_PATROL].levelCount,bossCount:1},[Ee.STEEL_VANGUARD]:{campaign:Ee.STEEL_VANGUARD,folderName:"steel-vanguard",levelCount:kn[Ee.STEEL_VANGUARD].levelCount,bossCount:1},[Ee.HELLFIRE_HORIZON]:{campaign:Ee.HELLFIRE_HORIZON,folderName:"hellfire-horizon",levelCount:kn[Ee.HELLFIRE_HORIZON].levelCount,bossCount:1}};function uE(c,t){const n=nc[c],s=Math.min(Math.max(1,t),n.levelCount),r=(s-1)%5+1,o=`/assets-audio/campaigns/${n.folderName}/level/track-${s}.mp3`,d=`/assets-audio/legacy/levelmusic-track${r}.mp3`;return{campaignPath:Wn(o),fallbackPath:Wn(d)}}function hE(c,t){const n=nc[c],s=Math.min(Math.max(1,t),n.bossCount),r=(s-1)%5+1,o=`/assets-audio/campaigns/${n.folderName}/boss/track-${s}.mp3`,d=`/assets-audio/legacy/bossmusic-track${r}.mp3`;return{campaignPath:Wn(o),fallbackPath:Wn(d)}}function dE(c){const n=`/assets-audio/campaigns/${nc[c].folderName}/story.mp3`;return{campaignPath:Wn(n),fallbackPath:Wn("/assets-audio/legacy/levelmusic-track1.mp3")}}function fE(c){const n=`/assets-audio/campaigns/${nc[c].folderName}/ending.mp3`;return{campaignPath:Wn(n),fallbackPath:Wn("/assets-audio/legacy/levelmusic-track5.mp3")}}async function gE(c){try{return(await fetch(c,{method:"HEAD"})).ok}catch{return!1}}const op="wwii-sky-ace-settings",Dh={controlScheme:"arrows",enemySpeed:60,enemyFireRate:60,musicVolume:50,sfxVolume:50,miniMapEnabled:!0,scanlinesIntensity:50};class pE{constructor(){this.listeners=new Set,this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(op);if(t){const n=JSON.parse(t);return{...Dh,...n}}}catch(t){console.warn("[GameSettings] Failed to load settings from localStorage:",t)}return{...Dh}}saveSettings(){try{localStorage.setItem(op,JSON.stringify(this.settings))}catch(t){console.warn("[GameSettings] Failed to save settings to localStorage:",t)}}getSettings(){return{...this.settings}}updateSettings(t){this.settings={...this.settings,...t},this.saveSettings(),this.notifyListeners()}resetToDefaults(){this.settings={...Dh},this.saveSettings(),this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getSettings();this.listeners.forEach(n=>n(t))}getControlKeys(){return this.settings.controlScheme==="wasd"?{LEFT:["a","A"],RIGHT:["d","D"],UP:["w","W"],DOWN:["s","S"]}:{LEFT:["ArrowLeft","a","A"],RIGHT:["ArrowRight","d","D"],UP:["ArrowUp","w","W"],DOWN:["ArrowDown","s","S"]}}getEnemySpeedMultiplier(){return this.settings.enemySpeed/100}getEnemyFireRateMultiplier(){return this.settings.enemyFireRate/100}getMusicVolume(){return this.settings.musicVolume/100}getSfxVolume(){return this.settings.sfxVolume/100}getScanlinesIntensity(){return this.settings.scanlinesIntensity/100}}const sa=new pE,mE=1e3,Es=1500,yE=2e3;class EE{constructor(){this.ctx=null,this.masterGain=null,this.musicGain=null,this.activeOscillators=[],this.currentMusic=null,this.currentLevel=0,this.isBossMusic=!1,this.unlockAttempted=!1,this.bombDescendingOsc=null,this.bombDescendingGain=null,this.currentCampaign=Ee.STEEL_VANGUARD,this.musicExistsCache=new Map,this.baseSfxVolume=1,this.baseMusicVolume=1,this.muted=!1}getSfxVolume(){return(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?1:this.baseSfxVolume)*sa.getSfxVolume()}getMusicVolume(){return this.baseMusicVolume*sa.getMusicVolume()}updateVolumes(){this.masterGain&&this.ctx&&this.masterGain.gain.setValueAtTime(this.getSfxVolume(),this.ctx.currentTime),this.currentMusic&&(this.currentMusic.volume=sa.getMusicVolume())}setMuted(t){this.muted=t,t&&this.stopMusic(!0)}isMutedState(){return this.muted}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=this.getSfxVolume(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.gain.value=this.getMusicVolume(),this.musicGain.connect(this.ctx.destination),console.log("[AudioService] Initialized AudioContext, state:",this.ctx.state),sa.subscribe(()=>{this.updateVolumes()}),this.unlockAttempted||this.setupGlobalUnlock()),this.ctx.state==="suspended"&&(console.log("[AudioService] Resuming suspended AudioContext..."),this.ctx.resume().then(()=>{var t;console.log("[AudioService] AudioContext resumed, state:",(t=this.ctx)==null?void 0:t.state)}).catch(t=>{console.warn("[AudioService] Failed to resume AudioContext:",t)}))}setupGlobalUnlock(){if(this.unlockAttempted)return;this.unlockAttempted=!0;const t=()=>{console.log("[AudioService] Global unlock triggered"),this.unlockAudio(),document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0)};document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),console.log("[AudioService] Global unlock listeners registered")}unlockAudio(){if(this.init(),!this.ctx)return;console.log("[AudioService] unlockAudio called, current state:",this.ctx.state);const t=this.ctx.state==="suspended"?this.ctx.resume():Promise.resolve();try{const n=this.ctx.createBuffer(1,1,22050),s=this.ctx.createBufferSource();s.buffer=n,s.connect(this.ctx.destination),s.start(0),console.log("[AudioService] Silent buffer played for iOS unlock")}catch(n){console.warn("[AudioService] Failed to play silent buffer:",n)}try{const n=this.ctx.createOscillator(),s=this.ctx.createGain();s.gain.value=.001,n.connect(s),s.connect(this.ctx.destination),n.start(0),n.stop(this.ctx.currentTime+.001),console.log("[AudioService] Silent oscillator played for iOS unlock")}catch(n){console.warn("[AudioService] Failed to play silent oscillator:",n)}t.then(()=>{var n;console.log("[AudioService] Audio unlocked, final state:",(n=this.ctx)==null?void 0:n.state)}).catch(n=>{console.warn("[AudioService] Resume failed:",n)})}fadeOut(t,n=Es){return new Promise(s=>{const r=t.volume,o=performance.now(),d=()=>{const f=performance.now()-o,p=Math.min(f/n,1);t.volume=r*(1-p),p<1?requestAnimationFrame(d):(t.pause(),t.currentTime=0,t.volume=r,s())};requestAnimationFrame(d)})}fadeIn(t,n,s=Es){t.volume=0,t.play().catch(()=>{});const r=performance.now(),o=()=>{const d=performance.now()-r,f=Math.min(d/s,1);t.volume=n*f,f<1&&requestAnimationFrame(o)};requestAnimationFrame(o)}crossfadeTo(t,n,s=Es){const r=this.currentMusic;this.currentMusic=t,this.fadeIn(t,n,s),r&&this.fadeOut(r,s)}stopMusic(t=!1,n=Es){if(this.currentMusic)if(t){const s=this.currentMusic;this.currentMusic=null,this.fadeOut(s,n)}else this.currentMusic.pause(),this.currentMusic.currentTime=0,this.currentMusic=null;this.musicGain&&(this.musicGain.gain.cancelScheduledValues(0),this.musicGain.gain.value=0,setTimeout(()=>{this.musicGain&&this.ctx&&this.musicGain.gain.setValueAtTime(.1,this.ctx.currentTime)},100))}setCampaign(t){this.currentCampaign=t,console.log("[AudioService] Campaign set to:",t)}getCampaign(){return this.currentCampaign}playLevelMusic(t,n){if(this.muted)return;this.init();const s=n||this.currentCampaign;this.currentLevel=t,this.isBossMusic=!1;const r=uE(s,t);this.playMusicWithFallback(r,!0,"level")}playBossMusic(t,n){if(this.muted)return;this.init();const s=n||this.currentCampaign;this.currentLevel=t,this.isBossMusic=!0;const r=hE(s,t);this.playMusicWithFallback(r,!0,"boss")}playStoryMusic(t){if(this.muted)return;this.init();const n=t||this.currentCampaign,s=dE(n);this.playMusicWithFallback(s,!0,"story")}playEndingMusic(t){if(this.muted)return;this.init();const n=t||this.currentCampaign,s=fE(n);this.playMusicWithFallback(s,!1,"ending")}playTitleMusic(){var r;if(this.muted||(this.init(),(r=this.currentMusic)!=null&&r.src.includes("title-page.mp3")))return;const t=sa.getMusicVolume(),n="/assets-audio/campaigns/title-page.mp3";console.log("[AudioService] Playing title page music:",n);const s=new Audio(n);s.loop=!0,this.currentMusic?this.crossfadeTo(s,t,Es):(this.currentMusic=s,this.fadeIn(s,t,Es))}isTitleMusicPlaying(){var t;return((t=this.currentMusic)==null?void 0:t.src.includes("title-page.mp3"))??!1}async playMusicWithFallback(t,n,s){let r=this.musicExistsCache.get(t.campaignPath);r===void 0&&(r=await gE(t.campaignPath),this.musicExistsCache.set(t.campaignPath,r));const o=r?t.campaignPath:t.fallbackPath;console.log(`[AudioService] Playing ${s} music: ${o}`);const d=sa.getMusicVolume();let f;switch(s){case"boss":f=mE;break;case"ending":f=yE;break;default:f=Es}const p=new Audio(o);p.loop=n,this.currentMusic?this.crossfadeTo(p,d,f):(this.currentMusic=p,this.fadeIn(p,d,f)),p.onerror=()=>{if(console.warn(`Failed to play ${s} music (${o})`),r&&o!==t.fallbackPath){console.log(`[AudioService] Trying fallback: ${t.fallbackPath}`);const y=new Audio(t.fallbackPath);y.loop=n,this.crossfadeTo(y,d,f)}}}playNote(t,n,s,r="square"){if(!this.ctx||!this.musicGain)return;const o=this.ctx.createOscillator(),d=this.ctx.createGain();o.type=r,o.frequency.setValueAtTime(t,n),d.gain.setValueAtTime(.2,n),d.gain.exponentialRampToValueAtTime(.01,n+s-.05),o.connect(d),d.connect(this.musicGain),o.start(n),o.stop(n+s)}playIntroMusic(){if(this.muted||(this.init(),this.stopMusic(),!this.ctx))return;const t=this.ctx.currentTime+.1,n=.12,s=[{f:196,d:1},{f:261.63,d:1},{f:329.63,d:1},{f:392,d:1},{f:523.25,d:4},{f:392,d:1},{f:392,d:1},{f:392,d:1},{f:329.63,d:2},{f:392,d:2},{f:523.25,d:6}];let r=0;s.forEach(o=>{this.playNote(o.f,t+r,o.d*n,"square"),r+=o.d*n})}playGameOverMusic(){if(this.muted||(this.init(),this.stopMusic(),!this.ctx))return;const t=this.ctx.currentTime+.1,n=.3,s=[{f:392,d:2},{f:369.99,d:2},{f:349.23,d:2},{f:329.63,d:4},{f:293.66,d:2},{f:196,d:8}];let r=0;s.forEach(o=>{this.playNote(o.f,t+r,o.d*n,"triangle"),r+=o.d*n})}playShoot(){if(this.muted||!this.ctx||!this.masterGain)return;if(this.ctx.state==="suspended"){this.ctx.resume();return}const t=this.ctx.createOscillator(),n=this.ctx.createGain(),s=this.ctx.createBiquadFilter();t.type="sawtooth",s.type="lowpass",s.frequency.setValueAtTime(1200,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+.05),t.frequency.setValueAtTime(280,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(80,this.ctx.currentTime+.05);const r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),o=r?.218:.168,d=r?.018:.014;n.gain.setValueAtTime(o,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(d,this.ctx.currentTime+.05),t.connect(s),s.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.05)}playEnemyExplosion(){this.muted||!this.ctx||!this.masterGain||this.createNoise(.2,.28)}playSmallExplosion(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.12,n=Math.floor(this.ctx.sampleRate*t),s=this.ctx.createBuffer(1,n,this.ctx.sampleRate),r=s.getChannelData(0);for(let p=0;p<n;p++){const y=1-p/n;r[p]=(Math.random()*2-1)*y*y}const o=this.ctx.createBufferSource();o.buffer=s;const d=this.ctx.createGain();d.gain.setValueAtTime(.15,this.ctx.currentTime),d.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t);const f=this.ctx.createBiquadFilter();f.type="lowpass",f.frequency.value=800,o.connect(f),f.connect(d),d.connect(this.masterGain),o.start(),o.stop(this.ctx.currentTime+t)}playDescending(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.5,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(180,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(80,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(400,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(150,this.ctx.currentTime+t),s.gain.setValueAtTime(.06,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.1,this.ctx.currentTime+.05),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain);const o=this.ctx.createBuffer(1,this.ctx.sampleRate*t,this.ctx.sampleRate),d=o.getChannelData(0);for(let m=0;m<d.length;m++)d[m]=(Math.random()*2-1)*.5;const f=this.ctx.createBufferSource(),p=this.ctx.createGain(),y=this.ctx.createBiquadFilter();f.buffer=o,y.type="lowpass",y.frequency.setValueAtTime(300,this.ctx.currentTime),y.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+t),p.gain.setValueAtTime(.04,this.ctx.currentTime),p.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),f.connect(y),y.connect(p),p.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t),f.start(),f.stop(this.ctx.currentTime+t)}playPlayerExplosion(){this.muted||!this.ctx||!this.masterGain||this.createNoise(.8,1.12)}playBomb(){if(this.muted||!this.ctx||!this.masterGain)return;const t=1.5,n=this.ctx.sampleRate*t,s=this.ctx.createBuffer(1,n,this.ctx.sampleRate),r=s.getChannelData(0);for(let p=0;p<n;p++)r[p]=Math.random()*2-1;const o=this.ctx.createBufferSource();o.buffer=s;const d=this.ctx.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(400,this.ctx.currentTime),d.frequency.linearRampToValueAtTime(50,this.ctx.currentTime+t);const f=this.ctx.createGain();f.gain.setValueAtTime(1.12,this.ctx.currentTime),f.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+t),o.connect(d),d.connect(f),f.connect(this.masterGain),o.start()}playBombDescending(){if(this.muted||!this.ctx||!this.masterGain)return;this.stopBombDescending();const t=1.2,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sine",n.frequency.setValueAtTime(1200,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+t),r.type="bandpass",r.frequency.setValueAtTime(1e3,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+t),r.Q.value=8,s.gain.setValueAtTime(.05,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.2,this.ctx.currentTime+.1),s.gain.setValueAtTime(.2,this.ctx.currentTime+t*.8),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t),this.bombDescendingOsc=n,this.bombDescendingGain=s,n.onended=()=>{this.bombDescendingOsc=null,this.bombDescendingGain=null}}stopBombDescending(){if(this.bombDescendingOsc){try{this.bombDescendingOsc.stop()}catch{}this.bombDescendingOsc=null}if(this.bombDescendingGain&&this.ctx){try{this.bombDescendingGain.gain.cancelScheduledValues(this.ctx.currentTime),this.bombDescendingGain.gain.setValueAtTime(0,this.ctx.currentTime)}catch{}this.bombDescendingGain=null}}playCannon(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.createOscillator(),n=this.ctx.createGain(),s=this.ctx.createBiquadFilter();t.type="sawtooth",s.type="lowpass",s.frequency.setValueAtTime(500,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.3),t.frequency.setValueAtTime(80,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(20,this.ctx.currentTime+.3),n.gain.setValueAtTime(.49,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+.3),t.connect(s),s.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.3)}playPowerUp(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.createOscillator(),n=this.ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(220,this.ctx.currentTime),t.frequency.linearRampToValueAtTime(440,this.ctx.currentTime+.15),t.frequency.linearRampToValueAtTime(660,this.ctx.currentTime+.3),n.gain.setValueAtTime(.15,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.5),t.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.5)}playCoin(){if(!this.muted){if(this.init(),!this.ctx||!this.masterGain){console.warn("[AudioService] playCoin: ctx or masterGain not ready");return}if(console.log("[AudioService] playCoin: ctx state before:",this.ctx.state),this.ctx.state==="suspended"){console.log("[AudioService] playCoin: Resuming suspended context"),this.ctx.resume().then(()=>{console.log("[AudioService] playCoin: Context resumed, now playing sound"),this.playCoinSound()}).catch(t=>{console.warn("[AudioService] playCoin: Resume failed:",t)}),this.playCoinSound();return}this.playCoinSound()}}playMenuSelect(){if(this.muted||(this.init(),!this.ctx||!this.masterGain))return;this.ctx.state==="suspended"&&this.ctx.resume();const t=.15,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sine",n.frequency.setValueAtTime(300,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(1500,this.ctx.currentTime),r.Q.value=1,s.gain.setValueAtTime(.15,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}playCoinSound(){if(!this.ctx||!this.masterGain)return;console.log("[AudioService] Playing coin sound, ctx state:",this.ctx.state);const t=this.ctx.createOscillator(),n=this.ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(900,this.ctx.currentTime),t.frequency.setValueAtTime(1200,this.ctx.currentTime+.1),n.gain.setValueAtTime(.2,this.ctx.currentTime),n.gain.setValueAtTime(.2,this.ctx.currentTime+.1),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.3),t.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.4)}playEvade(){if(this.muted||!this.ctx||!this.masterGain)return;const t=2.5,n=this.ctx.createOscillator(),s=this.ctx.createOscillator(),r=this.ctx.createGain(),o=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(800,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+t*.5),n.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+t),s.type="sine",s.frequency.setValueAtTime(400,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+t*.5),s.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+t),o.type="lowpass",o.frequency.setValueAtTime(2e3,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t*.5),o.frequency.exponentialRampToValueAtTime(1500,this.ctx.currentTime+t),o.Q.value=5,r.gain.setValueAtTime(.15,this.ctx.currentTime),r.gain.setValueAtTime(.25,this.ctx.currentTime+.1),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(o),s.connect(o),o.connect(r),r.connect(this.masterGain),n.start(),s.start(),n.stop(this.ctx.currentTime+t),s.stop(this.ctx.currentTime+t)}playDive(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.75,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(600,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(150,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(2e3,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t),r.Q.value=3,s.gain.setValueAtTime(.15,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}playClimb(){if(this.muted||!this.ctx||!this.masterGain)return;const t=1,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="triangle",n.frequency.setValueAtTime(200,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(500,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(500,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(1500,this.ctx.currentTime+t),r.Q.value=2,s.gain.setValueAtTime(.1,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.2,this.ctx.currentTime+t*.5),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}createNoise(t,n=.2){if(!this.ctx||!this.masterGain)return;const s=this.ctx.sampleRate*t,r=this.ctx.createBuffer(1,s,this.ctx.sampleRate),o=r.getChannelData(0);for(let y=0;y<s;y++)o[y]=Math.random()*2-1;const d=this.ctx.createBufferSource();d.buffer=r;const f=this.ctx.createBiquadFilter();f.type="lowpass",f.frequency.value=1e3;const p=this.ctx.createGain();p.gain.setValueAtTime(n,this.ctx.currentTime),p.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+t),d.connect(f),f.connect(p),p.connect(this.masterGain),d.start()}playHeatLevelUp(t){if(this.muted||!this.ctx||!this.masterGain)return;const n=this.ctx.currentTime,s=100+t*30,r=.1+t*.03,o=this.ctx.createOscillator(),d=this.ctx.createGain(),f=this.ctx.createBiquadFilter();if(o.type="sawtooth",o.frequency.setValueAtTime(s,n),o.frequency.linearRampToValueAtTime(s*1.8,n+r),f.type="lowpass",f.frequency.setValueAtTime(800+t*200,n),d.gain.setValueAtTime(.12,n),d.gain.exponentialRampToValueAtTime(.01,n+r),o.connect(f),f.connect(d),d.connect(this.masterGain),o.start(n),o.stop(n+r),t>=2){const p=this.ctx.createOscillator(),y=this.ctx.createGain();p.type="square",p.frequency.setValueAtTime(60+t*10,n),p.frequency.exponentialRampToValueAtTime(40,n+.05),y.gain.setValueAtTime(.1,n),y.gain.exponentialRampToValueAtTime(.01,n+.06),p.connect(y),y.connect(this.masterGain),p.start(n),p.stop(n+.06)}t>=4&&setTimeout(()=>this.playJackpot(),50)}playJackpot(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="sawtooth",n.frequency.setValueAtTime(80,t),n.frequency.linearRampToValueAtTime(150,t+.15),s.gain.setValueAtTime(.15,t),s.gain.exponentialRampToValueAtTime(.01,t+.2),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.2);const r=this.ctx.createOscillator(),o=this.ctx.createGain();r.type="square",r.frequency.setValueAtTime(400,t),r.frequency.exponentialRampToValueAtTime(1200,t+.08),o.gain.setValueAtTime(.08,t),o.gain.exponentialRampToValueAtTime(.01,t+.12),r.connect(o),o.connect(this.masterGain),r.start(t),r.stop(t+.12)}playComboUp(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="square",n.frequency.setValueAtTime(200,t),n.frequency.exponentialRampToValueAtTime(80,t+.05),s.gain.setValueAtTime(.12,t),s.gain.exponentialRampToValueAtTime(.01,t+.06),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.06)}playScoreDing(t=0){if(this.muted||!this.ctx||!this.masterGain)return;const n=this.ctx.currentTime,s=1+t*.15,r=this.ctx.createOscillator(),o=this.ctx.createGain();r.type="sawtooth",r.frequency.setValueAtTime(300*s,n),r.frequency.exponentialRampToValueAtTime(150,n+.04),o.gain.setValueAtTime(.06*s,n),o.gain.exponentialRampToValueAtTime(.01,n+.05),r.connect(o),o.connect(this.masterGain),r.start(n),r.stop(n+.05)}playCoinCollect(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="triangle",n.frequency.setValueAtTime(800,t),n.frequency.exponentialRampToValueAtTime(400,t+.03),s.gain.setValueAtTime(.08,t),s.gain.exponentialRampToValueAtTime(.01,t+.04),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.04)}}const Se=new EE;function Zo(c,t,n,s,r){const o=s.horizontalFreq??.03,d=s.verticalFreq??.05,f=s.horizontalAmp??1,p=s.verticalAmp??.5;return{vx:Math.sin(n*o)*t*f,vy:Math.cos(n*d)*p}}function _E(c,t,n,s,r){const o=s.horizontalFreq??.04,d=s.verticalFreq??.02,f=s.horizontalAmp??1,p=s.verticalAmp??.8;return{vx:Math.sin(n*o)*t*f,vy:Math.sin(n*d)*p}}function AE(c,t,n,s,r){const o=s.horizontalFreq??.02,d=s.horizontalAmp??1;return{vx:Math.sin(n*o)*t*d,vy:0}}function SE(c,t,n,s,r){const o=s.changeInterval??120,d=s.horizontalAmp??2,f=c.lastDirectionChange??0;return n-f>=o||c.lastVx===void 0?{vx:(Math.random()-.5)*t*d,vy:0}:{vx:c.lastVx??0,vy:0}}function TE(c,t,n,s,r){const o=s.horizontalFreq??.06,d=s.verticalFreq??.04,f=s.horizontalAmp??1,p=s.verticalAmp??1.5,y=c.phase>=2?1.5:1,m=p*y;return{vx:Math.sin(n*o)*t*f,vy:Math.cos(n*d)*m}}function vE(c,t,n,s,r){if(!r)return Zo(c,t,n,s);const o=s.trackingStrength??.3,d=s.horizontalAmp??1,f=s.verticalAmp??.3,p=c.pos.x+c.size.width/2,y=c.pos.y+c.size.height/2,m=r.x-p,_=r.y-y,S=Math.sqrt(m*m+_*_);if(S<10)return Zo(c,t,n,{...s,verticalAmp:.2});const R=m/S,b=_/S,x=Math.sin(n*.05)*.3;return{vx:(R*o+x)*t*d,vy:Math.max(-.5,Math.min(.5,b*o*f))}}function RE(c,t,n,s,r){const o=s.orbitSpeed??.015,d=s.horizontalAmp??1.2,f=s.verticalAmp??.4,p=n*o;return{vx:Math.cos(p)*t*d,vy:Math.sin(p)*f}}const ME={sine:Zo,figure8:_E,sweep:AE,erratic:SE,aggressive:TE,chase:vE,orbit:RE};function bE(c,t,n,s,r={},o){const d=ME[c];return d?d(t,n,s,r,o):(console.warn(`Unknown movement pattern: ${c}, falling back to sine`),Zo(t,n,s,r))}function OE(c,t){return{vx:c.vx*t,vy:c.vy*t}}function cp(){return{lastFireFrame:0,burstIndex:0,spiralAngle:0,currentMixedPattern:0,lastMixedSwitch:0,pauseUntil:0}}function mr(c,t,n,s,r){const o=c+n/2,d=t+s/2;return Math.atan2(r.y-d,r.x-o)}function Qh(c,t,n,s,r,o,d){const f=[],p=o.fireRate??45;if(s-r.lastFireFrame<p)return f;r.lastFireFrame=s;const y=o.bulletCount??3,m=o.spreadAngle??.6,_=mr(c.x,c.y,t.width,t.height,n),S=c.x+t.width/2,R=c.y+t.height;for(let b=0;b<y;b++){const x=y===1?0:(b/(y-1)-.5)*m;f.push({x:S,y:R,angle:_+x,speed:d,type:A.BULLET_CANNON})}return f}function Hp(c,t,n,s,r,o,d){const f=[],p=o.fireRate??8;if(s-r.lastFireFrame<p)return f;r.lastFireFrame=s;const y=o.bulletCount??4,m=o.rotationSpeed??.08,_=mr(c.x,c.y,t.width,t.height,n);r.spiralAngle+=m;const S=c.x+t.width/2,R=c.y+t.height/2;for(let b=0;b<y;b++){const x=r.spiralAngle+b*Math.PI*2/y,N=_+Math.sin(x)*.5;f.push({x:S,y:R,angle:N,speed:d,type:A.BULLET_CANNON})}return f}function xE(c,t,n,s,r,o,d){const f=[],p=o.fireRate??30;if(s-r.lastFireFrame<p)return f;r.lastFireFrame=s;const y=o.bulletCount??1,m=mr(c.x,c.y,t.width,t.height,n),_=c.x+t.width/2,S=c.y+t.height;for(let R=0;R<y;R++){const b=(Math.random()-.5)*.1;f.push({x:_,y:S,angle:m+b,speed:d*1.2,type:A.BULLET_CANNON})}return f}function LE(c,t,n,s,r,o,d){const f=[],p=o.burstCount??4,y=o.burstDelay??6,m=o.pauseDuration??60,_=o.bulletCount??4,S=o.spreadAngle??.5;if(s<r.pauseUntil||s-r.lastFireFrame<y)return f;r.lastFireFrame=s,r.burstIndex++;const R=mr(c.x,c.y,t.width,t.height,n),b=c.x+t.width/2,x=c.y+t.height;for(let N=0;N<_;N++){const L=_===1?0:(N/(_-1)-.5)*S;f.push({x:b,y:x,angle:R+L,speed:d,type:A.BULLET_CANNON})}return r.burstIndex>=p&&(r.burstIndex=0,r.pauseUntil=s+m),f}function NE(c,t,n,s,r,o,d){const f=o.alternateInterval??180;return s-r.lastMixedSwitch>=f&&(r.currentMixedPattern=(r.currentMixedPattern+1)%2,r.lastMixedSwitch=s),r.currentMixedPattern===0?Qh(c,t,n,s,r,{...o,bulletCount:o.bulletCount??4,fireRate:o.fireRate??35},d):Hp(c,t,n,s,r,{...o,bulletCount:3,fireRate:o.fireRate??12},d)}function DE(c,t,n,s,r,o,d){const f=[],p=o.fireRate??60;if(s-r.lastFireFrame<p)return f;r.lastFireFrame=s;const y=o.bulletCount??2,m=o.spreadAngle??.4,_=o.missileSpeed??.6,S=mr(c.x,c.y,t.width,t.height,n);for(let R=0;R<y;R++){const b=R%2===0?-1:1,x=y===1?0:(R/(y-1)-.5)*m;f.push({x:c.x+t.width/2+b*(t.width/4),y:c.y+t.height*.8,angle:S+x,speed:d*_,type:A.BULLET_CANNON,size:{width:16,height:16}})}return f}function CE(c,t,n,s,r,o,d){return[]}const PE={spread:Qh,spiral:Hp,aimed:xE,barrage:LE,mixed:NE,missiles:DE,turrets:CE};function wE(c,t,n,s,r,o,d={},f=5){const p=PE[c];return p?p(t,n,s,r,o,d,f):(console.warn(`Unknown attack pattern: ${c}, falling back to spread`),Qh(t,n,s,r,o,d,f))}function IE(c){const t=c.specialMechanics,n=[];if(t!=null&&t.hasArmorPlating&&t.armorPlateCount){const s=t.armorPlateHP??30,r=t.armorPlateCount;for(let o=0;o<r;o++){const d=o/r*Math.PI*2-Math.PI/2;n.push({id:`armor_${o}`,relPos:{x:Math.cos(d)*.6,y:Math.sin(d)*.6},size:{width:30,height:20},hp:s,maxHP:s,destroyed:!1})}}return{flareActive:!1,flareCooldown:0,flareTimer:0,flareParticles:[],smokeActive:!1,smokeCooldown:0,smokeTimer:0,smokeOpacity:0,armorPlates:n,totalArmorDestroyed:0,minionCooldown:0,totalMinionsSpawned:0,enraged:!1,enrageTriggered:!1}}function up(c,t,n,s){const r=t.specialMechanics,o={damageMultiplier:1,deflectBullets:!1,minionsToSpawn:[],speedMultiplier:1,fireRateMultiplier:1};if(!r)return o;if(r.hasFlareSpray&&(BE(c,r,n),c.flareActive&&(o.deflectBullets=!0)),r.hasSmokeScreen&&(HE(c,r),c.smokeActive&&(o.damageMultiplier*=.5)),r.hasArmorPlating&&c.armorPlates.filter(f=>!f.destroyed).length>0&&(o.damageMultiplier*=.3),r.hasMinions){const d=GE(c,r,n);o.minionsToSpawn=d}return r.hasEnrage&&(YE(c,r,n),c.enraged&&(o.speedMultiplier=r.enrageSpeedBoost??1.5,o.fireRateMultiplier=r.enrageFireRateBoost??1.25)),o}function BE(c,t,n,s){const r=t.flareSprayInterval??180,o=t.flareDuration??60;c.flareCooldown>0&&c.flareCooldown--,!c.flareActive&&c.flareCooldown<=0&&(c.flareActive=!0,c.flareTimer=o,c.flareCooldown=r,c.flareParticles=FE(n,30)),c.flareActive&&(c.flareTimer--,c.flareParticles=c.flareParticles.filter(d=>(d.x+=d.vx,d.y+=d.vy,d.vy+=.05,d.life--,d.life>0)),c.flareTimer<=0&&(c.flareActive=!1,c.flareParticles=[]))}function FE(c,t){const n=[],s=c.pos.x+c.size.width/2,r=c.pos.y+c.size.height/2,o=["#FF6600","#FFAA00","#FF3300","#FFFF00","#FFFFFF"];for(let d=0;d<t;d++){const f=Math.random()*Math.PI*2,p=2+Math.random()*4;n.push({x:s,y:r,vx:Math.cos(f)*p,vy:Math.sin(f)*p-2,life:30+Math.random()*30,maxLife:60,size:3+Math.random()*4,color:o[Math.floor(Math.random()*o.length)]})}return n}function HE(c,t,n,s){const r=t.smokeScreenInterval??300,o=t.smokeScreenDuration??120;c.smokeCooldown>0&&c.smokeCooldown--,!c.smokeActive&&c.smokeCooldown<=0&&(c.smokeActive=!0,c.smokeTimer=o,c.smokeCooldown=r,c.smokeOpacity=0),c.smokeActive&&(c.smokeTimer--,c.smokeTimer>o-20?c.smokeOpacity=Math.min(.7,c.smokeOpacity+.035):c.smokeTimer<30&&(c.smokeOpacity=Math.max(0,c.smokeOpacity-.023)),c.smokeTimer<=0&&(c.smokeActive=!1,c.smokeOpacity=0))}function GE(c,t,n,s){const r=[],o=t.minionSpawnRate??300,d=t.minionCount??2;if(c.minionCooldown>0)return c.minionCooldown--,r;c.minionCooldown=o;const f={x:n.pos.x+n.size.width/2,y:n.pos.y+n.size.height/2};for(let p=0;p<d;p++){const y=p%2===0?-1:1,m=(Math.floor(p/2)+1)*30;r.push({x:f.x+y*(n.size.width/2+20),y:f.y+m,type:c.totalMinionsSpawned%3===0?"red":"small"}),c.totalMinionsSpawned++}return r}function YE(c,t,n){if(c.enrageTriggered)return;const s=t.enrageThreshold??.3;n.hp/n.maxHP<=s&&(c.enraged=!0,c.enrageTriggered=!0)}class UE{constructor(t=Ee.STEEL_VANGUARD){this.bosses=new Map,this.activeBoss=null,this.bossIntroTimer=0,this.nextBossId=0,this.campaign=Ee.STEEL_VANGUARD,this.campaign=t,this.difficultyMultipliers=gr(t,1)}setCampaign(t){this.campaign=t,this.difficultyMultipliers=gr(t,1)}setDifficulty(t){switch(t){case gt.BEGINNER:this.setCampaign(Ee.DAWN_PATROL);break;case gt.NORMAL:this.setCampaign(Ee.STEEL_VANGUARD);break;case gt.VETERAN:this.setCampaign(Ee.HELLFIRE_HORIZON);break}}createBoss(t){const n=fy(this.campaign,t);if(!n){const r=gy(this.campaign,t);return r?this.createLegacyBoss(r,t):null}this.difficultyMultipliers=gr(this.campaign,t);const s=this.createBossFromVariant(n,t);return this.bosses.set(t,s),s}createBossFromVariant(t,n){const s=`boss_${this.nextBossId++}`,r=this.difficultyMultipliers,d=fl(this.campaign).levelCount,p=1+(n-1)/d*.3;let y=1.9;this.campaign===Ee.DAWN_PATROL?y=1.95:this.campaign===Ee.HELLFIRE_HORIZON&&(y=1.97);const m=90+n*15,_=Math.floor(m*r.enemyHP*y*t.hpMultiplier*p),S={width:t.size.width,height:t.size.height},R={x:w/2-S.width/2,y:-S.height-20},b=t.phases.map(W=>({hp:Math.floor(_*W.hpThreshold),attackPattern:W.attackPattern.type,fireRate:Math.floor(60*W.fireRateMultiplier),speed:2*W.speedMultiplier})),x=Math.floor(90/r.fireRate),N=t.turretConfig.positions||[],L=5,O=N.map((W,Z)=>({id:`t${Z+1}`,relPos:W,angle:0,cooldown:x+Z*30,fireRate:x,hp:Math.floor(L*t.turretConfig.hpMultiplier*y),hitFlash:0})),I=cp(),Y=IE(t);return{id:s,type:A.BOSS,bossType:t.baseBossType,pos:R,vel:{vx:0,vy:0},size:S,hp:_,maxHP:_,active:!0,frame:0,phase:0,phases:b,destructibleParts:[],invulnerable:!1,introPlayed:!1,turrets:O,scoreValue:_*10,variantId:t.variantId,variantName:t.displayName,variantSprite:t.spriteKey,lastDirectionChange:0,lastVx:0,orbitAngle:0,attackState:I,mechanicsState:Y}}createLegacyBoss(t,n){const s=`boss_${this.nextBossId++}`,r=this.difficultyMultipliers;let o,d,f,p,y=[];const m=Math.floor(90/r.fireRate);let _=1.9;this.campaign===Ee.DAWN_PATROL?_=1.95:this.campaign===Ee.HELLFIRE_HORIZON&&(_=1.97);const S=R=>Math.floor(R*_);switch(t){case Na.ACE_SQUADRON:o={width:200,height:200},d={x:w/2-100,y:-250},f=Math.floor((90+n*15)*r.enemyHP*_),p=[{hp:f,attackPattern:"dive",fireRate:30,speed:3},{hp:f*.6,attackPattern:"spiral",fireRate:20,speed:4},{hp:f*.3,attackPattern:"berserk",fireRate:25,speed:5}];break;case Na.FLYING_FORTRESS:o={width:250,height:250},d={x:w/2-125,y:-280},f=Math.floor((100+n*18)*r.enemyHP*_),p=[{hp:f,attackPattern:"formation",fireRate:40,speed:1},{hp:f*.5,attackPattern:"split",fireRate:25,speed:2}],y=[{id:"t1",relPos:{x:60,y:60},angle:0,cooldown:m,fireRate:m,hp:S(15),hitFlash:0},{id:"t2",relPos:{x:190,y:60},angle:0,cooldown:m+30,fireRate:m,hp:S(15),hitFlash:0},{id:"t3",relPos:{x:60,y:190},angle:0,cooldown:m+60,fireRate:m,hp:S(15),hitFlash:0},{id:"t4",relPos:{x:190,y:190},angle:0,cooldown:m+90,fireRate:m,hp:S(15),hitFlash:0}];break;case Na.SUPER_BATTLESHIP:o={width:220,height:300},d={x:w/2-110,y:-320},f=Math.floor((110+n*20)*r.enemyHP*_),p=[{hp:f,attackPattern:"broadside",fireRate:50,speed:.5},{hp:f*.7,attackPattern:"barrage",fireRate:35,speed:1},{hp:f*.4,attackPattern:"desperation",fireRate:25,speed:1.5}],y=[{id:"t1",relPos:{x:55,y:80},angle:0,cooldown:m,fireRate:m,hp:S(20),hitFlash:0},{id:"t2",relPos:{x:165,y:80},angle:0,cooldown:m+30,fireRate:m,hp:S(20),hitFlash:0},{id:"t3",relPos:{x:55,y:160},angle:0,cooldown:m+60,fireRate:m,hp:S(20),hitFlash:0},{id:"t4",relPos:{x:165,y:160},angle:0,cooldown:m+90,fireRate:m,hp:S(20),hitFlash:0},{id:"t5",relPos:{x:110,y:240},angle:0,cooldown:m+120,fireRate:m,hp:S(20),hitFlash:0}];break;case Na.EXPERIMENTAL_AIRSHIP:o={width:250,height:220},d={x:w/2-125,y:-240},f=Math.floor((120+n*22)*r.enemyHP*_),p=[{hp:f,attackPattern:"laser",fireRate:45,speed:2},{hp:f*.6,attackPattern:"missiles",fireRate:30,speed:2.5},{hp:f*.3,attackPattern:"overload",fireRate:25,speed:3}],y=[{id:"t1",relPos:{x:60,y:110},angle:0,cooldown:m,fireRate:m,hp:S(18),hitFlash:0},{id:"t2",relPos:{x:125,y:55},angle:0,cooldown:m+30,fireRate:m,hp:S(18),hitFlash:0},{id:"t3",relPos:{x:190,y:110},angle:0,cooldown:m+60,fireRate:m,hp:S(18),hitFlash:0}];break;case Na.ULTIMATE_WEAPON:default:o={width:280,height:280},d={x:w/2-140,y:-300},f=Math.floor((150+n*30)*r.enemyHP*_),p=[{hp:f,attackPattern:"core_shield",fireRate:60,speed:1},{hp:f*.8,attackPattern:"core_exposed",fireRate:40,speed:1.5},{hp:f*.6,attackPattern:"desperation",fireRate:35,speed:2},{hp:f*.4,attackPattern:"berserk",fireRate:25,speed:2.5},{hp:f*.2,attackPattern:"final_phase",fireRate:30,speed:3}],y=[{id:"t1",relPos:{x:70,y:70},angle:0,cooldown:m,fireRate:m,hp:S(25),hitFlash:0},{id:"t2",relPos:{x:210,y:70},angle:0,cooldown:m+30,fireRate:m,hp:S(25),hitFlash:0},{id:"t3",relPos:{x:140,y:120},angle:0,cooldown:m+60,fireRate:m,hp:S(30),hitFlash:0},{id:"t4",relPos:{x:70,y:210},angle:0,cooldown:m+90,fireRate:m,hp:S(25),hitFlash:0},{id:"t5",relPos:{x:210,y:210},angle:0,cooldown:m+120,fireRate:m,hp:S(25),hitFlash:0}];break}return{id:s,type:A.BOSS,bossType:t,pos:d,vel:{vx:0,vy:0},size:o,hp:f,maxHP:f,active:!0,frame:0,phase:0,phases:p,destructibleParts:[],invulnerable:!1,introPlayed:!1,turrets:y,scoreValue:f*10}}updateBoss(t,n,s){const r=[];if(!t.introPlayed)t.vel.vy=2,t.pos.y>=100&&(t.vel.vy=0,t.introPlayed=!0);else{const o=this.getCurrentPhase(t);if(!o)return r;this.updatePhase(t)&&(t.phaseJustChanged=!0);const f=t.variantId?jo[t.variantId]:null;let p=null;f&&t.mechanicsState&&(p=up(t.mechanicsState,f,t)),f?r.push(...this.executeVariantAttack(t,f,o,n,s,(p==null?void 0:p.fireRateMultiplier)||1)):r.push(...this.executeLegacyAttackPattern(t,o,n,s)),f?this.updateVariantMovement(t,f,o,s,n,(p==null?void 0:p.speedMultiplier)||1):this.updateLegacyMovement(t,o,s)}return t.pos.x+=t.vel.vx,t.pos.y+=t.vel.vy,t.pos.x=Math.max(0,Math.min(w-t.size.width,t.pos.x)),t.pos.y=Math.max(-100,Math.min(300,t.pos.y)),t.turrets&&t.turrets.forEach(o=>{const d=t.pos.x+o.relPos.x,f=t.pos.y+o.relPos.y,p=n.x-d,y=n.y-f,m=Math.atan2(y,p);o.angle=m+Math.PI/2,o.cooldown--,o.cooldown<=0&&o.hp>0&&(o.cooldown=o.fireRate,r.push(this.createBossBullet(d,f,m)))}),r}executeVariantAttack(t,n,s,r,o,d){const f=[],p=this.difficultyMultipliers,y=Math.min(t.phase,n.phases.length-1),m=n.phases[y],_=m==null?void 0:m.attackPattern;if(!_||_.type==="turrets")return f;t.attackState||(t.attackState=cp());const S=Math.floor(s.fireRate/(p.fireRate*d)),R=2.5*p.bulletSpeed,b=_.params,x=wE(_.type,t.pos,t.size,r,o,t.attackState,{bulletCount:Math.max(2,Math.round((b.bulletCount||3)*p.bulletCount)),spreadAngle:b.spreadAngle||.3,fireRate:S,burstCount:b.burstCount,burstDelay:b.burstDelay,pauseDuration:b.spiralSpeed,rotationSpeed:b.spiralSpeed},R);for(const N of x)f.push({id:`boss_bullet_${Date.now()}_${Math.random()}`,type:N.type,pos:{x:N.x,y:N.y},vel:{vx:Math.cos(N.angle)*N.speed,vy:Math.sin(N.angle)*N.speed},size:N.size||{width:12,height:12},hp:1,active:!0,frame:0,scoreValue:0});return f}updateVariantMovement(t,n,s,r,o,d){const f=Math.min(t.phase,n.phases.length-1),p=n.phases[f],y=p==null?void 0:p.movementPattern;if(!y){this.updateLegacyMovement(t,s,r);return}const m={pos:t.pos,size:t.size,phase:t.phase,lastDirectionChange:t.lastDirectionChange,lastVx:t.lastVx,orbitAngle:t.orbitAngle},_=y.params||{};let S=bE(y.type,m,s.speed,r,_,o);if(d!==1&&(S=OE(S,d)),t.vel.vx=S.vx,t.vel.vy=S.vy,y.type==="erratic"){const R=_.changeInterval??120;r-(t.lastDirectionChange||0)>=R&&(t.lastDirectionChange=r,t.lastVx=S.vx)}}executeLegacyAttackPattern(t,n,s,r){const o=[],d=this.difficultyMultipliers,f=Math.floor(n.fireRate/d.fireRate),p=t.pos.x+t.size.width/2,y=t.pos.y+t.size.height/2,m=Math.atan2(s.y-y,s.x-p);switch(n.attackPattern){case"dive":case"spiral":case"berserk":r%f===0&&o.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,m));break;case"formation":case"split":break;case"broadside":if(r%Math.floor(f/2)===0){const _=Math.max(2,Math.round(3*d.bulletCount));for(let S=0;S<_;S++){const R=m+(S-(_-1)/2)*.3;o.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,R))}}break;case"barrage":case"desperation":if(r%f===0){const _=Math.max(2,Math.round(4*d.bulletCount));for(let S=0;S<_;S++){const R=m+(S-(_-1)/2)*.25;o.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,R))}}break;case"laser":case"missiles":case"overload":break;case"core_shield":case"core_exposed":case"final_phase":if(r%f===0){const _=Math.max(3,Math.round(5*d.bulletCount));for(let S=0;S<_;S++){const R=r*.05+S*Math.PI*2/_,b=m+Math.sin(R)*.5;o.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height/2,b))}}break}return o}updateLegacyMovement(t,n,s){switch(t.bossType){case Na.ACE_SQUADRON:t.vel.vx=Math.sin(s*.03)*n.speed,t.vel.vy=Math.cos(s*.05)*.5;break;case Na.FLYING_FORTRESS:t.vel.vx=Math.sin(s*.02)*n.speed,t.vel.vy=0;break;case Na.SUPER_BATTLESHIP:s%120===0&&(t.vel.vx=(Math.random()-.5)*n.speed*2),t.vel.vy=0;break;case Na.EXPERIMENTAL_AIRSHIP:t.vel.vx=Math.sin(s*.04)*n.speed,t.vel.vy=Math.sin(s*.02)*.8;break;case Na.ULTIMATE_WEAPON:t.phase>=3?(t.vel.vx=Math.sin(s*.06)*n.speed,t.vel.vy=Math.cos(s*.04)*1.5):(t.vel.vx=Math.sin(s*.03)*n.speed,t.vel.vy=0);break}}getCurrentPhase(t){for(let n=0;n<t.phases.length;n++)if(t.hp>=t.phases[n].hp||n===t.phases.length-1)return t.phases[n];return null}updatePhase(t){let n=0;for(let s=t.phases.length-1;s>=0;s--)if(t.hp<t.phases[s].hp){n=s;break}return t.phase!==n?(t.phase=n,t.invulnerable=!1,!0):!1}checkPhaseTransition(t){for(let n=0;n<t.phases.length;n++)if(t.hp<t.phases[n].hp&&t.phase!==n)return!0;return!1}createBossBullet(t,n,s){const r=2.5*this.difficultyMultipliers.bulletSpeed;return{id:`boss_bullet_${Date.now()}_${Math.random()}`,type:A.BULLET_CANNON,pos:{x:t,y:n},vel:{vx:Math.cos(s)*r,vy:Math.sin(s)*r},size:{width:12,height:12},hp:1,active:!0,frame:0,scoreValue:0}}isBossDefeated(t){return t.hp<=0}getActiveBoss(){return this.activeBoss}setActiveBoss(t){this.activeBoss=t}reset(){this.bosses.clear(),this.activeBoss=null,this.bossIntroTimer=0}getMinionSpawns(t,n){var o;if(!t.variantId||!t.mechanicsState)return[];const s=jo[t.variantId];return!s||!((o=s.specialMechanics)!=null&&o.hasMinions)?[]:up(t.mechanicsState,s,t).minionsToSpawn}getDamageMultiplier(t){return!t.variantId||!t.mechanicsState||!jo[t.variantId]?1:t.mechanicsState.smokeActive?.5:t.mechanicsState.armorPlates.filter(r=>!r.destroyed).length>0?.3:1}shouldDeflectBullets(t){return t.mechanicsState?t.mechanicsState.flareActive:!1}}class zE{constructor(){this.particles=[],this.maxParticles=500,this.particleMultiplier=1,this.particlesEnabled=!0}setPerformanceSettings(t,n,s){this.particlesEnabled=t,this.particleMultiplier=n,this.maxParticles=s}shouldEmit(){return!(!this.particlesEnabled||this.particleMultiplier<=0||this.particleMultiplier<1&&Math.random()>this.particleMultiplier)}getMultiplier(){return this.particleMultiplier}emitBulletTracer(t,n,s,r,o="#999999"){if(this.shouldEmit())for(let d=0;d<2;d++)this.particles.push({x:t+(Math.random()-.5)*3,y:n+(Math.random()-.5)*3,vx:s*.3+(Math.random()-.5)*2,vy:r*.3+(Math.random()-.5)*2,life:15,maxLife:15,size:3+Math.random()*2,color:o,type:"BULLET_TRACER",rotation:0,rotationSpeed:0,alpha:.5,gravity:0,drag:.95})}emitMuzzleFlash(t,n,s=0,r="#FF4422"){if(!this.shouldEmit())return;const d=(this.particleMultiplier>=.7?8:4)+Math.floor(Math.random()*4);for(let f=0;f<d;f++){const p=s+(Math.random()-.5)*Math.PI*.5,y=3+Math.random()*5,m=["#FF4422","#FF5533","#FF3311","#DD3311","#EE4422"],_=m[Math.floor(Math.random()*m.length)];this.particles.push({x:t,y:n,vx:Math.cos(p)*y,vy:Math.sin(p)*y,life:8,maxLife:8,size:4+Math.random()*6,color:_,type:"MUZZLE_FLASH",rotation:Math.random()*Math.PI*2,rotationSpeed:0,alpha:.7,gravity:0,drag:.9})}}emitEngineExhaust(t,n,s,r){this.shouldEmit()&&this.particles.push({x:t,y:n,vx:s*.1+(Math.random()-.5)*1,vy:r*.1+(Math.random()-.5)*1,life:40,maxLife:40,size:4+Math.random()*4,color:Math.random()>.5?"#888888":"#AAAAAA",type:"ENGINE_EXHAUST",rotation:0,rotationSpeed:0,alpha:.4,gravity:0,drag:.98})}emitWaterSplash(t,n){if(!this.shouldEmit())return;const r=(this.particleMultiplier>=.7?12:6)+Math.floor(Math.random()*8);for(let o=0;o<r;o++){const d=Math.random()*Math.PI*2,f=2+Math.random()*4;this.particles.push({x:t,y:n,vx:Math.cos(d)*f,vy:Math.sin(d)*f-2,life:20,maxLife:20,size:2+Math.random()*4,color:"#4A90E2",type:"WATER_SPLASH",rotation:0,rotationSpeed:0,alpha:.6,gravity:.3,drag:.96})}}emitShrapnel(t,n,s=15){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let o=0;o<r;o++){const d=Math.random()*Math.PI*2,f=3+Math.random()*7;this.particles.push({x:t,y:n,vx:Math.cos(d)*f,vy:Math.sin(d)*f,life:30+Math.random()*20,maxLife:50,size:3+Math.random()*5,color:Math.random()>.5?"#666666":"#888888",type:"SHRAPNEL",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,alpha:.7,gravity:.2,drag:.98})}}emitSparks(t,n,s=10){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let o=0;o<r;o++){const d=Math.random()*Math.PI*2,f=4+Math.random()*6,p=["#DD3311","#BB4422","#999999","#777777"],y=p[Math.floor(Math.random()*p.length)];this.particles.push({x:t,y:n,vx:Math.cos(d)*f,vy:Math.sin(d)*f,life:12,maxLife:12,size:2+Math.random()*2,color:y,type:"SPARKS",rotation:0,rotationSpeed:0,alpha:.6,gravity:.1,drag:.95})}}emitFire(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(3*s*this.particleMultiplier);for(let o=0;o<r;o++){const d=-Math.PI/2+(Math.random()-.5)*.5,f=1+Math.random()*2,p=["#FF4500","#DD3311","#CC2211","#888888"],y=p[Math.floor(Math.random()*p.length)];this.particles.push({x:t+(Math.random()-.5)*10,y:n,vx:Math.cos(d)*f,vy:Math.sin(d)*f,life:20+Math.random()*15,maxLife:35,size:6+Math.random()*8,color:y,type:"FIRE",rotation:0,rotationSpeed:0,alpha:.5,gravity:-.1,drag:.97})}}emitGroundEmbers(t,n,s=3){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let o=0;o<r;o++){const d=["#FF6600","#FF4400","#FFAA00","#FF8800","#FFCC00"],f=d[Math.floor(Math.random()*d.length)];this.particles.push({x:t+(Math.random()-.5)*40,y:n+(Math.random()-.5)*20,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.3,life:40+Math.random()*40,maxLife:80,size:2+Math.random()*3,color:f,type:"SPARKS",rotation:0,rotationSpeed:0,alpha:.9,gravity:.02,drag:.99})}}emitWhiteSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(2*s*this.particleMultiplier);for(let o=0;o<r;o++)this.particles.push({x:t+(Math.random()-.5)*20,y:n,vx:-.3-Math.random()*.5,vy:-1.5-Math.random()*1.5,life:80+Math.random()*40,maxLife:120,size:10+Math.random()*15,color:Math.random()>.3?"#CCCCCC":"#AAAAAA",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.03,alpha:.5,gravity:-.03,drag:.99})}emitSmokePlume(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(2.2*s*this.particleMultiplier);for(let o=0;o<r;o++)this.particles.push({x:t+(Math.random()-.5)*15,y:n,vx:(Math.random()-.5)*1,vy:-1-Math.random()*2,life:66+Math.random()*44,maxLife:110,size:8.8+Math.random()*13.2,color:Math.random()>.5?"#555555":"#666666",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.45,gravity:-.05,drag:.99})}emitCrashSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(1.5*s*this.particleMultiplier);for(let o=0;o<r;o++)this.particles.push({x:t+(Math.random()-.5)*5,y:n,vx:(Math.random()-.5)*.5,vy:-.5-Math.random()*1,life:40+Math.random()*30,maxLife:70,size:3+Math.random()*4,color:Math.random()>.5?"#555555":"#666666",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.5,gravity:-.03,drag:.98})}emitDamageSmoke(t,n,s){if(!this.shouldEmit())return;const r=s;if(r<.1)return;const o=(.1+r*.3)*this.particleMultiplier;if(Math.random()>o)return;const d=r>.7?2:1;for(let f=0;f<d;f++)this.particles.push({x:t+(Math.random()-.5)*12,y:n+20,vx:(Math.random()-.5)*.8,vy:.8+Math.random()*1.2,life:40+Math.random()*30,maxLife:70,size:4+Math.random()*6*r,color:r>.7?"#3a3a3a":"#5a5a5a",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.03,alpha:.3+r*.25,gravity:-.02,drag:.97})}emitExplosionDebris(t,n,s=20){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let o=0;o<r;o++){const d=Math.random()*Math.PI*2,f=5+Math.random()*10,p=["#DD3311","#CC2211","#333333","#555555"],y=p[Math.floor(Math.random()*p.length)];this.particles.push({x:t,y:n,vx:Math.cos(d)*f,vy:Math.sin(d)*f,life:40+Math.random()*30,maxLife:70,size:4+Math.random()*8,color:y,type:"EXPLOSION_DEBRIS",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.4,alpha:.7,gravity:.3,drag:.97})}}emitSpriteDebris(t,n,s,r=12){if(!this.shouldEmit())return;const o=Math.ceil(r*this.particleMultiplier);for(let d=0;d<o;d++){const f=Math.random(),p=f<.5?s.primary:f<.8?s.secondary:s.accent,y=Math.random()*Math.PI*2,m=4+Math.random()*8;this.particles.push({x:t,y:n,vx:Math.cos(y)*m,vy:Math.sin(y)*m+3,life:25+Math.random()*25,maxLife:50,size:3+Math.random()*5,color:p,type:"SPRITE_DEBRIS",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,alpha:.8,gravity:.2,drag:.97})}}emitEnemyDamageSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let o=0;o<r;o++)this.particles.push({x:t+(Math.random()-.5)*10,y:n+(Math.random()-.5)*10,vx:(Math.random()-.5)*2,vy:-.5-Math.random()*1.5,life:25+Math.random()*20,maxLife:45,size:5+Math.random()*6,color:Math.random()>.3?"#555555":"#444444",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.4,gravity:-.03,drag:.98})}update(){const t=[];for(const n of this.particles)n.vy+=n.gravity,n.vx*=n.drag,n.vy*=n.drag,n.x+=n.vx,n.y+=n.vy,n.rotation+=n.rotationSpeed,n.life--,n.alpha=n.life/n.maxLife,(n.type==="SMOKE_PLUME"||n.type==="ENGINE_EXHAUST")&&(n.size*=1.03),n.life>0&&t.push(n);if(this.particles=t,this.particles.length>this.maxParticles){const n=this.particles.length-this.maxParticles;this.particles.splice(0,n)}}render(t,n=!1){n&&(t.save(),t.globalCompositeOperation="lighter");for(const s of this.particles)t.globalAlpha=s.alpha,t.fillStyle=s.color,s.type==="BULLET_TRACER"||s.type==="MUZZLE_FLASH"||s.type==="SPARKS"||s.type==="FIRE"?(t.globalAlpha=s.alpha*.3,t.beginPath(),t.arc(s.x,s.y,s.size*1.5,0,Math.PI*2),t.fill(),t.globalAlpha=s.alpha,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill()):s.type==="SHRAPNEL"||s.type==="EXPLOSION_DEBRIS"||s.type==="SPRITE_DEBRIS"?s.rotation!==0?(t.save(),t.translate(s.x,s.y),t.rotate(s.rotation),t.fillRect(-s.size/2,-s.size/2,s.size,s.size),t.restore()):t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size):(t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill());n&&t.restore(),t.globalAlpha=1}getCount(){return this.particles.length}clear(){this.particles=[]}}const Te=new zE;var kE={};const Ch=typeof process<"u"?kE.NEXT_PUBLIC_ATMOSPHERE_EFFECTS!=="false":!0,hp={[Ee.DAWN_PATROL]:{type:"CLOUD",maxParticles:25,spawnRate:.025,scaleRange:[.5,1.5],alphaRange:[.15,.35],velocityYRange:[1,2],velocityXRange:[-.3,.3],rotates:!1,rotationSpeedRange:[0,0],secondaryType:"FOG",secondaryChance:.55,secondaryScaleRange:[1.5,3.5],secondaryAlphaRange:[.35,.55]},[Ee.STEEL_VANGUARD]:{type:"FOG",maxParticles:8,spawnRate:.01,scaleRange:[1.5,3],alphaRange:[.18,.35],velocityYRange:[1.5,3],velocityXRange:[-.5,.5],rotates:!1,rotationSpeedRange:[0,0]},[Ee.HELLFIRE_HORIZON]:{type:"SANDSTORM",maxParticles:25,spawnRate:.04,scaleRange:[.3,.7],alphaRange:[.2,.4],velocityYRange:[2,3.5],velocityXRange:[1,2.5],rotates:!0,rotationSpeedRange:[-.1,.1]}};class VE{constructor(){this.particles=[],this.enabled=Ch,this.intensity=1,this.campaign=Ee.DAWN_PATROL,this.level=1,this.frameCount=0,this.performanceMultiplier=1,this.windGustActive=!1,this.windGustStrength=0,this.windGustTimer=0,this.nextGustTime=180,this.cloudSprite=null,this.fogSprite=null,this.sandSprite=null,this.config=hp[Ee.DAWN_PATROL]}setSprites(t,n,s){this.cloudSprite=t,this.fogSprite=n,this.sandSprite=s}getCurrentSprite(){switch(this.config.type){case"CLOUD":return this.cloudSprite;case"FOG":return this.fogSprite;case"SANDSTORM":return this.sandSprite;default:return this.cloudSprite}}setCampaign(t,n){this.campaign=t,this.level=n,this.config=hp[t];const s=Kh(t),r=.3,o=.7;this.intensity=r+o*((n-1)/Math.max(1,s-1)),this.particles=[]}setPerformanceMultiplier(t){this.performanceMultiplier=Math.max(0,Math.min(1,t))}setEnabled(t){this.enabled=t&&Ch,this.enabled||(this.particles=[])}clear(){this.particles=[]}random(t,n){return t+Math.random()*(n-t)}spawnParticle(){const t=this.config,n=t.secondaryType&&t.secondaryChance&&Math.random()<t.secondaryChance,s=n?t.secondaryType:t.type,r=this.random(-100,w+100);let o=-this.random(50,200);t.type==="SANDSTORM"&&Math.random()<.3&&(o=this.random(0,G));const d=n&&t.secondaryScaleRange?t.secondaryScaleRange:t.scaleRange,f=n&&t.secondaryAlphaRange?t.secondaryAlphaRange:t.alphaRange,y=this.random(d[0],d[1])*(.8+this.intensity*.2),_=this.random(f[0],f[1])*this.intensity;let S=this.random(t.velocityYRange[0],t.velocityYRange[1])*(.8+this.intensity*.4),R=this.random(t.velocityXRange[0],t.velocityXRange[1]);if(s==="FOG"&&(S=this.random(3,5)*(.8+this.intensity*.4),R=this.random(-.5,.5)),t.type==="SANDSTORM"){const N=Math.sin(this.frameCount/60)*.5;R+=N}const b=t.rotates?Math.random()*Math.PI*2:0,x=t.rotates?this.random(t.rotationSpeedRange[0],t.rotationSpeedRange[1]):0;this.particles.push({x:r,y:o,vx:R,vy:S,scale:y,alpha:_,rotation:b,rotationSpeed:x,effectType:s})}update(t,n=1){if(!this.enabled)return;this.frameCount=t;const s=this.config;if(s.type==="FOG"||s.type==="SANDSTORM"||s.secondaryType==="FOG"){const _=s.type==="FOG"?"FOG":s.type==="SANDSTORM"?"SANDSTORM":"FOG";this.updateWindGusts(n,_)}let o=1;this.windGustActive&&(s.type==="FOG"?o=.05:s.type==="SANDSTORM"&&(o=.3));const d=s.spawnRate*this.intensity*this.performanceMultiplier*o,f=Math.floor(s.maxParticles*this.performanceMultiplier);this.particles.length<f&&Math.random()<d&&this.spawnParticle();const p=this.getCurrentSprite(),y=(p==null?void 0:p.width)||128,m=(p==null?void 0:p.height)||96;for(let _=this.particles.length-1;_>=0;_--){const S=this.particles[_];S.x+=S.vx*n,S.y+=S.vy*n,s.rotates&&(S.rotation+=S.rotationSpeed*n),S.effectType==="FOG"&&(S.scale*=1.001,this.windGustActive&&(S.x+=this.windGustStrength*n,S.alpha*=.96)),s.type==="SANDSTORM"&&this.windGustActive&&(S.x+=this.windGustStrength*.5*n,S.alpha*=.998);const R=y*S.scale,b=m*S.scale;(S.y>G+b||S.x<-R-100||S.x>w+R+100||S.alpha<.02)&&this.particles.splice(_,1)}}updateWindGusts(t,n){this.windGustTimer+=t;const s=n==="FOG"?180:120,r=n==="FOG"?60:240,o=n==="FOG"?180:480;this.windGustActive?this.windGustTimer>s&&(this.windGustActive=!1,this.windGustStrength=0,this.windGustTimer=0,this.nextGustTime=r+Math.random()*(o-r)):this.windGustTimer>this.nextGustTime&&(this.windGustActive=!0,n==="FOG"?this.windGustStrength=3+Math.random()*4:this.windGustStrength=2+Math.random()*2,Math.random()<.5&&(this.windGustStrength*=-1),this.windGustTimer=0)}getSpriteForType(t){switch(t){case"CLOUD":return this.cloudSprite;case"FOG":return this.fogSprite;case"SANDSTORM":return this.sandSprite;default:return this.cloudSprite}}render(t){if(!this.enabled||this.particles.length===0)return;const n=this.config;t.save();for(const s of this.particles){const r=this.getSpriteForType(s.effectType);if(!r)continue;const o=r.width*s.scale,d=r.height*s.scale;t.globalAlpha=s.alpha,n.rotates&&s.effectType==="SANDSTORM"?(t.save(),t.translate(s.x,s.y),t.rotate(s.rotation),t.drawImage(r,-o/2,-d/2,o,d),t.restore()):t.drawImage(r,s.x-o/2,s.y-d/2,o,d)}t.globalAlpha=1,t.restore()}getParticleCount(){return this.particles.length}isEnabled(){return this.enabled&&Ch}hasSprites(){return this.cloudSprite!==null||this.fogSprite!==null||this.sandSprite!==null}}const zn=new VE;class Gp{constructor(){this.screenShake={active:!1,intensity:0,duration:0,elapsed:0},this.damageVignette={active:!1,intensity:0,duration:0,elapsed:0},this.whiteFlash={active:!1,intensity:0,duration:0,elapsed:0},this.chromaticAberration={active:!1,intensity:0,duration:0,elapsed:0},this.heatDistortion={active:!1,intensity:0,duration:0,elapsed:0},this.precisionVignette={active:!1,intensity:0,duration:0,elapsed:0}}triggerScreenShake(t=10,n=15){this.screenShake={active:!0,intensity:Math.max(this.screenShake.intensity,t),duration:n,elapsed:0}}triggerDamageVignette(t=.5,n=30){this.damageVignette={active:!0,intensity:t,duration:n,elapsed:0}}triggerWhiteFlash(t=1,n=10){this.whiteFlash={active:!0,intensity:t,duration:n,elapsed:0},setTimeout(()=>{this.whiteFlash.active&&this.whiteFlash.elapsed>=n*2&&(console.error("[FREEZE DEBUG] White flash stuck! Force clearing."),this.whiteFlash.active=!1,this.whiteFlash.intensity=0)},n*2*16.67)}triggerChromaticAberration(t=5,n=15){this.chromaticAberration={active:!0,intensity:t,duration:n,elapsed:0}}triggerHeatDistortion(t=3,n=20){this.heatDistortion={active:!0,intensity:t,duration:n,elapsed:0}}triggerPrecisionVignette(t,n){this.precisionVignette.active=!0,this.precisionVignette.intensity=Math.max(0,Math.min(1,t)),this.precisionVignette.duration=n,this.precisionVignette.elapsed=0}update(){this.screenShake.active&&(this.screenShake.elapsed++,this.screenShake.intensity*=.9,(this.screenShake.elapsed>=this.screenShake.duration||this.screenShake.intensity<.5)&&(this.screenShake.active=!1,this.screenShake.intensity=0)),this.damageVignette.active&&(this.damageVignette.elapsed++,this.damageVignette.elapsed>=this.damageVignette.duration&&(this.damageVignette.active=!1,this.damageVignette.intensity=0)),this.whiteFlash.active&&(this.whiteFlash.elapsed++,this.whiteFlash.intensity=1-this.whiteFlash.elapsed/this.whiteFlash.duration,this.whiteFlash.elapsed>=this.whiteFlash.duration&&(this.whiteFlash.active=!1,this.whiteFlash.intensity=0)),this.chromaticAberration.active&&(this.chromaticAberration.elapsed++,this.chromaticAberration.elapsed>=this.chromaticAberration.duration&&(this.chromaticAberration.active=!1,this.chromaticAberration.intensity=0)),this.heatDistortion.active&&(this.heatDistortion.elapsed++,this.heatDistortion.elapsed>=this.heatDistortion.duration&&(this.heatDistortion.active=!1,this.heatDistortion.intensity=0)),this.precisionVignette.active&&this.precisionVignette.elapsed<this.precisionVignette.duration&&(this.precisionVignette.elapsed++,this.precisionVignette.elapsed>=this.precisionVignette.duration&&(this.precisionVignette.active=!1))}applyScreenShake(t){if(this.screenShake.active&&this.screenShake.intensity>0){const n=(Math.random()-.5)*this.screenShake.intensity,s=(Math.random()-.5)*this.screenShake.intensity;t.translate(n,s)}}renderDamageVignette(t,n,s,r=!0){if(!this.damageVignette.active||!r)return;t.save();const o=t.createRadialGradient(n/2,s/2,0,n/2,s/2,Math.max(n,s)*.8);o.addColorStop(0,"rgba(255, 0, 0, 0)"),o.addColorStop(.7,"rgba(255, 0, 0, 0)"),o.addColorStop(1,`rgba(255, 0, 0, ${this.damageVignette.intensity})`),t.fillStyle=o,t.fillRect(0,0,n,s),t.restore()}renderWhiteFlash(t,n,s){!this.whiteFlash.active||this.whiteFlash.intensity<=0||(t.save(),t.fillStyle=`rgba(255, 255, 255, ${this.whiteFlash.intensity})`,t.fillRect(0,0,n,s),t.restore())}renderPrecisionVignette(t,n,s,r=!0){if(!this.precisionVignette.active||this.precisionVignette.intensity<=0||!r)return;const o=this.precisionVignette.intensity;t.save();const d=t.createRadialGradient(n/2,s/2,s*.2,n/2,s/2,s*.7);d.addColorStop(0,"rgba(0, 100, 255, 0)"),d.addColorStop(1,`rgba(0, 100, 255, ${o*.3})`),t.fillStyle=d,t.fillRect(0,0,n,s),t.strokeStyle=`rgba(0, 150, 255, ${o*.5})`,t.lineWidth=4,t.strokeRect(2,2,n-4,s-4),t.restore()}renderChromaticAberration(t,n){if(!this.chromaticAberration.active||this.chromaticAberration.intensity<=0)return;const s=this.chromaticAberration.intensity,r=n.getImageData(0,0,t.width,t.height);r.data;const o=document.createElement("canvas");o.width=t.width,o.height=t.height;const d=o.getContext("2d");d&&(d.putImageData(r,0,0),n.save(),n.globalCompositeOperation="lighten",n.globalAlpha=.5,n.drawImage(o,-s,0),n.drawImage(o,s,0),n.restore())}renderScanlines(t,n,s,r,o=!0){if(!o||r<=0)return;const d=r*.15;t.fillStyle=`rgba(0, 0, 0, ${d})`;for(let f=0;f<s;f+=3)t.fillRect(0,f,n,1)}getScreenShake(){return this.screenShake.active?{x:(Math.random()-.5)*this.screenShake.intensity,y:(Math.random()-.5)*this.screenShake.intensity}:{x:0,y:0}}hasActiveEffects(){return this.screenShake.active||this.damageVignette.active||this.whiteFlash.active||this.chromaticAberration.active||this.heatDistortion.active||this.precisionVignette.active}reset(){this.screenShake={active:!1,intensity:0,duration:0,elapsed:0},this.damageVignette={active:!1,intensity:0,duration:0,elapsed:0},this.whiteFlash={active:!1,intensity:0,duration:0,elapsed:0},this.chromaticAberration={active:!1,intensity:0,duration:0,elapsed:0},this.heatDistortion={active:!1,intensity:0,duration:0,elapsed:0},this.precisionVignette={active:!1,intensity:0,duration:0,elapsed:0}}}const Yp="",dp=!0;let Za=null,Yo=null;const WE=()=>{try{const c=document.createElement("canvas");return c.width=1,c.height=1,c.toDataURL("image/webp").startsWith("data:image/webp")}catch{return!1}},Jh=WE();async function XE(){return Za||Yo||(Yo=(async()=>{try{const c=await fetch("/dist-assets/manifest.json");return c.ok?(Za=await c.json(),console.log("[ASSETS] Loaded compressed assets manifest:",Za==null?void 0:Za.version),Za):(console.warn("[ASSETS] Manifest not found, falling back to dynamic loading"),null)}catch(c){return console.warn("[ASSETS] Failed to load manifest:",c),null}})(),Yo)}function Up(c){return Za&&[...Za.bundles.initial.graphics,...Za.bundles.progressive.tier2,...Za.bundles.progressive.tier3,...Za.bundles.progressive.terrain].find(n=>n.name===c)||null}function jE(c){if(Za&&Jh){const t=Up(c);if(t)return`/dist-assets/${t.path}`}return`${Yp}/api/asset/${c}`}function sc(c){if(Za&&Jh){const t=Up(`${c}_thumb`);if(t)return`/dist-assets/${t.path}`}return`${Yp}/api/asset/${c}/thumb`}const $E="v2",zp=`game-assets-${$E}`,qE=50,ZE=500;let Wh=0;const KE=["player","enemySmall1","enemySmall2","enemySmall3","enemyRed","cloud","explosion","powerupFirepower","powerupFirepowerEnhanced","powerupBomb","powerupInvincibility","helicopter1","helicopter2","bombDropped","bombTier1","bombTier2","bombTier3","bombTier4"],Ka=new Map,QE={1:["ocean1","island1","enemySmall1","enemySmall2"],2:["ocean2","island2","enemyBig1","helicopter1","helicopter2"],3:["ocean3","island3","battleship1","battleship2"],4:["ocean4","bossAceSquadron","bossFlyingFortress"],5:["ocean5","bossSuperBattleship","bossExperimentalAirship","bossUltimateWeapon"]};let fp=!1,Ko=new Set;function Qo(c){return`${zp}-${c}`}function JE(c){try{const t=localStorage.getItem(Qo(c));return t&&console.log(`[CACHE]  Hit: ${c}`),t}catch(t){return console.warn(`[CACHE] Failed to read ${c}:`,t),null}}function e_(c,t){try{const n=t.length*.75/1024;return n>ZE?(console.log(`[CACHE]  Skip ${c}: ${n.toFixed(0)}KB (too large)`),!1):(Wh+n>qE*1024&&(console.warn("[CACHE]  Cache full, clearing old entries..."),Xh()),localStorage.setItem(Qo(c),t),Wh+=n,console.log(`[CACHE]  Saved: ${c} (${n.toFixed(0)}KB)`),!0)}catch(n){if(console.warn(`[CACHE] Failed to save ${c}:`,n),n instanceof DOMException&&n.name==="QuotaExceededError"){Xh();try{return localStorage.setItem(Qo(c),t),!0}catch{return!1}}return!1}}function Xh(){try{const c=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith("game-assets-")&&!n.startsWith(zp)&&c.push(n)}c.forEach(t=>localStorage.removeItem(t)),console.log(`[CACHE] Cleared ${c.length} old cache entries`),Wh=0}catch(c){console.warn("[CACHE] Failed to clear old cache:",c)}}Xh();const Ph=3,gp=1e3;async function Pe(c,t=!0,n=!1,s=0){const r=JE(c);if(r)return t_(c,r);const o=jE(c),d=o.includes("/dist-assets/");return console.log(`[ASSET] Loading: ${c} from ${o}${s>0?` (retry ${s}/${Ph})`:""}${d?" (WebP)":""}`),new Promise((f,p)=>{const y=new Image;if(y.crossOrigin="anonymous",y.onload=()=>{console.log(`[ASSET]  Loaded: ${c}`);const m=document.createElement("canvas");m.width=y.width,m.height=y.height;const _=m.getContext("2d");if(!_){console.error(`Failed to get 2D context for ${c}`),f(m);return}if(_.drawImage(y,0,0),n){const S=_.getImageData(0,0,m.width,m.height),R=S.data;for(let b=0;b<R.length;b+=4){const x=R[b],N=R[b+1],L=R[b+2],O=.299*x+.587*N+.114*L;R[b]=(x*.6+O*.4)*.8,R[b+1]=(N*.6+O*.4)*.8,R[b+2]=(L*.6+O*.4)*.8}_.putImageData(S,0,0),console.log(` ${c}: Applied desaturation overlay`)}if(t)try{const S=_.getImageData(0,0,m.width,m.height),R=S.data,b=R[0],x=R[1],N=R[2];let L=0;const O=60;for(let I=0;I<R.length;I+=4){const Y=R[I],W=R[I+1],Z=R[I+2],K=Math.abs(Y-b),Q=Math.abs(W-x),me=Math.abs(Z-N);K<O&&Q<O&&me<O&&(R[I+3]=0,L++)}_.putImageData(S,0,0),console.log(` ${c}: Removed ${L.toLocaleString()} background pixels (sampled bg: rgb(${b}, ${x}, ${N}))`)}catch(S){console.error(`Failed to apply chroma key to ${c}:`,S)}else console.log(` ${c}: Keeping opaque (no chroma key)`);if(KE.includes(c)||c==="titleScreen")try{const S=m.toDataURL("image/png");e_(c,S)}catch(S){console.warn(`[CACHE] Failed to cache ${c}:`,S)}f(m)},y.onerror=async m=>{if(console.error(`[ASSET]  Failed to load ${c}:`,m),console.error(`[ASSET] URL was: ${y.src}`),s<Ph){console.log(`[ASSET]  Retrying ${c} in ${gp}ms...`),await new Promise(_=>setTimeout(_,gp*(s+1)));try{const _=await Pe(c,t,n,s+1);f(_)}catch(_){p(_)}}else p(new Error(`Failed to load ${c} after ${Ph} retries`))},d)y.src=o;else{const m=Date.now();y.src=`${o}?t=${m}`}})}async function t_(c,t){return new Promise((n,s)=>{const r=new Image;r.onload=()=>{const o=document.createElement("canvas");o.width=r.width,o.height=r.height;const d=o.getContext("2d");if(!d){s(new Error(`Failed to get 2D context for cached ${c}`));return}d.drawImage(r,0,0),n(o)},r.onerror=()=>{console.warn(`[CACHE] Corrupted cache for ${c}, removing...`),localStorage.removeItem(Qo(c)),s(new Error(`Cached ${c} corrupted`))},r.src=t})}const Uo=(c,t,n,s,r)=>{const d=document.createElement("canvas");d.width=s+6,d.height=r+6;const f=d.getContext("2d");if(f){const p=d.width/2;d.height/2,f.shadowColor=n,f.shadowBlur=4;const y=f.createLinearGradient(p,3,p,3+r);y.addColorStop(0,c),y.addColorStop(.3,t),y.addColorStop(1,n),f.fillStyle=y,f.beginPath(),f.roundRect(3,3,s,r,s/2),f.fill(),f.shadowBlur=0;const m=f.createLinearGradient(p,3,p,3+r*.4);m.addColorStop(0,"#FFFFFF"),m.addColorStop(1,c),f.fillStyle=m,f.beginPath(),f.roundRect(4,3,s-2,r*.4,(s-2)/2),f.fill()}return d},a_=()=>{const c=`
      <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#888;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ccc;stop-opacity:1" />
          </linearGradient>
        </defs>
        <g>
          <rect x="11" y="2" width="3" height="14" fill="url(#grad1)"/>
          <rect x="18" y="2" width="3" height="14" fill="url(#grad1)"/>
          <circle cx="16" cy="16" r="8" fill="url(#grad1)"/>
          <circle cx="16" cy="16" r="5" fill="#666"/>
        </g>
      </svg>`,t=new Image;return t.src="data:image/svg+xml;base64,"+btoa(c),t},lc=(c=64,t=64)=>{const n=document.createElement("canvas");n.width=c,n.height=t;const s=n.getContext("2d");return s&&(s.fillStyle="#333",s.fillRect(0,0,c,t)),n};let it={},i_=!1;async function n_(){if(!fp){console.log("[TIER 2] Loading deferred assets in background...");try{const c=await Promise.allSettled([Pe("ocean2",!1,!0),Pe("ocean3",!1,!0),Pe("ocean4",!1,!0),Pe("ocean5",!1,!0),Pe("island1",!0,!1),Pe("island2",!0,!1),Pe("island3",!0,!1),Pe("enemySmall3",!0,!1),Pe("enemyBig1",!0,!1),Pe("enemyBig2",!0,!1),Pe("enemyBig3",!0,!1),Pe("helicopter2",!0,!1),Pe("battleship1",!0,!1),Pe("battleship2",!0,!1),Pe("battleship3",!0,!1),Pe("tank1",!0,!1),Pe("tank2",!0,!1),Pe("tank3",!0,!1),Pe("largeTank1",!0,!1),Pe("largeTank2",!0,!1),Pe("largeTank3",!0,!1),Pe("turretBaseAA",!0,!1),Pe("turretCannonAA",!0,!1),Pe("turretBaseFortress",!0,!1),Pe("turretCannonFortress",!0,!1),Pe("turretBaseNaval",!0,!1),Pe("turretCannonNaval",!0,!1)]),t=lc(),n=(_e,Je,U)=>_e.status==="fulfilled"?_e.value:(console.warn(`[TIER 2] Failed to load ${U}, using placeholder`),t),[s,r,o,d,f,p,y,m,_,S,R,b,x,N,L,O,I,Y,W,Z,K,Q,me,pe,fe,re,ce]=[n(c[0],0,"ocean2"),n(c[1],1,"ocean3"),n(c[2],2,"ocean4"),n(c[3],3,"ocean5"),n(c[4],4,"island1"),n(c[5],5,"island2"),n(c[6],6,"island3"),n(c[7],7,"enemySmall3"),n(c[8],8,"enemyBig1"),n(c[9],9,"enemyBig2"),n(c[10],10,"enemyBig3"),n(c[11],11,"helicopter2"),n(c[12],12,"battleship1"),n(c[13],13,"battleship2"),n(c[14],14,"battleship3"),n(c[15],15,"tank1"),n(c[16],16,"tank2"),n(c[17],17,"tank3"),n(c[18],18,"largeTank1"),n(c[19],19,"largeTank2"),n(c[20],20,"largeTank3"),n(c[21],21,"turretBaseAA"),n(c[22],22,"turretCannonAA"),n(c[23],23,"turretBaseFortress"),n(c[24],24,"turretCannonFortress"),n(c[25],25,"turretBaseNaval"),n(c[26],26,"turretCannonNaval")];it.ocean&&(it.ocean[1]=s,it.ocean[2]=r,it.ocean[3]=o,it.ocean[4]=d),it.island&&(it.island[0]=f,it.island[1]=p,it.island[2]=y),it.enemySmall&&(it.enemySmall[2]=m),it.enemyBig&&(it.enemyBig[0]=_,it.enemyBig[1]=S,it.enemyBig[2]=R),it.enemyHelicopter&&(it.enemyHelicopter[1]=b),it.battleship&&(it.battleship[0]=x,it.battleship[1]=N,it.battleship[2]=L),it.tank&&(it.tank[0]=O,it.tank[1]=I,it.tank[2]=Y),it.largeTank&&(it.largeTank[0]=W,it.largeTank[1]=Z,it.largeTank[2]=K),it.turretBaseAA=Q,it.turretCannonAA=me,it.turretBaseFortress=pe,it.turretCannonFortress=fe,it.turretBaseNaval=re,it.turretCannonNaval=ce,fp=!0,console.log("[TIER 2]  Deferred assets loaded")}catch(c){console.error("[TIER 2]  Failed to load deferred assets:",c)}}}const jh={[Ee.DAWN_PATROL]:["dawnPatrolStory1","dawnPatrolStory2","dawnPatrolStory3","dawnPatrolStory4","dawnPatrolStory5"],[Ee.STEEL_VANGUARD]:["steelVanguardStory1","steelVanguardStory2","steelVanguardStory3","steelVanguardStory4","steelVanguardStory5"],[Ee.HELLFIRE_HORIZON]:["hellfireStory1","hellfireStory2","hellfireStory3","hellfireStory4","hellfireStory5"]},$h={[Ee.DAWN_PATROL]:["dawnPatrolVictory1","dawnPatrolVictory2"],[Ee.STEEL_VANGUARD]:["steelVanguardVictory1","steelVanguardVictory2"],[Ee.HELLFIRE_HORIZON]:["hellfireVictory1","hellfireVictory2"]},wh=new Map;async function pp(c){const t=wh.get(c);if(t&&t.length===5&&!t.some(p=>p.width===64)&&jh[c].every(m=>ec(m)))return console.log(`[LAZY] Using cached story panels for ${c}`),t;const n=jh[c];console.log(`[LAZY] Loading ${c} story panels with progressive loading...`);const s=lc(640,480);console.log(`[LAZY] Phase 1: Loading ${c} story panel thumbnails...`);const o=(await Promise.allSettled(n.map(async p=>{try{const y=sc(p),m=await rc(y),_=oc(m,640,480);return Ka.set(p,{thumbnail:_,full:null,loading:!0}),_}catch{return console.warn(`[LAZY] Could not load thumbnail for ${p}, trying full asset...`),null}}))).map((p,y)=>p.status==="fulfilled"&&p.value?p.value:s);wh.set(c,o),console.log(`[LAZY]  ${c} story panel thumbnails ready`),console.log(`[LAZY] Phase 2: Loading full ${c} story panels...`);const f=(await Promise.allSettled(n.map(p=>Pe(p,!1,!1)))).map((p,y)=>{const m=n[y];if(p.status==="fulfilled"){const S=Ka.get(m);return S?(S.full=p.value,S.loading=!1):Ka.set(m,{thumbnail:null,full:p.value,loading:!1}),p.value}console.warn(`[LAZY] Failed to load ${m}, using thumbnail or placeholder`);const _=Ka.get(m);return(_==null?void 0:_.thumbnail)||s});return wh.set(c,f),console.log(`[LAZY]  Full ${c} story panels loaded`),f}function mp(c){return jh[c]}function s_(c){return $h[c]}const Ih=new Map;async function l_(c){const t=Ih.get(c);if(t&&t.length===2&&!t.some(p=>p.width===64)&&$h[c].every(m=>ec(m)))return console.log(`[LAZY] Using cached victory panels for ${c}`),t;const n=$h[c];console.log(`[LAZY] Loading ${c} victory panels with progressive loading...`);const s=lc(640,480);console.log(`[LAZY] Phase 1: Loading ${c} victory panel thumbnails...`);const o=(await Promise.allSettled(n.map(async p=>{try{const y=sc(p),m=await rc(y),_=oc(m,640,480);return Ka.set(p,{thumbnail:_,full:null,loading:!0}),_}catch{return console.warn(`[LAZY] Could not load thumbnail for ${p}, trying full asset...`),null}}))).map(p=>p.status==="fulfilled"&&p.value?p.value:s);Ih.set(c,o),console.log(`[LAZY]  ${c} victory panel thumbnails ready`),console.log(`[LAZY] Phase 2: Loading full ${c} victory panels...`);const f=(await Promise.allSettled(n.map(p=>Pe(p,!1,!1)))).map((p,y)=>{const m=n[y];if(p.status==="fulfilled"){const S=Ka.get(m);return S?(S.full=p.value,S.loading=!1):Ka.set(m,{thumbnail:null,full:p.value,loading:!1}),p.value}console.warn(`[LAZY] Failed to load ${m}, using thumbnail or placeholder`);const _=Ka.get(m);return(_==null?void 0:_.thumbnail)||s});return Ih.set(c,f),console.log(`[LAZY]  Full ${c} victory panels loaded`),f}const kp={1:"bossAceSquadron",2:"bossFlyingFortress",3:"bossSuperBattleship",4:"bossExperimentalAirship",5:"bossUltimateWeapon"};async function Jo(c){const t=kp[c];if(!(!t||Ko.has(t))){console.log(`[LAZY] Loading boss for level ${c}: ${t}`);try{const n=await Pe(t,!0,!1);it[t]=n,Ko.add(t),console.log(`[LAZY]  ${t} loaded`)}catch(n){console.error(`[LAZY]  Failed to load ${t}:`,n)}}}async function r_(){console.log("[LAZY] Loading all boss sprites in background...");const c=Object.entries(kp).map(async([t,n])=>{if(!Ko.has(n))try{const s=await Pe(n,!0,!1);it[n]=s,Ko.add(n),console.log(`[LAZY]  ${n} loaded`)}catch(s){console.error(`[LAZY]  Failed to load ${n}:`,s)}});await Promise.allSettled(c),console.log("[LAZY]  All boss sprites loaded")}async function o_(c){const t=c+1;if(!(t>5||!QE[t])){console.log(`[PRELOAD] Preloading assets for level ${t}...`);try{console.log(`[PRELOAD] Preloading terrain for level ${t}...`),await Ta.generateForLevelAsync(t),console.log(`[PRELOAD] Terrain for level ${t} preloaded successfully`)}catch(s){console.error(`[PRELOAD] Failed to preload terrain for level ${t}:`,s)}await Jo(t)}}async function rc(c){return new Promise((t,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const o=r.getContext("2d");o&&o.drawImage(s,0,0),t(r)},s.onerror=()=>n(new Error(`Failed to load thumbnail from ${c}`)),s.src=c})}function oc(c,t,n){const s=document.createElement("canvas");s.width=t,s.height=n;const r=s.getContext("2d");return r&&(r.imageSmoothingEnabled=!1,r.drawImage(c,0,0,t,n)),s}async function c_(c=!1,t,n,s){console.log(""),console.log(" Loading Assets (Tiered Loading)..."),console.log("API_BASE:","(relative path)"),console.log("USE_COMPRESSED:",dp),console.log("WEBP_SUPPORTED:",Jh),console.log("");const r=Date.now(),o=d=>{s&&s(d)};try{o(5),dp&&(console.log("[MANIFEST] Loading compressed assets manifest..."),await XE()),console.log("[TIER 0] Loading title screen with progressive loading...");let d=null;try{const ce=sc("titleScreen"),_e=await rc(ce);d=oc(_e,640,960),console.log(`[TIER 0]  Thumbnail ready (${Date.now()-r}ms) - showing pixelated preview`),t&&t(d),it.titleScreen=d,Ka.set("titleScreen",{thumbnail:d,full:null,loading:!0})}catch{console.warn("[TIER 0] Could not load thumbnail, waiting for full image...")}o(15);const f=await Pe("titleScreen",!1,!1);console.log(`[TIER 0]  Full title screen loaded (${Date.now()-r}ms)`),o(25),it.titleScreen=f,Ka.set("titleScreen",{thumbnail:d,full:f,loading:!1}),!d&&t&&t(f),console.log("[TIER 1] Loading essential assets...");const p=Date.now();o(30);const[y,m,_,S,R,b]=await Promise.all([Pe("player",!0,!1),Pe("ocean1",!1,!0),Pe("explosion",!0,!1),Pe("cloud",!0,!1),Pe("fogPatch",!0,!1),Pe("sandParticle",!0,!1)]);o(45);const[x,N,L,O]=await Promise.all([Pe("enemySmall1",!0,!1),Pe("enemySmall2",!0,!1),Pe("enemyRed",!0,!1),Pe("helicopter1",!0,!1)]);o(60);const[I,Y,W,Z]=await Promise.all([Pe("powerupFirepower",!0,!1),Pe("powerupFirepowerEnhanced",!0,!1),Pe("powerupBomb",!0,!1),Pe("powerupInvincibility",!0,!1)]);o(75);const[K,Q,me,pe,fe]=await Promise.all([Pe("bombDropped",!0,!1),Pe("bombTier1",!0,!1),Pe("bombTier2",!0,!1),Pe("bombTier3",!0,!1),Pe("bombTier4",!0,!1)]);o(90),console.log(`[TIER 1]  Essential assets loaded (${Date.now()-p}ms)`);const re=lc();return Object.assign(it,{titleScreen:f,ocean:[m,re,re,re,re],island:[re,re,re],cloud:S,fogPatch:R,sandParticle:b,explosion:_,player:y,enemySmall:[x,N,re],enemyRed:L,enemyBig:[re,re,re],battleship:[re,re,re],tank:[re,re,re],largeTank:[re,re,re],enemyHelicopter:[O,re],powerupFirepower:I,powerupFirepowerEnhanced:Y,powerupBomb:W,powerupInvincibility:Z,bombDropped:K,bombTier1:Q,bombTier2:me,bombTier3:pe,bombTier4:fe,bulletPlayer:Uo("#FFFF00","#FF8800","#FF4400",22,14),bulletEnemy:Uo("#FF6666","#CC0000","#880000",22,12),bulletTurret:Uo("#FFAA00","#FF6600","#CC3300",4,10),bulletCannon:Uo("#FFFF00","#FF4400","#CC0000",10,10),turret:a_(),storyPanels:[re,re,re,re,re],explosionSmall:[_],explosionMedium:[_],explosionLarge:[_],explosionMassive:[_],bossAceSquadron:re,bossFlyingFortress:re,bossSuperBattleship:re,bossExperimentalAirship:re,bossUltimateWeapon:re}),i_=!0,n_().catch(ce=>console.error("[TIER 2] Background load error:",ce)),await Jo(1).catch(ce=>console.error("[LAZY] Boss 1 load error:",ce)),r_().catch(ce=>console.error("[LAZY] All bosses load error:",ce)),o(100),console.log(""),console.log(` Essential assets ready! (${Date.now()-r}ms)`),console.log(" Deferred assets loading in background..."),console.log(""),it}catch(d){throw console.error(" Failed to load assets:",d),d}}function yp(c){const t=Ka.get(c);return t?t.full||t.thumbnail:null}function ec(c){const t=Ka.get(c);return(t==null?void 0:t.full)!==null&&(t==null?void 0:t.full)!==void 0}async function u_(c){console.log(`[PROGRESSIVE] Preloading ${c.length} thumbnails...`);const t=c.map(async n=>{if(!Ka.has(n))try{const s=sc(n),r=await rc(s),o=oc(r,512,512);Ka.set(n,{thumbnail:o,full:null,loading:!1})}catch{}});await Promise.allSettled(t),console.log("[PROGRESSIVE]  Thumbnails preloaded")}function zo(){return Si?V:null}const un=Yi.chunkSize,Hi=un*Yi.tileSize;function Ep(c,t,n){return`${c}:${t}:${n}`}class h_{constructor(){this.chunks=new Map,this.tilesets=new Map,this.tileCache=new Map,this.currentTilemap=null,this.dirtyChunks=new Set,this.currentCampaign="DAWN_PATROL",this.currentLevel=1}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n}getEffectiveAdjustments(){const t=zo();return t&&t.isEnabled()?t.getEffectiveTerrainAdjustments():ca(this.currentCampaign,this.currentLevel)}getEffectiveTerrainWidthForRendering(t){const n=Ta.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel);return n!==null?n:this.getEffectiveAdjustments().mapWidthExtended}isDesignModeActive(){const t=zo();return t?t.isEnabled():!1}loadTilemap(t){this.currentTilemap=t,this.chunks.clear(),this.dirtyChunks.clear(),console.log(`[TilemapRenderer] Loaded tilemap: ${t.width}x${t.height} tiles`)}registerTileset(t,n){this.tilesets.set(t,n),this.tileCache.clear(),this.chunks.clear(),console.log(`[TilemapRenderer] Registered tileset: ${t}`)}getTile(t,n,s=Yi.tileSize){const r=`${n}:${t}`;if(this.tileCache.has(r))return this.tileCache.get(r);const o=this.tilesets.get(n);if(!o)return console.warn(`[TilemapRenderer] Tileset not found: ${n}`),null;const d=Math.floor(o.width/s),f=t%d*s,p=Math.floor(t/d)*s,y=document.createElement("canvas");y.width=s,y.height=s;const m=y.getContext("2d");return m&&(m.imageSmoothingEnabled=!1,m.drawImage(o,f,p,s,s,0,0,s,s)),this.tileCache.set(r,y),y}getChunk(t,n,s,r){var _,S;if(!this.currentTilemap)return null;const o=Ep(n,s,r);if(!this.dirtyChunks.has(o)&&this.chunks.has(o))return this.chunks.get(o);const d=document.createElement("canvas");d.width=Hi,d.height=Hi;const f=d.getContext("2d");if(!f)return null;f.imageSmoothingEnabled=!1;const p=this.currentTilemap.tileSize,y=s*un,m=r*un;for(let R=0;R<un;R++)for(let b=0;b<un;b++){const x=y+b,N=m+R;if(N>=t.tiles.length||x>=(((_=t.tiles[0])==null?void 0:_.length)||0))continue;const L=(S=t.tiles[N])==null?void 0:S[x];if(!L)continue;const O=this.getTile(L.id,this.currentTilemap.tilesetId,p);if(!O)continue;const I=b*p,Y=R*p;L.rotation||L.flipX||L.flipY?(f.save(),f.translate(I+p/2,Y+p/2),L.rotation&&f.rotate(L.rotation*Math.PI/180),L.flipX&&f.scale(-1,1),L.flipY&&f.scale(1,-1),f.drawImage(O,-p/2,-p/2),f.restore()):f.drawImage(O,I,Y)}return this.chunks.set(o,d),this.dirtyChunks.delete(o),d}markTileDirty(t,n){const s=Math.floor(t/un),r=Math.floor(n/un);if(this.currentTilemap)for(let o=0;o<this.currentTilemap.layers.length;o++)this.dirtyChunks.add(Ep(o,s,r))}renderLayer(t,n,s,r=w/2,o=w,d=G,f=!1){if(!this.currentTilemap)return;const p=this.currentTilemap.layers[n];if(!p||p.visible===!1)return;const y=s*p.parallaxFactor,m=this.currentTilemap.tileSize;let _=0,S=0;if(f||this.isDesignModeActive()){const fe=zo();fe&&(_=fe.getDesignScrollX(),S=fe.getTerrainHorizontalOffset())}else{const fe=o/2,re=(r-fe)/fe,ce=Vn(this.currentCampaign,this.currentLevel),_e=this.getEffectiveTerrainWidthForRendering(!1);let Je=bt.MAX_PARALLAX_OFFSET;ce&&(Je=gl(_e,ce.leftX,ce.rightX,o)),_=Math.floor(re*Je);const U=zo();U&&(S=U.getTerrainHorizontalOffset())}const R=this.currentTilemap.height*m,b=Math.ceil(this.currentTilemap.width/un),x=Math.ceil(this.currentTilemap.height/un),L=R-y,O=L-d,I=Math.floor(O/Hi),Y=Math.ceil(L/Hi),W=this.getEffectiveTerrainWidthForRendering(f),Z=Math.floor((W-o)/2),K=Z+_-S,Q=K+o,me=Math.max(0,Math.floor(K/Hi)-1),pe=Math.min(b,Math.ceil(Q/Hi)+1);for(let fe=I;fe<=Y;fe++){let re=fe%x;re<0&&(re+=x);for(let ce=me;ce<=pe;ce++){if(ce<0||ce>=b)continue;const _e=this.getChunk(p,n,ce,re);if(!_e)continue;const Je=fe*Hi,U=d-(L-Je),se=ce*Hi-Z-_+S;t.drawImage(_e,se,U,Hi+1,Hi+1)}}}render(t,n,s=w/2,r,o=!1){if(!this.currentTilemap)return;const d=r||[Gi.BACKGROUND,Gi.TERRAIN,Gi.DECORATION];for(const f of d)this.renderLayer(t,f,n,s,w,G,o)}renderBackground(t,n,s=w/2,r=!1){this.renderLayer(t,Gi.BACKGROUND,n,s,w,G,r)}renderTerrain(t,n,s=w/2,r=!1){this.renderLayer(t,Gi.TERRAIN,n,s,w,G,r)}renderDecoration(t,n,s=w/2,r=!1){this.renderLayer(t,Gi.DECORATION,n,s,w,G,r)}getTileAt(t,n,s){var f,p;if(!this.currentTilemap)return null;const r=this.currentTilemap.layers[s];if(!r)return null;const o=Math.floor(t/this.currentTilemap.tileSize),d=Math.floor(n/this.currentTilemap.tileSize);return d<0||d>=r.tiles.length||o<0||o>=(((f=r.tiles[0])==null?void 0:f.length)||0)?null:((p=r.tiles[d])==null?void 0:p[o])||null}hasCollision(t,n){return this.getTileAt(t,n,Gi.COLLISION)!==null}setTileAt(t,n,s,r){var d;if(!this.currentTilemap)return;const o=this.currentTilemap.layers[s];o&&(n<0||n>=o.tiles.length||t<0||t>=(((d=o.tiles[0])==null?void 0:d.length)||0)||(o.tiles[n][t]=r,this.markTileDirty(t,n)))}clearCache(){this.chunks.clear(),this.dirtyChunks.clear(),this.tileCache.clear(),console.log("[TilemapRenderer] Cache cleared")}clearAll(){this.chunks.clear(),this.dirtyChunks.clear(),this.tileCache.clear(),this.tilesets.clear(),console.log("[TilemapRenderer] All caches including tilesets cleared")}getDebugInfo(){return{chunks:this.chunks.size,tiles:this.tileCache.size,tilesets:this.tilesets.size}}}const Ia=new h_,d_={[As.SPAWN_TANK]:{entityType:A.SUPPLY_CONVOY,hp:50,scoreValue:100},[As.SPAWN_TRUCK]:{entityType:A.SUPPLY_CONVOY,hp:30,scoreValue:50},[As.SPAWN_AA_VEHICLE]:{entityType:A.AA_EMPLACEMENT,hp:40,fireRate:60,scoreValue:150},[As.TURRET_MG]:{entityType:A.AA_EMPLACEMENT,hp:50,fireRate:30,scoreValue:100},[As.TURRET_AA]:{entityType:A.AA_EMPLACEMENT,hp:75,fireRate:45,scoreValue:150},[As.TURRET_CANNON]:{entityType:A.FORTRESS,hp:100,fireRate:90,scoreValue:200}};class f_{constructor(){this.spawnedTiles=new Set,this.spawnedEntities=[],this.triggeredSpawns=new Set,this.activeStructures=new Map,this.levelData=null,this.tilemap=null,this.entityIdCounter=0}loadLevel(t){this.levelData=t,this.tilemap=t.tilemap,this.reset();for(const n of t.structures){const s=Jg[n.structureId];if(s){const r=`${n.tileX}:${n.tileY}`;this.activeStructures.set(r,{structureId:n.structureId,tileX:n.tileX,tileY:n.tileY,hp:n.hp||s.hp||100})}}console.log(`[TilemapEntityManager] Loaded level ${t.id} with ${t.structures.length} structures`)}reset(){this.spawnedTiles.clear(),this.spawnedEntities=[],this.triggeredSpawns.clear(),this.activeStructures.clear(),this.entityIdCounter=0}generateEntityId(){return`tile_entity_${++this.entityIdCounter}`}getTileKey(t,n){return`${t}:${n}`}processVisibleTiles(t,n,s){var _,S;if(!this.tilemap)return;const r=this.tilemap.tileSize,o=((_=this.tilemap.layers[Gi.ENTITY])==null?void 0:_.parallaxFactor)||.6,d=t*o,f=d+G+r*2,p=Math.max(0,Math.floor(d/r)-1),y=Math.min(this.tilemap.height-1,Math.ceil(f/r)+1),m=this.tilemap.layers[Gi.ENTITY];if(m)for(let R=p;R<=y;R++)for(let b=0;b<this.tilemap.width;b++){const x=this.getTileKey(b,R);if(this.spawnedTiles.has(x))continue;const N=(S=m.tiles[R])==null?void 0:S[b];if(!N)continue;const L=d_[N.id];if(!L)continue;this.spawnedTiles.add(x);const O=b*r+r/2,I=R*r,Y=this.createGroundEntity(L.entityType,O,I/o,L.hp,L.fireRate,L.scoreValue);this.spawnedEntities.push({tileX:b,tileY:R,entityId:Y.id}),s(Y)}}processSpawnTriggers(t,n){if(this.levelData)for(const s of this.levelData.spawnTriggers)this.triggeredSpawns.has(s.id)||s.triggerType==="scroll_position"&&s.triggerY!==void 0&&t>=s.triggerY&&(this.triggeredSpawns.add(s.id),this.executeTrigger(s,n))}executeTrigger(t,n){var r,o;console.log(`[TilemapEntityManager] Executing trigger: ${t.id}`);const s=((r=this.tilemap)==null?void 0:r.tileSize)||Yi.tileSize;for(let d=0;d<t.count;d++){const f=t.spawnX*(((o=this.tilemap)==null?void 0:o.width)||10)*s,p=(t.spawnY||0)-50;let y=0;t.formation&&(y=(d-Math.floor(t.count/2))*t.formation.spacing);const m={id:this.generateEntityId(),type:t.entityType,pos:{x:f+y,y:p},vel:{vx:0,vy:3},size:this.getEntitySize(t.entityType),hp:this.getEntityHP(t.entityType),active:!0,frame:0,altitude:t.altitude,scoreValue:this.getEntityScore(t.entityType)};t.formation&&t.delay?setTimeout(()=>n(m),d*t.formation.delay*16):n(m)}}createGroundEntity(t,n,s,r,o,d){const f=this.getEntitySize(t);return{id:this.generateEntityId(),type:t,pos:{x:n-f.width/2,y:s},vel:{vx:0,vy:0},size:f,hp:r||this.getEntityHP(t),active:!0,frame:0,altitude:Wt.LOW_ALTITUDE,scoreValue:d||this.getEntityScore(t)}}getEntitySize(t){switch(t){case A.SUPPLY_CONVOY:return{width:48,height:32};case A.AA_EMPLACEMENT:return{width:40,height:40};case A.FORTRESS:return{width:96,height:96};case A.ENEMY_SMALL:return{width:48,height:48};case A.ENEMY_RED:return{width:48,height:48};case A.ENEMY_BIG:return{width:64,height:64};case A.ENEMY_HELICOPTER:return{width:56,height:56};default:return{width:48,height:48}}}getEntityHP(t){switch(t){case A.SUPPLY_CONVOY:return 30;case A.AA_EMPLACEMENT:return 50;case A.FORTRESS:return 200;case A.ENEMY_SMALL:return 10;case A.ENEMY_RED:return 15;case A.ENEMY_BIG:return 40;case A.ENEMY_HELICOPTER:return 25;default:return 20}}getEntityScore(t){switch(t){case A.SUPPLY_CONVOY:return 100;case A.AA_EMPLACEMENT:return 150;case A.FORTRESS:return 500;case A.ENEMY_SMALL:return 50;case A.ENEMY_RED:return 75;case A.ENEMY_BIG:return 150;case A.ENEMY_HELICOPTER:return 100;default:return 50}}getCurrentAltitudeZone(t){if(!this.levelData)return null;const n=t*.6;for(const s of this.levelData.altitudeZones)if(n>=s.startY&&n<=s.endY)return s;return null}handleTileDestruction(t,n,s){var f;if(!this.tilemap)return null;const r=this.tilemap.layers[s];if(!r)return null;const o=(f=r.tiles[n])==null?void 0:f[t];if(!o)return null;const d=Hy.find(p=>p.tileId===o.id);return!d||d.type!=="destroyable"?null:(r.tiles[n][t]=null,{scoreValue:d.scoreValue||10,dropsPowerup:d.dropsPowerup||!1})}damageStructure(t,n,s){for(const[r,o]of this.activeStructures){const d=Jg[o.structureId];if(d&&t>=o.tileX&&t<o.tileX+d.widthTiles&&n>=o.tileY&&n<o.tileY+d.heightTiles)return o.hp-=s,o.hp<=0?(this.activeStructures.delete(r),{destroyed:!0,scoreValue:d.scoreValue||200,dropsPowerup:d.dropsPowerup||!1}):{destroyed:!1,scoreValue:0,dropsPowerup:!1}}return null}cullOffscreenEntities(t,n){const s=t-G;return n.filter(r=>r.id.startsWith("tile_entity_")?!(r.pos.y<s-200):!0)}getDebugInfo(){return{spawnedTiles:this.spawnedTiles.size,activeStructures:this.activeStructures.size,triggeredSpawns:this.triggeredSpawns.size}}}const tc=new f_,Ts=new Map,vs=new Map;function ed(c,t){return`${c}_${t}`}let $o=!1,Ss=null;async function g_(c,t){const n=c??Ee.STEEL_VANGUARD,s=t??1;if($o&&Ss===n){console.log(`[TILEMAP] Terrain already loaded for campaign: ${n}`);return}Ss!==null&&Ss!==n&&(console.log(`[TILEMAP] Switching campaigns: ${Ss} -> ${n}`),vs.clear(),Ts.clear(),Ia.clearAll(),Ta.clearCache(),$o=!1),console.log(`[TILEMAP] Initializing tilemap system for campaign: ${n}, level: ${s}...`);const r=ed(n,s),o=await Ta.generateForCampaignAsync(n,s);vs.set(r,o),Ia.registerTileset(`terrain_level_${s}`,o.tileset),$o=!0,Ss=n,console.log(`[TILEMAP] Tilemap system initialized for campaign: ${n}, level: ${s}`)}function Vp(c,t){var _;const{tileGrid:n}=t,s=n.length,r=((_=n[0])==null?void 0:_.length)||Yi.mapWidthTiles,o={tiles:n.map(S=>S.map(R=>({id:R}))),parallaxFactor:1,visible:!0},d={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!0},f={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!1},p={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!0},y={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!1},m={width:r,height:s,tileSize:Yi.tileSize,tilesetId:`terrain_level_${c}`,layers:[o,d,f,p,y]};return{level:c,tilemap:m,spawnTriggers:[],structures:[]}}async function Bh(c,t){Ia.clearCache();const n=t??Ss??Ee.STEEL_VANGUARD;Ia.setLevelContext(n,c),dt.setLevelContext(n,c),$t.setLevelContext(n,c);const s=ed(n,c);console.log(`[TILEMAP] Loading terrain for ${n} level ${c}...`);let r=vs.get(s);if(r||(r=await Ta.generateForCampaignAsync(n,c),vs.set(s,r)),Ia.registerTileset(`terrain_level_${c}`,r.tileset),Ts.has(s)){const d=Ts.get(s);return Ia.loadTilemap(d.tilemap),tc.loadLevel(d),console.log(`[TILEMAP] Loaded cached tilemap for ${n} level ${c}`),d}const o=Vp(c,r);return Ts.set(s,o),Ia.loadTilemap(o.tilemap),tc.loadLevel(o),console.log(`[TILEMAP] Level ${c} tilemap ready: ${o.tilemap.width}x${o.tilemap.height} tiles`),o}function _p(c,t){console.log(`[TILEMAP] loadLevelTilemap called: level=${c}, campaign=${t}`),Ia.clearCache();const n=t??Ss??Ee.STEEL_VANGUARD,s=ed(n,c);console.log(`[TILEMAP] targetCampaign=${n}, cacheKey=${s}`),Ia.setLevelContext(n,c),dt.setLevelContext(n,c),$t.setLevelContext(n,c);let r=vs.get(s);if(!r){const d=Ta.getCampaignCached(n,c);d&&(r=d,vs.set(s,r))}if(r&&Ia.registerTileset(`terrain_level_${c}`,r.tileset),Ts.has(s)){const d=Ts.get(s);return Ia.loadTilemap(d.tilemap),tc.loadLevel(d),console.log(`[TILEMAP] Loaded cached tilemap for ${n} level ${c}`),d}if(!r)return console.log(`[TILEMAP] Terrain not cached for ${n} level ${c}, starting async load...`),Ta.generateForCampaignAsync(n,c).then(f=>{vs.set(s,f),Ia.registerTileset(`terrain_level_${c}`,f.tileset),console.log(`[TILEMAP] Terrain for ${n} level ${c} now cached`)}),{level:c,tilemap:{width:Yi.mapWidthTiles,height:Yi.mapHeightTiles,tileSize:Yi.tileSize,tilesetId:`terrain_level_${c}`,layers:[]},spawnTriggers:[],structures:[]};const o=Vp(c,r);return Ts.set(s,o),Ia.loadTilemap(o.tilemap),tc.loadLevel(o),console.log(`[TILEMAP] Level ${c} tilemap ready: ${o.tilemap.width}x${o.tilemap.height} tiles`),o}function Ap(c,t,n=w/2,s=!1){Ia.renderBackground(c,t,n,s)}function Sp(c,t,n=w/2,s=!1){Ia.renderTerrain(c,t,n,s)}function Fh(){return $o}const qh="/dist-assets";console.log(`[DestroyedOverlayRenderer] ASSET_BASE_PATH=${qh}, PROD=true`);const ul=new Map,cn=new Set;class p_{constructor(){this.campaign="",this.level=0,this.totalMapHeight=0,this.overlays=[],this.revealedOverlays=new Map,this.baseOffsetX=0}setLevelContext(t,n,s){this.campaign=t,this.level=n,this.totalMapHeight=s;const r=ca(t,n);this.baseOffsetX=Math.floor((r.mapWidthExtended-w)/2),this.overlays=Bp(t,n),this.revealedOverlays.clear(),this.preloadOverlayImages(),console.log(`[DestroyedOverlayRenderer] Loaded ${this.overlays.length} overlays for ${t} level ${n}`)}getDynamicParallaxOffsetForPlayer(t){const n=Vn(this.campaign,this.level);if(n){const s=Ta.getDetectedTerrainWidth(this.campaign,this.level),r=ca(this.campaign,this.level),o=s??r.mapWidthExtended,d=gl(o,n.leftX,n.rightX,w),f=w/2,p=(t-f)/f;return Math.floor(p*d)}return ic(t,w)}preloadOverlayImages(){for(const t of this.overlays)if(!ul.has(t.id)&&!cn.has(t.id)){cn.add(t.id);const n=new Image;n.onload=()=>{ul.set(t.id,n),cn.delete(t.id),console.log(`[DestroyedOverlayRenderer] Preloaded overlay: ${t.id}`)},n.onerror=r=>{cn.delete(t.id),console.error(`[DestroyedOverlayRenderer] Failed to preload overlay: ${n.src}`,r)};const s=`${qh}/${t.imagePath}`;console.log(`[DestroyedOverlayRenderer] Preloading from: ${s}`),n.src=s}}async preloadAllImages(){if(this.overlays.length===0)return;console.log(`[DestroyedOverlayRenderer] Preloading ${this.overlays.length} overlay images...`);const t=this.overlays.map(n=>new Promise(s=>{if(ul.has(n.id)){s();return}if(cn.has(n.id)){const d=setInterval(()=>{(ul.has(n.id)||!cn.has(n.id))&&(clearInterval(d),s())},50);return}cn.add(n.id);const r=new Image;r.onload=()=>{ul.set(n.id,r),cn.delete(n.id),console.log(`[DestroyedOverlayRenderer] Loaded overlay: ${n.id}`),s()},r.onerror=d=>{cn.delete(n.id),console.error(`[DestroyedOverlayRenderer] Failed to load overlay: ${r.src}`,d),s()};const o=`${qh}/${n.imagePath}`;console.log(`[DestroyedOverlayRenderer] Loading image: ${o}`),r.src=o}));await Promise.all(t),console.log(`[DestroyedOverlayRenderer] All ${this.overlays.length} overlay images preloaded`)}checkAndRevealForDestroyedTargets(t){for(const n of t){const s=ep(this.campaign,this.level,n);s&&!this.revealedOverlays.has(s.id)&&this.revealOverlay(s)}}revealOverlay(t){const n=ul.get(t.id);n?(this.revealedOverlays.set(t.id,{overlay:t,image:n,revealTime:performance.now(),fadeInProgress:0}),console.log(`[DestroyedOverlayRenderer] Revealed overlay: ${t.id} (linked to ${t.linkedTargetId})`)):console.warn(`[DestroyedOverlayRenderer] Cannot reveal overlay ${t.id}: image not loaded`)}revealOverlayForTarget(t){const n=ep(this.campaign,this.level,t);n&&this.revealOverlay(n)}update(t){for(const s of this.revealedOverlays.values())if(s.fadeInProgress<1){const r=performance.now()-s.revealTime;s.fadeInProgress=Math.min(1,r/500)}}render(t,n,s){if(this.revealedOverlays.size===0)return;const r=this.totalMapHeight-n;t.save();for(const o of this.revealedOverlays.values()){const{overlay:d,image:f,fadeInProgress:p}=o,{cropArea:y}=d,m=this.getDynamicParallaxOffsetForPlayer(s),_=y.x-this.baseOffsetX-m,S=G-(r-y.y),R=G-(r-(y.y+y.height)),b=Math.min(S,R),x=Math.max(S,R),N=x-b;b>G+50||x<-50||_>w+50||_+y.width<-50||(t.globalAlpha=p,t.drawImage(f,_,b,y.width,N))}t.restore()}reset(){this.revealedOverlays.clear()}isOverlayRevealed(t){return this.revealedOverlays.has(t)}getRevealedCount(){return this.revealedOverlays.size}getTotalOverlays(){return this.overlays.length}}const pr=new p_,Tp=Object.assign({}),Hh=Object.assign({"../data/generated/maps/campaigns/dawn-patrol-1_combined_metadata.json":()=>zt(()=>import("./dawn-patrol-1_combined_metadata-uFdTddyA.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-2_combined_metadata.json":()=>zt(()=>import("./dawn-patrol-2_combined_metadata-qhkigtIS.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-3_combined_metadata.json":()=>zt(()=>import("./dawn-patrol-3_combined_metadata-DKAThoaN.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-4_combined_metadata.json":()=>zt(()=>import("./dawn-patrol-4_combined_metadata-BFXl99t6.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-5_combined_metadata.json":()=>zt(()=>import("./dawn-patrol-5_combined_metadata-CAmGGX5N.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-1_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-1_combined_metadata-CKGhBMD_.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-2_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-2_combined_metadata-CW-zkVym.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-3_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-3_combined_metadata-OLnkna3i.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-4_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-4_combined_metadata-DIZaaKOV.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-5_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-5_combined_metadata-R-AoW6iY.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-6_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-6_combined_metadata-Cwvrsig9.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-7_combined_metadata.json":()=>zt(()=>import("./hellfire-horizon-7_combined_metadata-CKdUWefK.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-1_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-1_combined_metadata-CwCKkbOh.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-2_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-2_combined_metadata-B4830iwU.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-3_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-3_combined_metadata-BFb0beKi.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-4_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-4_combined_metadata-BHOCbtsV.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-5_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-5_combined_metadata-DiPkbG6M.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-6_combined_metadata.json":()=>zt(()=>import("./steel-vanguard-6_combined_metadata-BQ-_5Hdl.js"),[])}),vp=Object.assign({"../data/generated/maps/level1_combined_metadata.json":()=>zt(()=>import("./level1_combined_metadata-DEg4OSmK.js"),[]),"../data/generated/maps/level2_combined_metadata.json":()=>zt(()=>import("./level2_combined_metadata-ByJ4iVlt.js"),[]),"../data/generated/maps/level3_combined_metadata.json":()=>zt(()=>import("./level3_combined_metadata-CYIMHv7w.js"),[]),"../data/generated/maps/level4_combined_metadata.json":()=>zt(()=>import("./level4_combined_metadata-DukPmzVA.js"),[]),"../data/generated/maps/level5_combined_metadata.json":()=>zt(()=>import("./level5_combined_metadata-BUA17aNz.js"),[])});class m_{constructor(){this.state=te.ATTRACT,this.campaign=Ee.STEEL_VANGUARD,this.difficulty=gt.NORMAL,this.entities=[],this.score=0,this.finalScore=0,this.highScore=1e4,this.lives=3,this.frameCount=0,this.waveTimer=0,this.credits=0,this.totalCreditsRemaining=10,this.pausedFromState=te.PLAYING,this.pauseSelection=0,this.screenShake=0,this.camera={x:0,y:0,zoom:1,targetZoom:1,rotation:0,targetRotation:0,smoothing:.2},this.timeScale=1,this.targetTimeScale=1,this.freezeFrames=0,this.logicFrame=0,this.level=1,this.levelProgress=0,this.intermissionTimer=0,this.intermissionScrollY=0,this.intermissionFadeAlpha=0,this.intermissionPhase="stats",this.intermissionLoading=!1,this.intermissionIsFinalLevel=!1,this.intermissionCachedProgress=null,this.INTERMISSION_DURATION=300,this.INTERMISSION_FADE_DURATION=30,this.INTERMISSION_SCROLL_SPEED=1.5,this.bossEngine=new UE,this.activeBoss=null,this.bossIntroTimer=0,this.bossIntroStartFrame=0,this.bossDefeating=!1,this.crashingBoss=null,this.bossCrashTimer=0,this.bossCrashRotation=0,this.nextStateAfterDebrief=te.GAME_OVER,this.postProcessing=new Gp,this.combo=0,this.comboTimer=0,this.COMBO_TIMEOUT=180,this.LEVEL_DURATION=1800,this.heatPoints=0,this.heatLevel=Ut.COLD,this.heatDecayTimer=0,this.lastHeatLevel=Ut.COLD,this.lastScoreMilestone=0,this.lastComboMilestone=0,this.floatingScores=[],this.lingeringFireZones=[],this.pendingScores=[],this.pendingScoreTimer=0,this.SCORE_BUNDLE_WINDOW=12,this.playerEvading=!1,this.evadeTimer=0,this.firepowerBullets=0,this.firepowerStacks=0,this.activeFirepowerTier=$a.STANDARD,this.spreadBullets=0,this.spreadStacks=0,this.spreadDropsCompleted=[],this.bombQueue=[],this.bombCooldown=0,this.bombActiveFrame=-100,this.playerInvincible=0,this.playerHealth=100,this.maxPlayerHealth=100,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.invincibilityCount=0,this.gameOverTimer=0,this.powerupLegendTimer=0,this.nextLevelPreloaded=!1,this.autoZoomEnabled=!0,this.actionDensity=0,this.currentZoomState=Wa.CALM,this.zoomOverride=Oa.NONE,this.zoomOverrideTimer=0,this.nearDeathActive=!1,this.bulletHellActive=!1,this.previousDensity=0,this.debugMode=!1,this.playerAltitude=2,this.targetAltitude=2,this.altitudeTransitionTimer=0,this.diveBombChargeTimer=0,this.isTransitioningAltitude=!1,this.autoClimbTimer=0,this.currentLevelMap=null,this.spawnedEntityIds=new Set,this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.tilemapEnabled=!0,this.tilemapScrollY=0,this.waterZones=[],this.roadZones=[],this.landZones=[],this.mapElements=[],this.entityPaths=[],this.pathSpawnTimers=new Map,this.reset()}get MAX_LEVEL(){return Kh(this.campaign)}get bombCount(){return this.bombQueue.length}get firepowerCount(){return this.standardFirepowerCount+this.enhancedFirepowerCount}setCampaign(t){switch(this.campaign=t,this.bossEngine.setCampaign(t),Se.setCampaign(t),t){case Ee.DAWN_PATROL:this.difficulty=gt.BEGINNER;break;case Ee.STEEL_VANGUARD:this.difficulty=gt.NORMAL;break;case Ee.HELLFIRE_HORIZON:this.difficulty=gt.VETERAN;break}}setDifficulty(t){switch(t){case gt.BEGINNER:this.setCampaign(Ee.DAWN_PATROL);break;case gt.NORMAL:this.setCampaign(Ee.STEEL_VANGUARD);break;case gt.VETERAN:this.setCampaign(Ee.HELLFIRE_HORIZON);break}}getDifficultyMultiplier(){const t=gr(this.campaign,this.level),n=sa.getEnemySpeedMultiplier()/.8,s=sa.getEnemyFireRateMultiplier()/.8;return{...t,speed:t.speed*n,fireRate:t.fireRate*s}}getCampaignTurretHPMult(){return this.campaign===Ee.DAWN_PATROL?1.3:this.campaign===Ee.HELLFIRE_HORIZON?1.7:1.5}getEnemyMaxHP(t){const n=this.getDifficultyMultiplier();switch(t){case A.ENEMY_SMALL:case A.ENEMY_RED:return this.campaign===Ee.HELLFIRE_HORIZON?6:this.campaign===Ee.STEEL_VANGUARD?4:3;case A.ENEMY_HELICOPTER:return Math.floor(12*n.enemyHP);case A.ENEMY_BIG:return Math.floor(35*n.enemyHP);case A.ENEMY_BATTLESHIP:return Math.floor(170*n.enemyHP);case A.ENEMY_TANK:return Math.floor(50*n.enemyHP);case A.ENEMY_LARGE_TANK:return Math.floor(95*n.enemyHP);default:return 10}}reset(){this.entities=[],this.score=0,this.finalScore=0,this.lives=3+this.credits,this.bombQueue=[fa.STANDARD,fa.STANDARD,fa.STANDARD],this.bombCooldown=0,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.invincibilityCount=0,this.frameCount=0,this.waveTimer=0,this.firepowerBullets=0,this.firepowerStacks=0,this.activeFirepowerTier=$a.STANDARD,this.spreadBullets=0,this.spreadStacks=0,this.spreadDropsCompleted=[],this.bombActiveFrame=-100,this.screenShake=0;const t=parseInt("0",10);switch(t>0&&t<=this.MAX_LEVEL?(this.level=t,console.log(`[GameEngine] CHEAT: Skipping to level ${t}`)):this.level=1,this.levelProgress=0,this.tilemapScrollY=0,zn.setCampaign(this.campaign,this.level),this.waterZones=[],this.landZones=[],this.mapElements=[],dt.reset(),$t.reset(),this.playerAltitude=Wt.HIGH_ALTITUDE,this.targetAltitude=Wt.HIGH_ALTITUDE,this.altitudeTransitionTimer=0,this.diveBombChargeTimer=0,this.isTransitioningAltitude=!1,this.autoClimbTimer=0,this.difficulty){case gt.BEGINNER:this.maxPlayerHealth=300;break;case gt.NORMAL:this.maxPlayerHealth=200;break;case gt.VETERAN:this.maxPlayerHealth=100;break}this.playerHealth=this.maxPlayerHealth,this.spawnPlayer()}insertCoin(){this.totalCreditsRemaining>0&&(this.credits++,this.totalCreditsRemaining--,Se.playCoin())}startGame(){this.credits>0&&(this.state=te.STORY,this.gameOverTimer=0,this.reset(),this.credits=0,Se.init())}pause(){(this.state===te.PLAYING||this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE)&&(this.pausedFromState=this.state,this.state=te.PAUSED,this.pauseSelection=0)}resume(){this.state===te.PAUSED&&(this.state=this.pausedFromState)}quitToTitle(){if(this.state===te.PAUSED){const t=Math.max(0,this.lives-3);this.totalCreditsRemaining+=t,this.state=te.ATTRACT,zn.clear()}}isDesignModeAvailable(){return Si}isDesignModeEnabled(){return V.isEnabled()}toggleDesignMode(){if(!Si)return console.warn("[DESIGN MODE] Not available - VITE_DESIGN_TIME not set"),this.state;V.setLevelContext(this.campaign,this.level),V.setEntityPaths(this.entityPaths);const t=V.toggleDesignMode(this.state,this.tilemapScrollY);return this.state=t,t}getDesignModeManager(){return V}async switchDesignModeLevel(t){if(!Si||this.state!==te.DESIGN_MODE)return console.warn("[DESIGN MODE] Cannot switch level - not in design mode"),!1;if(V.resetForLevelSwitch(),this.level=t,V.setLevelContext(this.campaign,t),dt.setLevelContext(this.campaign,t),$t.setLevelContext(this.campaign,t),V.loadCompiledOverrides(),this.tilemapScrollY=0,this.tilemapEnabled)try{await Bh(t,this.campaign),console.log(`[DESIGN MODE] Loaded tilemap for ${this.campaign} level ${t}`)}catch(n){return console.warn(`[DESIGN MODE] Failed to load tilemap for ${this.campaign} level ${t}:`,n),!1}return await this.loadLevelMap(t),V.setEntityPaths(this.entityPaths),console.log(`[DESIGN MODE] Switched to ${this.campaign} level ${t}`),!0}getPathHorizontalOffset(t){if(Si&&V.isEnabled()){const n=V.getPendingChanges();if(n.pathOverrides[t])return n.pathOverrides[t].horizontalOffset}return Xy(this.campaign,this.level,t)}getEffectiveScrollY(){return this.state===te.DESIGN_MODE?V.getDesignScrollY():this.state===te.LEVEL_COMPLETE?this.intermissionPhase==="fadeIn"?this.tilemapScrollY:this.intermissionScrollY:this.tilemapScrollY}clearEntitiesForIntermission(){this.entities=this.entities.filter(t=>t.type===A.PLAYER),Te.clear(),this.activeBoss=null}startIntermission(t=!1){if(this.state=te.LEVEL_COMPLETE,this.intermissionTimer=this.INTERMISSION_DURATION,this.intermissionScrollY=this.tilemapScrollY,this.intermissionFadeAlpha=0,this.intermissionPhase="stats",this.intermissionLoading=!1,this.intermissionIsFinalLevel=t,this.intermissionCachedProgress=$t.getLevelProgress(),this.clearEntitiesForIntermission(),this.bossDefeating=!1,t&&(this.finalScore=this.score),!t&&this.level<this.MAX_LEVEL){const n=this.level+1;console.log(`[INTERMISSION] Preloading level ${n} assets...`);const s=`../data/generated/level${n}.json`,r=Tp[s];r&&r().then(()=>{console.log(`[INTERMISSION] Level ${n} JSON preloaded`)}).catch(p=>{console.warn("[INTERMISSION] Level JSON preload failed:",p)});const d=`../data/generated/maps/campaigns/${this.campaign.toLowerCase().replace(/_/g,"-")}-${n}_combined_metadata.json`,f=Hh[d];f&&f().then(()=>{console.log(`[INTERMISSION] Level ${n} metadata preloaded`)}).catch(p=>{console.warn("[INTERMISSION] Metadata preload failed:",p)}),Bh(n,this.campaign).then(()=>{console.log(`[INTERMISSION] Level ${n} tilemap preloaded`)}).catch(p=>{console.warn("[INTERMISSION] Tilemap preload failed:",p)}),Jo(n).catch(p=>{console.warn("[INTERMISSION] Boss asset preload failed:",p)})}}async updateIntermission(){if(this.state===te.LEVEL_COMPLETE){if(this.intermissionScrollY+=this.INTERMISSION_SCROLL_SPEED,this.intermissionPhase==="stats")this.intermissionTimer--,this.intermissionTimer<=0&&(this.intermissionPhase="fadeOut",this.intermissionFadeAlpha=0);else if(this.intermissionPhase==="fadeOut")this.intermissionFadeAlpha+=1/this.INTERMISSION_FADE_DURATION,this.intermissionFadeAlpha>=1&&!this.intermissionLoading&&(this.intermissionFadeAlpha=1,this.intermissionLoading=!0,this.intermissionIsFinalLevel?(this.postProcessing.reset(),this.intermissionLoading=!1,console.log("[INTERMISSION] Final level complete - transitioning to VICTORY"),this.state=te.VICTORY):(this.level++,this.levelProgress=0,this.tilemapScrollY=0,this.nextLevelPreloaded=!1,this.spreadDropsCompleted=[],zn.setCampaign(this.campaign,this.level),await this.loadLevelMap(this.level),this.tilemapEnabled&&(Ta.hasCampaignCached(this.campaign,this.level)?_p(this.level,this.campaign):await Bh(this.level,this.campaign)),Jo(this.level).catch(t=>console.error("[LAZY] Failed to load boss for level",this.level,t)),Se.playLevelMusic(this.level,this.campaign),this.postProcessing.reset(),this.intermissionLoading=!1,this.intermissionPhase="fadeIn"));else if(this.intermissionPhase==="fadeIn"&&(this.intermissionFadeAlpha-=1/this.INTERMISSION_FADE_DURATION,this.intermissionFadeAlpha<=0)){this.intermissionFadeAlpha=0,this.state=te.PLAYING,this.playerInvincible=54;for(let t=0;t<2&&this.bombQueue.length<Et.MAX_BOMBS;t++)this.bombQueue.push(fa.STANDARD)}}}async startMission(){await this.loadLevelMap(this.level),this.state=te.PLAYING,this.powerupLegendTimer=180,this.playerInvincible=54;for(let t=0;t<2&&this.bombQueue.length<Et.MAX_BOMBS;t++)this.bombQueue.push(fa.STANDARD);if(console.log(`[TILEMAP] tilemapEnabled=${this.tilemapEnabled}, campaign=${this.campaign}, level=${this.level}`),this.tilemapEnabled)try{console.log("[TILEMAP] About to call loadLevelTilemap..."),_p(this.level,this.campaign),this.tilemapScrollY=0,console.log(`[TILEMAP] Loaded tilemap for ${this.campaign} level ${this.level}`)}catch(t){console.warn(`[TILEMAP] Failed to load tilemap for ${this.campaign} level ${this.level}:`,t)}else console.log("[TILEMAP] Tilemap is DISABLED, skipping terrain load");Se.playLevelMusic(this.level,this.campaign)}async loadLevelMap(t){var n,s,r;try{const o=`../data/generated/level${t}.json`,d=Tp[o];if(d){const f=await d();this.currentLevelMap=f.default||f,this.spawnedEntityIds.clear(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.playerAltitude=Wt.HIGH_ALTITUDE,this.targetAltitude=Wt.HIGH_ALTITUDE,this.isTransitioningAltitude=!1,console.log(`[LEVEL MAP] Loaded level ${t}: ${(n=this.currentLevelMap)==null?void 0:n.name}`),console.log(`[LEVEL MAP] Spawns: ${(s=this.currentLevelMap)==null?void 0:s.spawns.length}, Altitude zones: ${(r=this.currentLevelMap)==null?void 0:r.altitudeZones.length}`)}else console.log(`[LEVEL MAP] No level${t}.json found, using procedural spawning`),this.currentLevelMap=null,this.spawnedEntityIds.clear(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.playerAltitude=Wt.HIGH_ALTITUDE,this.targetAltitude=Wt.HIGH_ALTITUDE,this.isTransitioningAltitude=!1}catch(o){console.warn(`[LEVEL MAP] Failed to load level ${t}, using procedural spawning:`,o),this.currentLevelMap=null}await this.loadTerrainMetadata(t)}async loadTerrainMetadata(t){const n=bt.TOTAL_MAP_HEIGHT,r=`../data/generated/maps/campaigns/${this.campaign.toLowerCase().replace(/_/g,"-")}-${t}_combined_metadata.json`,o=`../data/generated/maps/level${t}_combined_metadata.json`;Hh[r]?await this.loadMetadataFromPath(r,!0,t,n):vp[o]?await this.loadMetadataFromPath(o,!1,t,n):(this.waterZones=[],this.landZones=[],this.mapElements=[],dt.reset(),console.log(`[TERRAIN] ${this.campaign} Level ${t}: No metadata found, using unrestricted spawning`))}async loadMetadataFromPath(t,n,s,r){dt.setLevelContext(this.campaign,s),$t.setLevelContext(this.campaign,s),pr.setLevelContext(this.campaign,s,r),pr.preloadAllImages().catch(m=>{console.warn("[TERRAIN] Failed to preload destroyed overlays:",m)});let o=[],d=[],f=[],p=[];try{const m=n?Hh[t]:vp[t];if(!m)throw new Error(`No loader found for path: ${t}`);const _=await m(),S=_.default||_;let R=[];if(S&&S.slices)for(const x of S.slices)x.entities&&(R=R.concat(x.entities));if(R.length>0){o=R.filter(N=>N.type==="turret").map(N=>({id:N.id,x:N.x,worldY:N.worldY})),console.log(`[TERRAIN] Level ${s}: Loaded ${o.length} turrets from JSON metadata`);const x=R.filter(N=>N.type==="target").map(N=>({id:N.id,type:"target",shape:"circle",label:N.id,x:N.x,y:r-N.worldY,radius:N.radius||20,normalizedX:N.x/640,normalizedY:(r-N.worldY)/r,targetType:N.targetType,scoreValue:N.points||100}));$t.loadFromMetadata(x,r,s),x.length>0&&console.log(`[TERRAIN] Level ${s}: Loaded ${x.length} mission targets from JSON metadata`)}else console.warn(`[TERRAIN] Level ${s}: No entities in metadata, turrets will be empty`),$t.loadFromMetadata([],r,s);$t.loadAddedTargets(),S&&S.terrainZones&&(d=S.terrainZones.water||[],f=S.terrainZones.road||[],p=S.terrainZones.land||[],console.log(`[TERRAIN] Level ${s}: Loaded ${d.length} water, ${f.length} road, ${p.length} land zones from metadata`)),S&&S.entityPaths&&S.entityPaths.length>0?(this.entityPaths=S.entityPaths.map(x=>({id:x.id,entityType:this.parseEntityType(x.entityType),waypoints:x.waypoints||[],totalLength:x.totalLength||0,speedMultiplier:x.speedMultiplier??1,spawnDelay:x.spawnDelay??0,spawnInterval:x.spawnInterval??600,maxEntities:x.maxEntities??1,loop:x.loop??!1,direction:x.direction||"random",activeEntities:0,nextSpawnFrame:x.spawnDelay??0})),this.pathSpawnTimers.clear(),this.entityPaths.forEach(x=>{this.pathSpawnTimers.set(x.id,x.spawnDelay)}),console.log(`[TERRAIN] Level ${s}: Loaded ${this.entityPaths.length} entity paths from metadata`),this.entityPaths.forEach(x=>{const N=x.waypoints.map(I=>I.x),L=Math.min(...N),O=Math.max(...N);console.log(`[TERRAIN] Path ${x.id}: ${x.waypoints.length} waypoints, X range: ${L.toFixed(1)} to ${O.toFixed(1)} (${(O-L).toFixed(1)}px)`)})):(this.entityPaths=[],this.pathSpawnTimers.clear());const b=jy(this.campaign,this.level);if(b.length>0){for(const x of b){const N=$y(this.campaign,this.level,x.pathId),L=this.parseEntityType((N==null?void 0:N.entityType)||x.entityType),O=(N==null?void 0:N.speed)??x.speed,I=(N==null?void 0:N.direction)??x.direction,Y=(N==null?void 0:N.spawnPoint)??x.spawnPoint,W={id:x.pathId,entityType:L,waypoints:x.waypoints,totalLength:this.calculatePathLength(x.waypoints),speedMultiplier:O,spawnDelay:x.spawnDelay??0,spawnInterval:x.spawnInterval??600,maxEntities:x.maxEntities??1,loop:x.loop??!1,direction:I,spawnPoint:Y,activeEntities:0,nextSpawnFrame:x.spawnDelay??0};this.entityPaths.push(W),this.pathSpawnTimers.set(W.id,W.spawnDelay)}console.log(`[TERRAIN] Level ${s}: Loaded ${b.length} added paths from design overrides`)}}catch(m){console.warn(`[TERRAIN] Level ${s}: Failed to load metadata JSON, using fallback zones:`,m)}d.length>0?this.waterZones=d.map(m=>({id:m.id,type:"water",shape:"rect",label:m.label||m.id,x:m.x,y:m.y,width:m.width,height:m.height,normalizedX:m.x/w,normalizedY:m.y/r,isSpawnZone:!0,allowedSpawns:[A.ENEMY_BATTLESHIP]})):(this.waterZones=[],console.log(`[TERRAIN] Level ${s}: No water zones - battleships disabled`)),p.length>0?this.landZones=p.map(m=>({id:m.id,type:"land",shape:"rect",label:m.label||m.id,x:m.x,y:m.y,width:m.width,height:m.height,normalizedX:m.x/w,normalizedY:m.y/r})):this.landZones=[{id:"land_left",type:"land",shape:"rect",label:"land_left",x:90,y:r/2,width:180,height:r,normalizedX:.14,normalizedY:.5}],f.length>0?(this.roadZones=f.map(m=>({id:m.id,type:"road",shape:"rect",label:m.label||m.id,x:m.x,y:m.y,width:m.width,height:m.height,normalizedX:m.x/w,normalizedY:m.y/r,isSpawnZone:!0,allowedSpawns:[A.ENEMY_TANK,A.ENEMY_LARGE_TANK]})),console.log(`[TERRAIN] Level ${s}: ${this.roadZones.length} road zones enabled for tank spawning`)):this.roadZones=[];const y=o.map(m=>({id:m.id,type:"turret",shape:"circle",label:m.id,x:m.x,y:r-m.worldY,radius:8,normalizedX:m.x/640,normalizedY:(r-m.worldY)/r,entityType:A.AA_EMPLACEMENT,hp:15,fireRate:360,scoreValue:200}));this.mapElements=[...this.waterZones,...this.roadZones,...this.landZones,...y],dt.reset(),dt.setLevelContext(this.campaign,s),dt.setTotalMapHeight(r),dt.loadFromMetadata(y,0,r,r),dt.loadAddedTurrets(),console.log(`[TERRAIN] Level ${s}: Loaded ${this.waterZones.length} water, ${this.roadZones.length} road, ${this.landZones.length} land zones, ${y.length} turrets (mapHeight=${r})`)}setCameraZoom(t,n=30){this.camera.targetZoom=Math.max(.5,Math.min(2,t)),this.camera.smoothing=n>0?.15:1}setCameraOffset(t,n){this.camera.x=t,this.camera.y=n}resetCamera(){this.camera.targetZoom=1,this.camera.targetRotation=0,this.camera.x=0,this.camera.y=0}initiateAltitudeTransition(t){var s,r;if(this.playerAltitude===t||this.isTransitioningAltitude)return;this.targetAltitude=t,this.isTransitioningAltitude=!0;const n=t<this.playerAltitude;this.altitudeTransitionTimer=n?Xa.DIVE_TRANSITION_FRAMES:Xa.CLIMB_TRANSITION_FRAMES,this.zoomOverride=n?Oa.DIVE_BOMB:Oa.CLIMB_UP,n?(s=Se.playDive)==null||s.call(Se):(r=Se.playClimb)==null||r.call(Se),console.log(`[ALTITUDE] Transitioning from ${this.playerAltitude} to ${t}`)}startDiveBomb(t){const n=t??Math.max(0,this.playerAltitude-1);this.initiateAltitudeTransition(n)}climbUp(){this.initiateAltitudeTransition(Wt.HIGH_ALTITUDE)}updateAltitudeTransition(){if(!this.isTransitioningAltitude||this.altitudeTransitionTimer<=0)return;this.altitudeTransitionTimer--;const t=this.targetAltitude<this.playerAltitude,n=t?Xa.DIVE_TRANSITION_FRAMES:Xa.CLIMB_TRANSITION_FRAMES,s=1-this.altitudeTransitionTimer/n,r=s<.5?2*s*s:1-Math.pow(-2*s+2,2)/2,o=y=>{switch(y){case Wt.SEA_LEVEL:return Xa.SEA_LEVEL;case Wt.LOW_ALTITUDE:return Xa.LOW_ALTITUDE;case Wt.HIGH_ALTITUDE:return Xa.HIGH_ALTITUDE;default:return 1}},d=o(this.playerAltitude),f=o(this.targetAltitude),p=d+(f-d)*r;if(this.camera.targetZoom=p,t?(this.camera.targetRotation=Xa.DIVE_ROTATION_MAX*(1-s),this.targetTimeScale=Xa.DIVE_TIME_SCALE,this.screenShake=Math.max(this.screenShake,Xa.DIVE_SHAKE_INTENSITY*(1-s))):this.targetTimeScale=Xa.CLIMB_TIME_SCALE,this.altitudeTransitionTimer<=0){this.playerAltitude=this.targetAltitude,this.isTransitioningAltitude=!1,this.camera.targetRotation=0,this.targetTimeScale=1,this.zoomOverride=Oa.NONE,this.autoClimbTimer=0;const y=this.entities.find(m=>m.type===A.PLAYER);y&&(y.altitude=this.playerAltitude),console.log(`[ALTITUDE] Transition complete. Now at altitude ${this.playerAltitude}`)}}canCollideWithAltitude(t,n){return t===n}getDefaultAltitude(t){switch(t){case A.ENEMY_BATTLESHIP:case A.AIRCRAFT_CARRIER:case A.DESTROYER:case A.SUPPLY_SHIP:case A.SUBMARINE:case A.PT_BOAT:case A.WAKE:return Wt.SEA_LEVEL;case A.VILLAGE:case A.FORTRESS:case A.AA_EMPLACEMENT:case A.RADAR_STATION:case A.FUEL_DEPOT:case A.AIRFIELD:case A.SUPPLY_CONVOY:return Wt.LOW_ALTITUDE;case A.PLAYER:case A.ENEMY_SMALL:case A.ENEMY_RED:case A.ENEMY_BIG:case A.ENEMY_HELICOPTER:case A.BOSS:case A.SUPPORT_FIGHTER:case A.BULLET_PLAYER:case A.BULLET_ENEMY:case A.POWERUP:default:return Wt.HIGH_ALTITUDE}}getAltitudeScoreMultiplier(t){return this.playerAltitude===t?1:t===Wt.SEA_LEVEL&&this.playerAltitude<=Wt.LOW_ALTITUDE?Xa.SEA_ATTACK_MULTIPLIER:t===Wt.LOW_ALTITUDE&&this.playerAltitude===Wt.LOW_ALTITUDE?Xa.GROUND_ATTACK_MULTIPLIER:1}calculateActionDensity(){if(!this.autoZoomEnabled)return 0;const t=this.entities.find(m=>m.type===A.PLAYER);if(!t)return 0;const n=this.entities.filter(m=>{if(!m.type.toString().startsWith("ENEMY"))return!1;const _=m.pos.x-t.pos.x,S=m.pos.y-t.pos.y;return Math.sqrt(_*_+S*S)<lt.ENEMY_RADIUS}).length,s=Math.min(1,n/lt.MAX_ENEMIES_NORMALIZE),r=this.entities.filter(m=>{if(m.type!==A.BULLET_CANNON&&m.type!==A.BULLET_ENEMY&&m.type!==A.BULLET_TURRET)return!1;const _=m.pos.x-t.pos.x,S=m.pos.y-t.pos.y;return Math.sqrt(_*_+S*S)<lt.BULLET_RADIUS}).length,o=Math.min(1,r/lt.MAX_BULLETS_NORMALIZE);let d=0;this.activeBoss&&this.activeBoss.vulnerable&&(d=1);const f=1-this.playerHealth/this.maxPlayerHealth,p=Math.min(1,this.combo/20),y=s*lt.ENEMY_WEIGHT+o*lt.BULLET_WEIGHT+d*lt.BOSS_WEIGHT+f*lt.HEALTH_WEIGHT+p*lt.COMBO_WEIGHT;return this.debugMode&&this.logicFrame%60===0&&console.log(`[DYNAMIC ZOOM] Density: ${(y*100).toFixed(1)}% | Enemies: ${n} | Bullets: ${r} | Health: ${this.playerHealth}/${this.maxPlayerHealth} | Combo: ${this.combo}`),Math.max(0,Math.min(1,y))}determineZoomState(t){const n=lt.HYSTERESIS;return t<this.previousDensity?t<lt.CALM_THRESHOLD-n?Wa.CALM:t<lt.MODERATE_THRESHOLD-n?Wa.MODERATE:t<lt.INTENSE_THRESHOLD-n?Wa.INTENSE:Wa.EXTREME:t<lt.CALM_THRESHOLD?Wa.CALM:t<lt.MODERATE_THRESHOLD?Wa.MODERATE:t<lt.INTENSE_THRESHOLD?Wa.INTENSE:Wa.EXTREME}checkZoomOverrides(){if(!this.entities.find(r=>r.type===A.PLAYER))return;if(this.activeBoss&&this.activeBoss.vulnerable&&this.zoomOverride!==Oa.BOSS_VULNERABLE){this.zoomOverride=Oa.BOSS_VULNERABLE,this.zoomOverrideTimer=lt.BOSS_VULNERABLE_DURATION,console.log("[DYNAMIC ZOOM] Boss vulnerable! Precision mode activated.");return}const n=this.playerHealth/this.maxPlayerHealth;if(n<lt.NEAR_DEATH_THRESHOLD&&!this.nearDeathActive?(this.nearDeathActive=!0,this.zoomOverride=Oa.NEAR_DEATH,this.zoomOverrideTimer=-1,console.log("[DYNAMIC ZOOM] Near death! Last stand mode activated.")):n>lt.NEAR_DEATH_RELEASE&&this.nearDeathActive&&(this.nearDeathActive=!1,this.zoomOverride=Oa.NONE,this.zoomOverrideTimer=0,console.log("[DYNAMIC ZOOM] Health recovered. Exiting last stand mode.")),this.nearDeathActive)return;const s=this.entities.filter(r=>r.type===A.BULLET_CANNON||r.type===A.BULLET_ENEMY||r.type===A.BULLET_TURRET).length;s>lt.BULLET_HELL_THRESHOLD&&!this.bulletHellActive?(this.bulletHellActive=!0,this.zoomOverride=Oa.BULLET_HELL,this.zoomOverrideTimer=-1,console.log(`[DYNAMIC ZOOM] Bullet hell detected! ${s} bullets on screen.`)):s<lt.BULLET_HELL_RELEASE&&this.bulletHellActive&&(this.bulletHellActive=!1,this.zoomOverride=Oa.NONE,this.zoomOverrideTimer=0,console.log("[DYNAMIC ZOOM] Bullet density decreased. Exiting bullet hell mode."))}updateZoomVisualEffects(t){if(t>=1.1){const n=(t-1)/.3;this.postProcessing.triggerPrecisionVignette(n*.3,1)}}updateDynamicZoom(){if(!this.autoZoomEnabled)return;this.actionDensity=this.calculateActionDensity(),this.checkZoomOverrides();let t=lt.NORMAL,n=1,s=lt.SMOOTH_DURATION;if(this.zoomOverride!==Oa.NONE)switch(this.zoomOverride){case Oa.BOSS_VULNERABLE:t=lt.BOSS_VULNERABLE_ZOOM,n=lt.BOSS_VULNERABLE_TIMESCALE,s=lt.FAST_TRANSITION;break;case Oa.NEAR_DEATH:t=lt.NEAR_DEATH_ZOOM,n=lt.NEAR_DEATH_TIMESCALE;break;case Oa.BULLET_HELL:t=lt.BULLET_HELL_ZOOM,n=lt.BULLET_HELL_TIMESCALE;break}else{const r=this.currentZoomState;switch(this.currentZoomState=this.determineZoomState(this.actionDensity),this.debugMode&&r!==this.currentZoomState&&console.log(`[DYNAMIC ZOOM] State changed: ${r} -> ${this.currentZoomState} (Density: ${(this.actionDensity*100).toFixed(1)}%)`),this.currentZoomState){case Wa.CALM:t=lt.CALM_ZOOM,n=lt.CALM_TIMESCALE;break;case Wa.MODERATE:t=lt.MODERATE_ZOOM,n=lt.MODERATE_TIMESCALE;break;case Wa.INTENSE:t=lt.INTENSE_ZOOM,n=lt.INTENSE_TIMESCALE;break;case Wa.EXTREME:t=lt.EXTREME_ZOOM,n=lt.EXTREME_TIMESCALE;break}}this.setCameraZoom(t,s),this.setTimeScale(n,0),this.updateZoomVisualEffects(t),this.previousDensity=this.actionDensity,this.zoomOverrideTimer>0&&(this.zoomOverrideTimer--,this.zoomOverrideTimer<=0&&(this.zoomOverride=Oa.NONE))}setTimeScale(t,n=0){this.targetTimeScale=Math.max(.1,Math.min(2,t)),n===0&&(this.timeScale=this.targetTimeScale)}freezeFrame(t){this.freezeFrames=t}spawnPlayer(){this.playerHealth=this.maxPlayerHealth,this.entities.push({id:"player",type:A.PLAYER,pos:{x:w/2-Xg/2,y:G-100},vel:{vx:0,vy:0},size:{width:Xg,height:Ty},hp:1,active:!0,frame:0,hitFlash:0,bankAngle:0})}handleInput(t){if(this.state!==te.PLAYING&&this.state!==te.BOSS_INTRO&&this.state!==te.BOSS_BATTLE)return;const n=this.entities.find(N=>N.type===A.PLAYER);if(!n||!n.active||n.isLooping)return;let s=0,r=0;t.left&&(s=-ur),t.right&&(s=ur),t.up&&(r=-ur),t.down&&(r=ur),n.vel.vx=n.vel.vx*.8+s*.2,n.vel.vy=n.vel.vy*.8+r*.2;const o=n.vel.vx/ur*.3;n.bankAngle=(n.bankAngle||0)*.8+o*.2;const d=n.pos.x+n.vel.vx,f=n.pos.y+n.vel.vy,p=G*.05,y=G*.07,m=w*.02,_=Vn(this.campaign,this.level),S=p,R=G-y-n.size.height;let b=m,x=w-m-n.size.width;if(_){const N=Ta.getDetectedTerrainWidth(this.campaign,this.level),L=ca(this.campaign,this.level),O=N??L.mapWidthExtended;gl(O,_.leftX,_.rightX,w);const I=10;b=I,x=w-I-n.size.width;const Y=_.rightX-_.leftX;if(Y<w){const W=(w-Y)/2;b=Math.max(I,W),x=Math.min(w-I-n.size.width,w-W-n.size.width)}(b>=x||x-b<50)&&(b=m,x=w-m-n.size.width)}d<b?(n.pos.x=b,n.vel.vx=0):d>x?(n.pos.x=x,n.vel.vx=0):n.pos.x=d,f<S?(n.pos.y=S,n.vel.vy=0):f>R?(n.pos.y=R,n.vel.vy=0):n.pos.y=f,t.fire&&!this.playerEvading&&this.logicFrame%8===0&&this.fireBullet(n),t.evade&&this.lives>0&&!this.playerEvading&&this.performEvade(n),t.bomb&&this.bombQueue.length>0&&!this.playerEvading&&this.bombCooldown<=0&&this.triggerBomb(n)}triggerBomb(t){if(this.bombQueue.length===0||this.bombCooldown>0)return;const n=this.bombQueue.pop();if(!n)return;this.bombActiveFrame=this.frameCount,this.bombCooldown=Et.COOLDOWN,Se.playBomb(),Se.playBombDescending();const s=t.pos.x+t.size.width/2,r=this.getDynamicTerrainParallaxOffset(s),o=s-16+r;this.entities.push({id:`bomb_${Date.now()}`,type:A.BOMB_DROPPED,pos:{x:o,y:t.pos.y+10},vel:{vx:0,vy:Et.INITIAL_VELOCITY},size:{width:32,height:48},hp:1,active:!0,frame:0,bombTier:n,dropFrame:0,scale:Et.INITIAL_SCALE,shadowScale:0})}detonateBomb(t){Se.stopBombDescending();const n=t.bombTier||fa.STANDARD,s=Et.TIERS[n];this.entities.forEach(L=>{if(!this.isEnemy(L))return;const O=L.pos.x+L.size.width/2-(t.pos.x+t.size.width/2),I=L.pos.y+L.size.height/2-(t.pos.y+t.size.height/2),Y=Math.sqrt(O*O+I*I);if(Y>s.radius)return;const W=Math.pow(1-Y/s.radius,2),Z=Math.floor(s.damage*W);L.hp-=Z,L.hp<=0?(L.active=!1,this.decrementPathActiveEntities(L),this.spawnExplosion(L.pos,L.size),L.scoreValue&&(this.score+=L.scoreValue)):L.hitFlash=5,L.turrets&&(L.turrets.forEach(K=>{Math.sqrt(Math.pow(L.pos.x+K.relPos.x-t.pos.x,2)+Math.pow(L.pos.y+K.relPos.y-t.pos.y,2))<s.radius&&(K.hp-=Math.floor(Z*.5),K.hp<=0&&this.spawnExplosion({x:L.pos.x+K.relPos.x-16,y:L.pos.y+K.relPos.y-16},{width:32,height:32}))}),L.turrets=L.turrets.filter(K=>K.hp>0))}),this.entities.forEach(L=>{if(L.type===A.BULLET_ENEMY||L.type===A.BULLET_CANNON||L.type===A.BULLET_TURRET){const O=L.pos.x-t.pos.x,I=L.pos.y-t.pos.y;Math.sqrt(O*O+I*I)<s.radius&&(L.active=!1)}});const r=this.entities.find(L=>L.type===A.PLAYER),o=r?r.pos.x+r.size.width/2:w/2,d=this.getDynamicTerrainParallaxOffset(o),p=t.pos.x+t.size.width/2-d,y=t.pos.y+t.size.height/2,m=dt.applyBombDamage(p,y,s.radius,s.damage,this.tilemapScrollY,o);for(const L of m.destroyed){const O=dt.getTurretScreenPosition(L,this.tilemapScrollY);O&&(this.spawnExplosion({x:O.x-24,y:O.y-24},{width:48,height:48}),Te.emitExplosionDebris(O.x,O.y,10),this.score+=200,this.spawnFloatingScore(O.x,O.y,200,"turret"),this.spawnTurretDebris(O.x,O.y))}const _=$t.applyBombDamage(p,y,s.radius,this.tilemapScrollY,o);for(const L of _.destroyed){const O=$t.getTargetScreenPosition(L,this.tilemapScrollY,o);O&&(this.spawnExplosion({x:O.x-32,y:O.y-32},{width:64,height:64}),Te.emitExplosionDebris(O.x,O.y,15))}if(this.score+=_.pointsAwarded,_.destroyed.length>0&&pr.checkAndRevealForDestroyedTargets(_.destroyed),this.activeBoss){const L=this.entities.find(O=>O.type===A.BOSS);if(L&&L.active){const O=L.pos.x+L.size.width/2,I=L.pos.y+L.size.height/2,Y=p-O,W=y-I,Z=Math.sqrt(Y*Y+W*W),K=Math.max(L.size.width,L.size.height)/2;if(Z<=s.radius+K){const me=this.campaign===Ee.STEEL_VANGUARD||this.campaign===Ee.HELLFIRE_HORIZON||this.campaign===Ee.DAWN_PATROL&&this.level>=2?.2:1,pe=Math.floor(s.damage*me);this.activeBoss.hp-=pe,L.hp=this.activeBoss.hp,Te.emitExplosionDebris(O,I,10),console.log(`[BOSS] Bomb hit! Damage: ${pe} (${me*100}%), HP remaining: ${this.activeBoss.hp}`)}}}this.entities.push({id:`blast_wave_${Date.now()}`,type:A.BLAST_WAVE,pos:{x:t.pos.x+t.size.width/2,y:t.pos.y+t.size.height/2},vel:{vx:0,vy:0},size:{width:0,height:0},hp:1,active:!0,frame:0,maxFrames:30,blastRadius:s.radius}),this.spawnExplosion(t.pos,{width:96,height:96}),s.clusters>0&&this.spawnClusterExplosions(t.pos,n,s.clusters),this.screenShake=Et.SCREEN_SHAKE_BASE+n*Et.SCREEN_SHAKE_PER_TIER,Te.emitExplosionDebris(t.pos.x+t.size.width/2,t.pos.y+t.size.height/2,15+n*5);const S=ca(this.campaign,this.level),R=Math.floor((S.mapWidthExtended-w)/2),b=dt.getTotalMapHeight(),x=p+R+d,N=b-this.tilemapScrollY-G+y;this.addLingeringFireZone(x,N)}isEnemy(t){return t.type===A.ENEMY_SMALL||t.type===A.ENEMY_RED||t.type===A.ENEMY_BIG||t.type===A.ENEMY_HELICOPTER||t.type===A.ENEMY_BATTLESHIP||t.type===A.AA_EMPLACEMENT||t.type===A.FORTRESS||t.type===A.AIRCRAFT_CARRIER||t.type===A.DESTROYER}addLingeringFireZone(t,n){this.lingeringFireZones.length>=8&&this.lingeringFireZones.shift(),this.lingeringFireZones.push({worldX:t,worldY:n,startFrame:this.frameCount})}updateLingeringFireZones(){if(this.lingeringFireZones.length===0)return;const t=this.entities.find(p=>p.type===A.PLAYER),n=t?t.pos.x+t.size.width/2:w/2,s=ca(this.campaign,this.level),r=Math.floor((s.mapWidthExtended-w)/2),o=this.getDynamicTerrainParallaxOffset(n),d=dt.getTotalMapHeight(),f=60;for(let p=this.lingeringFireZones.length-1;p>=0;p--){const y=this.lingeringFireZones[p],m=y.worldX-r-o,_=G-(d-this.tilemapScrollY-y.worldY);if(_>G+50){this.lingeringFireZones.splice(p,1);continue}if(_<-100){this.lingeringFireZones.splice(p,1);continue}if(_<0||_>G||m<-50||m>w+50)continue;if(this.frameCount-y.startFrame<f){if(Math.random()<.08){const R=-Math.PI/2+(Math.random()-.5)*.5;Te.emitMuzzleFlash(m+(Math.random()-.5)*30,_,R)}Math.random()<.08&&Te.emitGroundEmbers(m+(Math.random()-.5)*30,_,2),Math.random()<.12&&Te.emitWhiteSmoke(m+(Math.random()-.5)*25,_,.5),Math.random()<.04&&Te.emitSparks(m+(Math.random()-.5)*50,_,2)}else Math.random()<.15&&Te.emitWhiteSmoke(m+(Math.random()-.5)*25,_,.6)}}getBombTierForLevel(){return this.level>=Et.TIER_THRESHOLDS.MEGA?fa.MEGA:this.level>=Et.TIER_THRESHOLDS.CLUSTER?fa.CLUSTER:this.level>=Et.TIER_THRESHOLDS.HEAVY?fa.HEAVY:fa.STANDARD}getFirepowerTierForLevel(){if(this.level<oi.TIER_THRESHOLDS.ENHANCED)return $a.STANDARD;const t=oi.ENHANCED_CHANCE[this.difficulty]||0;return Math.random()<t?$a.ENHANCED:$a.STANDARD}spawnClusterExplosions(t,n,s){const r=Et.CLUSTER_SPREAD_BASE+n*Et.CLUSTER_SPREAD_PER_TIER;for(let o=0;o<s;o++){const d=o/s*Math.PI*2+Math.random()*.3,f=r*(.5+Math.random()*.5),p=o*Et.CLUSTER_DELAY_FRAMES+Math.floor(Math.random()*3),y=t.x+Math.cos(d)*f,m=t.y+Math.sin(d)*f;this.entities.push({id:`cluster_${Date.now()}_${o}`,type:A.EXPLOSION,pos:{x:y,y:m},vel:{vx:0,vy:0},size:{width:48,height:48},hp:1,active:!0,frame:-p,maxFrames:20}),this.applyBlastDamage(y,m,Et.CLUSTER_RADIUS,Et.TIERS[n].damage*Et.CLUSTER_DAMAGE_RATIO)}}applyBlastDamage(t,n,s,r){this.entities.forEach(o=>{if(!this.isEnemy(o))return;const d=o.pos.x+o.size.width/2-t,f=o.pos.y+o.size.height/2-n,p=Math.sqrt(d*d+f*f);if(p>s)return;const y=1-p/s;o.hp-=Math.floor(r*y),o.hp<=0&&(o.active=!1,this.decrementPathActiveEntities(o),this.spawnExplosion(o.pos,o.size))})}performEvade(t){t.isEvading=!0,t.evasiveScale=1,this.playerEvading=!0,this.evadeTimer=150,this.playerInvincible=150,Se.playEvade()}activateFirepower(){this.enhancedFirepowerCount>0?(this.enhancedFirepowerCount--,this.firepowerBullets=oi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=$a.ENHANCED):this.standardFirepowerCount>0&&(this.standardFirepowerCount--,this.firepowerBullets=oi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=$a.STANDARD)}generateBulletOffsets(t,n=15){const s=[],r=Math.floor(t/2);for(let o=0;o<r;o++){const d=(o+1)*n;s.push(-d,d)}return s}fireBullet(t){Se.playShoot();const n=this.firepowerBullets>0;if(this.spreadBullets>0){const r=this.spreadStacks-1,d=[...[-Math.PI/2,-Math.PI/4,0,0,Math.PI/4,Math.PI/2]];for(let y=0;y<r;y++){const m=(y+1)*(Math.PI/16);y%2===0?d.push(m):d.push(-m)}const f=t.pos.x+t.size.width/2,p=t.pos.y;d.forEach((y,m)=>{const _=y-Math.PI/2,S=Math.cos(_)*Co,R=Math.sin(_)*Co;let b=0;y===0&&(b=m===2?-8:8),this.entities.push({id:Math.random().toString(),type:A.BULLET_PLAYER,pos:{x:f-2+b,y:p},vel:{vx:S,vy:R},size:{width:4,height:16},hp:1,active:!0,frame:0}),(m===2||m===3)&&Te.emitMuzzleFlash(f+b,p,_)}),this.spreadBullets--,this.spreadBullets===0&&(this.spreadStacks=0)}else{let r,o=1;if(n){const d=oi.TIERS[this.activeFirepowerTier],f=d.offsets.length,p=this.firepowerStacks-1,y=f+p;o=d.damageMultiplier,r=this.generateBulletOffsets(y)}else r=[-10,10];r.forEach((d,f)=>{const p=t.pos.x+t.size.width/2+d-2,y=t.pos.y;this.entities.push({id:Math.random().toString(),type:A.BULLET_PLAYER,pos:{x:p,y},vel:{vx:0,vy:-Co},size:{width:4,height:16},hp:o,active:!0,frame:0}),f<2&&Te.emitMuzzleFlash(p+2,y,-Math.PI/2),(f===0||f===r.length-1)&&Te.emitBulletTracer(p+2,y-10,0,-Co)}),n&&(this.firepowerBullets--,this.firepowerBullets===0&&(this.firepowerStacks=0,this.activateFirepower()))}}update(){if(this.postProcessing.update(),zn.update(this.frameCount,this.timeScale),$t.update(1),this.updateAltitudeTransition(),this.screenShake>0&&(this.screenShake*=.9,this.screenShake<.5&&(this.screenShake=0)),this.combo>0&&(this.comboTimer--,this.comboTimer<=0&&(this.combo=0)),this.updateHeatDecay(),this.updateFloatingScores(),this.updateLingeringFireZones(),this.state===te.GAME_OVER&&(this.gameOverTimer++,this.gameOverTimer>300&&(this.state=te.ATTRACT,this.gameOverTimer=0)),this.state===te.LEVEL_COMPLETE){this.updateIntermission();return}if(this.state===te.BOSS_INTRO){if(this.bossIntroTimer++,this.bossIntroTimer===1&&this.activeBoss){this.freezeFrame(8),this.postProcessing.triggerWhiteFlash(.8,15),this.setCameraZoom(1.3,40);const s=this.activeBoss.pos.x+this.activeBoss.size.width/2,r=this.activeBoss.pos.y+this.activeBoss.size.height/2;for(let o=0;o<12;o++){const d=Math.PI*2/12*o,f=Math.max(this.activeBoss.size.width,this.activeBoss.size.height)/2;Te.emitShrapnel(s+Math.cos(d)*f,r+Math.sin(d)*f,8)}}if(this.bossIntroTimer>8&&this.bossIntroTimer<80&&this.activeBoss&&this.bossIntroTimer%5===0){const s=this.activeBoss.pos.x+this.activeBoss.size.width/2,r=this.activeBoss.pos.y+this.activeBoss.size.height/2;Te.emitFire(s+(Math.random()-.5)*50,r+(Math.random()-.5)*50,2)}this.bossIntroTimer===80&&this.setCameraZoom(1,30),this.bossIntroTimer>120&&(this.state=te.BOSS_BATTLE,this.bossIntroTimer=0,this.resetCamera())}if(this.state===te.BOSS_BATTLE&&this.activeBoss){const s=this.entities.find(r=>r.type===A.PLAYER);if(s){const r=this.bossEngine.updateBoss(this.activeBoss,s.pos,this.logicFrame);if(r.length>20&&console.warn(`[FREEZE DEBUG] Boss generated ${r.length} bullets! Frame: ${this.logicFrame}, TimeScale: ${this.timeScale.toFixed(2)}`),r.length>50?(console.error(`[FREEZE DEBUG] Boss bullet explosion! Limiting ${r.length} to 50.`),this.entities.push(...r.slice(0,50))):this.entities.push(...r),this.activeBoss.phaseJustChanged){console.log(`[FREEZE DEBUG] Boss phase transition! Phase: ${this.activeBoss.phase}, HP: ${this.activeBoss.hp}, Frame: ${this.logicFrame}`),this.activeBoss.phaseJustChanged=!1,this.freezeFrame(5),console.log("[FREEZE DEBUG] Freeze frame triggered for 5 frames"),this.postProcessing.triggerChromaticAberration(8,20),this.screenShake=12;const o=this.activeBoss.pos.x+this.activeBoss.size.width/2,d=this.activeBoss.pos.y+this.activeBoss.size.height/2;Te.emitExplosionDebris(o,d,20),Te.emitShrapnel(o,d,15);for(let f=0;f<8;f++){const p=Math.PI*2/8*f;Te.emitFire(o+Math.cos(p)*40,d+Math.sin(p)*40,3)}}}if(this.bossEngine.isBossDefeated(this.activeBoss)&&!this.bossDefeating){this.bossDefeating=!0,this.score+=this.activeBoss.scoreValue||5e4,console.log("[FREEZE DEBUG] Boss defeat triggered at frame",this.logicFrame),this.setTimeScale(.6,0),this.setCameraZoom(.9,30);const r=this.activeBoss.pos.x+this.activeBoss.size.width/2,o=this.activeBoss.pos.y+this.activeBoss.size.height/2;for(let f=0;f<4;f++){const p=(Math.random()-.5)*this.activeBoss.size.width*.6,y=(Math.random()-.5)*this.activeBoss.size.height*.6;this.spawnExplosion({x:r+p-32,y:o+y-32},{width:64,height:64})}Te.emitExplosionDebris(r,o,15),Te.emitFire(r,o,5),Te.emitShrapnel(r,o,10),this.postProcessing.triggerWhiteFlash(.6,8),this.screenShake=20;const d=Math.random()>.5?1:-1;this.crashingBoss={...this.activeBoss},this.crashingBoss.vel={vx:d*(.5+Math.random()*.3),vy:2+Math.random()*.5},this.crashingBoss.scale=1,this.bossCrashTimer=60,this.bossCrashRotation=d*.1,this.activeBoss.active=!1,this.activeBoss=null,this.entities.forEach(f=>{f.type===A.BOSS&&(f.active=!1),f.pathFollow&&(f.type===A.ENEMY_TANK||f.type===A.ENEMY_LARGE_TANK||f.type===A.ENEMY_BATTLESHIP||f.type===A.AIRCRAFT_CARRIER||f.type===A.DESTROYER)&&(f.active=!1)}),this.entityPaths.forEach(f=>{f.activeEntities=0}),console.log("[BOSS] Started crash sequence, cleared ground units")}}if(this.crashingBoss&&this.bossCrashTimer>0){const r=1-this.bossCrashTimer/60;this.crashingBoss.vel.vy+=.08,this.crashingBoss.pos.y+=this.crashingBoss.vel.vy,this.crashingBoss.pos.x+=this.crashingBoss.vel.vx,this.crashingBoss.scale=1-r*.6,this.bossCrashRotation+=.025;const o=this.crashingBoss.pos.x+this.crashingBoss.size.width/2,d=this.crashingBoss.pos.y+this.crashingBoss.size.height/2;if(this.logicFrame%2===0&&(Te.emitCrashSmoke(o+(Math.random()-.5)*40,d,2),Te.emitSmokePlume(o+(Math.random()-.5)*60,d,1)),this.logicFrame%3===0&&Te.emitFire(o+(Math.random()-.5)*80,d+(Math.random()-.5)*30,1),this.bossCrashTimer%10===0){const f=(Math.random()-.5)*this.crashingBoss.size.width*.6,p=(Math.random()-.5)*this.crashingBoss.size.height*.4;this.spawnExplosion({x:o+f-24,y:d+p-24},{width:48,height:48}),Te.emitExplosionDebris(o+f,d+p,6)}this.bossCrashTimer--,(this.bossCrashTimer<=0||this.crashingBoss.pos.y>G+50)&&(this.crashingBoss.pos.y<G+100?this.triggerBossCrashExplosion():(this.crashingBoss=null,this.bossCrashTimer=0,this.finishBossDefeat()))}if(this.powerupLegendTimer>0&&this.powerupLegendTimer--,this.state!==te.PLAYING&&this.state!==te.GAME_OVER&&this.state!==te.LEVEL_COMPLETE&&this.state!==te.BOSS_INTRO&&this.state!==te.BOSS_BATTLE)return;if(this.camera.zoom+=(this.camera.targetZoom-this.camera.zoom)*this.camera.smoothing,this.camera.rotation+=(this.camera.targetRotation-this.camera.rotation)*this.camera.smoothing,this.updateDynamicZoom(),this.timeScale!==this.targetTimeScale&&(this.timeScale+=(this.targetTimeScale-this.timeScale)*.1,Math.abs(this.timeScale-this.targetTimeScale)<.01&&(this.timeScale=this.targetTimeScale)),this.postProcessing.update(),this.freezeFrames>0){this.freezeFrames--,this.freezeFrames===0&&console.log("[FREEZE DEBUG] Freeze frame ended, resuming game logic");return}if(this.state===te.PAUSED||this.state===te.DESIGN_MODE)return;const t=this.timeScale;if(this.frameCount+=t,this.logicFrame++,this.playerInvincible>0&&(this.playerInvincible-=t),this.state===te.PLAYING){this.waveTimer++,this.levelProgress++,this.tilemapEnabled&&(this.tilemapScrollY=this.levelProgress*oa);const s=this.entities.find(f=>f.type===A.PLAYER);if(s){dt.update(this.tilemapScrollY,s.pos,t);const f=this.getDifficultyMultiplier(),p=dt.getFiringTurrets(this.tilemapScrollY,this.logicFrame,f.fireRate);for(const m of p)m.burstPending=Hn.BURST_COUNT,m.burstNextFrame=this.logicFrame;const y=dt.getActiveTurrets();for(const m of y){if(m.burstPending<=0||this.logicFrame<m.burstNextFrame)continue;const _=dt.getTurretScreenPosition(m.metadata.id,this.tilemapScrollY,s.pos.x);if(!_)continue;const R=(Hn.BURST_COUNT-m.burstPending===0?-1:1)*Hn.PARALLEL_OFFSET/2,b=m.angle+Math.PI/2,x=Math.cos(b)*R,N=Math.sin(b)*R,L=Hn.BASE_SPEED*f.bulletSpeed,O=Math.cos(m.angle)*L,I=Math.sin(m.angle)*L;this.entities.push({id:Math.random().toString(),type:A.BULLET_TURRET,pos:{x:_.x+x,y:_.y+N},vel:{vx:O,vy:I},size:{width:Hn.WIDTH,height:Hn.HEIGHT},hp:1,active:!0,frame:0}),m.burstPending--,m.burstNextFrame=this.logicFrame+Hn.BURST_DELAY}}const r=this.LEVEL_DURATION*.8;this.levelProgress>=r&&!this.nextLevelPreloaded&&this.level<this.MAX_LEVEL&&(console.log(`[PRELOAD] Level ${this.level} at 80%, preloading level ${this.level+1} assets...`),this.nextLevelPreloaded=!0,o_(this.level).catch(f=>console.error("[PRELOAD] Failed to preload next level:",f)));const o=this.levelProgress/this.LEVEL_DURATION*100;let d=[];this.campaign===Ee.DAWN_PATROL?d=[40]:this.campaign===Ee.STEEL_VANGUARD?d=[40,80]:this.campaign===Ee.HELLFIRE_HORIZON&&(d=[40,60,80]);for(const f of d)o>=f&&!this.spreadDropsCompleted.includes(f)&&(this.spawnSupportFighter(),this.spreadDropsCompleted.push(f));if(this.levelProgress>=this.LEVEL_DURATION&&this.level<=this.MAX_LEVEL){const f=this.bossEngine.createBoss(this.level);f&&(this.activeBoss=f,this.entities.push(f),this.state=te.BOSS_INTRO,this.bossIntroTimer=0,this.bossIntroStartFrame=this.frameCount,this.bossDefeating=!1,this.entities.forEach(p=>{if(p.pathFollow&&(p.type===A.ENEMY_TANK||p.type===A.ENEMY_LARGE_TANK)){p.active=!1;const y=this.entityPaths.find(m=>m.id===p.pathFollow.pathId);y&&(y.activeEntities=Math.max(0,y.activeEntities-1))}}),Se.playBossMusic(this.level,this.campaign));return}}if(this.state===te.GAME_OVER)return;if(this.bombCooldown>0&&this.bombCooldown--,this.playerEvading){this.evadeTimer--;const s=this.entities.find(r=>r.type===A.PLAYER);if(s&&s.isEvading){const o=(150-this.evadeTimer)/150;o<.5?s.evasiveScale=1-o*2*.3:s.evasiveScale=.7+(o-.5)*2*.3}this.evadeTimer<=0&&(s&&(s.isEvading=!1,s.evasiveScale=1),this.playerEvading=!1)}this.entities.forEach(s=>{if(s.animationSpeed&&(s.frame+=s.animationSpeed,s.maxFrames&&s.frame>=s.maxFrames&&(s.frame=0)),s.type===A.POWERUP&&(s.rotation=(s.rotation||0)+.02),s.type===A.BOSS&&this.activeBoss){const r=Math.sin(this.frameCount/30)*.02;s.scale=1+r}}),this.spawnWaves(),this.spawnPathBasedEntities();const n=this.entities.find(s=>s.type===A.PLAYER);if(this.entities.forEach(s=>{var p,y,m;if(s.type===A.ENEMY_SMALL||s.type===A.ENEMY_RED||s.type===A.ENEMY_BIG||s.type===A.POWERUP){const _=oa;s.vel.vy<_&&(s.vel.vy=_)}if(s.type!==A.PLAYER&&!s.pathFollow&&(s.pos.x+=s.vel.vx,s.pos.y+=s.vel.vy),s.hitFlash&&s.hitFlash>0&&s.hitFlash--,s.type===A.BOMB_DROPPED){if(s.dropFrame=(s.dropFrame||0)+1,s.dropFrame<=Et.INITIAL_FORWARD_FRAMES)s.vel.vy=Et.INITIAL_VELOCITY,s.scale=Et.INITIAL_SCALE;else{s.vel.vy=0,s.vel.vx=0;const _=(s.dropFrame-Et.INITIAL_FORWARD_FRAMES)/(Et.DROP_DURATION-Et.INITIAL_FORWARD_FRAMES),S=Et.INITIAL_SCALE*(1-Et.SHRINK_FACTOR);s.scale=Et.INITIAL_SCALE-_*(Et.INITIAL_SCALE-S),s.shadowScale=_}s.dropFrame>=Et.DROP_DURATION&&(this.detonateBomb(s),s.active=!1)}if(s.type===A.SUPPORT_FIGHTER&&this.updateSupportFighter(s),s.formationState&&s.formationState.waypoints.length>0){const _=s.formationState,S=_.waypoints[_.currentWaypointIndex];if(S){const R=this.getDifficultyMultiplier(),b=Po*Wg(this.campaign,this.level)*R.speed,x=Kg(s.pos,S,b);s.vel.vx+=(x.vx-s.vel.vx)*.15,s.vel.vy+=(x.vy-s.vel.vy)*.15;const N=Qg(s.vel);s.rotation===void 0?s.rotation=N:s.rotation=Iy(s.rotation,N,.12),By(s.pos,S,25)&&(_.currentWaypointIndex++,_.waypointProgress=0)}}if(s.type===A.ENEMY_SMALL||s.type===A.ENEMY_RED){const _=s.vel.vx/Po*.4;if(s.bankAngle=_,this.difficulty===gt.VETERAN&&this.level>=3&&n){const S=n.pos.y-s.pos.y,R=s.type===A.ENEMY_RED,b=oa,x=R?oa+1.5:oa+2.5;let L=(b+x)/2;S>200?L=x:S<100&&S>0&&(L=b),s.vel.vy+=(L-s.vel.vy)*.05,s.vel.vy=Math.max(b,Math.min(x,s.vel.vy))}}if(s.type===A.ENEMY_HELICOPTER){if(this.getDifficultyMultiplier(),s.pos.y<100)s.vel.vy=2;else{s.vel.vy=.5;const S=Math.sin(this.frameCount/30)*3;let R=0;if(this.difficulty===gt.NORMAL?R=.3:this.difficulty===gt.VETERAN&&(R=.5),n&&R>0){const b=n.pos.x-(s.pos.x+s.size.width/2),x=Math.sign(b)*Math.min(Math.abs(b)*.01,R);s.vel.vx=S*.6+x*.4}else s.vel.vx=S;this.difficulty===gt.VETERAN&&(s.vel.vy+=Math.sin(this.frameCount/60)*.3)}const _=s.vel.vx/3*.3;s.bankAngle=_,this.logicFrame%150===0&&Math.random()>.3&&this.enemyShoot(s)}if(s.type===A.ENEMY_BIG){const _=this.getDifficultyMultiplier(),S=.015,R=1+(_.speed-1)*.5;if(s.vel.vx=Math.sin(this.frameCount*S)*R,this.difficulty===gt.VETERAN&&n){const x=n.pos.x-(s.pos.x+s.size.width/2);s.vel.vx+=Math.sign(x)*.15}const b=s.vel.vx/2*.2;s.bankAngle=b}if(s.pathFollow&&this.updatePathFollowingEntity(s),s.type===A.ENEMY_BATTLESHIP&&!s.pathFollow){const _=s.pos.y+s.size.height/2,S=this.getWaterBoundsAtScreenY(_);if(S){const R=S.minX,b=S.maxX-s.size.width,L=Math.sin((this.frameCount+(s.id?parseInt(s.id.substring(0,8),16):0))*.008)*.3;s.vel.vx=L,s.pos.x<R&&(s.pos.x=R,s.vel.vx=Math.abs(s.vel.vx)),s.pos.x>b&&(s.pos.x=b,s.vel.vx=-Math.abs(s.vel.vx))}else s.pos.y>0&&(s.active=!1,console.log(`[TERRAIN] Battleship deactivated - no water zone at Y=${_.toFixed(0)}`))}if((s.type===A.ENEMY_TANK||s.type===A.ENEMY_LARGE_TANK)&&!s.pathFollow){const _=s.pos.y+s.size.height/2,S=this.tilemapScrollY+_,R=this.getRoadBoundsAtWorldY(S);if(R){const b=R.minX,x=R.maxX-s.size.width;s.pos.x<b&&(s.pos.x=b,s.vel.vx=Math.abs(s.vel.vx)),s.pos.x>x&&(s.pos.x=x,s.vel.vx=-Math.abs(s.vel.vx))}}if(s.type===A.PARTICLE){s.vel.vx*=.95,s.vel.vy*=.95,s.hp--,(p=s.id)!=null&&p.startsWith("turret_debris")?(s.rotation!==void 0&&s.scoreValue&&(s.rotation+=s.scoreValue),s.vel.vy+=.1,s.size.width*=.99,s.size.height*=.99):(s.size.width*=.95,s.size.height*=.95),s.hp<=0&&(s.active=!1);return}if(s.type===A.SMOKE){s.pos.y+=oa,s.hp--,s.size.width+=.5,s.size.height+=.5,s.hp<=0&&(s.active=!1);return}if(s.type===A.WAKE){s.pos.y+=oa,s.hp--,s.size.width+=1,s.size.height+=.5,s.hp<=0&&(s.active=!1);return}if(s.type===A.CRASHING_AIRCRAFT){s.crashTimer=(s.crashTimer||38)-1,s.vel.vy+=.05;const S=1-s.crashTimer/38;s.scale=1-S*.5;const R=s.pos.x+s.size.width/2,b=s.pos.y+s.size.height/2;this.logicFrame%2===0&&Te.emitCrashSmoke(R,b,1),this.logicFrame%5===0&&Te.emitFire(R,b,.3),s.crashTimer<=0&&(s.active=!1,s.pos.y<G+50&&s.pos.x>-100&&s.pos.x<w+100&&(this.triggerFullExplosion(s),Se.playEnemyExplosion(),this.screenShake=5));return}if(s.type===A.PLAYER&&this.logicFrame%8===0&&Te.emitEngineExhaust(s.pos.x+s.size.width/2,s.pos.y+s.size.height,0,2),s.type===A.PLAYER){const _=1-this.playerHealth/this.maxPlayerHealth;_>.05&&(this.debugMode&&this.logicFrame%60===0&&console.log(`[DAMAGE SMOKE] Player damage: ${(_*100).toFixed(1)}% | Health: ${this.playerHealth}/${this.maxPlayerHealth}`),Te.emitDamageSmoke(s.pos.x+s.size.width/2,s.pos.y+s.size.height,_))}if(s.type===A.BOSS&&this.logicFrame%6===0&&Te.emitEngineExhaust(s.pos.x+s.size.width/2,s.pos.y+s.size.height,0,3),(s.type===A.ENEMY_BIG||s.type===A.ENEMY_BATTLESHIP)&&s.hp<20&&this.logicFrame%20===0&&this.spawnSmoke(s.pos.x+s.size.width/2,s.pos.y+s.size.height/2),s.type===A.BOSS&&this.activeBoss&&s.hp<this.activeBoss.maxHP/2&&this.logicFrame%10===0){const _=s.pos.x+s.size.width/2,S=s.pos.y+s.size.height/2;Te.emitSmokePlume(_,S,3),Te.emitFire(_,S,2)}if(s.type===A.ENEMY_BATTLESHIP&&this.logicFrame%15===0&&this.spawnWake(s.pos.x+s.size.width/2,s.pos.y-5),s.turrets){s.turrets.forEach(S=>{S.hitFlash&&S.hitFlash>0&&S.hitFlash--});const _=s.pos.y>-s.size.height&&s.pos.y<G&&s.pos.x>-s.size.width&&s.pos.x<w;if(n&&n.active&&!n.isLooping&&_){const S=this.getDifficultyMultiplier();s.turrets.forEach(R=>{const b=s.pos.x+R.relPos.x,x=s.pos.y+R.relPos.y,N=n.pos.x+n.size.width/2-b,L=n.pos.y+n.size.height/2-x;R.angle=Math.atan2(L,N)+Math.PI/2,R.cooldown>0?R.cooldown--:Math.abs(N)<400&&Math.abs(L)<600&&(this.fireTurret(b,x,Math.atan2(L,N)),R.cooldown=Math.max(30,Math.floor(6e3/(R.fireRate*S.fireRate))))})}}s.type===A.ENEMY_BIG&&this.logicFrame%120===0&&Math.random()>.5&&this.enemyShoot(s);const o=((y=s.pathFollow)==null?void 0:y.hasBeenOnScreen)===!1?!1:s.pos.y<-500;(s.pathFollow&&s.pathFollow.hasBeenOnScreen!==!0?!1:s.pos.y>G+300||o||s.pos.x<-200||s.pos.x>w+200)&&s.type!==A.PLAYER&&(s.type===A.ENEMY_BATTLESHIP&&console.log(`[DEACTIVATE] Battleship removed: pos.y=${s.pos.y.toFixed(0)}, pos.x=${s.pos.x.toFixed(0)}, hasBeenOnScreen=${(m=s.pathFollow)==null?void 0:m.hasBeenOnScreen}`),s.active=!1)}),this.checkCollisions(),this.entities=this.entities.filter(s=>s.active),this.entities.length>200){console.error(`[FREEZE DEBUG] CRITICAL: Entity count ${this.entities.length}! Emergency cleanup!`);const s=[],r=[],o=[];for(const p of this.entities)p.type===A.PLAYER||p.type===A.BOSS||p.type===A.ENEMY_SMALL||p.type===A.ENEMY_RED||p.type===A.ENEMY_BIG||p.type===A.ENEMY_BATTLESHIP||p.type===A.ENEMY_HELICOPTER||p.type===A.POWERUP?s.push(p):p.type===A.BULLET_PLAYER||p.type===A.BULLET_ENEMY||p.type===A.BULLET_CANNON||p.type===A.BULLET_TURRET?r.push(p):o.push(p);const d=r.length>80?r.slice(-80):r,f=o.length>40?o.slice(-40):o;this.entities=[...s,...d,...f],console.error(`[FREEZE DEBUG] Emergency cleanup complete. Entities: ${this.entities.length} (${s.length} critical, ${d.length} bullets, ${f.length} effects)`)}this.entities.find(s=>s.type===A.PLAYER)||(this.lives>0?(this.lives--,this.spawnPlayer(),this.firepowerBullets=0,this.firepowerStacks=0,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.spreadBullets=0,this.spreadStacks=0,this.bombQueue=[fa.STANDARD,fa.STANDARD,fa.STANDARD]):(this.state=te.GAME_OVER,this.score>this.highScore&&(this.highScore=this.score),Se.stopMusic()))}fireTurret(t,n,s){Se.playCannon();const o=3.75*this.getDifficultyMultiplier().bulletSpeed;this.entities.push({id:Math.random().toString(),type:A.BULLET_CANNON,pos:{x:t-8,y:n-8},vel:{vx:Math.cos(s)*o,vy:Math.sin(s)*o},size:{width:16,height:16},hp:1,active:!0,frame:0}),Math.random()>.5&&Te.emitMuzzleFlash(t,n,s)}enemyShoot(t){const n=this.entities.find(p=>p.type===A.PLAYER);if(!n)return;const s=this.getDifficultyMultiplier(),r=n.pos.x-t.pos.x,o=n.pos.y-t.pos.y,d=Math.sqrt(r*r+o*o),f=Math.atan2(o,r);this.entities.push({id:Math.random().toString(),type:A.BULLET_ENEMY,pos:{x:t.pos.x+t.size.width/2,y:t.pos.y+t.size.height},vel:{vx:r/d*7.5*s.speed,vy:o/d*7.5*s.speed},size:{width:8,height:8},hp:1,active:!0,frame:0}),Math.random()>.7&&Te.emitMuzzleFlash(t.pos.x+t.size.width/2,t.pos.y+t.size.height,f)}checkOverlap(t,n){return this.entities.some(s=>!n.includes(s.type)||!s.active?!1:t.x<s.pos.x+s.size.width&&t.x+t.width>s.pos.x&&t.y<s.pos.y+s.size.height&&t.y+t.height>s.pos.y)}isValidNavalSpawnPosition(t,n){if(this.waterZones.length===0)return!0;const s=this.waterZones.some(o=>{if(o.shape==="ellipse"&&o.rx&&o.ry){const d=(t-o.x)/o.rx,f=(n-o.y)/o.ry;return d*d+f*f<=1}if(o.shape==="rect"&&o.width&&o.height){const d=o.width/2,f=o.height/2;return t>=o.x-d&&t<=o.x+d&&n>=o.y-f&&n<=o.y+f}return!1}),r=this.landZones.some(o=>{if(o.shape==="ellipse"&&o.rx&&o.ry){const d=(t-o.x)/o.rx,f=(n-o.y)/o.ry;return d*d+f*f<=1}if(o.shape==="rect"&&o.width&&o.height){const d=o.width/2,f=o.height/2;return t>=o.x-d&&t<=o.x+d&&n>=o.y-f&&n<=o.y+f}return!1});return s&&!r}getWaterSpawnX(){if(this.waterZones.length===0)return-1;const t=this.waterZones[Math.floor(Math.random()*this.waterZones.length)];if(t.shape==="rect"&&t.width){const n=t.x-t.width/2,s=t.x+t.width/2-140;return Math.max(0,Math.min(w-140,n+Math.random()*(s-n)))}if(t.shape==="ellipse"&&t.rx){const n=t.x-t.rx,s=t.x+t.rx-140;return Math.max(0,Math.min(w-140,n+Math.random()*(s-n)))}return Math.random()*(w-140)}getRoadSpawnX(){if(this.roadZones.length===0)return-1;const t=this.roadZones[Math.floor(Math.random()*this.roadZones.length)];if(t.shape==="rect"&&t.width){const s=t.x-t.width/2,r=t.x+t.width/2-80;return Math.max(0,Math.min(w-80,s+Math.random()*(r-s)))}return-1}getRoadBoundsAtWorldY(t){for(const n of this.roadZones){if(n.shape!=="rect"||!n.width||!n.height)continue;const s=n.y-n.height/2,r=n.y+n.height/2,o=bt.TOTAL_MAP_HEIGHT,d=o-r,f=o-s;if(t>=d&&t<=f){const p=n.width/2;return{minX:n.x-p,maxX:n.x+p}}}return null}parseEntityType(t){return{battleship:A.ENEMY_BATTLESHIP,tank:A.ENEMY_TANK,"large-tank":A.ENEMY_LARGE_TANK,ENEMY_BATTLESHIP:A.ENEMY_BATTLESHIP,ENEMY_TANK:A.ENEMY_TANK,ENEMY_LARGE_TANK:A.ENEMY_LARGE_TANK}[t]||A.ENEMY_TANK}calculatePathLength(t){if(t.length<2)return 0;let n=0;for(let s=1;s<t.length;s++){const r=t[s].x-t[s-1].x,o=t[s].y-t[s-1].y;n+=Math.sqrt(r*r+o*o)}return n}spawnPathBasedEntities(){if(this.logicFrame%60===0&&console.log(`[PATH-SPAWN-DEBUG] logicFrame=${this.logicFrame}, frameCount=${this.frameCount}, state=${this.state}, entityPaths.length=${this.entityPaths.length}`),this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE){this.frameCount<=3&&console.log("[PATH-SPAWN] Early return due to boss state");return}const t=gr(this.campaign,this.level);this.frameCount===1&&(console.log(`[PATH-SPAWN] Frame 1: entityPaths.length=${this.entityPaths.length}, tilemapScrollY=${this.tilemapScrollY}`),this.entityPaths.forEach(n=>console.log(`[PATH-SPAWN] Path ${n.id}: direction=${n.direction}, maxEntities=${n.maxEntities}, spawnPoint=${n.spawnPoint}, entityType=${n.entityType}`)));for(const n of this.entityPaths){if(this.logicFrame<=120&&this.logicFrame%60===0&&console.log(`[PATH-SPAWN] Checking path: id=${n.id}, entityType=${n.entityType}, activeEntities=${n.activeEntities}, maxEntities=${n.maxEntities}`),n.waypoints.length===0)continue;const s=this.pathSpawnTimers.get(n.id)||0;if(this.frameCount<s){this.logicFrame<=120&&console.log(`[PATH-SPAWN] Path ${n.id}: skipping - frameCount=${this.frameCount} < timer=${s}`);continue}if(n.activeEntities>=n.maxEntities){this.logicFrame<=120&&console.log(`[PATH-SPAWN] Path ${n.id}: skipping - activeEntities=${n.activeEntities} >= maxEntities=${n.maxEntities}`);continue}const r=n.waypoints[0].y,d=n.waypoints[n.waypoints.length-1].y<r,f=Ta.getDetectedTerrainWidth(this.campaign,this.level),p=ca(this.campaign,this.level),m=((f??p.mapWidthExtended)-w)/2,_=-150,S=-50,R=n.entityType===A.ENEMY_TANK||n.entityType===A.ENEMY_LARGE_TANK;let b;R||n.direction==="down"?b=_+Math.random()*(S-_):n.direction==="up"?b=G+50+Math.random()*100:b=-200+Math.random()*(G+400);const x=bt.TOTAL_MAP_HEIGHT,N=b-G+x-this.tilemapScrollY;let L=0,O=1/0;for(let ce=0;ce<n.waypoints.length;ce++){const _e=Math.abs(n.waypoints[ce].y-N);_e<O&&(O=_e,L=ce)}const I=300,Y=n.id.startsWith("path_");this.logicFrame<=120&&this.logicFrame%60===0&&console.log(`[PATH-SPAWN] Path ${n.id}: isAddedPath=${Y}`);let W,Z=null;if(Y){let ce;if(n.spawnPoint==="top")ce=0;else if(n.spawnPoint==="bottom")ce=n.waypoints.length-1;else{const Je=n.waypoints.map(ye=>ye.y),U=Math.min(...Je),se=Math.max(...Je);n.direction==="up"?ce=n.waypoints.findIndex(ye=>ye.y===se):ce=n.waypoints.findIndex(ye=>ye.y===U)}const _e=n.waypoints[ce];W=ce/(n.waypoints.length-1),Z=_e,this.frameCount<=5&&console.log(`[PATH-SPAWN] Added path ${n.id}: immediate spawn at waypoint ${ce}, progress=${W}, spawnPoint=${n.spawnPoint}`)}else{if(O>I)continue;W=L/(n.waypoints.length-1)}const K=Z||n.waypoints[L];let Q;if(Y){const ce=(p.mapWidthExtended-w)/2;Q=K.x-ce}else{const ce=this.getPathHorizontalOffset(n.id);Q=K.x-m+ce}const me=G-x+this.tilemapScrollY+K.y,pe=150,fe=this.entities.filter(ce=>{var _e;return((_e=ce.pathFollow)==null?void 0:_e.pathId)===n.id&&ce.active});let re=!1;for(const ce of fe){const _e=ce.pos.y+ce.size.height/2;if(Math.abs(me-_e)<pe){re=!0;break}}if(!re){const ce={id:0,x:0,y:0,type:n.entityType},_e=this.getEntityPropsForType(n.entityType,ce,t),Je=_e.size,U=_e.hp;let se;Y&&n.spawnPoint?n.spawnPoint==="top"?se=1:se=-1:n.direction==="up"?se=d?1:-1:n.direction==="down"?se=d?-1:1:W<.1?se=1:W>.9?se=-1:se=Math.random()<.5?1:-1;const ye=n.waypoints.map(va=>va.y),$e=Math.min(...ye),Ze=Math.max(...ye),P=Math.max(Ze-$e,100),le=1/(P/oa),ue=1+n.speedMultiplier;let Le=1;n.entityType===A.ENEMY_BATTLESHIP?Le=Sh:n.entityType===A.ENEMY_TANK?Le=Th:n.entityType===A.ENEMY_LARGE_TANK&&(Le=vh);const q=le*ue*Le,be=n.entityType===A.ENEMY_TANK||n.entityType===A.ENEMY_LARGE_TANK,he=be?ue*Le:void 0;console.log(`[PATH] Spawning ${n.entityType}: progress=${(W*100).toFixed(0)}%, pathYSpan=${P.toFixed(0)}, pathSpeed=${q.toFixed(6)}${be?`, ySpeed=${he==null?void 0:he.toFixed(3)}`:""}`),console.log(`[PATH] Spawn position: screenX=${Q.toFixed(0)}, screenY=${me.toFixed(0)}, waypointY=${K.y.toFixed(0)}, tilemapScrollY=${this.tilemapScrollY.toFixed(0)}`);const Be={id:`path_${n.id}_${this.frameCount}`,type:n.entityType,pos:{x:Q-Je.width/2,y:me-Je.height/2},vel:{vx:0,vy:0},size:Je,hp:U,active:!0,altitude:this.getDefaultAltitude(n.entityType),pathFollow:{pathId:n.id,pathProgress:W,pathSpeed:q,pathDirection:se,lastWaypointIndex:L,anchorSvgY:be?K.y:void 0,worldY:be?K.y:void 0,ySpeedMultiplier:he},frame:0,animationSpeed:_e.animationSpeed,maxFrames:_e.maxFrames,turrets:_e.turrets};this.entities.push(Be),n.activeEntities++,this.pathSpawnTimers.set(n.id,this.frameCount+n.spawnInterval);const qt=n.direction==="down"?"moving down":n.direction==="up"?"moving up":"random";console.log(`[PATH] Spawned ${n.entityType} on path ${n.id} (${qt})`)}}}updatePathFollowingEntity(t){if(!t.pathFollow)return;t.type===A.ENEMY_BATTLESHIP&&this.logicFrame%60===0&&console.log(`[BATTLESHIP-POS] pos.y=${t.pos.y.toFixed(0)}, active=${t.active}, hasBeenOnScreen=${t.pathFollow.hasBeenOnScreen}, progress=${(t.pathFollow.pathProgress*100).toFixed(1)}%`);const n=this.entityPaths.find(Q=>Q.id===t.pathFollow.pathId);if(!n||n.waypoints.length<2){t.active=!1;return}const s=t.type===A.ENEMY_TANK||t.type===A.ENEMY_LARGE_TANK,r=n.waypoints.length,o=t.pathFollow.pathSpeed;o>0&&(t.pathFollow.pathProgress+=o*t.pathFollow.pathDirection,t.pathFollow.pathProgress>=1?(t.pathFollow.pathProgress=1,n.direction==="random"&&(t.pathFollow.pathDirection=-1)):t.pathFollow.pathProgress<=0&&(t.pathFollow.pathProgress=0,n.direction==="random"&&(t.pathFollow.pathDirection=1)));let d,f;if(s&&t.pathFollow.worldY!==void 0){let Q=0,me=1/0;for(let re=0;re<r;re++){const ce=Math.abs(n.waypoints[re].y-t.pathFollow.worldY);ce<me&&(me=ce,Q=re)}d=Math.max(0,Math.min(Q,r-2));const pe=n.waypoints[d].y,fe=n.waypoints[Math.min(d+1,r-1)].y;Math.abs(fe-pe)>.01?(f=(t.pathFollow.worldY-pe)/(fe-pe),f=Math.max(0,Math.min(1,f))):f=0}else{const Q=t.pathFollow.pathProgress*(r-1),me=Math.floor(Q);f=Q-me,d=Math.min(me,r-2)}const p=n.waypoints[d],y=n.waypoints[Math.min(d+1,r-1)],m=p.x+(y.x-p.x)*f,_=p.y+(y.y-p.y)*f,S=Ta.getDetectedTerrainWidth(this.campaign,this.level),R=ca(this.campaign,this.level),x=((S??R.mapWidthExtended)-w)/2,N=n.id.startsWith("path_");let L;if(N){const Q=(R.mapWidthExtended-w)/2;L=m-Q}else{const Q=this.getPathHorizontalOffset(n.id);L=m-x+Q}const O=bt.TOTAL_MAP_HEIGHT;let I;s&&t.pathFollow.worldY!==void 0&&t.pathFollow.ySpeedMultiplier!==void 0?(t.pathFollow.worldY+=oa*t.pathFollow.ySpeedMultiplier,I=G-O+this.tilemapScrollY+t.pathFollow.worldY):I=G-O+this.tilemapScrollY+_,t.pos.x=L-t.size.width/2,t.pos.y=I-t.size.height/2,N&&t.type===A.ENEMY_BATTLESHIP&&this.frameCount%30===0&&console.log(`[PATH-MOVE] Battleship on ${n.id}: pos.y=${t.pos.y.toFixed(0)}, progress=${(t.pathFollow.pathProgress*100).toFixed(1)}%, svgY=${_.toFixed(0)}, dir=${t.pathFollow.pathDirection}`);const Y=p.tangentX+(y.tangentX-p.tangentX)*f,W=p.tangentY+(y.tangentY-p.tangentY)*f;if(s){const Q=t.size.width,me=this.entities.filter(pe=>{var fe;return pe.active&&pe.id!==t.id&&(pe.type===A.ENEMY_TANK||pe.type===A.ENEMY_LARGE_TANK)&&((fe=pe.pathFollow)==null?void 0:fe.pathId)===t.pathFollow.pathId});for(const pe of me){if(!pe.pathFollow)continue;const fe=pe.pos.x-t.pos.x,re=pe.pos.y-t.pos.y;if(Math.sqrt(fe*fe+re*re)<Q){const _e=pe.pathFollow.pathProgress-t.pathFollow.pathProgress;if(_e>0&&t.pathFollow.pathDirection===1||_e<0&&t.pathFollow.pathDirection===-1){t.pathFollow.pathDirection=t.pathFollow.pathDirection===1?-1:1,t.pathFollow.lastReversalFrame=this.frameCount,t.pathFollow.lastReversalProgress=t.pathFollow.pathProgress,console.log(`[TANK] Collision avoidance: ${t.id} reversed direction`);break}}}}const Z=t.pathFollow.pathDirection;if(Math.abs(Y)>.01||Math.abs(W)>.01){let Q=Math.atan2(W*Z,Y*Z)+Math.PI/2;s&&(Q=-Q+Math.PI),t.rotation=Q}if(t.pathFollow.lastWaypointIndex=d,!t.pathFollow.hasBeenOnScreen&&t.pos.y>=0&&t.pos.y<=G&&(t.pathFollow.hasBeenOnScreen=!0),t.type===A.ENEMY_BATTLESHIP||t.type===A.AIRCRAFT_CARRIER||t.type===A.DESTROYER){const Q=t.pathFollow.hasBeenOnScreen&&t.pos.y<-300;(t.pos.y>G+150||Q)&&(t.active=!1,n.activeEntities=Math.max(0,n.activeEntities-1))}else{const Q=t.pathFollow.hasBeenOnScreen&&t.pos.y<-300;(t.pos.y>G+300||Q)&&(t.active=!1,n.activeEntities=Math.max(0,n.activeEntities-1))}}decrementPathActiveEntities(t){if(t.pathFollow){const n=this.entityPaths.find(s=>s.id===t.pathFollow.pathId);n&&(n.activeEntities=Math.max(0,n.activeEntities-1))}}getWaterBoundsAtScreenY(t){const n=this.tilemapScrollY+t;return this.getWaterBoundsAtWorldY(n)}getWaterBoundsAtWorldY(t){for(const n of this.waterZones){if(n.shape!=="rect"||!n.width||!n.height)continue;const s=n.y-n.height/2,r=n.y+n.height/2,o=bt.TOTAL_MAP_HEIGHT,d=o-r,f=o-s;if(t>=d&&t<=f){const p=n.width/2;return{minX:n.x-p,maxX:n.x+p}}}return null}spawnWaves(){this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE||(this.currentLevelMap?(this.spawnFromLevelMap(),this.updateAltitudeZones()):this.spawnProceduralWaves())}spawnFromLevelMap(){if(!this.currentLevelMap)return;const t=this.getDifficultyMultiplier(),n=oa;for(let s=0;s<this.currentLevelMap.spawns.length;s++){const r=this.currentLevelMap.spawns[s];this.spawnedEntityIds.has(s)||this.levelProgress>=r.frameOffset&&(this.spawnedEntityIds.add(s),this.spawnEntityFromMap(r,t,n,s))}}spawnEntityFromMap(t,n,s,r){const o=t.x*(w-100)+50,d=t.yOffset||0,f=this.getEntityTypeFromString(t.type);if(f===null){console.warn(`[LEVEL MAP] Unknown entity type: ${t.type}`);return}const p=this.getEntityPropsForType(f,t,n),y=this.getVelocityForPattern(t.movementPattern,n,f),m={id:`map_${this.level}_${r}_${Math.random().toString(36).substr(2,9)}`,type:f,pos:{x:o,y:-p.size.height+d},vel:y,size:p.size,hp:p.hp,active:!0,frame:0,scoreValue:p.score,hitFlash:0,spriteVariant:t.variant||0,altitude:t.altitude,turrets:p.turrets,animationSpeed:p.animationSpeed,maxFrames:p.maxFrames};if(this.entities.push(m),t.formation)for(let _=1;_<t.formation.count;_++)setTimeout(()=>{const S={...m,id:`map_${this.level}_${r}_f${_}_${Math.random().toString(36).substr(2,9)}`,pos:{x:o+_*t.formation.spacing,y:-p.size.height+d-_*30}};this.entities.push(S)},_*(t.formation.delay||10)*16)}getEntityTypeFromString(t){return{ENEMY_SMALL:A.ENEMY_SMALL,ENEMY_RED:A.ENEMY_RED,ENEMY_BIG:A.ENEMY_BIG,ENEMY_HELICOPTER:A.ENEMY_HELICOPTER,ENEMY_BATTLESHIP:A.ENEMY_BATTLESHIP,VILLAGE:A.VILLAGE,FORTRESS:A.FORTRESS,AA_EMPLACEMENT:A.AA_EMPLACEMENT,RADAR_STATION:A.RADAR_STATION,FUEL_DEPOT:A.FUEL_DEPOT,AIRFIELD:A.AIRFIELD,SUPPLY_CONVOY:A.SUPPLY_CONVOY,ENEMY_TANK:A.ENEMY_TANK,ENEMY_LARGE_TANK:A.ENEMY_LARGE_TANK,AIRCRAFT_CARRIER:A.AIRCRAFT_CARRIER,DESTROYER:A.DESTROYER,SUPPLY_SHIP:A.SUPPLY_SHIP,SUBMARINE:A.SUBMARINE,PT_BOAT:A.PT_BOAT}[t]||null}getEntityPropsForType(t,n,s){const r=s.enemyHP;switch(t){case A.ENEMY_SMALL:case A.ENEMY_RED:let o=3;return this.campaign===Ee.STEEL_VANGUARD?o=4:this.campaign===Ee.HELLFIRE_HORIZON&&(o=6),{size:{width:66,height:66},hp:o,score:t===A.ENEMY_RED?150:100};case A.ENEMY_BIG:return{size:{width:177,height:138},hp:Math.floor(35*r),score:2e3,turrets:this.createBomberTurrets()};case A.ENEMY_HELICOPTER:return{size:{width:89,height:89},hp:Math.floor(12*r),score:500,animationSpeed:.2,maxFrames:2};case A.ENEMY_BATTLESHIP:return{size:{width:140,height:300},hp:Math.floor(170*r),score:5e3,turrets:this.createBattleshipTurrets({width:140,height:300})};case A.AIRCRAFT_CARRIER:return{size:{width:na.AIRCRAFT_CARRIER.width,height:na.AIRCRAFT_CARRIER.height},hp:Math.floor(na.AIRCRAFT_CARRIER.hp*r),score:na.AIRCRAFT_CARRIER.score,turrets:this.createCarrierTurrets()};case A.DESTROYER:return{size:{width:na.DESTROYER.width,height:na.DESTROYER.height},hp:Math.floor(na.DESTROYER.hp*r),score:na.DESTROYER.score,turrets:this.createDestroyerTurrets()};case A.SUPPLY_SHIP:return{size:{width:na.SUPPLY_SHIP.width,height:na.SUPPLY_SHIP.height},hp:Math.floor(na.SUPPLY_SHIP.hp*r),score:na.SUPPLY_SHIP.score};case A.SUBMARINE:return{size:{width:na.SUBMARINE.width,height:na.SUBMARINE.height},hp:Math.floor(na.SUBMARINE.hp*r),score:na.SUBMARINE.score};case A.PT_BOAT:return{size:{width:na.PT_BOAT.width,height:na.PT_BOAT.height},hp:Math.floor(na.PT_BOAT.hp*r),score:na.PT_BOAT.score};case A.VILLAGE:return{size:{width:Tt.VILLAGE.width,height:Tt.VILLAGE.height},hp:Math.floor(Tt.VILLAGE.hp*r),score:Tt.VILLAGE.score};case A.FORTRESS:return{size:{width:Tt.FORTRESS.width,height:Tt.FORTRESS.height},hp:Math.floor(Tt.FORTRESS.hp*r),score:Tt.FORTRESS.score,turrets:this.createFortressTurrets()};case A.AA_EMPLACEMENT:return{size:{width:Tt.AA_EMPLACEMENT.width,height:Tt.AA_EMPLACEMENT.height},hp:Math.floor(Tt.AA_EMPLACEMENT.hp*r),score:Tt.AA_EMPLACEMENT.score,turrets:[{id:Math.random().toString(),relPos:{x:32,y:32},angle:0,cooldown:Tt.AA_EMPLACEMENT.turretFireRate,fireRate:Tt.AA_EMPLACEMENT.turretFireRate,hp:3,hitFlash:0}]};case A.RADAR_STATION:return{size:{width:Tt.RADAR_STATION.width,height:Tt.RADAR_STATION.height},hp:Math.floor(Tt.RADAR_STATION.hp*r),score:Tt.RADAR_STATION.score};case A.FUEL_DEPOT:return{size:{width:Tt.FUEL_DEPOT.width,height:Tt.FUEL_DEPOT.height},hp:Math.floor(Tt.FUEL_DEPOT.hp*r),score:Tt.FUEL_DEPOT.score};case A.AIRFIELD:return{size:{width:Tt.AIRFIELD.width,height:Tt.AIRFIELD.height},hp:Math.floor(Tt.AIRFIELD.hp*r),score:Tt.AIRFIELD.score,turrets:this.createAirfieldTurrets()};case A.SUPPLY_CONVOY:return{size:{width:Tt.SUPPLY_CONVOY.width,height:Tt.SUPPLY_CONVOY.height},hp:Math.floor(Tt.SUPPLY_CONVOY.hp*r),score:Tt.SUPPLY_CONVOY.score};case A.ENEMY_TANK:return{size:{width:80,height:60},hp:Math.floor(50*r),score:1500,turrets:this.createTankTurrets({width:80,height:60})};case A.ENEMY_LARGE_TANK:return{size:{width:120,height:80},hp:Math.floor(95*r),score:3500,turrets:this.createLargeTankTurrets({width:120,height:80})};default:return{size:{width:64,height:64},hp:10,score:100}}}getVelocityForPattern(t,n,s){let r;s===A.ENEMY_BATTLESHIP||s===A.AIRCRAFT_CARRIER||s===A.DESTROYER?r=Sh:s===A.ENEMY_TANK?r=Th:s===A.ENEMY_LARGE_TANK?r=vh:s===A.ENEMY_BIG?r=oa:s===A.ENEMY_RED?r=oa+.5:s===A.ENEMY_SMALL?r=oa+1.5:r=Math.max(oa,Po);let o;switch(t){case"straight":o={vx:0,vy:r*n.speed};break;case"sine":o={vx:1.5*n.speed,vy:r*n.speed};break;case"tracking":o={vx:0,vy:r*.8*n.speed};break;case"stationary":o={vx:0,vy:oa};break;default:o={vx:0,vy:r*n.speed}}return o}createBattleshipTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"t1",relPos:{x:t.width/2,y:t.height*.3},angle:0,cooldown:300,fireRate:30,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0},{id:"t2",relPos:{x:t.width/2,y:t.height*.7},angle:Math.PI,cooldown:350,fireRate:30,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0}]}createCarrierTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(5*t);return[{id:"c1",relPos:{x:40,y:80},angle:-Math.PI/2,cooldown:40,fireRate:75,hp:n,hitFlash:0},{id:"c2",relPos:{x:140,y:80},angle:Math.PI/2,cooldown:50,fireRate:75,hp:n,hitFlash:0},{id:"c3",relPos:{x:40,y:320},angle:-Math.PI/2,cooldown:60,fireRate:75,hp:n,hitFlash:0},{id:"c4",relPos:{x:140,y:320},angle:Math.PI/2,cooldown:70,fireRate:75,hp:n,hitFlash:0}]}createDestroyerTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(4*t);return[{id:"d1",relPos:{x:50,y:50},angle:0,cooldown:50,fireRate:60,hp:n,hitFlash:0},{id:"d2",relPos:{x:50,y:125},angle:0,cooldown:60,fireRate:60,hp:n,hitFlash:0},{id:"d3",relPos:{x:50,y:200},angle:Math.PI,cooldown:70,fireRate:60,hp:n,hitFlash:0}]}createFortressTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(6*t);return[{id:"f1",relPos:{x:40,y:40},angle:-Math.PI/4,cooldown:75,fireRate:40,hp:n,hitFlash:0},{id:"f2",relPos:{x:160,y:40},angle:Math.PI/4,cooldown:85,fireRate:40,hp:n,hitFlash:0},{id:"f3",relPos:{x:40,y:160},angle:-3*Math.PI/4,cooldown:95,fireRate:40,hp:n,hitFlash:0},{id:"f4",relPos:{x:160,y:160},angle:3*Math.PI/4,cooldown:105,fireRate:40,hp:n,hitFlash:0}]}createAirfieldTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(4*t);return[{id:"a1",relPos:{x:50,y:75},angle:0,cooldown:60,fireRate:50,hp:n,hitFlash:0},{id:"a2",relPos:{x:250,y:75},angle:0,cooldown:80,fireRate:50,hp:n,hitFlash:0}]}createTankTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"tank_main",relPos:{x:t.width/2,y:t.height*.4},angle:0,cooldown:60,fireRate:50,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0}]}createLargeTankTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"ltank_main",relPos:{x:t.width/2,y:t.height*.35},angle:0,cooldown:75,fireRate:40,hp:Math.floor((3+Math.floor(this.level/2))*n),hitFlash:0},{id:"ltank_mg",relPos:{x:t.width/2,y:t.height*.65},angle:Math.PI,cooldown:40,fireRate:75,hp:Math.floor((2+Math.floor(this.level/3))*n),hitFlash:0}]}createBomberTurrets(){const t=this.getCampaignTurretHPMult();return[{id:"bomber_rear",relPos:{x:88,y:115},angle:Math.PI,cooldown:75+Math.floor(Math.random()*30),fireRate:40,hp:Math.floor(5*t),hitFlash:0}]}updateAltitudeZones(){if(!this.currentLevelMap)return;let t=null;for(const n of this.currentLevelMap.altitudeZones)if(this.levelProgress>=n.startFrame&&this.levelProgress<=n.endFrame){t=n;break}t&&!this.currentAltitudeZone?(this.currentAltitudeZone=t,this.altitudeZoneNotified=!1,console.log(`[ALTITUDE ZONE] Entering: ${t.description} (suggested altitude: ${t.suggestedAltitude})`),this.playerAltitude===Wt.HIGH_ALTITUDE&&!this.isTransitioningAltitude&&(console.log(`[ALTITUDE ZONE] Auto-diving to altitude ${t.suggestedAltitude}`),this.startDiveBomb(t.suggestedAltitude))):!t&&this.currentAltitudeZone&&(console.log("[ALTITUDE ZONE] Exiting zone, climbing back to high altitude"),this.playerAltitude!==Wt.HIGH_ALTITUDE&&!this.isTransitioningAltitude&&this.climbUp(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1)}spawnProceduralWaves(){const t=this.getDifficultyMultiplier();this.logicFrame%Math.floor(400/t.spawn)===0&&this.entities.push({id:Math.random().toString(),type:A.ENEMY_HELICOPTER,pos:{x:Math.random()*(w-83),y:-90},vel:{vx:0,vy:2},size:{width:89,height:89},hp:Math.floor(12*t.enemyHP),active:!0,frame:0,scoreValue:500,hitFlash:0,animationSpeed:.2,maxFrames:2}),this.logicFrame%170===0&&this.spawnEnemyFormation(),this.logicFrame%Math.floor(600/t.spawn)===0&&this.entities.push({id:Math.random().toString(),type:A.ENEMY_BIG,pos:{x:w/2-82,y:-145},vel:{vx:0,vy:oa*t.speed},size:{width:177,height:138},hp:Math.floor(35*t.enemyHP),active:!0,frame:0,scoreValue:2e3,hitFlash:0,spriteVariant:Math.floor(Math.random()*3),turrets:this.createBomberTurrets()});const n=this.entityPaths.some(o=>o.entityType===A.ENEMY_BATTLESHIP);if(this.waterZones.length>0&&n&&this.logicFrame===501&&console.log("[SPAWN] Zone-based battleship spawning DISABLED - entity paths exist for battleships"),this.waterZones.length>0&&!n&&this.logicFrame>500&&this.logicFrame%Math.floor(1200/t.spawn)===0){const o={width:140,height:300};let d=10;for(;d>0;){const f=this.getWaterSpawnX(),p={x:f,y:-350},y=!this.checkOverlap({...p,...o},[A.ENEMY_BATTLESHIP]),m=this.getWaterBoundsAtWorldY(this.tilemapScrollY+p.y),_=m&&f>=m.minX&&f+o.width<=m.maxX;if(y&&_){const S=this.createBattleshipTurrets(o);this.entities.push({id:Math.random().toString(),type:A.ENEMY_BATTLESHIP,pos:p,vel:{vx:0,vy:Sh*t.speed},size:o,hp:Math.floor(170*t.enemyHP),active:!0,frame:0,scoreValue:5e3,turrets:S,hitFlash:0,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Battleship spawned in water zone at X=${p.x.toFixed(0)}`);break}d--}d===0&&console.log("[TERRAIN] Battleship spawn skipped - overlapping with existing battleship")}const s=this.entityPaths.some(o=>o.entityType===A.ENEMY_TANK);if(this.roadZones.length>0&&!s&&this.logicFrame>500&&this.logicFrame%Math.floor(800/t.spawn)===0){const o=this.getRoadSpawnX();if(o>=0){const d={width:80,height:60},f={x:o,y:-80},p=!this.checkOverlap({...f,...d},[A.ENEMY_TANK,A.ENEMY_LARGE_TANK]),y=this.getRoadBoundsAtWorldY(this.tilemapScrollY+f.y),m=y&&o>=y.minX&&o+d.width<=y.maxX;if(p&&m){const _=this.createTankTurrets(d);this.entities.push({id:Math.random().toString(),type:A.ENEMY_TANK,pos:f,vel:{vx:0,vy:Th*t.speed},size:d,hp:Math.floor(50*t.enemyHP),active:!0,frame:0,scoreValue:1500,turrets:_,hitFlash:0,altitude:Wt.LOW_ALTITUDE,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Tank spawned in road zone at X=${f.x.toFixed(0)}`)}}}const r=this.entityPaths.some(o=>o.entityType===A.ENEMY_LARGE_TANK);if(this.roadZones.length>0&&!r&&this.logicFrame>1e3&&this.logicFrame%Math.floor(1500/t.spawn)===0){const o=this.getRoadSpawnX();if(o>=0){const d={width:120,height:80},f={x:o,y:-100},p=!this.checkOverlap({...f,...d},[A.ENEMY_TANK,A.ENEMY_LARGE_TANK]),y=this.getRoadBoundsAtWorldY(this.tilemapScrollY+f.y),m=y&&o>=y.minX&&o+d.width<=y.maxX;if(p&&m){const _=this.createLargeTankTurrets(d);this.entities.push({id:Math.random().toString(),type:A.ENEMY_LARGE_TANK,pos:f,vel:{vx:0,vy:vh*t.speed},size:d,hp:Math.floor(95*t.enemyHP),active:!0,frame:0,scoreValue:3500,turrets:_,hitFlash:0,altitude:Wt.LOW_ALTITUDE,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Large Tank spawned in road zone at X=${f.x.toFixed(0)}`)}}}}checkCollisions(){const t=this.entities.find(d=>d.type===A.PLAYER),n=[],s=[],r=[],o=[];this.entities.length>250&&console.warn(`[FREEZE DEBUG] checkCollisions() with ${this.entities.length} entities`);for(const d of this.entities)if(d.active)switch(d.type){case A.BULLET_PLAYER:n.push(d);break;case A.ENEMY_SMALL:case A.ENEMY_RED:case A.ENEMY_BIG:case A.ENEMY_HELICOPTER:case A.BOSS:s.push(d),r.push(d);break;case A.ENEMY_BATTLESHIP:case A.ENEMY_TANK:case A.ENEMY_LARGE_TANK:s.push(d);break;case A.BULLET_ENEMY:case A.BULLET_CANNON:case A.BULLET_TURRET:r.push(d);break;case A.POWERUP:o.push(d);break}(n.length>100||r.length>100)&&console.warn(`[FREEZE DEBUG] Collision workload: ${n.length} player bullets  ${s.length} enemies + ${r.length} threats`);for(const d of n){if(!d.active)continue;if(d.active){const p=(t==null?void 0:t.pos.x)??w/2,y=dt.checkBulletCollision(d.pos.x+d.size.width/2,d.pos.y+d.size.height/2,Math.max(d.size.width,d.size.height)/2,this.tilemapScrollY,p);if(y){d.active=!1;const m=dt.getTurret(y),_=dt.getTurretScreenPosition(y,this.tilemapScrollY,p),S=dt.damageTurret(y,1);if(m&&_&&(this.spawnDebris(_.x,_.y,nt.GREY,3),Te.emitSparks(_.x,_.y,8),S)){const R=m.metadata.scoreValue||200;this.score+=R,Se.playEnemyExplosion(),this.spawnExplosion({x:_.x-20,y:_.y-20},{width:40,height:40}),Te.emitExplosionDebris(_.x,_.y,10),this.spawnFloatingScore(_.x,_.y,R,"turret"),this.spawnTurretDebris(_.x,_.y),console.log(`[TERRAIN] Turret ${y} destroyed!`)}}}if(d.active&&this.activeBoss&&this.activeBoss.turrets&&this.activeBoss.turrets.length>0){for(const p of this.activeBoss.turrets){if(p.hp<=0)continue;const y=this.activeBoss.pos.x+p.relPos.x-20,m=this.activeBoss.pos.y+p.relPos.y-20;if(d.pos.x<y+40&&d.pos.x+d.size.width>y&&d.pos.y<m+40&&d.pos.y+d.size.height>m){d.active=!1,p.hp--,this.spawnDebris(y+20,m+20,nt.GREY,3),Te.emitSparks(y+20,m+20,10),p.hp<=0&&(this.score+=200,Se.playEnemyExplosion(),this.spawnExplosion({x:y,y:m},{width:40,height:40}),this.activeBoss.hp-=3,Te.emitExplosionDebris(y+20,m+20,15),Te.emitFire(y+20,m+20,2),this.spawnFloatingScore(y+20,m+20,200,"turret"),this.spawnTurretDebris(y+20,m+20),console.log(`[BOSS] Turret destroyed! Boss HP: ${this.activeBoss.hp}, Turrets remaining: ${this.activeBoss.turrets.filter(b=>b.hp>0).length}`));break}}this.activeBoss.turrets=this.activeBoss.turrets.filter(p=>p.hp>0)}if(!d.active)continue;const f=this.getDynamicTerrainParallaxOffset((t==null?void 0:t.pos.x)??w/2);for(const p of s)if(p.active&&this.isCollidingWithParallax(d,p,f)){d.active=!1;const y=d.hp||1;p.hp-=y,p.type!==A.BOSS&&(p.hitFlash=2),p.type===A.BOSS&&console.log(`[FREEZE DEBUG] Boss hit! HP: ${p.hp}, Frame: ${this.logicFrame}`),this.spawnDebris(d.pos.x,d.pos.y,nt.YELLOW,1);const m=p.type===A.BOSS?8:5;Te.emitSparks(d.pos.x+2,d.pos.y+2,m);const _=p.pos.x+p.size.width/2+(Math.random()-.5)*p.size.width*.6,S=p.pos.y+p.size.height/2+(Math.random()-.5)*p.size.height*.6;if(Te.emitSparks(_,S,p.type===A.BOSS?6:3),p.hp<=0)this.destroyEnemy(p);else{const R=this.getEnemyMaxHP(p.type),b=1-p.hp/R;if(b>.3&&Math.random()<.3){const x=p.pos.x+p.size.width/2,N=p.pos.y+p.size.height/2;Te.emitEnemyDamageSmoke(x,N,1+b)}}break}d.active&&d.pos.y<-20&&(d.active=!1)}if(t&&!t.isEvading&&t.active&&this.playerInvincible<=0){const d=this.getDynamicTerrainParallaxOffset(t.pos.x);for(const f of r){if(!f.active||f.hp<=0)continue;if(f.type===A.BULLET_ENEMY||f.type===A.BULLET_CANNON||f.type===A.BULLET_TURRET?this.isColliding(t,f):this.isCollidingWithParallax(t,f,d)){let m=0;f.type===A.BULLET_ENEMY?m=20:f.type===A.BULLET_CANNON?m=50:f.type===A.BULLET_TURRET?m=Hn.DAMAGE:f.type===A.ENEMY_SMALL||f.type===A.ENEMY_RED||f.type===A.ENEMY_HELICOPTER?m=40:f.type===A.ENEMY_BIG?m=60:f.type===A.BOSS&&(m=100),this.destroyPlayer(t,m),(f.type===A.BULLET_ENEMY||f.type===A.BULLET_CANNON||f.type===A.BULLET_TURRET)&&(f.active=!1);break}}}if(t&&t.active){const d=this.getDynamicTerrainParallaxOffset(t.pos.x);for(const f of o)if(this.isCollidingWithParallax(t,f,d)){f.active=!1,this.score+=500,Se.playPowerUp();const p=f.pos.x+f.size.width/2,y=f.pos.y+f.size.height/2;if(this.freezeFrame(3),this.setCameraZoom(1.15,15),setTimeout(()=>{this.setCameraZoom(1,15)},250),f.powerupType===da.FIREPOWER)Te.emitFire(p,y,10),Te.emitShrapnel(p,y,8);else if(f.powerupType===da.BOMB)Te.emitMuzzleFlash(p,y,0),Te.emitExplosionDebris(p,y,12);else if(f.powerupType===da.INVINCIBILITY){for(let m=0;m<16;m++){const _=Math.PI*2/16*m;Te.emitBulletTracer(p,y,Math.cos(_)*3,Math.sin(_)*3)}Te.emitSparks(p,y,15)}if(f.powerupType===da.FIREPOWER){const m=f.firepowerTier||$a.STANDARD;this.firepowerBullets===0?(this.firepowerBullets=oi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=m):m===this.activeFirepowerTier?(this.firepowerBullets+=oi.BULLETS_PER_POWERUP,this.firepowerStacks=Math.min(this.firepowerStacks+1,oi.MAX_STACKS)):m===$a.ENHANCED?this.enhancedFirepowerCount=Math.min(this.enhancedFirepowerCount+1,9):this.standardFirepowerCount=Math.min(this.standardFirepowerCount+1,9)}else if(f.powerupType===da.BOMB){if(this.bombQueue.length<Et.MAX_BOMBS){const m=f.bombTier||this.getBombTierForLevel();this.bombQueue.push(m)}}else f.powerupType===da.INVINCIBILITY?this.playerInvincible=210:f.powerupType===da.SPREAD&&(this.spreadBullets===0?(this.spreadBullets=oi.BULLETS_PER_POWERUP,this.spreadStacks=1):(this.spreadBullets+=oi.BULLETS_PER_POWERUP,this.spreadStacks=Math.min(this.spreadStacks+1,oi.MAX_STACKS)))}}}getHitbox(t){let n=.7,s=.7;t.type===A.BOSS?(n=.8,s=.8):t.type===A.ENEMY_BATTLESHIP?(n=.4,s=.9):t.type===A.ENEMY_BIG?(n=.8,s=.6):t.type===A.PLAYER&&(n=.4,s=.7),(t.type===A.BULLET_PLAYER||t.type===A.BULLET_ENEMY||t.type===A.BULLET_CANNON||t.type===A.BULLET_TURRET)&&(n=1,s=1);const r=t.size.width*n,o=t.size.height*s,d=t.pos.x+(t.size.width-r)/2,f=t.pos.y+(t.size.height-o)/2;return{x:d,y:f,width:r,height:o}}isColliding(t,n){const s=this.getHitbox(t),r=this.getHitbox(n);return s.x<r.x+r.width&&s.x+s.width>r.x&&s.y<r.y+r.height&&s.y+s.height>r.y}isCollidingWithParallax(t,n,s){const r=this.getHitbox(t),o=this.getHitbox(n),d=o.x-s;return r.x<d+o.width&&r.x+r.width>d&&r.y<o.y+o.height&&r.y+r.height>o.y}spawnDebris(t,n,s,r){const o=this.entities.filter(d=>d.type===A.PARTICLE).length;if(o>150&&(r=Math.floor(r/2)),!(o>300))for(let d=0;d<r;d++)this.entities.push({id:Math.random().toString(),type:A.PARTICLE,pos:{x:t,y:n},vel:{vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10},size:{width:6,height:6},hp:30+Math.random()*20,active:!0,frame:0,color:s})}spawnTurretDebris(t,n){this.entities.push({id:`turret_debris_base_${Math.random()}`,type:A.PARTICLE,pos:{x:t-5,y:n},vel:{vx:-4-Math.random()*3,vy:3+Math.random()*3},size:{width:18,height:14},hp:70,active:!0,frame:0,color:"#8b7355",rotation:0,scoreValue:.18+Math.random()*.12}),this.entities.push({id:`turret_debris_cannon_${Math.random()}`,type:A.PARTICLE,pos:{x:t+5,y:n-5},vel:{vx:4+Math.random()*3,vy:-4-Math.random()*3},size:{width:22,height:8},hp:70,active:!0,frame:0,color:"#5c5c5c",rotation:Math.PI/4,scoreValue:-.22-Math.random()*.12});for(let s=0;s<6;s++){const r=Math.PI*2*s/6+Math.random()*.5,o=5+Math.random()*4;this.entities.push({id:`turret_debris_shrapnel_${Math.random()}`,type:A.PARTICLE,pos:{x:t,y:n},vel:{vx:Math.cos(r)*o,vy:Math.sin(r)*o},size:{width:6,height:6},hp:50+Math.random()*25,active:!0,frame:0,color:"#a0a0a0"})}}spawnSmoke(t,n){this.entities.push({id:Math.random().toString(),type:A.SMOKE,pos:{x:t,y:n},vel:{vx:(Math.random()-.5)*1,vy:0},size:{width:10,height:10},hp:60,active:!0,frame:0})}spawnWake(t,n){this.entities.push({id:Math.random().toString(),type:A.WAKE,pos:{x:t,y:n},vel:{vx:0,vy:0},size:{width:20,height:5},hp:120,active:!0,frame:0})}destroyEnemy(t){this.decrementPathActiveEntities(t);const n=t.type===A.ENEMY_SMALL||t.type===A.ENEMY_RED||t.type===A.ENEMY_BIG||t.type===A.ENEMY_HELICOPTER||t.type===A.BOSS;this.combo++,this.comboTimer=this.COMBO_TIMEOUT;const s=Math.min(this.combo,8);this.addHeat();const r=(t.scoreValue||100)*s,o=this.getHeatMultiplier(),d=this.awardScoreWithHeat(r),f=t.pos.x+t.size.width/2,p=t.pos.y,y=t.type===A.ENEMY_BIG?"bomber":"fighter";if(this.spawnFloatingScore(f,p,d,y,o>1?o:void 0),this.checkComboMilestones(),this.screenShake=5,Se.playEnemyExplosion(),t.type===A.ENEMY_RED){const m=Math.random()*100,_=10;let S;m<_?S=da.INVINCIBILITY:m<50+_/2?S=da.FIREPOWER:S=da.BOMB;const R=S===da.BOMB?this.getBombTierForLevel():void 0,b=S===da.FIREPOWER?this.getFirepowerTierForLevel():void 0;this.entities.push({id:Math.random().toString(),type:A.POWERUP,pos:{...t.pos},vel:{vx:0,vy:oa+.5},size:{width:32,height:32},hp:1,active:!0,frame:0,powerupType:S,bombTier:R,firepowerTier:b})}if(n){const _=Math.random()>.5?1:-1;this.entities.push({id:Math.random().toString(),type:A.CRASHING_AIRCRAFT,pos:{...t.pos},vel:{vx:_*(.8+Math.random()*.4),vy:2.5+Math.random()*1},size:{...t.size},hp:0,active:!0,frame:t.frame,rotation:t.rotation||0,crashTimer:38,crashRotationSpeed:0,originalType:t.type,bossType:t.bossType,crashDiveAngle:_,colorPalette:t.colorPalette,spriteVariant:t.spriteVariant,maxFrames:t.maxFrames,animationSpeed:t.animationSpeed,scale:1}),t.active=!1,Se.playSmallExplosion(),Se.playDescending();const S=t.pos.x+t.size.width/2,R=t.pos.y+t.size.height/2;Te.emitSmokePlume(S,R,1),Te.emitSparks(S,R,8),Te.emitFire(S,R,.5)}else t.active=!1,this.triggerFullExplosion(t)}triggerFullExplosion(t){const n=t.pos.x+t.size.width/2,s=t.pos.y+t.size.height/2,r=t.originalType||t.type;this.spawnExplosion(t.pos,t.size),this.spawnDebris(n,s,nt.ORANGE,5),this.spawnDebris(n,s,nt.RED,4),this.spawnDebris(n,s,nt.GREY,3),Te.emitExplosionDebris(n,s,15),(r===A.ENEMY_BIG||r===A.ENEMY_BATTLESHIP||r===A.BOSS)&&Te.emitFire(n,s,5),Te.emitShrapnel(n,s,12);const o=t.colorPalette||this.getDefaultColorPalette(r),d=r===A.ENEMY_BIG||r===A.ENEMY_BATTLESHIP||r===A.BOSS?18:10;Te.emitSpriteDebris(n,s,o,d)}triggerBossCrashExplosion(){if(!this.crashingBoss)return;const t=this.crashingBoss.pos.x+this.crashingBoss.size.width/2,n=this.crashingBoss.pos.y+this.crashingBoss.size.height/2;console.log("[BOSS] Crash explosion triggered at",t,n);for(let r=0;r<6;r++){const o=(Math.random()-.5)*this.crashingBoss.size.width,d=(Math.random()-.5)*this.crashingBoss.size.height*.5;this.spawnExplosion({x:t+o-40,y:n+d-40},{width:80,height:80}),Te.emitExplosionDebris(t+o,n+d,20),Te.emitFire(t+o,n+d,6)}for(let r=0;r<5;r++){const o=(Math.random()-.5)*this.crashingBoss.size.width;Te.emitSmokePlume(t+o,n,5)}Te.emitShrapnel(t,n,40);const s=this.crashingBoss.colorPalette||this.getDefaultColorPalette(A.BOSS);Te.emitSpriteDebris(t,n,s,25),this.spawnDebris(t,n,nt.ORANGE,8),this.spawnDebris(t,n,nt.RED,6),this.spawnDebris(t,n,nt.GREY,5),this.screenShake=45,this.postProcessing.triggerWhiteFlash(.7,12),Se.playEnemyExplosion(),this.crashingBoss=null,this.bossCrashTimer=0,setTimeout(async()=>{try{console.log("[FREEZE DEBUG] Boss crash cleanup"),this.setTimeScale(1,0),this.resetCamera(),this.playerInvincible=180;const r=this.level>=this.MAX_LEVEL;this.startIntermission(r)}catch(r){console.error("[FREEZE DEBUG] Error in boss crash cleanup:",r),this.bossDefeating=!1,this.setTimeScale(1,0),this.state=te.PLAYING}},1e3)}finishBossDefeat(){setTimeout(async()=>{try{console.log("[FREEZE DEBUG] Boss defeat cleanup (off-screen)"),this.setTimeScale(1,0),this.resetCamera(),this.playerInvincible=180;const t=this.level>=this.MAX_LEVEL;this.startIntermission(t)}catch(t){console.error("[FREEZE DEBUG] Error in boss defeat cleanup:",t),this.bossDefeating=!1,this.setTimeScale(1,0),this.state=te.PLAYING}},500)}getDefaultColorPalette(t){switch(t){case A.ENEMY_SMALL:case A.ENEMY_RED:return{primary:"#4a6b4a",secondary:"#6b6b6b",accent:"#8b7355"};case A.ENEMY_HELICOPTER:return{primary:"#556b2f",secondary:"#708090",accent:"#2f4f4f"};case A.ENEMY_BIG:return{primary:"#484848",secondary:"#3c5a3c",accent:"#5a5a5a"};case A.ENEMY_BATTLESHIP:return{primary:"#708090",secondary:"#4a4a4a",accent:"#5f6f7f"};case A.ENEMY_TANK:case A.ENEMY_LARGE_TANK:return{primary:"#6b5a3a",secondary:"#4a5a4a",accent:"#3a3a3a"};default:return{primary:"#888888",secondary:"#666666",accent:"#444444"}}}destroyPlayer(t,n=100){if(this.playerHealth-=n,this.playerHealth<=0){this.playerHealth=0,t.active=!1;const s=t.pos.x+t.size.width/2,r=t.pos.y+t.size.height/2;this.setTimeScale(.5,0),setTimeout(()=>this.setTimeScale(1,0),800),this.setCameraZoom(.7,40),this.camera.targetRotation=-.1,this.screenShake=25,this.postProcessing.triggerWhiteFlash(.7,12),this.postProcessing.triggerDamageVignette(.8,40),Se.playPlayerExplosion(),this.spawnExplosion(t.pos,t.size),Te.emitExplosionDebris(s,r,25),Te.emitFire(s,r,12),Te.emitShrapnel(s,r,20),Te.emitSmokePlume(s,r,8),this.spawnDebris(s,r,nt.WHITE,15),this.spawnDebris(s,r,nt.RED,12),this.spawnDebris(s,r,nt.ORANGE,10),this.resetCamera()}else this.screenShake=Math.min(8,Math.floor(n/10)),this.postProcessing.triggerDamageVignette(.4,20),this.playerInvincible<=0&&(this.playerInvincible=60),Se.playEnemyExplosion()}spawnExplosion(t,n){this.entities.push({id:Math.random().toString(),type:A.EXPLOSION,pos:{x:t.x,y:t.y},vel:{vx:0,vy:2},size:{width:n.width,height:n.width},hp:1,active:!0,frame:0,maxFrames:20})}spawnEnemyFormation(){const t=this.getDifficultyMultiplier(),n=wy(this.campaign),s=Py(this.campaign),r=80,o=r+Math.random()*(w-r*2),d=My(n.type,s,o,-60),f=Wg(this.campaign,this.level),p=Ly(n.movementPattern,o,f);let y;for(let m=0;m<d.length;m++){const _=d[m],S=Math.random().toString();m===0&&(y=S);const R=m===0?{x:0,y:0}:{x:_.x-d[0].x,y:_.y-d[0].y},b=p.map(Z=>({x:Z.x+R.x,y:Z.y+R.y,speed:Z.speed})),x=Fy(b,m===0?void 0:y,R),N=this.campaign===Ee.HELLFIRE_HORIZON?.4:this.campaign===Ee.STEEL_VANGUARD?.25:.15,L=m>0&&Math.random()<N,O=L?A.ENEMY_RED:A.ENEMY_SMALL,I=L?7:5,Y=L?300:100,W=Kg(_,b[0],Po*f*t.speed);this.entities.push({id:S,type:O,pos:{..._},vel:{...W},size:{width:66,height:66},hp:Math.floor(I*t.enemyHP),active:!0,frame:0,scoreValue:Y,hitFlash:0,bankAngle:0,rotation:Qg(W),formationState:x})}}spawnSupportFighter(){console.log("[SUPPORT]  Spawning support fighter with SPREAD powerup!"),this.entities.push({id:"support-fighter",type:A.SUPPORT_FIGHTER,pos:{x:-80,y:G*.4},vel:{vx:8,vy:0},size:{width:66,height:66},hp:100,active:!0,frame:0,hitFlash:0}),Se.playPowerUp()}updateSupportFighter(t){const n=w/2;t.hp===100&&t.pos.x>=n-40&&(t.hp=50,console.log("[SUPPORT]  Dropping SPREAD powerup at center!"),this.entities.push({id:Math.random().toString(),type:A.POWERUP,pos:{x:t.pos.x+t.size.width/2-20,y:t.pos.y+t.size.height},vel:{vx:0,vy:oa+.5},size:{width:40,height:40},hp:1,active:!0,frame:0,powerupType:da.SPREAD,isSpecial:!0}),Te.emitSparks(t.pos.x+t.size.width/2,t.pos.y+t.size.height,10),Se.playPowerUp()),t.pos.x>w+100&&(t.active=!1)}getDynamicTerrainParallaxOffset(t){const n=Vn(this.campaign,this.level);if(n){const s=Ta.getDetectedTerrainWidth(this.campaign,this.level),r=ca(this.campaign,this.level),o=s??r.mapWidthExtended,d=gl(o,n.leftX,n.rightX,w),f=w/2,p=(t-f)/f;return Math.floor(p*d)}return ic(t,w)}calculateHeatLevel(){const t=ms.THRESHOLDS;return this.heatPoints>=t.BLAZING?Ut.BLAZING:this.heatPoints>=t.ON_FIRE?Ut.ON_FIRE:this.heatPoints>=t.HOT?Ut.HOT:this.heatPoints>=t.WARM?Ut.WARM:Ut.COLD}getHeatMultiplier(){return ms.MULTIPLIERS[this.heatLevel]}addHeat(t=ms.HEAT_PER_KILL,n=!1){const s=this.combo*ms.HEAT_PER_COMBO_POINT,r=n?ms.HEAT_PER_TARGET:0;this.heatPoints+=t+s+r,this.heatDecayTimer=0;const o=this.calculateHeatLevel();o!==this.heatLevel&&(this.onHeatLevelChange(this.heatLevel,o),this.heatLevel=o)}onHeatLevelChange(t,n){const s=[Ut.COLD,Ut.WARM,Ut.HOT,Ut.ON_FIRE,Ut.BLAZING],r=s.indexOf(t),o=s.indexOf(n);o>r&&(Se.playHeatLevelUp(o),n===Ut.BLAZING?(this.postProcessing.triggerWhiteFlash(.6,15),this.screenShake=8):n===Ut.ON_FIRE?(this.postProcessing.triggerWhiteFlash(.4,10),this.screenShake=5):n===Ut.HOT&&this.postProcessing.triggerWhiteFlash(.2,8))}updateHeatDecay(){if(!(this.heatPoints<=0)&&(this.heatDecayTimer++,this.heatDecayTimer>ms.DECAY_DELAY)){this.heatPoints-=ms.DECAY_PER_FRAME,this.heatPoints<0&&(this.heatPoints=0);const t=this.calculateHeatLevel();t!==this.heatLevel&&(this.heatLevel=t)}}awardScoreWithHeat(t){const n=this.getHeatMultiplier(),s=Math.floor(t*n);return this.score+=s,this.checkScoreMilestones(),s}checkScoreMilestones(){for(const t of vy)this.score>=t.score&&this.lastScoreMilestone<t.score&&(this.lastScoreMilestone=t.score,this.score+=t.bonus,Se.playJackpot(),this.postProcessing.triggerWhiteFlash(.8,20),this.screenShake=15,this.addHeat(5),console.log(`[MILESTONE] ${t.label} - Bonus: +${t.bonus}`))}checkComboMilestones(){for(const t of Ry)this.combo>=t.combo&&this.lastComboMilestone<t.combo&&(this.lastComboMilestone=t.combo,this.awardScoreWithHeat(t.bonus),t.combo>=10?(Se.playJackpot(),this.postProcessing.triggerWhiteFlash(.6,15),this.screenShake=10):t.combo>=5?(Se.playComboUp(),this.postProcessing.triggerWhiteFlash(.3,10),this.screenShake=5):Se.playComboUp(),console.log(`[COMBO] ${t.label} - Bonus: +${t.bonus}`));this.combo===0&&(this.lastComboMilestone=0)}resetHeatSystem(){this.heatPoints=0,this.heatLevel=Ut.COLD,this.heatDecayTimer=0,this.lastHeatLevel=Ut.COLD,this.lastScoreMilestone=0,this.lastComboMilestone=0,this.floatingScores=[],this.lingeringFireZones=[],this.pendingScores=[],this.pendingScoreTimer=0}spawnFloatingScore(t,n,s,r="fighter",o){this.pendingScores.push({x:t,y:n,points:Math.floor(s),entityType:r,heatLevel:this.heatLevel}),this.pendingScoreTimer=this.SCORE_BUNDLE_WINDOW}processPendingScores(){if(this.pendingScores.length===0)return;const t=this.pendingScores.reduce((p,y)=>p+y.points,0),n=this.pendingScores.reduce((p,y)=>p+y.x,0)/this.pendingScores.length,s=this.pendingScores.reduce((p,y)=>p+y.y,0)/this.pendingScores.length,r=this.pendingScores.length,o=[Ut.BLAZING,Ut.ON_FIRE,Ut.HOT,Ut.WARM,Ut.COLD],d=this.pendingScores.reduce((p,y)=>{const m=o.indexOf(p);return o.indexOf(y.heatLevel)<m?y.heatLevel:p},Ut.COLD);let f="fighter";this.pendingScores.some(p=>p.entityType==="bomber")?f="bomber":this.pendingScores.some(p=>p.entityType==="turret")?f="turret":this.pendingScores.some(p=>p.entityType==="target")&&(f="target"),this.floatingScores.push({x:n,y:s,points:t,frame:0,maxFrames:90,heatLevel:d,multiplier:r>1?r:void 0,entityType:f}),this.pendingScores=[]}updateFloatingScores(){this.pendingScoreTimer>0&&(this.pendingScoreTimer--,this.pendingScoreTimer===0&&this.pendingScores.length>0&&this.processPendingScores());for(let t=this.floatingScores.length-1;t>=0;t--){const n=this.floatingScores[t];n.frame++,n.frame>=n.maxFrames&&this.floatingScores.splice(t,1)}}}let _s=new Map;const y_=20;class E_{constructor(){this.frameTimeHistory=[],this.HISTORY_SIZE=60,this.lastFrameTime=0,this.currentFPS=60,this.targetFPS=60,this.qualityLevel="HIGH",this.isMobile=!1,this.isLowEndDevice=!1,this.consecutiveLowFrames=0,this.consecutiveHighFrames=0,this.lastQualityChange=0,this.QUALITY_CHANGE_COOLDOWN=120,this.detectDevice(),this.cachedSettings=this.getSettingsForLevel(this.qualityLevel)}detectDevice(){this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);const t=navigator.hardwareConcurrency||2,n=navigator.deviceMemory||4;this.isLowEndDevice=t<=4||n<=2,this.isMobile?this.isLowEndDevice?this.qualityLevel="LOW":this.qualityLevel="MEDIUM":this.qualityLevel="HIGH",this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log("[PerformanceManager] Device detected:",{isMobile:this.isMobile,isLowEnd:this.isLowEndDevice,cores:t,memory:n,initialQuality:this.qualityLevel})}startFrame(){this.lastFrameTime=performance.now()}endFrame(){const t=performance.now()-this.lastFrameTime;if(this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length>=10){const n=this.frameTimeHistory.reduce((s,r)=>s+r,0)/this.frameTimeHistory.length;this.currentFPS=Math.round(1e3/n)}this.adjustQuality()}adjustQuality(){if(this.frameTimeHistory.length<this.QUALITY_CHANGE_COOLDOWN)return;this.currentFPS<45?(this.consecutiveLowFrames++,this.consecutiveHighFrames=0,this.consecutiveLowFrames>30&&(this.decreaseQuality(),this.consecutiveLowFrames=0)):this.currentFPS>=58?(this.consecutiveHighFrames++,this.consecutiveLowFrames=0,this.consecutiveHighFrames>180&&(this.increaseQuality(),this.consecutiveHighFrames=0)):(this.consecutiveLowFrames=0,this.consecutiveHighFrames=0)}decreaseQuality(){const t=["ULTRA","HIGH","MEDIUM","LOW"],n=t.indexOf(this.qualityLevel);n<t.length-1&&(this.qualityLevel=t[n+1],this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log(`[PerformanceManager] Quality decreased to ${this.qualityLevel} (FPS: ${this.currentFPS})`))}increaseQuality(){if(this.isMobile&&this.isLowEndDevice)return;const t=["ULTRA","HIGH","MEDIUM","LOW"],n=t.indexOf(this.qualityLevel),s=this.isMobile?"HIGH":"ULTRA",r=t.indexOf(s);n>r&&(this.qualityLevel=t[n-1],this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log(`[PerformanceManager] Quality increased to ${this.qualityLevel} (FPS: ${this.currentFPS})`))}getSettingsForLevel(t){switch(t){case"ULTRA":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:1,maxParticles:500,enablePostProcessing:!0,enableClouds:!0,enableScreenShake:!0,enableCameraZoom:!0,shadowQuality:"full",explosionDetail:"full",maxEntities:200};case"HIGH":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:.7,maxParticles:300,enablePostProcessing:!0,enableClouds:!0,enableScreenShake:!0,enableCameraZoom:!0,shadowQuality:"full",explosionDetail:"full",maxEntities:150};case"MEDIUM":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:.4,maxParticles:150,enablePostProcessing:!1,enableClouds:!1,enableScreenShake:!0,enableCameraZoom:!1,shadowQuality:"full",explosionDetail:"simple",maxEntities:100};case"LOW":return{qualityLevel:t,enableShadows:!1,enableParticles:!1,particleMultiplier:0,maxParticles:0,enablePostProcessing:!1,enableClouds:!1,enableScreenShake:!1,enableCameraZoom:!1,shadowQuality:"none",explosionDetail:"simple",maxEntities:75}}}getSettings(){return this.cachedSettings}getFPS(){return this.currentFPS}getQualityLevel(){return this.qualityLevel}setQualityLevel(t){this.qualityLevel=t,this.cachedSettings=this.getSettingsForLevel(t),console.log(`[PerformanceManager] Quality set to ${t}`)}getIsMobile(){return this.isMobile}getShadowCanvas(t,n){const s=`${t}x${n}`;if(!_s.has(s)){if(_s.size>=y_){const o=_s.keys().next().value;o&&_s.delete(o)}const r=document.createElement("canvas");r.width=t,r.height=n,_s.set(s,r)}return _s.get(s)}clearShadowCache(){_s.clear()}}const ko=new E_,Rp=(c,t,n)=>{if(c===0)return null;const s="w-7 h-7 sm:w-8 sm:h-8";return c===1?M.jsx("div",{className:"flex items-center",children:M.jsx("img",{src:t,alt:n,className:s,style:{imageRendering:"pixelated"}})}):M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("img",{src:t,alt:n,className:s,style:{imageRendering:"pixelated"}}),M.jsxs("span",{className:"text-white font-bold text-sm sm:text-base drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]",children:["x",c]})]})},__=({score:c,highScore:t,lives:n,bombs:s,level:r,combo:o,activeBoss:d,playerHealth:f,maxPlayerHealth:p,firepowerCount:y,bombCount:m,invincibilityCount:_,firepowerSprite:S,firepowerEnhancedSprite:R,bombSprite:b,invincibilitySprite:x,firepowerBullets:N,firepowerStacks:L,activeFirepowerTier:O,spreadBullets:I,spreadStacks:Y,enemyFighterSprite:W,playerInvincible:Z,gameEngine:K,canvasBounds:Q})=>{const[me,pe]=$.useState(c),fe=$.useRef(c);$.useEffect(()=>{if(c!==fe.current){const le=Math.ceil((c-me)/10);if(Math.abs(c-me)>0){const ue=setTimeout(()=>{pe(Le=>{const q=Le+le;return le>0?Math.min(q,c):Math.max(q,c)})},16);return()=>clearTimeout(ue)}fe.current=c}},[c,me]);const[re,ce]=$.useState(f),[_e,Je]=$.useState(f);$.useEffect(()=>{ce(f);const le=setTimeout(()=>{Je(f)},300);return()=>clearTimeout(le)},[f]),d&&d.hp/d.maxHP*100;const U=re/p*100,se=_e/p*100,ye=I>0||N>0,$e=I>0;let Ze=0,P=S;if($e){const le=oi.BULLETS_PER_POWERUP*Y;Ze=I/le*100,P=S}else if(N>0){const le=oi.BULLETS_PER_POWERUP*L;Ze=N/le*100,P=O===$a.ENHANCED?R:S}const ee=Math.ceil(Ze/100*10);return M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"absolute pointer-events-none z-50 flex items-center gap-2",style:{left:Q?Q.offsetLeft+8:8,bottom:Q?Q.offsetTop+8:8},children:[M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:N>0||y>0?Rp(L+y,N>0&&O===$a.ENHANCED?R:S,"Firepower"):M.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"NO FIRE"})}),M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:m>0?Rp(m,b,"Bomb"):M.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"NO BOMBS"})}),Z>0&&M.jsxs("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2 flex items-center gap-2",children:[M.jsx("img",{src:x,alt:"Shield",className:"w-7 h-7 sm:w-8 sm:h-8 animate-pulse",style:{imageRendering:"pixelated"}}),M.jsx("div",{className:"flex gap-0.5",children:Array.from({length:7}).map((le,ue)=>{const Le=30*(7-ue);return M.jsx("div",{className:`w-2 sm:w-2.5 h-5 sm:h-6 rounded transition-colors ${Z>=Le?"bg-gradient-to-t from-purple-600 to-purple-400":Z>=Le-30?"bg-gradient-to-t from-purple-600 to-purple-400 animate-pulse":"bg-gray-700/50"}`},ue)})})]})]}),M.jsx("div",{className:"absolute pointer-events-none z-50",style:{right:Q?Q.offsetLeft+8:8,bottom:Q?Q.offsetTop+8:8},children:M.jsxs("div",{className:"flex items-center gap-4 sm:gap-5 bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:[ye&&M.jsxs("div",{className:"flex items-center gap-2.5",children:[M.jsx("img",{src:P,alt:"Ammo",className:"w-8 h-8 sm:w-9 sm:h-9",style:{imageRendering:"pixelated"}}),M.jsx("div",{className:"flex gap-0.5",children:Array.from({length:10}).map((le,ue)=>M.jsx("div",{className:`w-2.5 sm:w-3 h-5 sm:h-6 rounded transition-colors ${ue<ee?Ze>30?"bg-gradient-to-t from-orange-600 to-orange-400":"bg-gradient-to-t from-red-700 to-red-500 animate-pulse":"bg-gray-700/50"}`},ue))})]}),ye&&M.jsx("div",{className:"w-px h-6 bg-gray-600"}),M.jsxs("div",{className:"flex items-center gap-1.5",children:[M.jsx("img",{src:W,alt:"Lives",className:"w-7 h-7 sm:w-8 sm:h-8",style:{imageRendering:"pixelated"}}),M.jsxs("span",{className:"text-green-400 font-bold text-sm sm:text-base",children:["x",n]})]})]})}),M.jsx("div",{className:"absolute pointer-events-none z-50",style:{right:Q?Q.offsetLeft+8:8,top:Q?Q.offsetTop+8:8},children:M.jsxs("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:[M.jsx("div",{className:"text-right mb-1 whitespace-nowrap",children:M.jsx("span",{className:"text-cyan-400 font-bold text-xs sm:text-sm tracking-wider drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:"HULL INTEGRITY"})}),M.jsxs("div",{className:"relative w-48 sm:w-64 h-5 sm:h-6 bg-gray-900/80 border border-cyan-600 rounded-lg overflow-hidden",children:[M.jsx("div",{className:"absolute inset-0 bg-red-900/50 transition-all duration-300",style:{width:`${se}%`}}),M.jsx("div",{className:`absolute inset-0 transition-all duration-100 ${U>66?"bg-gradient-to-r from-green-500 to-cyan-400":U>33?"bg-gradient-to-r from-yellow-500 to-orange-400":"bg-gradient-to-r from-red-600 to-red-400 animate-pulse"}`,style:{width:`${U}%`},children:M.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent"})}),M.jsx("div",{className:"absolute inset-0 flex",children:Array.from({length:10}).map((le,ue)=>M.jsx("div",{className:"flex-1 border-r border-black/30"},ue))}),M.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:M.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]",children:[Math.ceil(U),"%"]})})]})]})}),o>1&&M.jsx("div",{className:"absolute top-20 sm:top-32 pointer-events-none",style:{left:Q?o%2===0?Q.offsetLeft+16:Q.offsetLeft+Q.renderWidth-80:o%2===0?16:void 0,right:!Q&&o%2!==0?16:void 0},children:M.jsxs("div",{className:"text-center animate-bounce",children:[M.jsx("div",{className:"absolute inset-0 blur-xl bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 opacity-60 animate-pulse"}),M.jsxs("div",{className:"relative text-3xl sm:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 drop-shadow-[0_4px_8px_rgba(0,0,0,0.9)] animate-pulse",children:["x",o]}),M.jsx("div",{className:"relative text-xs sm:text-sm font-bold text-yellow-300 tracking-wider sm:tracking-widest drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:"COMBO!"})]})})]})};function A_(c){if(c.length<qa.CIRCLE_MIN_POINTS||c[c.length-1].time-c[0].time>qa.CIRCLE_MAX_DURATION)return!1;const n=c.reduce((p,y)=>p+y.x,0)/c.length,s=c.reduce((p,y)=>p+y.y,0)/c.length,r=c.map(p=>Math.hypot(p.x-n,p.y-s)),o=r.reduce((p,y)=>p+y,0)/r.length;if(o<qa.CIRCLE_MIN_RADIUS||o>qa.CIRCLE_MAX_RADIUS)return!1;let d=0;for(let p=1;p<c.length;p++){const y=Math.atan2(c[p-1].y-s,c[p-1].x-n);let _=Math.atan2(c[p].y-s,c[p].x-n)-y;for(;_>Math.PI;)_-=2*Math.PI;for(;_<-Math.PI;)_+=2*Math.PI;d+=_}const f=qa.CIRCLE_MIN_ANGLE*Math.PI/180;return Math.abs(d)>f}const S_=({onMove:c,onFire:t,onEvade:n,onBomb:s,onFirstTouch:r})=>{const o=$.useRef(null),d=$.useRef(!1),f=$.useRef(null),p=$.useRef(null),y=$.useRef(null),m=$.useRef(0),_=$.useRef(null),S=$.useRef([]),R=$.useRef(0),b=$.useRef(!1);return $.useEffect(()=>{const x=o.current;if(!x)return;const N=I=>{I.preventDefault(),!d.current&&r&&(d.current=!0,r()),Array.from(I.changedTouches).forEach(Y=>{const W=Y.clientX,Z=Y.clientY;if(f.current===null){f.current=Y.identifier,p.current={x:W,y:Z};return}if(y.current===null){const K=Date.now();if(K-m.current<qa.DOUBLE_TAP_WINDOW&&_.current!==null&&Math.hypot(W-_.current.x,Z-_.current.y)<qa.DOUBLE_TAP_DISTANCE){s(),"vibrate"in navigator&&navigator.vibrate(200),m.current=0,_.current=null;return}y.current=Y.identifier,t(!0),"vibrate"in navigator&&navigator.vibrate(10),S.current=[{x:W,y:Z,time:K}],R.current=K,b.current=!1}})},L=I=>{I.preventDefault(),Array.from(I.touches).forEach(Y=>{if(Y.identifier===f.current&&p.current){const W=Y.clientX-p.current.x,Z=Y.clientY-p.current.y;let K=W/qa.JOYSTICK_MAX_DISTANCE,Q=Z/qa.JOYSTICK_MAX_DISTANCE;K=Math.max(-1,Math.min(1,K)),Q=Math.max(-1,Math.min(1,Q)),Math.hypot(K,Q)<qa.JOYSTICK_DEAD_ZONE&&(K=0,Q=0),c(K,Q)}if(Y.identifier===y.current&&!b.current){const W=Date.now();if(W-R.current>=qa.CIRCLE_SAMPLE_INTERVAL){R.current=W,S.current.push({x:Y.clientX,y:Y.clientY,time:W});const Z=W-qa.CIRCLE_MAX_DURATION;S.current=S.current.filter(K=>K.time>=Z),A_(S.current)&&(n(),"vibrate"in navigator&&navigator.vibrate([30,30,30]),S.current=[],b.current=!0)}}})},O=I=>{Array.from(I.changedTouches).forEach(Y=>{Y.identifier===f.current&&(f.current=null,p.current=null,c(0,0)),Y.identifier===y.current&&(y.current=null,t(!1),m.current=Date.now(),_.current={x:Y.clientX,y:Y.clientY},S.current=[],b.current=!1)})};return x.addEventListener("touchstart",N,{passive:!1}),x.addEventListener("touchmove",L,{passive:!1}),x.addEventListener("touchend",O,{passive:!1}),x.addEventListener("touchcancel",O,{passive:!1}),()=>{x.removeEventListener("touchstart",N),x.removeEventListener("touchmove",L),x.removeEventListener("touchend",O),x.removeEventListener("touchcancel",O)}},[c,t,n,s,r]),M.jsx("div",{ref:o,className:"absolute inset-0 z-40 touch-none",style:{pointerEvents:"auto"}})},Vo=["INITIALIZING MEMORY...","LOADING ROM DATA...","CHECKING GRAPHICS...","SOUND CHIP TEST...","CALIBRATING INPUTS...","LOADING SPRITES...","DECODING ASSETS...","SYSTEM READY..."],ri=8,T_=5,v_=({progress:c,width:t,height:n})=>{const s=$.useRef(null),r=$.useRef(0),o=$.useRef([]),d=$.useRef([]),[f,p]=$.useState(Vo[0]);return $.useEffect(()=>{const y=Math.min(Math.floor(c/100*Vo.length),Vo.length-1);p(Vo[y])},[c]),$.useEffect(()=>{const y=s.current;if(!y)return;const m=y.getContext("2d");if(!m)return;const _=Math.ceil(t/ri),S=Math.ceil(n/ri),R=()=>{const L=[];for(let O=0;O<S;O++){L[O]=[];for(let I=0;I<_;I++)L[O][I]=Math.random()}return L},b=()=>{const L=[];for(let O=0;O<8;O++){let I="";for(let Y=0;Y<24;Y++)I+=Math.random()>.5?"1":"0";L.push(I)}return L};o.current=R(),d.current=b();let x;const N=()=>{var Le,q,be;r.current++;const L=r.current;m.fillStyle="#000000",m.fillRect(0,0,t,n);const O=30,I=25,Y=50,W=O,Z=I,K=t-O*2,Q=n-I-Y;if(L%T_===0)for(let he=0;he<S;he++)for(let Be=0;Be<_;Be++)o.current[he][Be]=Math.random();if(L%8===0)for(let he=0;he<d.current.length;he++)d.current[he]=d.current[he].substring(1)+(Math.random()>.5?"1":"0");const me=.25+Math.sin(L*.05)*.05;for(let he=0;he<S;he++)for(let Be=0;Be<_;Be++){const qt=Be*ri,va=he*ri;if(qt>=W-ri&&qt<=W+K&&va>=Z-ri&&va<=Z+Q)continue;const Xn=o.current[he][Be];if(Xn<me){const Qa=Math.floor(Xn*200+55);m.fillStyle=`rgb(${Qa}, ${Qa}, ${Qa})`,m.fillRect(qt,va,ri-1,ri-1)}}m.fillStyle="#000000",m.fillRect(W,Z,K,Q),m.strokeStyle="#333",m.lineWidth=1,m.strokeRect(W,Z,K,Q),m.strokeStyle="#222",m.strokeRect(W+2,Z+2,K-4,Q-4);const pe=2+Math.floor(Math.sin(L*.02)+1);for(let he=0;he<pe;he++){const Be=(L*.5+he*120)%n;if(Be<Z||Be>Z+Q){const qt=2+L%3,va=80+Math.floor(Math.sin(L*.1)*40+40);m.fillStyle=`rgba(${va}, ${va}, ${va}, 0.25)`,m.fillRect(0,Be,t,qt)}}const fe=L*1.5%(n+40)-20;m.fillStyle="rgba(255, 255, 255, 0.03)",m.fillRect(0,fe,t,20),m.fillStyle="rgba(255, 255, 255, 0.06)",m.fillRect(0,fe+8,t,4),m.fillStyle="rgba(0, 0, 0, 0.08)";for(let he=0;he<n;he+=3)m.fillRect(0,he,t,1);m.save();const re=W+15,ce=W+K-15;let _e=Z+30;m.font="bold 14px monospace",m.textAlign="center";const Je=.9+Math.sin(L*.05)*.1;m.fillStyle=`rgba(255, 255, 255, ${Je})`,m.fillText("WORLD WAR II SKY ACE - SYSTEM BOOT",t/2,_e),_e+=25,m.fillStyle="#333",m.fillRect(re,_e,ce-re,1),_e+=20,m.font="10px monospace",m.fillStyle="#AAA",m.textAlign="left",m.fillText("ROM CHECK:    OK",re,_e),m.fillText("RAM CHECK:    OK",re,_e+18),m.fillText(`VRAM:         ${String(Math.floor(c*64)).padStart(4," ")}K / 6400K`,re,_e+36),m.textAlign="right",m.fillStyle="#888",m.fillText(`FRAME: ${String(L).padStart(6,"0")}`,ce,_e),m.fillText("VER:   1.942.0",ce,_e+18),_e+=55,m.fillStyle="#222",m.fillRect(re,_e,ce-re,1),_e+=18,m.font="9px monospace",m.fillStyle="#555",m.textAlign="left";for(let he=0;he<4;he++)m.fillText(d.current[he]||"",re,_e+he*16);m.textAlign="right";for(let he=4;he<8;he++)m.fillText(d.current[he]||"",ce,_e+(he-4)*16);_e+=70,m.font="8px monospace",m.fillStyle="#666",m.textAlign="left";for(let he=0;he<4;he++){const Be=32768+(Math.floor(L/3)*16+he*256)&65535,qt=Math.floor((((Le=o.current[he])==null?void 0:Le[0])||.5)*256);m.fillText(`0x${Be.toString(16).toUpperCase().padStart(4,"0")}:  ${qt.toString(16).toUpperCase().padStart(2,"0")}`,re,_e+he*14)}m.textAlign="right";for(let he=0;he<4;he++){const Be=49152+(Math.floor(L/3)*8+he*128)&65535,qt=Math.floor((((q=o.current[he])==null?void 0:q[1])||.5)*256);m.fillText(`${qt.toString(16).toUpperCase().padStart(2,"0")}  :0x${Be.toString(16).toUpperCase().padStart(4,"0")}`,ce,_e+he*14)}const U=Z+Q-70;m.fillStyle="#333",m.fillRect(re,U,ce-re,1),m.font="bold 11px monospace",m.fillStyle="#FFF",m.textAlign="center";const se=Math.floor(L/20)%2===0;m.fillText("> "+f+(se?"_":" "),t/2,U+22);const ye=U+35,$e=16,Ze=K-30,P=W+15,ee=Math.floor(Ze/ri),le=Math.floor(c/100*ee);m.fillStyle="#111",m.fillRect(P,ye,Ze,$e),m.strokeStyle="#333",m.strokeRect(P,ye,Ze,$e);for(let he=0;he<le;he++){const Be=180+Math.floor((((be=o.current[0])==null?void 0:be[he%_])||.5)*75);m.fillStyle=`rgb(${Be}, ${Be}, ${Be})`,m.fillRect(P+2+he*ri,ye+2,ri-2,$e-4)}le<ee&&L%6<3&&(m.fillStyle="#AAA",m.fillRect(P+2+le*ri,ye+2,ri-2,$e-4)),m.font="bold 10px monospace",m.fillStyle="#FFF",m.textAlign="center",m.fillText(`[ ${String(Math.floor(c)).padStart(3," ")}% ]`,t/2,ye+$e+15),m.restore(),Math.random()<.01&&(m.fillStyle="rgba(255, 255, 255, 0.015)",m.fillRect(0,0,t,n));const ue=m.createRadialGradient(t/2,n/2,n*.3,t/2,n/2,n*.8);ue.addColorStop(0,"rgba(0, 0, 0, 0)"),ue.addColorStop(1,"rgba(0, 0, 0, 0.4)"),m.fillStyle=ue,m.fillRect(0,0,t,n),x=requestAnimationFrame(N)};return N(),()=>{cancelAnimationFrame(x)}},[t,n,c]),M.jsx("canvas",{ref:s,width:t,height:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",imageRendering:"pixelated"}})},R_=()=>{const[c,t]=$.useState({isTouchDevice:!1,isMobile:!1,isLowPerformance:!1,screenWidth:typeof window<"u"?window.innerWidth:0,screenHeight:typeof window<"u"?window.innerHeight:0});return $.useEffect(()=>{const n=()=>{const s="ontouchstart"in window||navigator.maxTouchPoints>0,r=window.innerWidth<768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),d=(navigator.hardwareConcurrency||2)<4||r;t({isTouchDevice:s,isMobile:r,isLowPerformance:d,screenWidth:window.innerWidth,screenHeight:window.innerHeight})};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),c};class M_{constructor(){this.joystickX=0,this.joystickY=0,this.firePressed=!1,this.evadeTriggered=!1,this.bombTriggered=!1}setJoystickPosition(t,n){this.joystickX=t,this.joystickY=n}setFirePressed(t){this.firePressed=t}triggerEvade(){this.evadeTriggered=!0}triggerBomb(){this.bombTriggered=!0}getInputState(){const t=this.joystickX<-.2,n=this.joystickX>qa.JOYSTICK_DEAD_ZONE,s=this.joystickY<-.2,r=this.joystickY>qa.JOYSTICK_DEAD_ZONE,o=this.bombTriggered;this.bombTriggered=!1;const d=this.evadeTriggered;return this.evadeTriggered=!1,{left:t,right:n,up:s,down:r,fire:this.firePressed,evade:d,bomb:o}}mergeWithKeyboardInput(t,n){return{left:t.left||n.left,right:t.right||n.right,up:t.up||n.up,down:t.down||n.down,fire:t.fire||n.fire,evade:t.evade||n.evade,bomb:t.bomb||n.bomb}}reset(){this.joystickX=0,this.joystickY=0,this.firePressed=!1,this.evadeTriggered=!1,this.bombTriggered=!1}}const hl=new M_,b_=({gameState:c,onSave:t,onLoad:n})=>{const[s,r]=$.useState(V.getState().selectedElement),[o,d]=$.useState(V.getState().pendingChanges),[f,p]=$.useState(V.hasUnsavedChanges()),[y,m]=$.useState(V.getDesignScrollY()),[_,S]=$.useState("30"),[R,b]=$.useState("1.5"),[x,N]=$.useState("5000"),[L,O]=$.useState("0.0035"),[I,Y]=$.useState("down"),[W,Z]=$.useState("tank"),[K,Q]=$.useState("top"),[me,pe]=$.useState("0");$.useEffect(()=>{if(c!==te.DESIGN_MODE)return;const q=setInterval(()=>{const be=V.getState();r(be.selectedElement),d(be.pendingChanges),p(be.isDirty),m(be.designScrollY)},100);return()=>clearInterval(q)},[c]),$.useEffect(()=>{if(s){if(s.type==="turret"||s.type==="target"){const q=V.getEntityMetadata(s.id);s.type==="turret"?(S(String((q==null?void 0:q.hp)??30)),b(String((q==null?void 0:q.fireRate)??1.5))):N(String((q==null?void 0:q.points)??5e3))}else if(s.type==="path"){const q=V.getPathMetadata(s.id),be=V.getPathOffset(s.id);pe(String(be)),O(String((q==null?void 0:q.speed)??.0035)),Y((q==null?void 0:q.direction)??"down"),Z((q==null?void 0:q.entityType)??"tank"),Q((q==null?void 0:q.spawnPoint)??"top")}}},[s==null?void 0:s.id,s==null?void 0:s.type]);const fe=$.useCallback((q,be)=>{const he=parseInt(be,10);isNaN(he)||!s||(q==="x"?V.nudgeSelected(he-s.currentPosition.x,0):V.nudgeSelected(0,he-s.currentPosition.y),r(V.getState().selectedElement))},[s]);$.useCallback(q=>{const be=parseInt(q,10);if(isNaN(be)||!s||s.type!=="path")return;V.updatePathOffset(s.id,be);const he=V.getState();r(he.selectedElement),d(he.pendingChanges)},[s]);const re=$.useCallback(()=>{if(!s||s.type!=="turret")return;const q=parseInt(_,10);isNaN(q)||(V.updateEntityMetadata(s.id,{hp:Math.max(1,q)}),d(V.getState().pendingChanges),p(!0))},[s,_]),ce=$.useCallback(()=>{if(!s||s.type!=="turret")return;const q=parseFloat(R);isNaN(q)||(V.updateEntityMetadata(s.id,{fireRate:Math.max(.1,q)}),d(V.getState().pendingChanges),p(!0))},[s,R]),_e=$.useCallback(()=>{if(!s||s.type!=="target")return;const q=parseInt(x,10);isNaN(q)||(V.updateEntityMetadata(s.id,{points:Math.max(100,q)}),d(V.getState().pendingChanges),p(!0))},[s,x]),Je=$.useCallback(()=>{if(!s||s.type!=="path")return;const q=parseInt(me,10);isNaN(q)||(V.updatePathOffset(s.id,q),d(V.getState().pendingChanges),p(!0))},[s,me]),U=$.useCallback(()=>{if(!s||s.type!=="path")return;const q=parseFloat(L);isNaN(q)||(V.updatePathMetadata(s.id,{speed:Math.max(.001,q)}),d(V.getState().pendingChanges),p(!0))},[s,L]),se=$.useCallback(q=>{!s||s.type!=="path"||(Y(q),V.updatePathMetadata(s.id,{direction:q}),d(V.getState().pendingChanges),p(!0))},[s]),ye=$.useCallback(q=>{!s||s.type!=="path"||(Z(q),V.updatePathMetadata(s.id,{entityType:q}),d(V.getState().pendingChanges),p(!0))},[s]),$e=$.useCallback(q=>{!s||s.type!=="path"||(Q(q),V.updatePathMetadata(s.id,{spawnPoint:q}),d(V.getState().pendingChanges),p(!0))},[s]),Ze=$.useCallback(async()=>{if(t)t();else{const q=V.getPendingChanges(),be=V.getLevelInfo(),he={campaign:be.campaign,level:be.level,timestamp:new Date().toISOString(),...q},Be=JSON.stringify(he,null,2);console.log("[DESIGN MODE] Saving changes:",Be);try{await navigator.clipboard.writeText(Be),alert(`Design changes copied to clipboard!

Paste into the API or JSON file.`),V.markSaved(),p(!1)}catch(qt){console.error("Failed to copy to clipboard:",qt),alert("Save failed. Check console for JSON output.")}}},[t]),P=$.useCallback(()=>{if(n)n();else{const q=prompt("Paste design overrides JSON:");if(q)try{const be=JSON.parse(q);V.loadOverrides(be),d(V.getState().pendingChanges),p(!1),alert("Design overrides loaded!")}catch(be){console.error("Failed to parse JSON:",be),alert("Invalid JSON format.")}}},[n]),ee=$.useCallback(()=>{confirm("Reset all design changes to defaults?")&&(V.resetToDefaults(),d(V.getState().pendingChanges),r(null),p(!0))},[]);if(!Si||c!==te.DESIGN_MODE)return null;const le=V.getLevelInfo(),ue=bt.TOTAL_MAP_HEIGHT,Le=Math.round(y/(ue-G)*100);return M.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:100},children:[M.jsxs("div",{className:"absolute top-0 left-0 right-0 h-12 bg-black/80 border-b-2 border-cyan-500 flex items-center px-4 pointer-events-auto",style:{backdropFilter:"blur(4px)"},children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("span",{className:"text-green-400 font-bold text-lg",children:"DESIGN MODE"}),M.jsx("span",{className:"text-white/50",children:"|"}),M.jsxs("span",{className:"text-white",children:[le.campaign," Level ",le.level]})]}),M.jsx("div",{className:"flex-1 text-center",children:M.jsxs("span",{className:"text-cyan-400 font-mono",children:["Scroll: ",Le,"% (",Math.round(y)," / ",ue-G,")"]})}),M.jsxs("div",{className:"flex items-center gap-2",children:[f&&M.jsx("span",{className:"text-orange-400 text-sm mr-2",children:"* Unsaved"}),M.jsx("button",{onClick:P,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded border border-gray-500",children:"Load"}),M.jsx("button",{onClick:Ze,className:"px-3 py-1 bg-cyan-700 hover:bg-cyan-600 text-white text-sm rounded border border-cyan-500",children:"Save (S)"}),M.jsx("button",{onClick:ee,className:"px-3 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Reset"})]})]}),s&&M.jsxs("div",{className:"absolute top-14 right-2 w-56 bg-black/90 border-2 border-cyan-500 rounded p-3 pointer-events-auto",style:{backdropFilter:"blur(4px)"},children:[M.jsx("h3",{className:"text-cyan-400 font-bold mb-2 text-sm",children:s.type==="path"?"Selected Path":"Selected Element"}),M.jsxs("div",{className:"space-y-2 text-sm",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-gray-400",children:"ID:"}),M.jsx("span",{className:"text-white font-mono text-xs truncate max-w-32",children:s.id})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-gray-400",children:"Type:"}),M.jsx("span",{className:"text-white",children:s.type.toUpperCase()})]}),s.type==="path"?M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2 space-y-2",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"H-Offset:"}),M.jsx("input",{type:"number",value:me,onChange:q=>pe(q.target.value),onBlur:Je,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"}),M.jsx("span",{className:"text-gray-500 text-xs",children:"px"})]}),parseInt(me,10)!==0&&M.jsxs("div",{className:"text-orange-400 text-xs",children:["Offset: ",parseInt(me,10)>0?"+":"",me,"px"]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-cyan-400 text-xs font-bold mb-2",children:"Path Properties"}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Speed:"}),M.jsx("input",{type:"number",step:"0.001",value:L,onChange:q=>O(q.target.value),onBlur:U,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Direction:"}),M.jsxs("select",{value:I,onChange:q=>se(q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"up",children:"Up"}),M.jsx("option",{value:"down",children:"Down"}),M.jsx("option",{value:"random",children:"Random"})]})]}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Entity:"}),M.jsxs("select",{value:W,onChange:q=>ye(q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"tank",children:"Tank"}),M.jsx("option",{value:"battleship",children:"Battleship"})]})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Spawn:"}),M.jsxs("select",{value:K,onChange:q=>$e(q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"top",children:"Top (first vertex)"}),M.jsx("option",{value:"bottom",children:"Bottom (last vertex)"})]})]})]})]}):s.type==="turret"?M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:q=>fe("x",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:q=>fe("y",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-green-400 text-xs font-bold mb-2",children:"Turret Properties"}),M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"HP:"}),M.jsx("input",{type:"number",value:_,onChange:q=>S(q.target.value),onBlur:re,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"Fire Rate:"}),M.jsx("input",{type:"number",step:"0.1",value:R,onChange:q=>b(q.target.value),onBlur:ce,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]}):s.type==="target"?M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:q=>fe("x",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:q=>fe("y",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-pink-400 text-xs font-bold mb-2",children:"Target Properties"}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"Points:"}),M.jsx("input",{type:"number",step:"100",value:x,onChange:q=>N(q.target.value),onBlur:_e,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]}):M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:q=>fe("x",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:q=>fe("y",q.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),(s.currentPosition.x!==s.originalPosition.x||s.currentPosition.y!==s.originalPosition.y)&&M.jsxs("div",{className:"text-orange-400 text-xs",children:["Delta: (",Math.round(s.currentPosition.x-s.originalPosition.x),",",Math.round(s.currentPosition.y-s.originalPosition.y),")"]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]})]})]}),M.jsxs("div",{className:"absolute top-14 left-2 bg-black/70 border border-gray-600 rounded p-2 text-xs pointer-events-none",style:{backdropFilter:"blur(2px)"},children:[M.jsx("div",{className:"text-gray-400 mb-1 font-bold",children:"Shortcuts"}),M.jsxs("div",{className:"text-gray-500 space-y-0.5",children:[M.jsx("div",{children:"D / ESC: Exit"}),M.jsx("div",{children:"Arrows: Nudge (1px)"}),M.jsx("div",{children:"+Shift: Nudge (10px)"}),M.jsx("div",{children:"Del: Delete"}),M.jsx("div",{children:"PgUp/Dn: Scroll"}),M.jsx("div",{children:"Home/End: Jump"}),M.jsx("div",{children:"Drag: Move"}),M.jsx("div",{children:"Ctrl+Drag: Pan"}),M.jsx("div",{className:"border-t border-gray-600 pt-1 mt-1",children:"N: Add Entity Mode"}),M.jsx("div",{children:"Enter: Finish Path"})]})]})]})},O_=({isOpen:c,onClose:t})=>{const[n,s]=$.useState(sa.getSettings());$.useEffect(()=>sa.subscribe(m=>{s(m)}),[]);const r=y=>{Se.playMenuSelect(),sa.updateSettings({controlScheme:y})},o=(y,m)=>{sa.updateSettings({[y]:m})},d=(y,m)=>{Se.playMenuSelect(),sa.updateSettings({[y]:m})},f=()=>{Se.playMenuSelect(),sa.resetToDefaults()},p=()=>{Se.playMenuSelect(),t()};return c?M.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{fontFamily:'"Black Ops One"'},children:[M.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:p}),M.jsxs("div",{className:"relative flex flex-col rounded-lg shadow-2xl",style:{width:"90%",maxWidth:"400px",maxHeight:"85vh",background:"linear-gradient(to bottom, #3B4A1C, #2B3A12)",border:"4px solid #5A6D33",boxShadow:"0 0 30px rgba(90, 109, 51, 0.3), inset 0 0 20px rgba(0,0,0,0.5)"},children:[M.jsxs("div",{className:"flex items-center justify-between px-4 py-3",style:{borderBottom:"2px solid #5A6D33",background:"linear-gradient(to right, rgba(59, 74, 28, 0.7), rgba(43, 58, 18, 0.7))"},children:[M.jsx("h2",{className:"text-xs sm:text-sm tracking-wider",style:{color:"#c9a961",textShadow:"0 0 10px rgba(201, 169, 97, 0.8)"},children:"GAME SETTINGS"}),M.jsx("button",{onClick:p,className:"text-red-500 hover:text-red-400 text-lg leading-none transition-colors",style:{textShadow:"0 0 5px rgba(239, 68, 68, 0.8)"},children:"X"})]}),M.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-6",children:[M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"CONTROLS"}),M.jsxs("div",{className:"flex gap-2",children:[M.jsx("button",{onClick:()=>r("arrows"),className:`flex-1 py-2 px-2 text-[11px] sm:text-[12px] rounded border-2 transition-all ${n.controlScheme==="arrows"?"text-white shadow-lg":"text-zinc-400 hover:border-zinc-500"}`,style:n.controlScheme==="arrows"?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 15px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:"ARROW KEYS"}),M.jsx("button",{onClick:()=>r("wasd"),className:`flex-1 py-2 px-2 text-[11px] sm:text-[12px] rounded border-2 transition-all ${n.controlScheme==="wasd"?"text-white shadow-lg":"text-zinc-400 hover:border-zinc-500"}`,style:n.controlScheme==="wasd"?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 15px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:"WASD KEYS"})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"DIFFICULTY"}),M.jsxs("div",{className:"mb-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"ENEMY SPEED"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.enemySpeed,"%"]})]}),M.jsxs("div",{className:"relative",children:[M.jsx("input",{type:"range",min:"20",max:"100",value:n.enemySpeed,onChange:y=>o("enemySpeed",parseInt(y.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${(n.enemySpeed-20)/80*100}%, #2B3A12 ${(n.enemySpeed-20)/80*100}%, #2B3A12 100%)`}}),M.jsx("style",{children:`
                  input[type="range"]::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    width: 16px;
                    height: 16px;
                    background: linear-gradient(135deg, #5A6D33 0%, #4A5D23 100%);
                    border: 2px solid #6B5B3D;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 0 8px rgba(90, 109, 51, 0.6);
                  }
                  input[type="range"]::-moz-range-thumb {
                    width: 16px;
                    height: 16px;
                    background: linear-gradient(135deg, #5A6D33 0%, #4A5D23 100%);
                    border: 2px solid #6B5B3D;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 0 8px rgba(90, 109, 51, 0.6);
                  }
                `})]}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"EASY"}),M.jsx("span",{children:"HARD"})]})]}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"ENEMY FIRE RATE"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.enemyFireRate,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"20",max:"100",value:n.enemyFireRate,onChange:y=>o("enemyFireRate",parseInt(y.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${(n.enemyFireRate-20)/80*100}%, #2B3A12 ${(n.enemyFireRate-20)/80*100}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"SLOW"}),M.jsx("span",{children:"FAST"})]})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"SOUND"}),M.jsxs("div",{className:"mb-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"MUSIC VOLUME"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.musicVolume,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.musicVolume,onChange:y=>o("musicVolume",parseInt(y.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.musicVolume}%, #2B3A12 ${n.musicVolume}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"SOUND EFFECTS"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.sfxVolume,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.sfxVolume,onChange:y=>o("sfxVolume",parseInt(y.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.sfxVolume}%, #2B3A12 ${n.sfxVolume}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"DISPLAY"}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"RADAR MINI-MAP"}),M.jsx("button",{onClick:()=>d("miniMapEnabled",!n.miniMapEnabled),className:"relative w-12 h-6 rounded-full transition-all duration-300 border-2",style:n.miniMapEnabled?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:M.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all duration-300 ${n.miniMapEnabled?"left-6 bg-white":"left-0.5 bg-zinc-400"}`})})]}),M.jsx("p",{className:"text-[9px] mt-2",style:{color:"#9AAF7A"},children:"Shows terrain preview with target locations during gameplay"}),M.jsxs("div",{className:"mt-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"CRT SCANLINES"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.scanlinesIntensity,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.scanlinesIntensity,onChange:y=>o("scanlinesIntensity",parseInt(y.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.scanlinesIntensity}%, #2B3A12 ${n.scanlinesIntensity}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]})]})]}),M.jsxs("div",{className:"flex gap-2 px-4 py-3",style:{borderTop:"2px solid #4A5D23",background:"rgba(43, 58, 18, 0.5)"},children:[M.jsx("button",{onClick:f,className:"flex-1 py-2 text-[11px] sm:text-[12px] text-zinc-300 rounded transition-colors",style:{background:"#2B3A12",border:"1px solid #3B4A1C"},children:"RESET DEFAULTS"}),M.jsx("button",{onClick:p,className:"flex-1 py-2 text-[11px] sm:text-[12px] text-white rounded transition-colors font-bold",style:{background:"#4A5D23",border:"1px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.3)"},children:"DONE"})]})]})]}):null},wa=60,La=512,x_="#ff0000",L_="#ffaa00",Mp="#5A6D33",Gh="#00ff00",N_=3,bp=4,D_=300,Wo=16,Op=8,C_=60,P_="#2d3748",w_="#1a202c",I_="rgba(90, 109, 51, 0.3)",Yh=bt.MAP_WIDTH_EXTENDED;bt.TOTAL_MAP_HEIGHT;class B_{constructor(){this.detectedTerrainWidths=new Map,this.terrainDrawInfoCache=new Map,this.terrainPreviewCache=new Map,this.currentCacheKey=null}getCacheKey(t,n){return`${t}_${n}`}async generateTerrainPreview(t,n){const s=this.getCacheKey(t,n);if(this.terrainPreviewCache.has(s))return this.currentCacheKey=s,this.terrainPreviewCache.get(s);console.log(`[MiniMapRenderer] Generating terrain preview for ${t} level ${n}`);const r=await Ta.generateForCampaignAsync(t,n),o=r.fullTerrainCanvas,d=r.detectedWidthGamePixels||Yh,f=o.height;this.detectedTerrainWidths.set(s,d);const p=Vn(t,n),y=(p==null?void 0:p.leftX)??0,m=(p==null?void 0:p.rightX)??d,S=ca(t,n).mapWidthExtended,R=document.createElement("canvas");R.width=wa,R.height=La;const b=R.getContext("2d");b.fillStyle="#1a202c",b.fillRect(0,0,wa,La),b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high";const x=d/f,N=La,L=La*x,O=(wa-L)/2,I=0;return b.drawImage(o,0,0,o.width,o.height,O,I,L,N),this.terrainDrawInfoCache.set(s,{width:L,height:N,terrainWidth:d,terrainHeight:f,offsetX:O,offsetY:I,terrainBoundaryLeft:y,terrainBoundaryRight:m,mapWidthExtended:S}),this.applyRadarEffect(b),this.terrainPreviewCache.set(s,R),this.currentCacheKey=s,console.log(`[MiniMapRenderer] Terrain preview generated: ${wa}x${La} (terrain ${d}x${f}, draw ${L.toFixed(1)}x${N.toFixed(1)} at ${O.toFixed(1)},${I.toFixed(1)})`),R}applyRadarEffect(t){t.globalCompositeOperation="multiply",t.fillStyle="rgba(100, 255, 150, 0.15)",t.fillRect(0,0,wa,La),t.globalCompositeOperation="source-over",t.fillStyle="rgba(0, 0, 0, 0.03)";for(let n=0;n<La;n+=2)t.fillRect(0,n,wa,1)}render(t,n,s,r,o){const d=this.terrainPreviewCache.get(this.currentCacheKey||"");if(!d){t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,wa,La);return}t.drawImage(d,0,0),this.renderTargets(t,o),this.renderViewport(t,n),this.renderPlayer(t,n,s,r,o)}renderTargets(t,n){const s=$t.getAllTargetsForMiniMap(),r=$t.getTotalMapHeight();if(s.length>0&&Math.floor(n/2e3)%5===0&&(console.log(`[MiniMap] Rendering ${s.length} targets, totalMapHeight=${r}`),s.forEach(O=>console.log(`  Target ${O.id}: x=${O.x.toFixed(0)}, y=${O.y.toFixed(0)}, type=${O.targetType}, destroyed=${O.destroyed}`))),r===0||s.length===0)return;const o=this.terrainDrawInfoCache.get(this.currentCacheKey||""),d=(o==null?void 0:o.terrainWidth)||this.detectedTerrainWidths.get(this.currentCacheKey||"")||Yh,f=(o==null?void 0:o.width)||wa,p=(o==null?void 0:o.height)||La,y=(o==null?void 0:o.offsetX)||0,m=(o==null?void 0:o.offsetY)||0,_=(o==null?void 0:o.terrainBoundaryLeft)??0,R=((o==null?void 0:o.terrainBoundaryRight)??d)-_,b=(o==null?void 0:o.mapWidthExtended)??R,x=400,N=n%x/x,L=.5+Math.sin(N*Math.PI*2)*.5;for(const O of s){if(O.destroyed)continue;const I=_+O.x/b*R,Y=y+I/d*f,W=m+O.y/r*p,Z=O.targetType==="game-target",K=Z?x_:L_;t.save(),Z?(t.strokeStyle=K,t.lineWidth=2,t.globalAlpha=L,t.shadowColor=K,t.shadowBlur=8,t.beginPath(),t.arc(Y,W,5,0,Math.PI*2),t.stroke(),t.globalAlpha=1,t.strokeStyle=K,t.lineWidth=2,t.shadowBlur=4,t.beginPath(),t.moveTo(Y-3,W),t.lineTo(Y+3,W),t.stroke(),t.beginPath(),t.moveTo(Y,W-3),t.lineTo(Y,W+3),t.stroke()):(t.fillStyle=K,t.globalAlpha=L,t.shadowColor=K,t.shadowBlur=6,t.beginPath(),t.arc(Y,W,N_,0,Math.PI*2),t.fill()),t.restore()}}renderViewport(t,n){const s=$t.getTotalMapHeight();if(s===0)return;const r=this.terrainDrawInfoCache.get(this.currentCacheKey||""),o=(r==null?void 0:r.width)||wa,d=(r==null?void 0:r.height)||La,f=(r==null?void 0:r.offsetX)||0,p=(r==null?void 0:r.offsetY)||0,m=s-n-G,_=p+m/s*d,S=G/s*d;t.save(),t.strokeStyle=Mp,t.lineWidth=1,t.globalAlpha=.8,t.shadowColor=Mp,t.shadowBlur=3,t.strokeRect(f+1,_,o-2,S),t.restore()}renderPlayer(t,n,s,r,o){const d=$t.getTotalMapHeight();if(d===0)return;const f=this.terrainDrawInfoCache.get(this.currentCacheKey||"");f!=null&&f.terrainWidth||this.detectedTerrainWidths.get(this.currentCacheKey||"");const p=(f==null?void 0:f.width)||wa,y=(f==null?void 0:f.height)||La,m=(f==null?void 0:f.offsetX)||0,_=(f==null?void 0:f.offsetY)||0,R=d-n-(G-r),b=_+R/d*y,N=s/600;let L=m+N*p;const O=bp+3;L=Math.max(m+O,Math.min(m+p-O,L));const I=300,Y=o%I/I,W=.5+Math.sin(Y*Math.PI*2)*.5;t.save();const Z=bp+2;t.strokeStyle=Gh,t.lineWidth=1.5,t.globalAlpha=W,t.shadowColor=Gh,t.shadowBlur=6,t.beginPath(),t.arc(L,b,Z,0,Math.PI*2),t.stroke(),t.globalAlpha=1,t.fillStyle=Gh,t.shadowBlur=3,t.beginPath(),t.arc(L,b,2,0,Math.PI*2),t.fill(),t.restore()}clearCache(){this.terrainPreviewCache.clear(),this.detectedTerrainWidths.clear(),this.terrainDrawInfoCache.clear(),this.currentCacheKey=null}isPreviewReady(t,n){return this.terrainPreviewCache.has(this.getCacheKey(t,n))}}const xp=new B_;function F_({campaign:c,level:t,scrollY:n,playerX:s,playerY:r,visible:o,containerWidth:d,canvasBounds:f}){const p=$.useRef(null),[y,m]=$.useState(!1),_=$.useRef(0),S=$.useRef(""),R=wa+12,b=La+28,x=d-(f.offsetLeft+f.renderWidth),N=f.offsetLeft,L=R+Wo*2,O=x>=L,I=N>=L,Y=O||I,W=typeof window<"u"&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.matchMedia("(max-width: 768px)").matches),Z=typeof window<"u"?window.innerWidth:d,K=R/Z>.07,Q=W&&K,me=Q?s<w/2:!0;$.useEffect(()=>{const re=`${c}_${t}`;re!==S.current&&(S.current=re,m(!1),xp.generateTerrainPreview(c,t).then(()=>{m(!0)}).catch(ce=>{console.error("[MiniMap] Failed to generate terrain preview:",ce)}))},[c,t]);const pe=$.useCallback(()=>{const re=p.current;if(!re||!y||!o)return;const ce=re.getContext("2d");ce&&(ce.clearRect(0,0,wa,La),xp.render(ce,n,s,r,performance.now()),_.current=requestAnimationFrame(pe))},[n,s,r,y,o]);if($.useEffect(()=>(o&&y&&(_.current=requestAnimationFrame(pe)),()=>{_.current&&cancelAnimationFrame(_.current)}),[o,y,pe]),!o)return null;const fe={position:"absolute",width:R,height:b,background:`linear-gradient(180deg, ${P_} 0%, ${w_} 100%)`,borderRadius:4,border:"2px solid #5A6D33",boxShadow:`0 0 10px ${I_}, inset 0 0 5px rgba(0, 0, 0, 0.5)`,padding:4,transition:Y||!Q?"none":`left ${D_}ms ease-out`,zIndex:30,pointerEvents:"none"};if(Y){const re=f.offsetTop+f.renderHeight;fe.bottom=`calc(100% - ${re}px + ${Wo}px)`,O?(fe.left=f.offsetLeft+f.renderWidth+Wo,fe.right="auto"):(fe.left=f.offsetLeft-R-Wo,fe.right="auto")}else fe.bottom=C_,me?(fe.left=f.offsetLeft+f.renderWidth-R-Op,fe.right="auto"):(fe.left=f.offsetLeft+Op,fe.right="auto");return M.jsxs("div",{style:fe,children:[M.jsx("div",{style:{fontFamily:'"Black Ops One", monospace',fontSize:9,color:"#5A6D33",textAlign:"center",marginBottom:2,textShadow:"0 0 4px #5A6D33",letterSpacing:1},children:"RADAR"}),M.jsxs("div",{style:{position:"relative",width:wa,height:La,borderRadius:2,overflow:"hidden"},children:[M.jsx("div",{style:{position:"absolute",top:0,left:0,width:8,height:8,borderTop:"2px solid #5A6D33",borderLeft:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",top:0,right:0,width:8,height:8,borderTop:"2px solid #5A6D33",borderRight:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:8,height:8,borderBottom:"2px solid #5A6D33",borderLeft:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:8,height:8,borderBottom:"2px solid #5A6D33",borderRight:"2px solid #5A6D33"}}),M.jsx("canvas",{ref:p,width:wa,height:La,style:{display:"block",width:wa,height:La,background:"#0a1a0a"}}),M.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.1) 0px, rgba(0, 0, 0, 0.1) 1px, transparent 1px, transparent 2px)",pointerEvents:"none"}}),!y&&M.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#5A6D33",fontSize:10,fontFamily:'"Black Ops One", monospace'},children:"..."})]})]})}const td="";async function Wp(c,t){try{const n=await fetch(`${td}/api/design/${encodeURIComponent(c.toLowerCase())}/${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return await n.json()}catch(n){return console.error("[DESIGN API] Load failed:",n),{success:!1,error:n instanceof Error?n.message:"Failed to load design overrides"}}}async function Xp(c,t,n){try{const s=await fetch(`${td}/api/design/${encodeURIComponent(c.toLowerCase())}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return await s.json()}catch(s){return console.error("[DESIGN API] Save failed:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save design overrides"}}}async function H_(c,t,n,s,r=!1){try{const o=await fetch(`${td}/api/design/generate-destroyed-overlay`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({overlayId:c,imageData:t,width:n,height:s,regenerate:r})});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.json()}catch(o){return console.error("[DESIGN API] Generate destroyed overlay failed:",o),{success:!1,error:o instanceof Error?o.message:"Failed to generate destroyed overlay"}}}const G_=Object.freeze(Object.defineProperty({__proto__:null,generateDestroyedOverlay:H_,loadDesignOverrides:Wp,saveDesignOverrides:Xp},Symbol.toStringTag,{value:"Module"})),ac=60,qo=new Map,Xo=new Map;function Y_(c,t,n,s,r){const o=(t+s)*2+20,d=o/2;let f="";const p=Math.PI*2/c;for(let y=0;y<c;y++){const m=r+y*p,_=Math.cos(m),S=Math.sin(m),R=d+_*s,b=d+S*s,x=d+_*(s+t),N=d+S*(s+t);f+=`
      <line x1="${R+1}" y1="${b+1}" x2="${x+1}" y2="${N+1}"
            stroke="#1a1a1a" stroke-width="${n+2}"
            stroke-linecap="round" opacity="0.5"/>
    `,f+=`
      <line x1="${R}" y1="${b}" x2="${x}" y2="${N}"
            stroke="#333333" stroke-width="${n}"
            stroke-linecap="round"/>
    `,f+=`
      <line x1="${R}" y1="${b}" x2="${x}" y2="${N}"
            stroke="#555555" stroke-width="${n*.4}"
            stroke-linecap="round"/>
    `}return`
    <svg width="${o}" height="${o}" viewBox="0 0 ${o} ${o}" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="hubGrad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#888888"/>
          <stop offset="70%" stop-color="#555555"/>
          <stop offset="100%" stop-color="#333333"/>
        </radialGradient>
        <radialGradient id="hubCenter" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#444444"/>
          <stop offset="100%" stop-color="#111111"/>
        </radialGradient>
      </defs>
      <!-- Motion blur effect - slight transparency on blades -->
      <g opacity="0.9">
        ${f}
      </g>
      <!-- Hub (center) -->
      <circle cx="${d}" cy="${d}" r="${s}"
              fill="url(#hubGrad)" stroke="#222222" stroke-width="2"/>
      <!-- Hub center bolt -->
      <circle cx="${d}" cy="${d}" r="${s*.35}"
              fill="url(#hubCenter)"/>
    </svg>
  `}function U_(c,t,n){return new Promise((s,r)=>{const o=document.createElement("canvas");o.width=t,o.height=n;const d=o.getContext("2d");if(!d){r(new Error("Could not get 2D context"));return}const f=new Image,p=new Blob([c],{type:"image/svg+xml;charset=utf-8"}),y=URL.createObjectURL(p);f.onload=()=>{d.drawImage(f,0,0,t,n),URL.revokeObjectURL(y),s(o)},f.onerror=()=>{URL.revokeObjectURL(y),r(new Error("Failed to load SVG image"))},f.src=y})}async function z_(c){if(qo.has(c))return qo.get(c);if(Xo.has(c))return Xo.get(c);const t=Np[c];if(!t)return console.warn(`No rotor config found for boss type: ${c}`),[];const n=(async()=>{const s=[],r=(t.bladeLength+t.hubRadius)*2+20;for(let o=0;o<ac;o++){const d=o/ac*Math.PI*2,f=Y_(t.bladeCount,t.bladeLength,t.bladeWidth,t.hubRadius,d);try{const p=await U_(f,r,r);s.push(p)}catch(p){console.error(`Failed to render rotor frame ${o} for ${c}:`,p);const y=document.createElement("canvas");y.width=r,y.height=r,s.push(y)}}return qo.set(c,s),Xo.delete(c),s})();return Xo.set(c,n),n}function k_(c){z_(c).catch(t=>{console.error(`Failed to initialize rotors for ${c}:`,t)})}function V_(c,t,n,s,r,o,d,f=1){const p=qo.get(t);if(!p||p.length===0){k_(t);return}const y=Np[t];if(!y)return;const m=y.baseRotationSpeed*f,_=d*m*(180/Math.PI)/6,S=n+r/2,R=s+o/2,b=p[0].width;y.positions.forEach((x,N)=>{let O=Math.floor(_*(N===0||N===2?1:-1))%ac;O<0&&(O+=ac);const I=p[O];if(!I)return;const Y=S+x.x*(r/2)-b/2,W=R+x.y*(o/2)-b/2;c.drawImage(I,Y,W)})}const W_={pacific:{name:"Pacific Jungle",colors:["#4A5D23","#3B4A1C","#2B3A12","#5A6D33","#6B5B3D"],weights:[.3,.25,.2,.15,.1]},european:{name:"European Theater",colors:["#4B5320","#3D4518","#5C6428","#6E7B4A","#454B32"],weights:[.35,.25,.2,.1,.1]},desert:{name:"Desert Sand",colors:["#C4A35A","#8B7355","#A68B5B","#D4B896","#6B5D4A"],weights:[.3,.25,.2,.15,.1]},splinter:{name:"Splinter Pattern",colors:["#5C6B4A","#3D4A32","#8B7355","#4A5D3A","#2B3520"],weights:[.25,.25,.2,.2,.1]},british:{name:"British DPM",colors:["#5A5D23","#3B3A1C","#6B5B3D","#4A4D33","#2B2A12"],weights:[.3,.25,.2,.15,.1]},steel:{name:"Industrial Steel",colors:["#4A4A4A","#5A5A5A","#3A3A3A","#6A6A6A","#333333"],weights:[.3,.25,.2,.15,.1]}};function X_(c){return()=>(c=c*1103515245+12345&2147483647,c/2147483647)}function j_(c,t,n=50,s){const r=[],o=new Set;for(;r.length<t;){const f=Math.floor(s()*c.length);o.has(f)||(o.add(f),r.push({...c[f]}))}let d=r.map((f,p)=>({centroid:f,points:[],colorIndex:p%5}));for(let f=0;f<n;f++){d.forEach(y=>y.points=[]),c.forEach(y=>{let m=1/0,_=0;d.forEach((S,R)=>{const b=Math.hypot(y.x-S.centroid.x,y.y-S.centroid.y);b<m&&(m=b,_=R)}),d[_].points.push(y)});let p=!0;if(d.forEach(y=>{if(y.points.length===0)return;const m=y.points.reduce((S,R)=>S+R.x,0)/y.points.length,_=y.points.reduce((S,R)=>S+R.y,0)/y.points.length;(Math.abs(m-y.centroid.x)>.1||Math.abs(_-y.centroid.y)>.1)&&(p=!1),y.centroid={x:m,y:_}}),p)break}return d}function $_(c){if(c.length<3)return c;let t=c[0];c.forEach(r=>{(r.y<t.y||r.y===t.y&&r.x<t.x)&&(t=r)});const n=c.slice().sort((r,o)=>{const d=Math.atan2(r.y-t.y,r.x-t.x),f=Math.atan2(o.y-t.y,o.x-t.x);return d-f}),s=[];return n.forEach(r=>{for(;s.length>=2;){const o=s[s.length-2],d=s[s.length-1];if((d.x-o.x)*(r.y-o.y)-(d.y-o.y)*(r.x-o.x)<=0)s.pop();else break}s.push(r)}),s}function q_(c,t,n,s,r,o){const d=X_(o.seed),f=W_[o.palette],p=f.colors,y=o.opacity??1,m=o.numClusters,_=o.pointDensity;c.save(),c.globalAlpha=y,c.fillStyle=p[0],c.fillRect(t,n,s,r);const S=Math.floor(s*r*_),R=[];for(let x=0;x<S;x++)R.push({x:t+d()*s,y:n+d()*r});const b=j_(R,m,50,d);b.forEach(x=>{let N=0;const L=d();for(let O=0;O<f.weights.length;O++)if(N+=f.weights[O],L<N){x.colorIndex=O;break}}),c.globalAlpha=y*.9,b.forEach(x=>{if(x.points.length<3)return;const N=$_(x.points);if(N.length<3)return;c.fillStyle=p[x.colorIndex],c.beginPath();const L=x.centroid,O=N.map(I=>({x:L.x+(I.x-L.x)*1.15,y:L.y+(I.y-L.y)*1.15}));c.moveTo(O[0].x,O[0].y);for(let I=0;I<O.length;I++){const Y=O[(I-1+O.length)%O.length],W=O[I],Z=O[(I+1)%O.length],K=O[(I+2)%O.length],Q=W.x+(Z.x-Y.x)/6,me=W.y+(Z.y-Y.y)/6,pe=Z.x-(K.x-W.x)/6,fe=Z.y-(K.y-W.y)/6;c.bezierCurveTo(Q,me,pe,fe,Z.x,Z.y)}c.closePath(),c.fill()}),c.restore()}const D=new m_;gt.BEGINNER,gt.NORMAL,gt.VETERAN;const Yn=py;function jp(c){return fl(c).storyText}function $p(c){return fl(c).endingText}jp(Ee.STEEL_VANGUARD);const dl=$p(Ee.STEEL_VANGUARD),dr=(c,t)=>{var r,o;const n=c.spriteVariant||0;switch(c.type===A.CRASHING_AIRCRAFT&&c.originalType?c.originalType:c.type){case A.PLAYER:return t.player;case A.ENEMY_RED:return t.enemyRed;case A.ENEMY_BIG:return t.enemyBig[n%3];case A.ENEMY_BATTLESHIP:return t.battleship[n%3];case A.ENEMY_TANK:return((r=t.tank)==null?void 0:r[n%3])||t.enemySmall[0];case A.ENEMY_LARGE_TANK:return((o=t.largeTank)==null?void 0:o[n%3])||t.enemyBig[0];case A.BULLET_PLAYER:return t.bulletPlayer;case A.BULLET_ENEMY:return t.bulletEnemy;case A.BULLET_TURRET:return t.bulletTurret;case A.POWERUP:if(c.powerupType===da.BOMB)switch(c.bombTier||fa.STANDARD){case fa.HEAVY:return t.bombTier2;case fa.CLUSTER:return t.bombTier3;case fa.MEGA:return t.bombTier4;default:return t.bombTier1}return c.powerupType===da.FIREPOWER?(c.firepowerTier||$a.STANDARD)===$a.ENHANCED?t.powerupFirepowerEnhanced:t.powerupFirepower:c.powerupType===da.INVINCIBILITY?t.powerupInvincibility:t.powerupFirepower;case A.EXPLOSION:return t.explosion;case A.BOMB_DROPPED:return t.bombDropped;case A.ENEMY_SMALL:return t.enemySmall[n%3];case A.ENEMY_HELICOPTER:const d=Math.floor(c.frame||0);return t.enemyHelicopter[d%2];case A.BOSS:if(c.variantSprite&&t[c.variantSprite])return t[c.variantSprite];switch(c.bossType){case Na.ACE_SQUADRON:return t.bossAceSquadron;case Na.FLYING_FORTRESS:return t.bossFlyingFortress;case Na.SUPER_BATTLESHIP:return t.bossSuperBattleship;case Na.EXPERIMENTAL_AIRSHIP:return t.bossExperimentalAirship;case Na.ULTIMATE_WEAPON:return t.bossUltimateWeapon;default:return t.enemyBig[0]}case A.SUPPORT_FIGHTER:return t.player;default:return t.enemySmall[0]}},Z_=()=>{const c=$.useRef(null),t=$.useRef(null);$.useRef(1);const[n,s]=$.useState(te.ATTRACT),[r,o]=$.useState(0),[d,f]=$.useState(1e4),[p,y]=$.useState(3),[m,_]=$.useState(0),[S,R]=$.useState(10),[b,x]=$.useState(0),[N,L]=$.useState(1),[O,I]=$.useState(Ee.STEEL_VANGUARD),[Y,W]=$.useState(gt.NORMAL),[Z,K]=$.useState(0),[Q,me]=$.useState(0),[pe,fe]=$.useState(0),[re,ce]=$.useState([]),[_e,Je]=$.useState([]),[U,se]=$.useState(!1),[ye,$e]=$.useState(!1),Ze=R_(),[P,ee]=$.useState(!0),[le,ue]=$.useState(null),[Le,q]=$.useState(0),[be,he]=$.useState(!1),[Be,qt]=$.useState(0),[va,Rs]=$.useState(100),[Xn,Qa]=$.useState(100),[jn,$n]=$.useState({show:!1,targetLevel:0}),[cc,qn]=$.useState(!1),[pl,hn]=$.useState(!1),[yr,ml]=$.useState(!1),[Ms,ga]=$.useState(Se.isMutedState()),[uc,Er]=$.useState(0),[yl,bs]=$.useState({x:w/2,y:G-100}),[hc,_r]=$.useState(sa.getSettings().miniMapEnabled),[Os,dc]=$.useState({offsetLeft:0,offsetTop:0,renderWidth:0,renderHeight:0}),pa=$.useRef(null),Da=$.useRef(null),Ba=$.useRef([]),Ca=$.useRef(0);$.useRef(new Gp);const El=$.useRef(0),_l=$.useRef(!1),Al=$.useRef(0),Fa=$.useRef({}),dn=$.useRef(!1),fn=$.useRef(!1),Ti=$.useRef(!1),gn=$.useRef(0),Zn=300,Ar=$.useRef(te.ATTRACT),zi=$.useMemo(()=>pa.current?{firepower:pa.current.powerupFirepower.toDataURL(),firepowerEnhanced:pa.current.powerupFirepowerEnhanced.toDataURL(),bomb:pa.current.powerupBomb.toDataURL(),invincibility:pa.current.powerupInvincibility.toDataURL(),enemyFighter:pa.current.enemySmall[0].toDataURL()}:null,[pa.current]),Kn=$.useCallback(F=>{if(!c.current)return null;const g=c.current.getBoundingClientRect(),ve=w/G,_t=g.width/g.height;let Ue,Pt,pt,Ot;_t>ve?(Pt=g.height,Ue=g.height*ve,pt=(g.width-Ue)/2,Ot=0):(Ue=g.width,Pt=g.width/ve,pt=0,Ot=(g.height-Pt)/2);const kt=F.clientX-g.left-pt,It=F.clientY-g.top-Ot,wt=kt/Ue*w,Bt=It/Pt*G;return{x:wt,y:Bt}},[]),Ni=$.useCallback(()=>{if(!c.current||!t.current)return;c.current;const F=t.current.getBoundingClientRect(),g=w/G,ve=F.width/F.height;let _t,Ue,Pt,pt;ve>g?(Ue=F.height,_t=F.height*g,Pt=(F.width-_t)/2,pt=0):(_t=F.width,Ue=F.width/g,Pt=0,pt=(F.height-Ue)/2),dc({offsetLeft:Pt,offsetTop:pt,renderWidth:_t,renderHeight:Ue})},[]);$.useEffect(()=>(Ni(),window.addEventListener("resize",Ni),()=>window.removeEventListener("resize",Ni)),[Ni]),$.useEffect(()=>{if(P)return;const g=Ar.current!==n;n===te.ATTRACT?Se.playIntroMusic():n===te.STORY?Se.playStoryMusic(D.campaign):n===te.VICTORY&&g?(Se.playEndingMusic(D.campaign),me(0),$e(!1),l_(D.campaign).then(ve=>{console.log(`[LAZY] ${D.campaign} victory panels loaded`),Je(ve),$e(!0)}).catch(ve=>console.error("[LAZY] Failed to load campaign victory panels:",ve))):n===te.ENDING||n===te.GAME_OVER&&Se.playGameOverMusic(),Ar.current=n},[n,P]);const fc=async F=>{ee(!0),ue(null),q(0);try{console.log("[LOAD] Starting asset load...");const g=await c_(F,ve=>{console.log("[LOAD] Title screen available! Displaying immediately..."),Da.current=ve},void 0,ve=>{q(ve)});console.log("[LOAD] Assets loaded successfully!"),pa.current=g,zn.setSprites(g.cloud,g.fogPatch,g.sandParticle),ee(!1)}catch(g){console.error("[LOAD] Failed to load assets:",g),ue(g instanceof Error?g.message:"Failed to load game assets"),ee(!1)}};$.useEffect(()=>{const F={current:!0},g=setTimeout(()=>{F.current&&(console.error("[LOAD] Asset loading timeout after 30 seconds"),ue("Loading timeout - Please check your connection and refresh"))},3e4);return fc(!1).finally(()=>{F.current=!1}),()=>{clearTimeout(g),F.current=!1}},[]),$.useEffect(()=>{window.gameAPI={insertCoin:()=>{console.log("API: Inserting Coin"),D.insertCoin(),_(D.credits),R(D.totalCreditsRemaining),Se.init()},startGame:()=>{console.log("API: Starting Game"),D.credits>0?(D.startGame(),_(D.credits),R(D.totalCreditsRemaining),K(0),Se.init()):console.warn("API: Cannot start game. No credits.")},getState:()=>({state:D.state,credits:D.credits,level:D.level}),setControls:F=>{console.log("API: Controls set (not fully implemented)",F)}}},[]);const Sr=$.useCallback(async()=>{const F=V.getLevelInfo(),g=V.getPendingChanges();console.log("[DESIGN] Saving overrides to server...");const ve=await Xp(F.campaign,F.level,g);ve.success?(V.markSaved(),console.log("[DESIGN] Saved successfully:",ve.filepath),alert(`Design changes saved to ${ve.filepath||"server"}`)):(console.error("[DESIGN] Save failed:",ve.error),alert(`Save failed: ${ve.error}`))},[]),Tr=$.useCallback(async()=>{const F=V.getLevelInfo();console.log("[DESIGN] Loading overrides from server...");const g=await Wp(F.campaign,F.level);g.success&&g.data?(V.loadOverrides(g.data),console.log("[DESIGN] Loaded successfully"),alert("Design overrides loaded from server")):g.success&&!g.data?alert("No saved overrides found for this level"):(console.error("[DESIGN] Load failed:",g.error),alert(`Load failed: ${g.error}`))},[]),xs=$.useCallback(F=>{var g,ve,_t;if((Aa.EVADE.includes(F.key)||Aa.FIRE.includes(F.key)||Aa.BOMB.includes(F.key))&&F.preventDefault(),Fa.current[F.key]=!0,F.key==="Escape"){if(D.state===te.DESIGN_MODE){V.hasUnsavedChanges()?qn(!0):(D.toggleDesignMode(),s(D.state));return}D.state!==te.PAUSED&&D.pause();return}if(D.state===te.DESIGN_MODE){const Ue=document.activeElement;if(Ue instanceof HTMLInputElement||Ue instanceof HTMLTextAreaElement||Ue instanceof HTMLSelectElement)return;const pt=F.shiftKey?10:1,Ot=5,kt=5;if(F.ctrlKey||F.metaKey){if(F.shiftKey&&!F.altKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustSingleBoundary("left",-kt);return;case"ArrowRight":F.preventDefault(),V.adjustSingleBoundary("left",kt);return}else if(F.altKey&&!F.shiftKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustSingleBoundary("right",-kt);return;case"ArrowRight":F.preventDefault(),V.adjustSingleBoundary("right",kt);return}else if(!F.shiftKey&&!F.altKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustBoundaryWidth(-Ot);return;case"ArrowRight":F.preventDefault(),V.adjustBoundaryWidth(Ot);return}}const It=V.getState().selectedElement!==null;switch(F.key){case"ArrowUp":F.preventDefault(),It&&V.nudgeSelected(0,pt);break;case"ArrowDown":F.preventDefault(),It&&V.nudgeSelected(0,-pt);break;case"ArrowLeft":F.preventDefault(),It?V.nudgeSelected(-pt,0):V.adjustTerrainHorizontalOffset(-pt);break;case"ArrowRight":F.preventDefault(),It?V.nudgeSelected(pt,0):V.adjustTerrainHorizontalOffset(pt);break;case"Delete":case"Backspace":F.preventDefault();const Bt=V.getState().selectedElement;(Bt==null?void 0:Bt.type)==="added-path"&&Bt.selectedVertexIndex!==void 0?V.deleteSelectedVertex():V.deleteSelected();break;case"Home":F.preventDefault(),V.jumpToTop();break;case"End":F.preventDefault(),V.jumpToBottom();break;case"PageUp":F.preventDefault(),V.pageScroll(1);break;case"PageDown":F.preventDefault(),V.pageScroll(-1);break;case"s":case"S":F.preventDefault();const We=V.getPendingChanges(),xt=V.getLevelInfo(),vi={campaign:xt.campaign,level:xt.level,timestamp:new Date().toISOString(),...We};navigator.clipboard.writeText(JSON.stringify(vi,null,2)).then(()=>{console.log("[DESIGN MODE] Changes copied to clipboard"),V.markSaved()}).catch(Ve=>console.error("[DESIGN MODE] Failed to copy:",Ve));break;case"n":case"N":F.preventDefault();const Ri=V.getPlacementMode(),Ft=["none","turret","game-target","path"],Zt=Ft.indexOf(Ri),ci=Ft[(Zt+1)%Ft.length];V.setPlacementMode(ci),console.log(`[DESIGN MODE] Placement mode: ${ci}`);break;case"Escape":F.preventDefault(),V.getState().isDrawingPath?(V.cancelPathDrawing(),console.log("[DESIGN MODE] Path drawing cancelled")):V.getPlacementMode()!=="none"?(V.setPlacementMode("none"),console.log("[DESIGN MODE] Placement mode cancelled")):V.clearSelection();break;case"Enter":F.preventDefault(),V.getState().isDrawingPath&&(V.finishPathDrawing(),console.log("[DESIGN MODE] Path drawing finished"));break;case"[":case"]":F.preventDefault();const St=V.getState().selectedElement;if(St){const Ve=F.shiftKey?F.key==="["?-1:1:F.key==="["?-10:10;if(St.type==="turret"){const Fe=((g=V.getEntityMetadata(St.id))==null?void 0:g.hp)??30,we=Math.max(1,Fe+Ve);V.updateEntityMetadata(St.id,{hp:we}),console.log(`[DESIGN MODE] Turret HP: ${we}`)}else if(St.type==="target"){const Fe=F.shiftKey?F.key==="["?-100:100:F.key==="["?-1e3:1e3,we=((ve=V.getEntityMetadata(St.id))==null?void 0:ve.points)??5e3,Me=Math.max(100,we+Fe);V.updateEntityMetadata(St.id,{points:Me}),console.log(`[DESIGN MODE] Target Points: ${Me}`)}}break;case",":case".":F.preventDefault();const Ne=V.getState().selectedElement;if(Ne&&Ne.type==="turret"){const Ve=F.shiftKey?F.key===","?-.5:.5:F.key===","?-.1:.1,Fe=((_t=V.getEntityMetadata(Ne.id))==null?void 0:_t.fireRate)??1.5,we=Math.max(.1,Math.round((Fe+Ve)*10)/10);V.updateEntityMetadata(Ne.id,{fireRate:we}),console.log(`[DESIGN MODE] Turret Fire Rate: ${we}`)}break}const wt=parseInt(F.key);if(!isNaN(wt)&&wt>=1&&wt<=9){F.preventDefault();const Bt=V.getLevelInfo(),We=Kh(Bt.campaign);wt<=We&&wt!==Bt.level&&(V.hasUnsavedChanges()?$n({show:!0,targetLevel:wt}):D.switchDesignModeLevel(wt))}return}if(D.state===te.PAUSED){if(F.key==="ArrowUp")D.pauseSelection=Math.max(0,D.pauseSelection-1);else if(F.key==="ArrowDown")D.pauseSelection=Math.min(3,D.pauseSelection+1);else if(F.key==="Enter"||F.key===" ")if(D.pauseSelection===0)D.resume();else if(D.pauseSelection===1)ml(!0),hn(!0);else if(D.pauseSelection===2){const Ue=!Se.isMutedState();Se.setMuted(Ue),ga(Ue),Ue||Se.playLevelMusic(D.level,D.campaign)}else D.quitToTitle(),R(D.totalCreditsRemaining);return}if(Aa.COIN.includes(F.key)&&(Se.unlockAudio(),D.insertCoin(),_(D.credits),R(D.totalCreditsRemaining)),Aa.START.includes(F.key)&&!P&&D.state===te.ATTRACT){Se.unlockAudio(),D.startGame(),_(D.credits),R(D.totalCreditsRemaining),K(0);const Ue=mp(O);u_(Ue).catch(Pt=>console.warn("[PROGRESSIVE] Could not preload campaign story thumbnails:",Pt)),se(!1),pp(O).then(Pt=>{console.log(`[LAZY] ${O} story panels loaded for story mode`),ce(Pt),se(!0)}).catch(Pt=>console.error("[LAZY] Failed to load campaign story panels:",Pt))}if(D.state===te.ATTRACT&&(Se.playTitleMusic(),Aa.UP.includes(F.key)&&I(Ue=>{const pt=(Yn.indexOf(Ue)-1+Yn.length)%Yn.length,Ot=Yn[pt];D.setCampaign(Ot);const kt={[Ee.DAWN_PATROL]:gt.BEGINNER,[Ee.STEEL_VANGUARD]:gt.NORMAL,[Ee.HELLFIRE_HORIZON]:gt.VETERAN};return W(kt[Ot]),Se.playMenuSelect(),Ot}),Aa.DOWN.includes(F.key)&&I(Ue=>{const pt=(Yn.indexOf(Ue)+1)%Yn.length,Ot=Yn[pt];D.setCampaign(Ot);const kt={[Ee.DAWN_PATROL]:gt.BEGINNER,[Ee.STEEL_VANGUARD]:gt.NORMAL,[Ee.HELLFIRE_HORIZON]:gt.VETERAN};return W(kt[Ot]),Se.playMenuSelect(),Ot})),D.state===te.STORY&&((Aa.RIGHT.includes(F.key)||Aa.FIRE.includes(F.key)||F.code==="Space")&&(Z<4?K(Ue=>Ue+1):D.startMission()),Aa.LEFT.includes(F.key)&&Z>0&&K(Ue=>Ue-1)),F.key==="Control"){const Ue=Date.now();Ue-Al.current<300?(Si&&(D.state===te.PLAYING||D.state===te.BOSS_INTRO||D.state===te.BOSS_BATTLE||D.state===te.DESIGN_MODE)&&(D.state===te.DESIGN_MODE&&V.hasUnsavedChanges()?qn(!0):(D.toggleDesignMode(),s(D.state))),Al.current=0):Al.current=Ue}if((F.key==="d"||F.key==="D")&&(D.debugMode=!D.debugMode,console.log(`[DEBUG] Debug mode: ${D.debugMode?"ON":"OFF"}`)),F.code==="Space"||F.key===" "){const Ue=Date.now();Ue-El.current<250?(_l.current=!0,El.current=0):El.current=Ue}},[P,Z]),Qn=$.useCallback(F=>{Fa.current[F.key]=!1},[]),Jn=$.useCallback(F=>{if(sa.getSettings().controlScheme==="wasd"&&F.target===c.current)if(F.button===0){dn.current=!0;const g=Date.now();g-gn.current<Zn?(Ti.current=!0,gn.current=0):gn.current=g}else F.button===2&&(fn.current=!0)},[]),Ls=$.useCallback(F=>{F.button===0?dn.current=!1:F.button===2&&(fn.current=!1)},[]),Ns=$.useCallback(F=>{sa.getSettings().controlScheme==="wasd"&&F.target===c.current&&F.preventDefault()},[]);$.useEffect(()=>{D.setDifficulty(Y)},[Y]),$.useEffect(()=>{const F=async g=>{const ve=c.current;if(!ve)return console.error("[TERRAIN CAPTURE] Canvas not available"),null;if(!ve.getContext("2d"))return console.error("[TERRAIN CAPTURE] Canvas context not available"),null;try{const Ue=V.getState(),Pt=Ue.designScrollX,pt=Ue.designScrollY,Ot=dt.getTotalMapHeight()||bt.TOTAL_MAP_HEIGHT,kt=V.getLevelInfo(),It=ca(kt.campaign,kt.level),wt=Math.floor((It.mapWidthExtended-w)/2),Bt=V.getTerrainHorizontalOffset(),We=Ot-pt,xt=g.x-wt-Pt+Bt,vi=G-(We-g.y),Ri=G-(We-(g.y+g.height)),Ft=Math.min(vi,Ri);console.log(`[TERRAIN CAPTURE] World coords: (${g.x}, ${g.y}) ${g.width}x${g.height}`),console.log(`[TERRAIN CAPTURE] Screen coords: (${xt}, ${Ft})`);const Zt=document.createElement("canvas");Zt.width=w,Zt.height=G;const ci=Zt.getContext("2d");if(!ci)return console.error("[TERRAIN CAPTURE] Failed to create terrain context"),null;D.tilemapEnabled&&Fh()?(Ap(ci,pt,w/2,!0),Sp(ci,pt,w/2,!0)):(console.warn("[TERRAIN CAPTURE] Tilemap not ready, capturing from main canvas as fallback"),ci.drawImage(ve,0,0));const St=document.createElement("canvas");St.width=g.width,St.height=g.height;const Ne=St.getContext("2d");if(!Ne)return console.error("[TERRAIN CAPTURE] Failed to create offscreen context"),null;Ne.drawImage(Zt,xt,Ft,g.width,g.height,0,0,g.width,g.height);const Fe=St.toDataURL("image/png").replace(/^data:image\/png;base64,/,"");return console.log(`[TERRAIN CAPTURE] Captured ${g.width}x${g.height} area, base64 length: ${Fe.length}`),Fe}catch(Ue){return console.error("[TERRAIN CAPTURE] Error capturing terrain:",Ue),null}};V.setTerrainCaptureCallback(F),console.log("[TERRAIN CAPTURE] Callback registered")},[]),$.useEffect(()=>{const F=()=>{const ve=pa.current;ve&&(ve.turretBaseAA&&ve.turretCannonAA&&!dt.hasTurretSprites("aa")&&(dt.setTurretSprites("aa",ve.turretBaseAA,ve.turretCannonAA),console.log("[TURRETS] Connected AA turret sprites")),ve.turretBaseFortress&&ve.turretCannonFortress&&!dt.hasTurretSprites("fortress")&&(dt.setTurretSprites("fortress",ve.turretBaseFortress,ve.turretCannonFortress),console.log("[TURRETS] Connected Fortress turret sprites")),ve.turretBaseNaval&&ve.turretCannonNaval&&!dt.hasTurretSprites("naval")&&(dt.setTurretSprites("naval",ve.turretBaseNaval,ve.turretCannonNaval),console.log("[TURRETS] Connected Naval turret sprites")))};F();const g=setInterval(F,1e3);return()=>clearInterval(g)},[P]),$.useEffect(()=>(window.addEventListener("keydown",xs),window.addEventListener("keyup",Qn),()=>{window.removeEventListener("keydown",xs),window.removeEventListener("keyup",Qn)}),[xs,Qn]),$.useEffect(()=>(window.addEventListener("mousedown",Jn),window.addEventListener("mouseup",Ls),window.addEventListener("contextmenu",Ns),()=>{window.removeEventListener("mousedown",Jn),window.removeEventListener("mouseup",Ls),window.removeEventListener("contextmenu",Ns)}),[Jn,Ls,Ns]),$.useEffect(()=>{const F=t.current;if(!F)return;const g=()=>{Er(F.clientWidth)};g();const ve=new ResizeObserver(g);return ve.observe(F),()=>ve.disconnect()},[]),$.useEffect(()=>sa.subscribe(g=>{_r(g.miniMapEnabled)}),[]),$.useEffect(()=>{const F=c.current;if(!F)return;const g=F.getContext("2d");if(!g)return;let ve,_t=0;const Ue=1e3/Sy;let Pt=performance.now(),pt=0,Ot=0,kt=performance.now();const It=wt=>{if(Ot++,wt-kt>5e3){const Ne=Ot/5;console.log(`[FREEZE DEBUG] FPS: ${Ne.toFixed(1)}, Entities: ${D.entities.length}, Particles: ${Te.getCount()}`),Ne<30&&console.warn(`[FREEZE DEBUG] LOW FPS WARNING! ${Ne.toFixed(1)} fps with ${D.entities.length} entities`),Ot=0,kt=wt}ko.startFrame();let Bt=wt-Pt;Pt=wt,Bt>250&&(Bt=250),pt+=Bt;const We=pa.current;if(!We){requestAnimationFrame(It);return}const vi=We.ocean,Ri=Math.max(0,D.level-1)%5,Ft=vi[Ri];if(P||le){if(g.fillStyle="#000000",g.fillRect(0,0,w,G),le){g.font='18px "Black Ops One"',g.fillStyle=nt.RED,g.textAlign="center",g.fillText("LOADING ERROR",w/2,G/2-60),g.font='12px "Black Ops One"',g.fillStyle=nt.WHITE;const Ne=le.split(" ");let Ve="",Fe=G/2-20;Ne.forEach(Me=>{const Oe=Ve+Me+" ";g.measureText(Oe).width>w-40&&Ve.length>0?(g.fillText(Ve,w/2,Fe),Ve=Me+" ",Fe+=20):Ve=Oe}),g.fillText(Ve,w/2,Fe),g.fillStyle=nt.YELLOW,g.font='14px "Black Ops One"';const we=.5+Math.sin(Date.now()/500)*.5;g.globalAlpha=we,g.fillText("PRESS F5 TO RETRY",w/2,G/2+80),g.globalAlpha=1}ve=requestAnimationFrame(It);return}let Zt=0;const ci=5;for(;pt>=Ue&&Zt<ci;){const Ne=sa.getSettings().controlScheme==="wasd",Ve={left:Aa.LEFT.some(Me=>Fa.current[Me]),right:Aa.RIGHT.some(Me=>Fa.current[Me]),up:Aa.UP.some(Me=>Fa.current[Me]),down:Aa.DOWN.some(Me=>Fa.current[Me]),fire:Aa.FIRE.some(Me=>Fa.current[Me])||Ne&&dn.current,evade:Aa.EVADE.some(Me=>Fa.current[Me]),bomb:Aa.BOMB.some(Me=>Fa.current[Me])||_l.current||Ne&&(fn.current||Ti.current)};_l.current=!1,Ti.current=!1;const Fe=hl.getInputState(),we=hl.mergeWithKeyboardInput(Ve,Fe);D.handleInput(we),D.update(),pt-=Ue,Zt++}Zt>=ci&&(pt=0),s(D.state),o(D.score),f(D.highScore),y(D.lives),_(D.credits),R(D.totalCreditsRemaining),x(D.bombCount),L(D.level),qt(D.combo),Rs(D.playerHealth),Qa(D.maxPlayerHealth);const St=ko.getSettings();if(Te.setPerformanceSettings(St.enableParticles,St.particleMultiplier,St.maxParticles),Te.update(),g.imageSmoothingEnabled=!1,g.fillStyle="#000",g.fillRect(0,0,w,G),D.state===te.PLAYING||D.state===te.PAUSED||D.state===te.DESIGN_MODE||D.state===te.BOSS_INTRO||D.state===te.BOSS_BATTLE||D.state===te.LEVEL_COMPLETE||D.state===te.GAME_OVER){_t=(_t+2)%256,g.save();const Ne=D.camera,Fe=1+(Ne.zoom-1)*Xa.PARALLAX_SEA_LEVEL,we=Ne.zoom;if(g.translate(w/2,G/2),g.scale(Fe,Fe),g.rotate(Ne.rotation),g.translate(-w/2+Ne.x,-G/2+Ne.y),D.screenShake>0){const T=(Math.random()-.5)*D.screenShake,ge=(Math.random()-.5)*D.screenShake,ie=Et.SCREEN_SHAKE_ROTATION,oe=(Math.random()-.5)*ie*(D.screenShake/30);g.translate(w/2,G/2),g.rotate(oe),g.translate(-w/2,-G/2),g.translate(T,ge)}const Me=D.entities.find(T=>T.type===A.PLAYER),Oe=(Me==null?void 0:Me.pos.x)??w/2,qe=(Me==null?void 0:Me.pos.y)??G-100;bs({x:Oe,y:qe});const Ce=D.state===te.DESIGN_MODE;if(D.tilemapEnabled&&Fh())Ap(g,D.getEffectiveScrollY(),Oe,Ce);else if(Ft&&(Ft instanceof HTMLCanvasElement||Ft instanceof HTMLImageElement)&&Ft.width>0&&Ft.height>0){const T=Ft.width;_t=(_t+1)%T,g.save();const ge=Math.ceil(w/T)+1,ie=Math.ceil(G/T)+1,oe=_t%T-T;for(let de=0;de<ge;de++)for(let Ae=0;Ae<ie;Ae++)g.drawImage(Ft,de*T,oe+Ae*T);g.restore()}else g.fillStyle="#000033",g.fillRect(0,0,F.width,F.height);const st=D.getDynamicTerrainParallaxOffset(Oe);if(Ce||D.entities.forEach(T=>{if(T.type===A.WAKE){g.save(),g.globalAlpha=T.hp/120*.4,g.strokeStyle="rgba(255, 255, 255, 0.5)",g.lineWidth=2;const ge=T.pos.x-st,ie=T.pos.y,oe=T.size.width,de=T.size.height*2;g.beginPath(),g.moveTo(ge,ie),g.lineTo(ge-oe,ie-de),g.moveTo(ge,ie),g.lineTo(ge+oe,ie-de),g.stroke(),g.fillStyle="rgba(255, 255, 255, 0.3)",g.beginPath(),g.arc(ge,ie,3+T.size.width*.1,0,Math.PI*2),g.fill(),g.restore()}}),Ce||D.entities.forEach(T=>{if(T.type===A.ENEMY_BATTLESHIP){const ge=dr(T,We),ie=T.pos.x-st;g.save(),g.filter="none",g.globalAlpha=.3;const oe=document.createElement("canvas");oe.width=T.size.width,oe.height=T.size.height;const de=oe.getContext("2d");de&&(de.drawImage(ge,0,0,T.size.width,T.size.height),de.globalCompositeOperation="source-in",de.fillStyle="#000000",de.fillRect(0,0,T.size.width,T.size.height),g.drawImage(oe,ie+3,T.pos.y+3)),g.restore(),T.hitFlash&&T.hitFlash>0?(g.save(),g.filter="brightness(2.0)",g.drawImage(ge,ie,T.pos.y,T.size.width,T.size.height),g.restore()):g.drawImage(ge,ie,T.pos.y,T.size.width,T.size.height),T.turrets&&We.turret&&T.turrets.forEach(Ae=>{const ze=ie+Ae.relPos.x,Xe=T.pos.y+Ae.relPos.y;g.save(),g.translate(ze,Xe),g.rotate(Ae.angle),(T.hitFlash&&T.hitFlash>0||Ae.hitFlash&&Ae.hitFlash>0)&&(g.filter="brightness(10) grayscale(1)"),g.drawImage(We.turret,-18,-18,37,37),g.restore()})}}),D.tilemapEnabled&&Fh()&&Sp(g,D.getEffectiveScrollY(),Oe,Ce),Ce||(pr.update(16),pr.render(g,D.getEffectiveScrollY(),Oe)),Ce||D.entities.forEach(T=>{if(T.type===A.ENEMY_TANK||T.type===A.ENEMY_LARGE_TANK){const ge=dr(T,We),oe=T.pos.x-st+T.size.width/2,de=T.pos.y+T.size.height/2;g.save(),g.filter="none",g.globalAlpha=.3;const Ae=document.createElement("canvas");Ae.width=T.size.width,Ae.height=T.size.height;const ze=Ae.getContext("2d");ze&&(ze.drawImage(ge,0,0,T.size.width,T.size.height),ze.globalCompositeOperation="source-in",ze.fillStyle="#000000",ze.fillRect(0,0,T.size.width,T.size.height),g.translate(oe+2,de+2),T.rotation!==void 0&&g.rotate(T.rotation),g.drawImage(Ae,-T.size.width/2,-T.size.height/2)),g.restore(),g.save(),g.translate(oe,de),T.rotation!==void 0&&g.rotate(T.rotation),T.hitFlash&&T.hitFlash>0&&(g.filter="brightness(2.0)"),g.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.restore(),T.turrets&&We.turret&&T.turrets.forEach(Xe=>{let Ye=Xe.relPos.x-T.size.width/2,Ke=Xe.relPos.y-T.size.height/2;if(T.rotation!==void 0){const Ha=Math.cos(T.rotation),ua=Math.sin(T.rotation),ui=Ye*Ha-Ke*ua,hi=Ye*ua+Ke*Ha;Ye=ui,Ke=hi}const tt=oe+Ye,ke=de+Ke;g.save(),g.translate(tt,ke),g.rotate(Xe.angle),(T.hitFlash&&T.hitFlash>0||Xe.hitFlash&&Xe.hitFlash>0)&&(g.filter="brightness(10) grayscale(1)");const la=T.type===A.ENEMY_LARGE_TANK?32:28;g.drawImage(We.turret,-la/2,-la/2,la,la),g.restore()})}}),D.state!==te.LEVEL_COMPLETE&&(dt.render(g,D.getEffectiveScrollY(),Oe,Ce),$t.renderCrosshairs(g,D.getEffectiveScrollY(),Oe)),g.fillStyle="rgba(0, 10, 30, 0.3)",g.fillRect(0,0,w,G),St.enableClouds?(Math.random()<.005&&Ba.current.push({id:Ca.current++,x:Math.random()*(w-100),y:-100,type:"CLOUD",scale:.8+Math.random()*.4,opacity:.4+Math.random()*.3}),Ba.current.forEach(T=>{T.y+=2.5;const ge=We.cloud;g.globalAlpha=.3,g.drawImage(ge,Math.round(T.x),Math.round(T.y),ge.width*T.scale,ge.height*T.scale),g.globalAlpha=1}),Ba.current=Ba.current.filter(T=>T.y<G+100)):Ba.current=[],St.enableClouds&&zn.isEnabled()&&!V.isEnabled()&&(zn.setPerformanceMultiplier(St.particleMultiplier),zn.render(g)),g.restore(),g.save(),g.translate(w/2,G/2),g.scale(we,we),g.rotate(Ne.rotation),g.translate(-w/2+Ne.x,-G/2+Ne.y),D.screenShake>0){const T=(Math.random()-.5)*D.screenShake,ge=(Math.random()-.5)*D.screenShake,ie=Et.SCREEN_SHAKE_ROTATION,oe=(Math.random()-.5)*ie*(D.screenShake/30);g.translate(w/2,G/2),g.rotate(oe),g.translate(-w/2,-G/2),g.translate(T,ge)}const et=D.getDynamicTerrainParallaxOffset(Oe);if(!Ce&&St.enableShadows&&St.shadowQuality!=="none"&&(g.save(),g.filter="none",g.globalAlpha=St.shadowQuality==="full"?.5:.3,St.shadowQuality==="simple"?(g.fillStyle="#000000",D.entities.forEach(T=>{if(T.type===A.EXPLOSION||T.type===A.ENEMY_BATTLESHIP||T.type===A.ENEMY_TANK||T.type===A.ENEMY_LARGE_TANK||T.type===A.PARTICLE||T.type===A.BULLET_CANNON||T.type===A.BULLET_TURRET||T.type===A.BLAST_WAVE||T.type===A.SMOKE||T.type===A.WAKE)return;const ge=T.type===A.PLAYER&&T.isLooping?60:20,ie=T.type===A.PLAYER||T.type===A.BULLET_PLAYER?0:-et;g.fillRect(T.pos.x+ge+ie,T.pos.y+ge,T.size.width,T.size.height)})):D.entities.forEach(T=>{if(T.type===A.EXPLOSION||T.type===A.ENEMY_BATTLESHIP||T.type===A.ENEMY_TANK||T.type===A.ENEMY_LARGE_TANK||T.type===A.PARTICLE||T.type===A.BULLET_CANNON||T.type===A.BULLET_TURRET||T.type===A.BLAST_WAVE||T.type===A.SMOKE||T.type===A.WAKE)return;const ge=dr(T,We),ie=T.type===A.PLAYER&&T.isLooping,oe=ie?60:20,de=T.type===A.ENEMY_BATTLESHIP?5:oe,Ae=T.type===A.PLAYER||T.type===A.BULLET_PLAYER?0:-et,ze=T.pos.x+de+Ae,Xe=T.pos.y+de,Ye=Math.ceil(T.size.width*(ie?1.2:1)),Ke=Math.ceil(T.size.height*(ie?1.2:1)),tt=ko.getShadowCanvas(Ye,Ke),ke=tt.getContext("2d");if(!ke)return;if(ke.clearRect(0,0,Ye,Ke),ke.filter="none",ke.globalCompositeOperation="source-over",ie){const ua=Ye/2,ui=Ke/2;ke.translate(ua,ui),ke.rotate(D.frameCount*.2),ke.scale(1.1,1.1),ke.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),ke.setTransform(1,0,0,1,0,0)}else if(T.type===A.PLAYER&&T.bankAngle){const ua=Ye/2,ui=Ke/2;ke.translate(ua,ui),ke.rotate(T.bankAngle),ke.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),ke.setTransform(1,0,0,1,0,0)}else ke.drawImage(ge,0,0,T.size.width,T.size.height);ke.globalCompositeOperation="source-in",ke.fillStyle="#000000",ke.fillRect(0,0,Ye,Ke),ke.globalCompositeOperation="source-over";const la=ie?ze-(Ye-T.size.width)/2:ze,Ha=ie?Xe-(Ke-T.size.height)/2:Xe;g.drawImage(tt,la,Ha)}),g.restore()),Ce||D.entities.forEach(T=>{if(T.type===A.PARTICLE||T.type===A.SMOKE||T.type===A.WAKE||T.type===A.BULLET_CANNON||T.type===A.BLAST_WAVE||T.type===A.EXPLOSION||T.type===A.EXPLOSION_SMALL||T.type===A.EXPLOSION_MEDIUM||T.type===A.EXPLOSION_LARGE||T.type===A.EXPLOSION_MASSIVE)return;const ge=T.type===A.PLAYER||T.type===A.BULLET_PLAYER?0:-et;if(T.type===A.BOMB_DROPPED){const ie=We.bombDropped;if(ie){const oe=T.scale!==void 0?T.scale:1,de=T.shadowScale!==void 0?T.shadowScale:0;de>0&&(g.save(),g.globalAlpha=Et.SHADOW_MAX_ALPHA*de,g.fillStyle="#000000",g.beginPath(),g.ellipse(T.pos.x+T.size.width/2+ge,T.pos.y+T.size.height+40,24*de,10*de,0,0,Math.PI*2),g.fill(),g.restore()),g.save(),g.translate(T.pos.x+T.size.width/2+ge,T.pos.y+T.size.height/2),g.scale(oe,oe),g.drawImage(ie,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.restore()}return}if(T.type!==A.ENEMY_BATTLESHIP&&T.type!==A.ENEMY_TANK&&T.type!==A.ENEMY_LARGE_TANK){const ie=dr(T,We),oe=T.type===A.ENEMY_SMALL||T.type===A.ENEMY_RED||T.type===A.ENEMY_HELICOPTER,de=T.type===A.CRASHING_AIRCRAFT,Ae=oe&&T.rotation!==void 0;if(T.type===A.PLAYER&&(T.isEvading||T.bankAngle)||oe&&(T.bankAngle||Ae)||T.type===A.POWERUP&&T.rotation||T.type===A.BOSS&&T.scale||de){g.save();const Xe=T.pos.x+T.size.width/2+ge,Ye=T.pos.y+T.size.height/2;if(g.translate(Xe,Ye),oe&&T.rotation!==void 0?(g.rotate(T.rotation),T.bankAngle&&g.rotate(T.bankAngle*.3)):T.bankAngle&&g.rotate(T.bankAngle),de){const tt=T.scale||1;g.scale(tt,tt),g.filter="brightness(0.85) saturate(0.9)"}T.type===A.POWERUP&&T.rotation&&g.rotate(T.rotation),T.type===A.POWERUP&&(T.powerupType===da.SPREAD||T.isSpecial)&&Math.floor(D.frameCount/10)%2===0&&(g.filter="brightness(1.8) saturate(1.5)"),T.type===A.SUPPORT_FIGHTER&&(g.rotate(Math.PI/2),g.filter="hue-rotate(180deg) saturate(1.5) brightness(1.2)"),T.isEvading&&T.evasiveScale!==void 0&&g.scale(T.evasiveScale,T.evasiveScale),T.type===A.BOSS&&T.scale&&g.scale(T.scale,T.scale),T.hitFlash&&T.hitFlash>0&&T.type!==A.BOSS&&(g.filter="brightness(10) grayscale(1)"),D.playerInvincible>0&&Math.floor(D.frameCount/6)%2===0&&(g.globalAlpha=.5);const Ke=D.playerHealth/D.maxPlayerHealth*100;Ke<33&&Ke>0&&Math.floor(D.frameCount/15)%2===0&&(g.filter="brightness(1.5) hue-rotate(0deg) saturate(2)"),g.drawImage(ie,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.globalAlpha=1,g.restore()}else{const Xe=D.playerHealth/D.maxPlayerHealth*100,Ye=T.hitFlash&&T.hitFlash>0&&T.type!==A.BOSS||T.type===A.PLAYER&&D.playerInvincible>0||T.type===A.PLAYER&&Xe<33&&Xe>0;Ye&&g.save(),T.hitFlash&&T.hitFlash>0&&T.type!==A.BOSS&&(g.filter="brightness(10) grayscale(1)"),T.type===A.PLAYER&&D.playerInvincible>0&&Math.floor(D.frameCount/6)%2===0&&(g.globalAlpha=.5),T.type===A.PLAYER&&Xe<33&&Xe>0&&Math.floor(D.frameCount/15)%2===0&&(g.filter="brightness(1.5) hue-rotate(0deg) saturate(2)"),g.drawImage(ie,T.pos.x+ge,T.pos.y,T.size.width,T.size.height),Ye&&g.restore()}}if(T.type===A.BOSS&&T.bossType){let ie=1;const oe=T;if(oe.hp!==void 0&&oe.maxHP!==void 0){const de=oe.hp/oe.maxHP;de<.25?ie=2.5:de<.5&&(ie=2)}V_(g,T.bossType,T.pos.x+ge,T.pos.y,T.size.width,T.size.height,D.frameCount,ie)}T.turrets&&We.turret&&T.type!==A.ENEMY_BATTLESHIP&&T.type!==A.ENEMY_TANK&&T.type!==A.ENEMY_LARGE_TANK&&T.turrets.forEach(ie=>{g.save();const oe=T.pos.x+ie.relPos.x+ge,de=T.pos.y+ie.relPos.y;g.translate(oe,de),g.rotate(ie.angle),(T.hitFlash&&T.hitFlash>0||ie.hitFlash&&ie.hitFlash>0)&&(ie.hp<=3?g.filter="brightness(2) sepia(1) saturate(10) hue-rotate(-30deg)":g.filter="brightness(10) grayscale(1)"),g.drawImage(We.turret,-18,-18,37,37),g.restore()})}),D.activeBoss&&D.activeBoss.active){const T=D.activeBoss,ge=-et,ie=80,oe=6,de=T.pos.x+T.size.width/2-ie/2+ge,Ae=T.pos.y-15,ze=Math.max(0,T.hp/T.maxHP),Xe=T.introPlayed?Math.min(D.frameCount-(D.bossIntroStartFrame||0),180):0,Ye=T.variantName&&Xe<120?Math.max(0,1-Xe/120):0;if(Ye>0&&T.variantName){g.save(),g.globalAlpha=Ye,g.font='bold 10px "Black Ops One", monospace',g.textAlign="center";const tt=T.pos.x+T.size.width/2+ge,ke=Ae-10;g.strokeStyle="rgba(0, 0, 0, 0.8)",g.lineWidth=3,g.strokeText(T.variantName.toUpperCase(),tt,ke),g.fillStyle="#FF6600",g.fillText(T.variantName.toUpperCase(),tt,ke),g.restore()}g.fillStyle="rgba(0, 0, 0, 0.7)",g.fillRect(de-1,Ae-1,ie+2,oe+2),g.strokeStyle="#444444",g.lineWidth=1,g.strokeRect(de-1,Ae-1,ie+2,oe+2);let Ke;ze>.6?Ke="#22CC44":ze>.3?Ke="#CCAA22":Ke="#CC3322",g.fillStyle=Ke,g.fillRect(de,Ae,ie*ze,oe),g.fillStyle="rgba(255, 255, 255, 0.2)",g.fillRect(de,Ae,ie*ze,oe/2)}if(D.crashingBoss){const T=D.crashingBoss,ge=-et,ie=T.scale||1,oe=dr(T,We);if(oe){g.save();const de=T.pos.x+T.size.width/2+ge,Ae=T.pos.y+T.size.height/2;g.translate(de,Ae),g.rotate(D.bossCrashRotation),g.scale(ie,ie),g.filter="brightness(0.7) sepia(0.3) saturate(1.5)",g.drawImage(oe,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.restore(),g.save(),g.globalCompositeOperation="lighter",g.globalAlpha=(.4+Math.random()*.2)*ie,g.fillStyle="#FF4400";const ze=(30+Math.random()*20)*ie;g.beginPath(),g.ellipse(de+(Math.random()-.5)*T.size.width*.5*ie,Ae+(Math.random()-.5)*T.size.height*.3*ie,ze,ze*.7,0,0,Math.PI*2),g.fill(),g.restore()}}if(Ce||D.entities.forEach(T=>{if(T.type!==A.BLAST_WAVE)return;const ge=T.maxFrames||30,ie=T.frame/ge,de=(T.blastRadius||200)*ie,Ae=Math.max(8,40*(1-ie)),ze=.4*(1-ie*ie),Xe=T.pos.x-et,Ye=T.pos.y;g.save(),g.globalAlpha=ze,g.strokeStyle="#FF8800",g.lineWidth=Ae,g.beginPath(),g.arc(Xe,Ye,de,0,Math.PI*2),g.stroke(),g.strokeStyle="#FFDD44",g.lineWidth=Ae*.5,g.beginPath(),g.arc(Xe,Ye,de,0,Math.PI*2),g.stroke(),g.globalAlpha=ze*.15,g.fillStyle="#FFAA00",g.beginPath(),g.arc(Xe,Ye,de,0,Math.PI*2),g.fill(),g.restore(),T.frame++,T.frame>ge&&(T.active=!1)}),!Ce){g.save(),g.globalCompositeOperation="lighter",D.entities.forEach(T=>{var ie;const ge=T.type===A.PLAYER||T.type===A.BULLET_PLAYER?0:-et;if(T.type===A.PARTICLE)if((ie=T.id)!=null&&ie.startsWith("turret_debris")){g.save(),g.globalCompositeOperation="source-over",g.globalAlpha=Math.min(1,T.hp/40),g.fillStyle=T.color||"#718096";const oe=T.pos.x+T.size.width/2+ge,de=T.pos.y+T.size.height/2;g.translate(oe,de),T.rotation!==void 0&&g.rotate(T.rotation),g.fillRect(-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.strokeStyle="rgba(0,0,0,0.7)",g.lineWidth=2,g.strokeRect(-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.restore()}else g.globalAlpha=T.hp/40,g.fillStyle=T.color||nt.WHITE,g.fillRect(T.pos.x+ge,T.pos.y,T.size.width,T.size.height);else if(T.type===A.BULLET_CANNON){const oe=T.pos.x+T.size.width/2+ge,de=T.pos.y+T.size.height/2,Ae=g.createRadialGradient(oe,de,2,oe,de,10);Ae.addColorStop(0,"#FFFFFF"),Ae.addColorStop(.3,"#FFFF00"),Ae.addColorStop(.6,"#FF4400"),Ae.addColorStop(1,"rgba(204, 0, 0, 0)"),g.fillStyle=Ae,g.beginPath(),g.arc(oe,de,10,0,Math.PI*2),g.fill()}else if(T.type===A.EXPLOSION||T.type===A.EXPLOSION_SMALL||T.type===A.EXPLOSION_MEDIUM||T.type===A.EXPLOSION_LARGE||T.type===A.EXPLOSION_MASSIVE){const oe=We.explosion,de=T.maxFrames||20,Ae=T.frame/de,ze=.5+Ae*2;g.save();const Xe=T.pos.x+T.size.width/2+ge,Ye=T.pos.y+T.size.height/2;g.translate(Xe,Ye),g.rotate(T.frame*.5),g.scale(ze,ze),g.globalAlpha=1-Ae*Ae,g.drawImage(oe,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),g.restore(),T.frame++,T.frame>de&&(T.active=!1)}}),St.enableParticles&&Te.render(g,!0),$t.renderFloatingScores(g);for(const T of D.floatingScores){const ge=T.frame/T.maxFrames,ie=Math.sin(ge*Math.PI)*60,oe=1+Math.sin(ge*Math.PI*2)*.15,de=ge>.6?1-(ge-.6)/.4:1;let Ae=14;T.points>=1e4?Ae=32:T.points>=5e3?Ae=26:T.points>=1e3?Ae=22:T.points>=500&&(Ae=18);const ze=Math.floor(Ae*oe);let Xe="#ffffff",Ye="rgba(255, 255, 255, 0.4)";T.entityType==="bomber"?(Xe="#22d3ee",Ye="rgba(34, 211, 238, 0.6)"):T.entityType==="turret"?(Xe="#4ade80",Ye="rgba(74, 222, 128, 0.6)"):T.heatLevel==="BLAZING"?(Xe="#e879f9",Ye="rgba(232, 121, 249, 0.6)"):T.heatLevel==="ON_FIRE"?(Xe="#ef4444",Ye="rgba(239, 68, 68, 0.5)"):T.heatLevel==="HOT"?(Xe="#f97316",Ye="rgba(249, 115, 22, 0.5)"):T.heatLevel==="WARM"&&(Xe="#facc15",Ye="rgba(250, 204, 21, 0.5)");const Ke=T.x-et,tt=T.y-ie;g.save(),g.globalAlpha=de,g.font=`bold ${ze}px "Black Ops One", monospace`,g.textAlign="center",g.shadowColor=Ye,g.shadowBlur=15,g.strokeStyle="#000000",g.lineWidth=4,g.strokeText(`+${T.points}`,Ke,tt),g.fillStyle=Xe,g.fillText(`+${T.points}`,Ke,tt);const ke=T.multiplier?Math.round(T.multiplier):0;if(ke>=2){g.font=`bold ${Math.floor(ze*.6)}px "Black Ops One", monospace`,g.fillStyle=Xe;const la=`${ke}`;g.strokeText(la,Ke,tt+ze+2),g.fillText(la,Ke,tt+ze+2)}g.restore()}g.restore()}Ce||D.entities.forEach(T=>{if(T.type===A.SMOKE){const ge=-et;g.globalAlpha=T.hp/60*.5,g.fillStyle="#555",g.beginPath(),g.arc(T.pos.x+ge,T.pos.y,T.size.width,0,Math.PI*2),g.fill()}}),g.globalAlpha=1,g.restore()}if(D.frameCount-D.bombActiveFrame<15&&D.frameCount>15&&(g.fillStyle=`rgba(255, 255, 255, ${1-(D.frameCount-D.bombActiveFrame)/15})`,g.fillRect(0,0,w,G)),D.postProcessing.renderWhiteFlash(g,w,G),D.postProcessing.renderDamageVignette(g,w,G,St.enablePostProcessing),D.postProcessing.renderPrecisionVignette(g,w,G,St.enablePostProcessing),D.postProcessing.renderScanlines(g,w,G,sa.getScanlinesIntensity(),St.enablePostProcessing),D.state===te.ATTRACT){g.save(),g.beginPath(),g.roundRect(0,0,w,G,20),g.clip(),g.drawImage(We.titleScreen,0,0,w,G),g.fillStyle="rgba(0, 0, 0, 0.6)",g.fillRect(0,0,w,G),g.restore(),g.fillStyle="rgba(180, 180, 180, 0.7)",g.font="10px monospace",g.textAlign="center",g.fillText(" 2025-2026, Rodrigo Geve, All Rights Reserved",w/2,105);const Ve=(T,ge,ie=5)=>{const oe=g.createRadialGradient(T-1,ge-1,0,T,ge,ie);oe.addColorStop(0,"#999"),oe.addColorStop(.5,"#666"),oe.addColorStop(1,"#333"),g.beginPath(),g.arc(T,ge,ie,0,Math.PI*2),g.fillStyle=oe,g.fill(),g.strokeStyle="#222",g.lineWidth=1,g.stroke()},Fe=115,we=130,Me=15,Oe=20;g.fillStyle="rgba(30, 30, 30, 0.5)",g.beginPath(),g.roundRect(Oe,Fe,w-Oe*2,we,Me),g.fill(),g.strokeStyle="#555",g.lineWidth=2,g.beginPath(),g.roundRect(Oe,Fe,w-Oe*2,we,Me),g.stroke();const qe=70,Ce=55;for(let T=0;T<7;T++)Ve(Ce+T*qe,Fe+10,5),Ve(Ce+T*qe,Fe+we-10,5);g.save(),g.shadowColor="#000000",g.shadowBlur=25,g.fillStyle="#000000",g.font='50px "Black Ops One"',g.textAlign="center",g.fillText("WORLD WAR II",w/2+5,165),g.fillText("WORLD WAR II",w/2+3,163);const st=g.createLinearGradient(0,110,0,210);st.addColorStop(0,"#D4A574"),st.addColorStop(.3,"#C8C8C8"),st.addColorStop(.7,"#B8B8B8"),st.addColorStop(1,"#8B7355"),g.fillStyle=st,g.strokeStyle="#2a2a2a",g.lineWidth=2,g.strokeText("WORLD WAR II",w/2,160),g.fillText("WORLD WAR II",w/2,160),g.restore(),g.save(),g.shadowColor="#000000",g.shadowBlur=30,g.fillStyle="#000000",g.font='58px "Black Ops One"',g.textAlign="center",g.fillText("SKY ACE",w/2+5,225),g.fillText("SKY ACE",w/2+3,223);const et=g.createLinearGradient(0,180,0,240);et.addColorStop(0,"#D4A574"),et.addColorStop(.3,"#C8C8C8"),et.addColorStop(.7,"#B8B8B8"),et.addColorStop(1,"#8B7355"),g.fillStyle=et,g.strokeStyle="#2a2a2a",g.lineWidth=2,g.strokeText("SKY ACE",w/2,220),g.fillText("SKY ACE",w/2,220),g.restore(),g.fillStyle="rgba(0, 0, 0, 0.1)";for(let T=0;T<G;T+=3)g.fillRect(0,T,w,1)}if(D.state===te.STORY){g.fillStyle="#2B3A12",g.fillRect(0,0,w,G);const Ve=mp(D.campaign)[Z]||`storyPanel${Z+1}`,Fe=yp(Ve),we=Fe||re[Z]||We.storyPanels[Z],Me=ec(Ve);let Oe=0,qe=0,Ce=0,st=0;const et=80,T=30,ge=30,ie=15,oe=120,de=w-ge*2,Ae=G-T-et;if(we){const ct=we.naturalWidth||we.width,Ra=we.naturalHeight||we.height,Ci=ct/Ra||1.33,Vi=Ae-oe-ie;Ce=de,st=Ce/Ci,st>Vi&&(st=Vi,Ce=st*Ci),Oe=(w-Ce)/2,qe=T,!Me&&Fe&&(g.imageSmoothingEnabled=!1),g.drawImage(we,Oe,qe,Ce,st),g.imageSmoothingEnabled=!0,g.strokeStyle=nt.WHITE,g.lineWidth=3,g.beginPath(),g.roundRect(Oe,qe,Ce,st,10),g.stroke(),!Me&&Fe&&(g.fillStyle="rgba(0, 0, 0, 0.5)",g.fillRect(Oe+Ce-100,qe+10,90,24),g.fillStyle=nt.GREEN,g.font='12px "Black Ops One"',g.textAlign="right",g.fillText("LOADING...",Oe+Ce-15,qe+27),g.textAlign="left")}const Ye=jp(D.campaign)[Z].split(" "),Ke=Math.min(20,Math.max(16,Math.floor(Ce/30)));g.fillStyle=nt.GREEN,g.font=`${Ke}px "Black Ops One"`,g.textAlign="left";const tt=[];let ke="";const la=20,Ha=Ce-la*2;for(let ct=0;ct<Ye.length;ct++){const Ra=ke+Ye[ct]+" ";g.measureText(Ra).width>Ha&&ct>0?(tt.push(ke),ke=Ye[ct]+" "):ke=Ra}tt.push(ke);const ua=qe+st+ie,ui=Math.max(oe,G-et-ua),hi=Math.floor(Ke*2.2);g.fillStyle="rgba(43, 58, 18, 0.85)",g.beginPath(),g.roundRect(Oe,ua,Ce,ui,10),g.fill(),g.strokeStyle="#5A6D33",g.lineWidth=2,g.beginPath(),g.roundRect(Oe,ua,Ce,ui,10),g.stroke();const Ja=tt.length*hi,Ds=ua+(ui-Ja)/2+Ke;g.save(),g.shadowColor="rgba(0, 0, 0, 0.8)",g.shadowBlur=4,g.shadowOffsetX=2,g.shadowOffsetY=2,g.fillStyle="#c9a961",g.font=`${Ke}px "Black Ops One"`;let ki=Ds;tt.forEach(ct=>{g.fillText(ct,Oe+la,ki),ki+=hi}),g.restore(),g.fillStyle="rgba(0, 0, 0, 0.1)";for(let ct=0;ct<G;ct+=3)g.fillRect(0,ct,w,1)}if(D.powerupLegendTimer>0){g.fillStyle="rgba(0, 0, 0, 0.4)",g.fillRect(0,0,w,G),g.fillStyle=nt.YELLOW,g.font='20px "Black Ops One"',g.textAlign="center",g.fillText("POWER-UPS",w/2,120);const Ne=[],Ve=D.difficulty;Ne.push({icon:We.powerupFirepower,name:"FIRE",desc:"QUAD SHOT"}),Ve!==gt.BEGINNER&&Ne.push({icon:We.powerupFirepowerEnhanced,name:"FIRE+",desc:"6-SHOT 2X DMG"}),Ne.push({icon:We.bombTier1,name:"BOMB I",desc:"STANDARD"}),Ne.push({icon:We.bombTier2,name:"BOMB II",desc:"HEAVY"}),Ve!==gt.BEGINNER&&Ne.push({icon:We.bombTier3,name:"BOMB III",desc:"CLUSTER"}),Ve===gt.VETERAN&&Ne.push({icon:We.bombTier4,name:"BOMB IV",desc:"MEGA"}),Ne.push({icon:We.powerupInvincibility,name:"SHIELD",desc:"7 SECONDS"});const Fe=42,we=52,Me=308,Oe=60+Ne.length*we,qe=w/2-Me/2,Ce=150;g.fillStyle="rgba(0, 0, 0, 0.7)",g.beginPath(),g.roundRect(qe,Ce,Me,Oe,8),g.fill(),g.strokeStyle=nt.YELLOW,g.lineWidth=3,g.beginPath(),g.roundRect(qe,Ce,Me,Oe,8),g.stroke();const st=Ce+40;Ne.forEach((T,ge)=>{const ie=st+ge*we,oe=qe+30;T.icon&&g.drawImage(T.icon,oe,ie-18,Fe,Fe),g.fillStyle=nt.WHITE,g.font='12px "Black Ops One"',g.textAlign="left",g.fillText(T.name,oe+Fe+16,ie),g.fillStyle=nt.GREY,g.font='10px "Black Ops One"',g.fillText(T.desc,oe+Fe+16,ie+16)});const et=Math.ceil(D.powerupLegendTimer/60);g.fillStyle=nt.GREEN,g.font='12px "Black Ops One"',g.textAlign="center",g.fillText(`STARTING IN ${et}...`,w/2,Ce+Oe+25)}if(D.state===te.LEVEL_COMPLETE)if(D.intermissionPhase==="fadeIn")D.intermissionFadeAlpha>0&&(g.fillStyle=`rgba(0, 0, 0, ${D.intermissionFadeAlpha})`,g.fillRect(0,0,w,G));else{const Ve=D.intermissionScrollY%64,Fe=Math.floor(-Ve/32)-1,we=Math.ceil(G/32)+2,Me=Math.ceil(w/32);for(let tt=Fe;tt<we;tt++)for(let ke=0;ke<Me;ke++){const Ha=(tt+ke)%2===0?.5:.9;g.fillStyle=`rgba(0, 0, 0, ${Ha})`,g.fillRect(ke*32,tt*32+Ve,32,32)}g.fillStyle="rgba(0, 0, 0, 0.1)",g.fillRect(0,0,w,G);const Oe=D.intermissionCachedProgress||$t.getLevelProgress(),qe=420,Ce=360,st=(w-qe)/2,et=(G-Ce)/2,T=g.createLinearGradient(st,et,st,et+Ce);T.addColorStop(0,"rgba(59, 74, 28, 0.95)"),T.addColorStop(1,"rgba(43, 58, 18, 0.95)"),g.fillStyle=T,g.beginPath(),g.roundRect(st,et,qe,Ce,10),g.fill(),g.save(),g.shadowColor="#5A6D33",g.shadowBlur=15,g.strokeStyle="#5A6D33",g.lineWidth=3,g.beginPath(),g.roundRect(st,et,qe,Ce,10),g.stroke(),g.restore(),g.save(),g.shadowColor=nt.YELLOW,g.shadowBlur=20,g.fillStyle=nt.YELLOW,g.font=D.intermissionIsFinalLevel?'22px "Black Ops One"':'26px "Black Ops One"',g.textAlign="center";const ge=D.intermissionIsFinalLevel?"CAMPAIGN COMPLETE!":`STAGE ${D.level} COMPLETE!`;g.fillText(ge,w/2,et+60),g.restore(),g.font='16px "Black Ops One"',g.textAlign="center";const ie=et+110;g.fillStyle=nt.WHITE,g.fillText("SCORE",w/2,ie),g.fillStyle=nt.YELLOW,g.font='20px "Black Ops One"',g.fillText(`${D.score.toString().padStart(6,"0")}`,w/2,ie+22),g.font='16px "Black Ops One"',g.fillStyle=nt.WHITE,g.fillText("TARGETS DESTROYED",w/2,ie+55),g.fillStyle="#00ffff",g.font='18px "Black Ops One"',g.fillText(`${Oe.destroyedGameTargets} / ${Oe.totalGameTargets}`,w/2,ie+75),Oe.pointsEarned>0&&(g.font='16px "Black Ops One"',g.fillStyle=nt.GREEN,g.fillText(`TARGET BONUS: +${Oe.pointsEarned}`,w/2,ie+105)),g.font='16px "Black Ops One"',g.fillStyle=nt.WHITE,g.fillText(`LIVES: ${D.lives}`,w/2,ie+135);const oe=300,de=10,Ae=(w-oe)/2,ze=et+Ce-75,Xe=1-D.intermissionTimer/D.INTERMISSION_DURATION;if(g.fillStyle="#333",g.beginPath(),g.roundRect(Ae,ze,oe,de,5),g.fill(),Xe>0){const tt=g.createLinearGradient(Ae,ze,Ae+oe*Xe,ze);tt.addColorStop(0,"#5A6D33"),tt.addColorStop(1,"#4A5D23"),g.fillStyle=tt,g.beginPath(),g.roundRect(Ae,ze,oe*Xe,de,5),g.fill()}g.strokeStyle="#5A6D33",g.lineWidth=1,g.beginPath(),g.roundRect(Ae,ze,oe,de,5),g.stroke();const Ye=Math.ceil(D.intermissionTimer/60);g.font='16px "Black Ops One"',g.fillStyle="#5A6D33",g.textAlign="center";const Ke=D.intermissionIsFinalLevel?`CONTINUING IN ${Ye}`:`NEXT STAGE IN ${Ye}`;g.fillText(Ke,w/2,ze+de+20),g.fillStyle="rgba(0, 0, 0, 0.1)";for(let tt=0;tt<G;tt+=3)g.fillRect(0,tt,w,1);D.intermissionFadeAlpha>0&&(g.fillStyle=`rgba(0, 0, 0, ${D.intermissionFadeAlpha})`,g.fillRect(0,0,w,G))}if(D.state===te.PAUSED){g.fillStyle="rgba(0, 0, 0, 0.7)",g.fillRect(0,0,w,G);const Ne=220,Ve=260,Fe=(w-Ne)/2,we=(G-Ve)/2;g.save(),g.beginPath(),g.roundRect(Fe,we,Ne,Ve,12),g.clip(),q_(g,Fe,we,Ne,Ve,{palette:"pacific",seed:12345,numClusters:25,pointDensity:.08}),g.restore(),g.strokeStyle="#5A6D33",g.lineWidth=3,g.beginPath(),g.roundRect(Fe,we,Ne,Ve,12),g.stroke(),g.fillStyle="#c9a961",g.font="bold 24px monospace",g.textAlign="center",g.fillText("PAUSED",w/2,we+35);const Me=160,Oe=32,qe=Fe+(Ne-Me)/2,Ce=40,st=we+55,et=st;g.fillStyle=D.pauseSelection===0?"#4A5D23":"#2B3A12",g.beginPath(),g.roundRect(qe,et,Me,Oe,6),g.fill(),g.strokeStyle=D.pauseSelection===0?"#5A6D33":"#3B4A1C",g.lineWidth=2,g.beginPath(),g.roundRect(qe,et,Me,Oe,6),g.stroke(),g.fillStyle=D.pauseSelection===0?"#FFFFFF":"#AAAAAA",g.font="bold 14px monospace",g.fillText("RESUME",w/2,et+21);const T=st+Ce;g.fillStyle=D.pauseSelection===1?"#4A5D23":"#2B3A12",g.beginPath(),g.roundRect(qe,T,Me,Oe,6),g.fill(),g.strokeStyle=D.pauseSelection===1?"#5A6D33":"#3B4A1C",g.lineWidth=2,g.beginPath(),g.roundRect(qe,T,Me,Oe,6),g.stroke(),g.fillStyle=D.pauseSelection===1?"#FFFFFF":"#AAAAAA",g.fillText("SETTINGS",w/2,T+21);const ge=st+Ce*2,ie=Se.isMutedState();ie?(g.fillStyle=D.pauseSelection===2?"#6B2A2A":"#4A1C1C",g.beginPath(),g.roundRect(qe,ge,Me,Oe,6),g.fill(),g.strokeStyle=D.pauseSelection===2?"#8B3A3A":"#5A2A2A"):(g.fillStyle=D.pauseSelection===2?"#4A5D23":"#2B3A12",g.beginPath(),g.roundRect(qe,ge,Me,Oe,6),g.fill(),g.strokeStyle=D.pauseSelection===2?"#5A6D33":"#3B4A1C"),g.lineWidth=2,g.beginPath(),g.roundRect(qe,ge,Me,Oe,6),g.stroke(),g.fillStyle=D.pauseSelection===2?"#FFFFFF":ie?"#CC8888":"#AAAAAA",g.fillText(ie?"AUDIO: OFF":"AUDIO: ON",w/2,ge+21);const oe=st+Ce*3;g.fillStyle=D.pauseSelection===3?"#4A5D23":"#2B3A12",g.beginPath(),g.roundRect(qe,oe,Me,Oe,6),g.fill(),g.strokeStyle=D.pauseSelection===3?"#5A6D33":"#3B4A1C",g.lineWidth=2,g.beginPath(),g.roundRect(qe,oe,Me,Oe,6),g.stroke(),g.fillStyle=D.pauseSelection===3?"#FFFFFF":"#AAAAAA",g.fillText("QUIT",w/2,oe+21),g.fillStyle="#9AAF7A",g.font="10px monospace",g.fillText(" to select, Enter to confirm",w/2,we+Ve-12)}if(D.state===te.DESIGN_MODE&&Vh.render(g),D.state===te.VICTORY){g.fillStyle="#2B3A12",g.fillRect(0,0,w,G);const Ve=s_(D.campaign)[Q],Fe=yp(Ve),we=Fe||_e[Q],Me=ec(Ve),Oe=30,qe=30,Ce=30,st=15,et=150,T=w-Ce*2,ge=G-qe-Oe;let ie=0,oe=0,de=0,Ae=0;if(we){const ct=we.naturalWidth||we.width,Ra=we.naturalHeight||we.height,Ci=ct/Ra||1.33,Vi=ge-et-st;de=T,Ae=de/Ci,Ae>Vi&&(Ae=Vi,de=Ae*Ci),ie=(w-de)/2,oe=qe,!Me&&Fe&&(g.imageSmoothingEnabled=!1),g.drawImage(we,ie,oe,de,Ae),g.imageSmoothingEnabled=!0,g.strokeStyle=nt.WHITE,g.lineWidth=3,g.beginPath(),g.roundRect(ie,oe,de,Ae,10),g.stroke(),!Me&&Fe&&(g.fillStyle="rgba(0, 0, 0, 0.5)",g.fillRect(ie+de-100,oe+10,90,24),g.fillStyle=nt.GREEN,g.font='12px "Black Ops One"',g.textAlign="right",g.fillText("LOADING...",ie+de-15,oe+27),g.textAlign="left")}else de=T,Ae=ge-et-st,ie=Ce,oe=qe,g.fillStyle="rgba(74, 93, 35, 0.8)",g.beginPath(),g.roundRect(ie,oe,de,Ae,10),g.fill(),g.strokeStyle="#5A6D33",g.lineWidth=1,g.beginPath(),g.roundRect(ie,oe,de,Ae,10),g.stroke(),g.fillStyle=nt.GREY,g.font='12px "Black Ops One"',g.textAlign="center",g.fillText("LOADING IMAGE...",w/2,oe+Ae/2);const Ye=(my(D.campaign)[Q]||"VICTORY!").split(" "),Ke=Math.min(20,Math.max(16,Math.floor(de/30)));g.fillStyle=nt.GREEN,g.font=`${Ke}px "Black Ops One"`,g.textAlign="left";const tt=[];let ke="";const la=35,Ha=de-la*2;for(let ct=0;ct<Ye.length;ct++){const Ra=ke+Ye[ct]+" ";g.measureText(Ra).width>Ha&&ct>0?(tt.push(ke),ke=Ye[ct]+" "):ke=Ra}tt.push(ke);const ua=oe+Ae+st,hi=Math.max(et+25,G-Oe-ua),Ja=Math.floor(Ke*2.2);g.fillStyle="rgba(43, 58, 18, 0.85)",g.beginPath(),g.roundRect(ie,ua,de,hi,10),g.fill(),g.strokeStyle="#5A6D33",g.lineWidth=2,g.beginPath(),g.roundRect(ie,ua,de,hi,10),g.stroke();let ki=ua+30+Ke;g.save(),g.shadowColor="rgba(0, 0, 0, 0.8)",g.shadowBlur=4,g.shadowOffsetX=2,g.shadowOffsetY=2,g.fillStyle="#c9a961";for(let ct=0;ct<tt.length;ct++)g.fillText(tt[ct],ie+la,ki),ki+=Ja;g.restore(),g.fillStyle="rgba(0, 0, 0, 0.1)";for(let ct=0;ct<G;ct+=3)g.fillRect(0,ct,w,1)}if(D.state===te.ENDING){g.fillStyle="#000",g.fillRect(0,0,w,G);for(let T=0;T<50;T++){const ge=T*37%w,ie=T*73%G,oe=Math.sin(D.frameCount/10+T)*.5+.5;g.globalAlpha=oe,g.fillStyle="#fff",g.fillRect(ge,ie,2,2)}g.globalAlpha=1,g.fillStyle="rgba(0, 20, 40, 0.9)";const Ne=100,Ve=350;g.beginPath(),g.roundRect(40,Ne,w-80,Ve,10),g.fill(),g.strokeStyle=nt.YELLOW,g.lineWidth=3,g.beginPath(),g.roundRect(40,Ne,w-80,Ve,10),g.stroke(),g.fillStyle=nt.GREY,g.font='12px "Black Ops One"',g.textAlign="center",g.fillText(`${pe+1} / ${dl.length}`,w/2,Ne+25),g.fillStyle=nt.WHITE,g.font='16px "Black Ops One"',g.textAlign="center";const we=$p(D.campaign)[pe],Me=w-120,Oe=we.split(" ");let qe="",Ce=Ne+100;const st=30;Oe.forEach((T,ge)=>{const ie=qe+T+" ";g.measureText(ie).width>Me&&ge>0?(g.fillText(qe,w/2,Ce),qe=T+" ",Ce+=st):qe=ie}),g.fillText(qe,w/2,Ce);const et=.5+Math.sin(D.frameCount/15)*.5;g.globalAlpha=et,g.fillStyle=nt.GREEN,g.font='12px "Black Ops One"',g.textAlign="center",pe<dl.length-1?g.fillText("CLICK NEXT >",w/2,Ne+Ve-20):g.fillText("CLICK FINISH TO RETURN",w/2,Ne+Ve-20),g.globalAlpha=1}D.state===te.GAME_OVER&&(g.fillStyle="rgba(0,0,0,0.6)",g.fillRect(0,0,w,G),g.fillStyle=nt.RED,g.font='42px "Black Ops One"',g.textAlign="center",g.fillText("GAME OVER",w/2,G/2)),ko.endFrame(),ve=requestAnimationFrame(It)};return ve=requestAnimationFrame(It),()=>{cancelAnimationFrame(ve)}},[P,Y,Z,Q]);const Di=n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE||n===te.GAME_OVER;return M.jsxs("div",{className:"relative w-full h-dvh flex flex-col bg-black text-white overflow-hidden",children:[M.jsxs("div",{ref:t,className:"relative flex-1 flex items-center justify-center bg-black overflow-hidden",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},children:[M.jsx("canvas",{ref:c,width:w,height:G,className:"block bg-black w-full h-full",style:{objectFit:"contain",borderRadius:"20px"},onMouseDown:F=>{if(D.state===te.DESIGN_MODE){const g=Kn(F);g&&V.onMouseDown(g.x,g.y,F.ctrlKey||F.metaKey)}},onMouseMove:F=>{if(D.state===te.DESIGN_MODE){const g=Kn(F);g&&V.onMouseMove(g.x,g.y)}},onMouseUp:()=>{D.state===te.DESIGN_MODE&&V.onMouseUp()},onMouseLeave:()=>{D.state===te.DESIGN_MODE&&V.onMouseUp()},onWheel:F=>{D.state===te.DESIGN_MODE&&(F.preventDefault(),V.onWheel(F.deltaY))},onClick:F=>{if(D.state===te.PAUSED){const g=Kn(F);if(!g)return;const{x:ve,y:_t}=g,Ue=220,Pt=260,pt=(w-Ue)/2,Ot=(G-Pt)/2,kt=160,It=32,wt=pt+(Ue-kt)/2,Bt=40,We=Ot+55;if(ve>=wt&&ve<=wt+kt){const xt=We;if(_t>=xt&&_t<=xt+It){D.resume();return}const vi=We+Bt;if(_t>=vi&&_t<=vi+It){ml(!0),hn(!0);return}const Ri=We+Bt*2;if(_t>=Ri&&_t<=Ri+It){const Zt=!Se.isMutedState();Se.setMuted(Zt),ga(Zt),Zt||Se.playLevelMusic(D.level,D.campaign);return}const Ft=We+Bt*3;if(_t>=Ft&&_t<=Ft+It){D.quitToTitle(),R(D.totalCreditsRemaining);return}}}}}),Di&&M.jsx("div",{className:"absolute z-20 pointer-events-none",style:{left:Os.offsetLeft+8,top:Os.offsetTop+8},children:M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:M.jsxs("span",{className:"text-yellow-500 font-bold text-sm sm:text-base tracking-widest",children:["1UP ",M.jsx("span",{className:"text-white",children:r.toString().padStart(6,"0")})]})})}),P&&!le&&M.jsx("div",{className:"absolute inset-0 z-50",children:M.jsx(v_,{progress:Le,width:w,height:G})}),Ze.isTouchDevice&&(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE)&&M.jsx(S_,{onMove:(F,g)=>{hl.setJoystickPosition(F,g)},onFire:F=>{hl.setFirePressed(F)},onEvade:()=>{hl.triggerEvade()},onBomb:()=>{hl.triggerBomb()},onFirstTouch:()=>{Se.unlockAudio()}}),M.jsx(F_,{campaign:O,level:N,scrollY:D.getEffectiveScrollY(),playerX:yl.x,playerY:yl.y,visible:hc&&(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE),containerWidth:uc,canvasBounds:Os}),M.jsx(b_,{gameState:n,onSave:Sr,onLoad:Tr}),jn.show&&n===te.DESIGN_MODE&&M.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:M.jsxs("div",{style:{backgroundColor:"#1a1a2e",border:"2px solid #ffcc00",borderRadius:"8px",padding:"24px",maxWidth:"400px",textAlign:"center",color:"#ffffff",fontFamily:'"Black Ops One", monospace'},children:[M.jsx("h3",{style:{color:"#ffcc00",marginBottom:"16px",fontSize:"14px"},children:"UNSAVED CHANGES"}),M.jsxs("p",{style:{marginBottom:"20px",fontSize:"10px",lineHeight:"1.6"},children:["You have unsaved changes that will be lost if you switch to Level ",jn.targetLevel,"."]}),M.jsx("p",{style:{marginBottom:"24px",fontSize:"10px",color:"#aaaaaa"},children:"Press S to save before switching, or choose an option below:"}),M.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[M.jsx("button",{onClick:()=>{$n({show:!1,targetLevel:0}),D.switchDesignModeLevel(jn.targetLevel)},style:{backgroundColor:"#cc3333",color:"#ffffff",border:"none",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"DISCARD & SWITCH"}),M.jsx("button",{onClick:()=>$n({show:!1,targetLevel:0}),style:{backgroundColor:"#333366",color:"#ffffff",border:"1px solid #6666aa",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"CANCEL"})]})]})}),cc&&n===te.DESIGN_MODE&&M.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:M.jsxs("div",{style:{backgroundColor:"#1a1a2e",border:"2px solid #ffcc00",borderRadius:"8px",padding:"24px",maxWidth:"400px",textAlign:"center",color:"#ffffff",fontFamily:'"Black Ops One", monospace'},children:[M.jsx("h3",{style:{color:"#ffcc00",marginBottom:"16px",fontSize:"14px"},children:"DISCARD CHANGES?"}),M.jsx("p",{style:{marginBottom:"20px",fontSize:"10px",lineHeight:"1.6"},children:"You have unsaved changes that will be lost if you exit Design Mode."}),M.jsx("p",{style:{marginBottom:"24px",fontSize:"10px",color:"#aaaaaa"},children:"Press S to save before exiting, or choose an option below:"}),M.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[M.jsx("button",{onClick:()=>{qn(!1),D.toggleDesignMode(),s(D.state)},style:{backgroundColor:"#cc3333",color:"#ffffff",border:"none",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"DISCARD & EXIT"}),M.jsx("button",{onClick:()=>qn(!1),style:{backgroundColor:"#333366",color:"#ffffff",border:"1px solid #6666aa",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"CANCEL"})]})]})}),(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE||n===te.POWERUP_LEGEND)&&zi&&M.jsx(__,{score:r,highScore:d,lives:p,bombs:b,level:N,combo:Be,activeBoss:D.activeBoss,playerHealth:va,maxPlayerHealth:Xn,firepowerCount:D.firepowerCount,bombCount:D.bombCount,invincibilityCount:D.invincibilityCount,firepowerSprite:zi.firepower,firepowerEnhancedSprite:zi.firepowerEnhanced,bombSprite:zi.bomb,invincibilitySprite:zi.invincibility,firepowerBullets:D.firepowerBullets,firepowerStacks:D.firepowerStacks,activeFirepowerTier:D.activeFirepowerTier,spreadBullets:D.spreadBullets,spreadStacks:D.spreadStacks,enemyFighterSprite:zi.enemyFighter,playerInvincible:D.playerInvincible,gameEngine:D,canvasBounds:Os}),n===te.ATTRACT&&!P&&M.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",style:{fontFamily:'"Black Ops One"'},children:M.jsxs("div",{className:"flex flex-col items-center rounded-lg py-6 sm:py-8 px-4 sm:px-8 relative",style:{width:"85%",maxWidth:"420px",minWidth:"300px",marginTop:"15%",background:"rgba(15, 15, 15, 0.4)",border:"3px solid #444",boxShadow:"inset 0 0 20px rgba(0,0,0,0.4), 0 0 0 1px #222, 0 4px 20px rgba(0,0,0,0.5)"},children:[M.jsx("div",{className:"rivet absolute",style:{top:"8px",left:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{top:"8px",right:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{bottom:"8px",left:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{bottom:"8px",right:"8px"}}),M.jsx("div",{className:"text-yellow-400 text-[14px] sm:text-base mb-5 sm:mb-6 leading-none whitespace-nowrap",style:{textShadow:"0 0 10px rgba(255,255,0,0.5)"},children:"SELECT DIFFICULTY"}),M.jsx("div",{className:"flex flex-col items-center gap-1 sm:gap-2 pointer-events-auto w-full",children:Yn.map(F=>{const g=fl(F),ve=O===F;return M.jsxs("button",{onClick:()=>{Se.playTitleMusic(),O!==F&&Se.playMenuSelect(),I(F),D.setCampaign(F);const _t={[Ee.DAWN_PATROL]:gt.BEGINNER,[Ee.STEEL_VANGUARD]:gt.NORMAL,[Ee.HELLFIRE_HORIZON]:gt.VETERAN};W(_t[F])},className:`leading-none cursor-pointer transition-all outline-none focus:outline-none py-1.5 px-2 w-full text-center whitespace-nowrap ${ve?"text-[19px] sm:text-lg text-red-500 drop-shadow-[0_0_10px_rgba(255,0,0,0.8)]":"text-[13px] sm:text-sm text-gray-500 hover:text-gray-300"}`,children:[M.jsx("span",{className:ve?"visible":"invisible",children:"> "}),g.displayName.toUpperCase(),M.jsx("span",{className:ve?"visible":"invisible",children:" <"})]},F)})}),M.jsxs("div",{className:"text-[12px] sm:text-[14px] text-gray-400 mt-3 text-center pointer-events-none leading-relaxed whitespace-nowrap",children:[M.jsx("div",{children:fl(O).subtitle}),M.jsxs("div",{className:"mt-1",children:[fl(O).levelCount," Levels"]})]}),M.jsx("div",{className:"mt-5 sm:mt-6",children:m>0?M.jsx("div",{className:"text-white text-[14px] sm:text-base leading-none animate-pulse whitespace-nowrap",children:"PRESS START"}):M.jsx("div",{className:"text-orange-400 text-[14px] sm:text-base leading-none animate-pulse whitespace-nowrap",children:"INSERT COIN"})}),M.jsxs("div",{className:"mt-3 text-center whitespace-nowrap",children:[M.jsxs("div",{className:"text-white text-[13px] sm:text-sm leading-none",children:["CREDITS: ",m]}),M.jsxs("div",{className:"text-gray-500 text-[12px] sm:text-[14px] leading-none mt-1",children:["REMAINING: ",S,"/10"]})]})]})}),n===te.VICTORY&&M.jsx("div",{className:"absolute inset-0 z-50 pointer-events-none",children:M.jsxs("div",{className:"absolute bottom-16 left-0 right-0 flex justify-between px-8 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{Q>0&&me(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${Q===0?"opacity-0 pointer-events-none":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("button",{onClick:()=>{Q<1?me(F=>F+1):(D.state=te.ATTRACT,me(0),K(0))},className:"px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 animate-pulse",style:{fontFamily:'"Black Ops One"',background:Q===1?"#c9a961":"#4A5D23",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:Q===1?"#2B3A12":"white"},children:Q<1?"NEXT >":"FINISH"})]})}),n===te.ENDING&&M.jsx("div",{className:"absolute inset-0 z-50 pointer-events-none",children:M.jsxs("div",{className:"absolute bottom-16 left-0 right-0 flex justify-between px-8 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{pe>0&&fe(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${pe===0?"opacity-0 pointer-events-none":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("button",{onClick:()=>{pe<dl.length-1?fe(F=>F+1):(D.state=te.ATTRACT,fe(0),K(0))},className:"px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 animate-pulse",style:{fontFamily:'"Black Ops One"',background:pe===dl.length-1?"#c9a961":"#4A5D23",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:pe===dl.length-1?"#2B3A12":"white"},children:pe===dl.length-1?"FINISH":"NEXT >"})]})}),n===te.STORY&&M.jsx("div",{className:"absolute inset-0 flex items-end justify-center pointer-events-none",style:{paddingBottom:"15px"},children:M.jsxs("div",{className:"flex items-center gap-4 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{Z>0&&K(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${Z===0?"invisible":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("span",{className:"text-[14px] min-w-[50px] text-center",style:{fontFamily:'"Black Ops One"',color:"#c9a961"},children:U?`${Z+1}/5`:"LOADING..."}),M.jsx("button",{onClick:()=>{U&&(Z<4?K(F=>F+1):D.startMission())},disabled:!U,className:"px-4 py-2 text-[15px] text-white rounded transition-all active:scale-95",style:{fontFamily:'"Black Ops One"',background:U?Z===4?"#c9a961":"#4A5D23":"#2B3A12",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:U?Z===4?"#2B3A12":"white":"#5A6D33",cursor:U?"pointer":"wait",animation:U?"pulse 2s infinite":"none"},children:Z===4?"GO!":"NEXT >"})]})}),M.jsx("div",{className:"absolute inset-0 pointer-events-none scanlines opacity-20"})]}),le&&M.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-30 bg-red-900/90 border border-red-600 px-4 py-3 rounded-lg max-w-sm",children:[M.jsx("p",{className:"text-red-200 text-xs mb-2",children:le}),M.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-500 text-white font-bold text-xs py-1.5 px-4 rounded",children:"RELOAD"})]}),(n===te.ATTRACT||n===te.GAME_OVER)&&M.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20 flex justify-center items-center gap-3 px-3 py-3 bg-gradient-to-t from-black/90 via-black/60 to-transparent",children:[M.jsx("button",{onClick:()=>{const F=!Ms;Se.setMuted(F),ga(F),F||Se.playTitleMusic()},className:`p-[7px] rounded transition-all active:scale-95 border ${Ms?"bg-red-900/80 hover:bg-red-800 text-red-400 hover:text-red-300 border-red-700":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300 hover:text-white border-zinc-600"}`,title:Ms?"Unmute Audio":"Mute Audio",children:Ms?M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),M.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),M.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}):M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),M.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),M.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})}),M.jsx("button",{onClick:()=>{Se.playMenuSelect(),hn(!0)},className:"p-[7px] rounded transition-all bg-zinc-700 hover:bg-zinc-600 text-zinc-300 hover:text-white active:scale-95 border border-zinc-600",title:"Game Settings",children:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("circle",{cx:"12",cy:"12",r:"3"}),M.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),M.jsx("button",{onTouchStart:()=>{Se.unlockAudio()},onClick:()=>{Se.unlockAudio(),Se.playTitleMusic(),D.insertCoin(),_(D.credits),R(D.totalCreditsRemaining)},className:`font-bold text-[12px] py-[7px] px-[14px] rounded transition-all ${S===0?"bg-zinc-800 text-zinc-600 cursor-not-allowed":"bg-yellow-600 hover:bg-yellow-500 text-black active:scale-95"}`,disabled:S===0,children:"INSERT COIN"}),M.jsx("span",{className:"text-zinc-400 text-[13px] font-mono",children:m>0?`CREDITS: ${m}`:`${S}/10`}),M.jsx("button",{onTouchStart:()=>{Se.unlockAudio()},onClick:async()=>{if(Se.unlockAudio(),le){alert("Cannot start game: "+le+`

Please refresh the page.`);return}if(P||be){alert("Please wait for assets to finish loading...");return}if(!pa.current){alert("Game assets failed to load. Please refresh the page.");return}if(console.log(`[START] engine.state=${D.state}, GameState.ATTRACT=${te.ATTRACT}`),D.state!==te.ATTRACT){console.log("[START] Skipping - not in ATTRACT state");return}const F=parseInt("0",10),g=F>0?F:1;console.log(`[START] About to load terrain for campaign: ${O}, startLevel: ${g}`),he(!0);try{console.log(`[LOAD] Loading terrain for campaign: ${O}, level: ${g}...`),await g_(O,g),console.log("[LOAD] Terrain loaded successfully!")}catch(ve){console.error("[LOAD] Failed to load terrain:",ve),ue("Failed to load terrain. Please refresh."),he(!1);return}he(!1),D.startGame(),_(D.credits),R(D.totalCreditsRemaining),K(0),Se.init(),se(!1),pp(O).then(ve=>{console.log(`[LAZY] ${O} story panels loaded for story mode`),ce(ve),se(!0)}).catch(ve=>console.error("[LAZY] Failed to load campaign story panels:",ve))},disabled:P||be||le!==null,className:`font-bold text-[12px] py-[7px] px-[14px] rounded transition-all ${P||be||le?"bg-zinc-800 text-zinc-500 cursor-wait":"bg-red-600 hover:bg-red-500 text-white active:scale-95"}`,children:P?"LOADING...":be?"LOADING TERRAIN...":le?"ERROR":"START GAME"})]}),M.jsx(O_,{isOpen:pl,onClose:()=>{hn(!1),ml(!1)}})]})};function K_(){return $.useEffect(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("SW registered:",s)}).catch(s=>{console.log("SW registration failed:",s)})}),document.body.style.overscrollBehavior="none",document.documentElement.style.overscrollBehavior="none";const c=s=>{s.preventDefault()};document.addEventListener("contextmenu",c);const t=s=>{s.touches.length>1&&s.preventDefault()};document.addEventListener("touchmove",t,{passive:!1});const n=()=>{const s=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${s}px`)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{document.removeEventListener("contextmenu",c),document.removeEventListener("touchmove",t),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),M.jsx("div",{className:"w-full h-dvh bg-black",style:{overflow:"hidden"},children:M.jsx(Z_,{})})}const qp=document.getElementById("root");if(!qp)throw new Error("Could not find root element to mount to");const Q_=cy.createRoot(qp);Q_.render(M.jsx(ty.StrictMode,{children:M.jsx(K_,{})}));
