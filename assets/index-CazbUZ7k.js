(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();var Z2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vp(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var _h={exports:{}},hr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yg;function gy(){if(Yg)return hr;Yg=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,r,c){var h=null;if(c!==void 0&&(h=""+c),r.key!==void 0&&(h=""+r.key),"key"in r){c={};for(var d in r)d!=="key"&&(c[d]=r[d])}else c=r;return r=c.ref,{$$typeof:o,type:s,key:h,ref:r!==void 0?r:null,props:c}}return hr.Fragment=t,hr.jsx=n,hr.jsxs=n,hr}var Gg;function py(){return Gg||(Gg=1,_h.exports=gy()),_h.exports}var M=py(),Ah={exports:{}},Ke={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ug;function my(){if(Ug)return Ke;Ug=1;var o=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),h=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),E=Symbol.for("react.activity"),A=Symbol.iterator;function v(C){return C===null||typeof C!="object"?null:(C=A&&C[A]||C["@@iterator"],typeof C=="function"?C:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,L={};function N(C,ee,le){this.props=C,this.context=ee,this.refs=L,this.updater=le||b}N.prototype.isReactComponent={},N.prototype.setState=function(C,ee){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,ee,"setState")},N.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function x(){}x.prototype=N.prototype;function I(C,ee,le){this.props=C,this.context=ee,this.refs=L,this.updater=le||b}var G=I.prototype=new x;G.constructor=I,O(G,N.prototype),G.isPureReactComponent=!0;var W=Array.isArray;function Q(){}var j={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function Ee(C,ee,le){var ue=le.ref;return{$$typeof:o,type:C,key:ee,ref:ue!==void 0?ue:null,props:le}}function ye(C,ee){return Ee(C.type,ee,C.props)}function fe(C){return typeof C=="object"&&C!==null&&C.$$typeof===o}function re(C){var ee={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(le){return ee[le]})}var ce=/\/+/g;function Te(C,ee){return typeof C=="object"&&C!==null&&C.key!=null?re(""+C.key):ee.toString(36)}function at(C){switch(C.status){case"fulfilled":return C.value;case"rejected":throw C.reason;default:switch(typeof C.status=="string"?C.then(Q,Q):(C.status="pending",C.then(function(ee){C.status==="pending"&&(C.status="fulfilled",C.value=ee)},function(ee){C.status==="pending"&&(C.status="rejected",C.reason=ee)})),C.status){case"fulfilled":return C.value;case"rejected":throw C.reason}}throw C}function U(C,ee,le,ue,Le){var K=typeof C;(K==="undefined"||K==="boolean")&&(C=null);var xe=!1;if(C===null)xe=!0;else switch(K){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(C.$$typeof){case o:case t:xe=!0;break;case y:return xe=C._init,U(xe(C._payload),ee,le,ue,Le)}}if(xe)return Le=Le(C),xe=ue===""?"."+Te(C,0):ue,W(Le)?(le="",xe!=null&&(le=xe.replace(ce,"$&/")+"/"),U(Le,ee,le,"",function(ta){return ta})):Le!=null&&(fe(Le)&&(Le=ye(Le,le+(Le.key==null||C&&C.key===Le.key?"":(""+Le.key).replace(ce,"$&/")+"/")+xe)),ee.push(Le)),1;xe=0;var de=ue===""?".":ue+":";if(W(C))for(var Ue=0;Ue<C.length;Ue++)ue=C[Ue],K=de+Te(ue,Ue),xe+=U(ue,ee,le,K,Le);else if(Ue=v(C),typeof Ue=="function")for(C=Ue.call(C),Ue=0;!(ue=C.next()).done;)ue=ue.value,K=de+Te(ue,Ue++),xe+=U(ue,ee,le,K,Le);else if(K==="object"){if(typeof C.then=="function")return U(at(C),ee,le,ue,Le);throw ee=String(C),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return xe}function se(C,ee,le){if(C==null)return C;var ue=[],Le=0;return U(C,ue,"","",function(K){return ee.call(le,K,Le++)}),ue}function _e(C){if(C._status===-1){var ee=C._result;ee=ee(),ee.then(function(le){(C._status===0||C._status===-1)&&(C._status=1,C._result=le)},function(le){(C._status===0||C._status===-1)&&(C._status=2,C._result=le)}),C._status===-1&&(C._status=0,C._result=ee)}if(C._status===1)return C._result.default;throw C._result}var Qe=typeof reportError=="function"?reportError:function(C){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof C=="object"&&C!==null&&typeof C.message=="string"?String(C.message):String(C),error:C});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",C);return}console.error(C)},et={map:se,forEach:function(C,ee,le){se(C,function(){ee.apply(this,arguments)},le)},count:function(C){var ee=0;return se(C,function(){ee++}),ee},toArray:function(C){return se(C,function(ee){return ee})||[]},only:function(C){if(!fe(C))throw Error("React.Children.only expected to receive a single React element child.");return C}};return Ke.Activity=E,Ke.Children=et,Ke.Component=N,Ke.Fragment=n,Ke.Profiler=r,Ke.PureComponent=I,Ke.StrictMode=s,Ke.Suspense=g,Ke.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,Ke.__COMPILER_RUNTIME={__proto__:null,c:function(C){return j.H.useMemoCache(C)}},Ke.cache=function(C){return function(){return C.apply(null,arguments)}},Ke.cacheSignal=function(){return null},Ke.cloneElement=function(C,ee,le){if(C==null)throw Error("The argument must be a React element, but you passed "+C+".");var ue=O({},C.props),Le=C.key;if(ee!=null)for(K in ee.key!==void 0&&(Le=""+ee.key),ee)!q.call(ee,K)||K==="key"||K==="__self"||K==="__source"||K==="ref"&&ee.ref===void 0||(ue[K]=ee[K]);var K=arguments.length-2;if(K===1)ue.children=le;else if(1<K){for(var xe=Array(K),de=0;de<K;de++)xe[de]=arguments[de+2];ue.children=xe}return Ee(C.type,Le,ue)},Ke.createContext=function(C){return C={$$typeof:h,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null},C.Provider=C,C.Consumer={$$typeof:c,_context:C},C},Ke.createElement=function(C,ee,le){var ue,Le={},K=null;if(ee!=null)for(ue in ee.key!==void 0&&(K=""+ee.key),ee)q.call(ee,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Le[ue]=ee[ue]);var xe=arguments.length-2;if(xe===1)Le.children=le;else if(1<xe){for(var de=Array(xe),Ue=0;Ue<xe;Ue++)de[Ue]=arguments[Ue+2];Le.children=de}if(C&&C.defaultProps)for(ue in xe=C.defaultProps,xe)Le[ue]===void 0&&(Le[ue]=xe[ue]);return Ee(C,K,Le)},Ke.createRef=function(){return{current:null}},Ke.forwardRef=function(C){return{$$typeof:d,render:C}},Ke.isValidElement=fe,Ke.lazy=function(C){return{$$typeof:y,_payload:{_status:-1,_result:C},_init:_e}},Ke.memo=function(C,ee){return{$$typeof:m,type:C,compare:ee===void 0?null:ee}},Ke.startTransition=function(C){var ee=j.T,le={};j.T=le;try{var ue=C(),Le=j.S;Le!==null&&Le(le,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(Q,Qe)}catch(K){Qe(K)}finally{ee!==null&&le.types!==null&&(ee.types=le.types),j.T=ee}},Ke.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},Ke.use=function(C){return j.H.use(C)},Ke.useActionState=function(C,ee,le){return j.H.useActionState(C,ee,le)},Ke.useCallback=function(C,ee){return j.H.useCallback(C,ee)},Ke.useContext=function(C){return j.H.useContext(C)},Ke.useDebugValue=function(){},Ke.useDeferredValue=function(C,ee){return j.H.useDeferredValue(C,ee)},Ke.useEffect=function(C,ee){return j.H.useEffect(C,ee)},Ke.useEffectEvent=function(C){return j.H.useEffectEvent(C)},Ke.useId=function(){return j.H.useId()},Ke.useImperativeHandle=function(C,ee,le){return j.H.useImperativeHandle(C,ee,le)},Ke.useInsertionEffect=function(C,ee){return j.H.useInsertionEffect(C,ee)},Ke.useLayoutEffect=function(C,ee){return j.H.useLayoutEffect(C,ee)},Ke.useMemo=function(C,ee){return j.H.useMemo(C,ee)},Ke.useOptimistic=function(C,ee){return j.H.useOptimistic(C,ee)},Ke.useReducer=function(C,ee,le){return j.H.useReducer(C,ee,le)},Ke.useRef=function(C){return j.H.useRef(C)},Ke.useState=function(C){return j.H.useState(C)},Ke.useSyncExternalStore=function(C,ee,le){return j.H.useSyncExternalStore(C,ee,le)},Ke.useTransition=function(){return j.H.useTransition()},Ke.version="19.2.0",Ke}var zg;function id(){return zg||(zg=1,Ah.exports=my()),Ah.exports}var Z=id();const yy=Vp(Z);var Sh={exports:{}},dr={},Th={exports:{}},vh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kg;function Ey(){return kg||(kg=1,(function(o){function t(U,se){var _e=U.length;U.push(se);e:for(;0<_e;){var Qe=_e-1>>>1,et=U[Qe];if(0<r(et,se))U[Qe]=se,U[_e]=et,_e=Qe;else break e}}function n(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var se=U[0],_e=U.pop();if(_e!==se){U[0]=_e;e:for(var Qe=0,et=U.length,C=et>>>1;Qe<C;){var ee=2*(Qe+1)-1,le=U[ee],ue=ee+1,Le=U[ue];if(0>r(le,_e))ue<et&&0>r(Le,le)?(U[Qe]=Le,U[ue]=_e,Qe=ue):(U[Qe]=le,U[ee]=_e,Qe=ee);else if(ue<et&&0>r(Le,_e))U[Qe]=Le,U[ue]=_e,Qe=ue;else break e}}return se}function r(U,se){var _e=U.sortIndex-se.sortIndex;return _e!==0?_e:U.id-se.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;o.unstable_now=function(){return c.now()}}else{var h=Date,d=h.now();o.unstable_now=function(){return h.now()-d}}var g=[],m=[],y=1,E=null,A=3,v=!1,b=!1,O=!1,L=!1,N=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function G(U){for(var se=n(m);se!==null;){if(se.callback===null)s(m);else if(se.startTime<=U)s(m),se.sortIndex=se.expirationTime,t(g,se);else break;se=n(m)}}function W(U){if(O=!1,G(U),!b)if(n(g)!==null)b=!0,Q||(Q=!0,re());else{var se=n(m);se!==null&&at(W,se.startTime-U)}}var Q=!1,j=-1,q=5,Ee=-1;function ye(){return L?!0:!(o.unstable_now()-Ee<q)}function fe(){if(L=!1,Q){var U=o.unstable_now();Ee=U;var se=!0;try{e:{b=!1,O&&(O=!1,x(j),j=-1),v=!0;var _e=A;try{t:{for(G(U),E=n(g);E!==null&&!(E.expirationTime>U&&ye());){var Qe=E.callback;if(typeof Qe=="function"){E.callback=null,A=E.priorityLevel;var et=Qe(E.expirationTime<=U);if(U=o.unstable_now(),typeof et=="function"){E.callback=et,G(U),se=!0;break t}E===n(g)&&s(g),G(U)}else s(g);E=n(g)}if(E!==null)se=!0;else{var C=n(m);C!==null&&at(W,C.startTime-U),se=!1}}break e}finally{E=null,A=_e,v=!1}se=void 0}}finally{se?re():Q=!1}}}var re;if(typeof I=="function")re=function(){I(fe)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,Te=ce.port2;ce.port1.onmessage=fe,re=function(){Te.postMessage(null)}}else re=function(){N(fe,0)};function at(U,se){j=N(function(){U(o.unstable_now())},se)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(U){U.callback=null},o.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<U?Math.floor(1e3/U):5},o.unstable_getCurrentPriorityLevel=function(){return A},o.unstable_next=function(U){switch(A){case 1:case 2:case 3:var se=3;break;default:se=A}var _e=A;A=se;try{return U()}finally{A=_e}},o.unstable_requestPaint=function(){L=!0},o.unstable_runWithPriority=function(U,se){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var _e=A;A=U;try{return se()}finally{A=_e}},o.unstable_scheduleCallback=function(U,se,_e){var Qe=o.unstable_now();switch(typeof _e=="object"&&_e!==null?(_e=_e.delay,_e=typeof _e=="number"&&0<_e?Qe+_e:Qe):_e=Qe,U){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=_e+et,U={id:y++,callback:se,priorityLevel:U,startTime:_e,expirationTime:et,sortIndex:-1},_e>Qe?(U.sortIndex=_e,t(m,U),n(g)===null&&U===n(m)&&(O?(x(j),j=-1):O=!0,at(W,_e-Qe))):(U.sortIndex=et,t(g,U),b||v||(b=!0,Q||(Q=!0,re()))),U},o.unstable_shouldYield=ye,o.unstable_wrapCallback=function(U){var se=A;return function(){var _e=A;A=se;try{return U.apply(this,arguments)}finally{A=_e}}}})(vh)),vh}var Vg;function _y(){return Vg||(Vg=1,Th.exports=Ey()),Th.exports}var Rh={exports:{}},Na={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wg;function Ay(){if(Wg)return Na;Wg=1;var o=id();function t(g){var m="https://react.dev/errors/"+g;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+g+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(g,m,y){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:E==null?null:""+E,children:g,containerInfo:m,implementation:y}}var h=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(g,m){if(g==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Na.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Na.createPortal=function(g,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return c(g,m,null,y)},Na.flushSync=function(g){var m=h.T,y=s.p;try{if(h.T=null,s.p=2,g)return g()}finally{h.T=m,s.p=y,s.d.f()}},Na.preconnect=function(g,m){typeof g=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,s.d.C(g,m))},Na.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},Na.preinit=function(g,m){if(typeof g=="string"&&m&&typeof m.as=="string"){var y=m.as,E=d(y,m.crossOrigin),A=typeof m.integrity=="string"?m.integrity:void 0,v=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?s.d.S(g,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:E,integrity:A,fetchPriority:v}):y==="script"&&s.d.X(g,{crossOrigin:E,integrity:A,fetchPriority:v,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Na.preinitModule=function(g,m){if(typeof g=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=d(m.as,m.crossOrigin);s.d.M(g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&s.d.M(g)},Na.preload=function(g,m){if(typeof g=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,E=d(y,m.crossOrigin);s.d.L(g,y,{crossOrigin:E,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Na.preloadModule=function(g,m){if(typeof g=="string")if(m){var y=d(m.as,m.crossOrigin);s.d.m(g,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else s.d.m(g)},Na.requestFormReset=function(g){s.d.r(g)},Na.unstable_batchedUpdates=function(g,m){return g(m)},Na.useFormState=function(g,m,y){return h.H.useFormState(g,m,y)},Na.useFormStatus=function(){return h.H.useHostTransitionStatus()},Na.version="19.2.0",Na}var Xg;function Sy(){if(Xg)return Rh.exports;Xg=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),Rh.exports=Ay(),Rh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jg;function Ty(){if(jg)return dr;jg=1;var o=_y(),t=id(),n=Sy();function s(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)a+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function c(e){var a=e,i=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(i=a.return),e=a.return;while(e)}return a.tag===3?i:null}function h(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function d(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function g(e){if(c(e)!==e)throw Error(s(188))}function m(e){var a=e.alternate;if(!a){if(a=c(e),a===null)throw Error(s(188));return a!==e?null:e}for(var i=e,l=a;;){var u=i.return;if(u===null)break;var f=u.alternate;if(f===null){if(l=u.return,l!==null){i=l;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===i)return g(u),e;if(f===l)return g(u),a;f=f.sibling}throw Error(s(188))}if(i.return!==l.return)i=u,l=f;else{for(var _=!1,R=u.child;R;){if(R===i){_=!0,i=u,l=f;break}if(R===l){_=!0,l=u,i=f;break}R=R.sibling}if(!_){for(R=f.child;R;){if(R===i){_=!0,i=f,l=u;break}if(R===l){_=!0,l=f,i=u;break}R=R.sibling}if(!_)throw Error(s(189))}}if(i.alternate!==l)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?e:a}function y(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=y(e),a!==null)return a;e=e.sibling}return null}var E=Object.assign,A=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),I=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),Q=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Ee=Symbol.for("react.activity"),ye=Symbol.for("react.memo_cache_sentinel"),fe=Symbol.iterator;function re(e){return e===null||typeof e!="object"?null:(e=fe&&e[fe]||e["@@iterator"],typeof e=="function"?e:null)}var ce=Symbol.for("react.client.reference");function Te(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ce?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case O:return"Fragment";case N:return"Profiler";case L:return"StrictMode";case W:return"Suspense";case Q:return"SuspenseList";case Ee:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case b:return"Portal";case I:return e.displayName||"Context";case x:return(e._context.displayName||"Context")+".Consumer";case G:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case j:return a=e.displayName||null,a!==null?a:Te(e.type)||"Memo";case q:a=e._payload,e=e._init;try{return Te(e(a))}catch{}}return null}var at=Array.isArray,U=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_e={pending:!1,data:null,method:null,action:null},Qe=[],et=-1;function C(e){return{current:e}}function ee(e){0>et||(e.current=Qe[et],Qe[et]=null,et--)}function le(e,a){et++,Qe[et]=e.current,e.current=a}var ue=C(null),Le=C(null),K=C(null),xe=C(null);function de(e,a){switch(le(K,a),le(Le,e),le(ue,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?og(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=og(a),e=cg(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}ee(ue),le(ue,e)}function Ue(){ee(ue),ee(Le),ee(K)}function ta(e){e.memoizedState!==null&&le(xe,e);var a=ue.current,i=cg(a,e.type);a!==i&&(le(Le,e),le(ue,i))}function xa(e){Le.current===e&&(ee(ue),ee(Le)),xe.current===e&&(ee(xe),rr._currentValue=_e)}var Os,jn;function si(e){if(Os===void 0)try{throw Error()}catch(i){var a=i.stack.trim().match(/\n( *(at )?)/);Os=a&&a[1]||"",jn=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Os+e+jn}var $n=!1;function qn(e,a){if(!e||$n)return"";$n=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(a){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch($){var X=$}Reflect.construct(e,[],ne)}else{try{ne.call()}catch($){X=$}e.call(ne.prototype)}}else{try{throw Error()}catch($){X=$}(ne=e())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch($){if($&&X&&typeof $.stack=="string")return[$.stack,X.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=l.DetermineComponentFrameRoot(),_=f[0],R=f[1];if(_&&R){var w=_.split(`
`),k=R.split(`
`);for(u=l=0;l<w.length&&!w[l].includes("DetermineComponentFrameRoot");)l++;for(;u<k.length&&!k[u].includes("DetermineComponentFrameRoot");)u++;if(l===w.length||u===k.length)for(l=w.length-1,u=k.length-1;1<=l&&0<=u&&w[l]!==k[u];)u--;for(;1<=l&&0<=u;l--,u--)if(w[l]!==k[u]){if(l!==1||u!==1)do if(l--,u--,0>u||w[l]!==k[u]){var J=`
`+w[l].replace(" at new "," at ");return e.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",e.displayName)),J}while(1<=l&&0<=u);break}}}finally{$n=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?si(i):""}function gc(e,a){switch(e.tag){case 26:case 27:case 5:return si(e.type);case 16:return si("Lazy");case 13:return e.child!==a&&a!==null?si("Suspense Fallback"):si("Suspense");case 19:return si("SuspenseList");case 0:case 15:return qn(e.type,!1);case 11:return qn(e.type.render,!1);case 1:return qn(e.type,!0);case 31:return si("Activity");default:return""}}function Zn(e){try{var a="",i=null;do a+=gc(e,i),i=e,e=e.return;while(e);return a}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var _l=Object.prototype.hasOwnProperty,fn=o.unstable_scheduleCallback,Ar=o.unstable_cancelCallback,Al=o.unstable_shouldYield,Ls=o.unstable_requestPaint,Ea=o.unstable_now,pc=o.unstable_getCurrentPriorityLevel,Sr=o.unstable_ImmediatePriority,Sl=o.unstable_UserBlockingPriority,Ns=o.unstable_NormalPriority,mc=o.unstable_LowPriority,Tr=o.unstable_IdlePriority,Ds=o.log,yc=o.unstable_setDisableYieldValue,_a=null,Ba=null;function Va(e){if(typeof Ds=="function"&&yc(e),Ba&&typeof Ba.setStrictMode=="function")try{Ba.setStrictMode(_a,e)}catch{}}var Fa=Math.clz32?Math.clz32:Rl,Tl=Math.log,vl=Math.LN2;function Rl(e){return e>>>=0,e===0?32:31-(Tl(e)/vl|0)|0}var Wa=256,gn=262144,pn=4194304;function Oi(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function mn(e,a,i){var l=e.pendingLanes;if(l===0)return 0;var u=0,f=e.suspendedLanes,_=e.pingedLanes;e=e.warmLanes;var R=l&134217727;return R!==0?(l=R&~f,l!==0?u=Oi(l):(_&=R,_!==0?u=Oi(_):i||(i=R&~e,i!==0&&(u=Oi(i))))):(R=l&~f,R!==0?u=Oi(R):_!==0?u=Oi(_):i||(i=l&~e,i!==0&&(u=Oi(i)))),u===0?0:a!==0&&a!==u&&(a&f)===0&&(f=u&-u,i=a&-a,f>=i||f===32&&(i&4194048)!==0)?a:u}function Kn(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function vr(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wi(){var e=pn;return pn<<=1,(pn&62914560)===0&&(pn=4194304),e}function Qn(e){for(var a=[],i=0;31>i;i++)a.push(e);return a}function Ci(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ec(e,a,i,l,u,f){var _=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var R=e.entanglements,w=e.expirationTimes,k=e.hiddenUpdates;for(i=_&~i;0<i;){var J=31-Fa(i),ne=1<<J;R[J]=0,w[J]=-1;var X=k[J];if(X!==null)for(k[J]=null,J=0;J<X.length;J++){var $=X[J];$!==null&&($.lane&=-536870913)}i&=~ne}l!==0&&Rr(e,l,0),f!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=f&~(_&~a))}function Rr(e,a,i){e.pendingLanes|=a,e.suspendedLanes&=~a;var l=31-Fa(a);e.entangledLanes|=a,e.entanglements[l]=e.entanglements[l]|1073741824|i&261930}function Mr(e,a){var i=e.entangledLanes|=a;for(e=e.entanglements;i;){var l=31-Fa(i),u=1<<l;u&a|e[l]&a&&(e[l]|=a),i&=~u}}function ws(e,a){var i=a&-a;return i=(i&42)!==0?1:Jn(i),(i&(e.suspendedLanes|a))!==0?0:i}function Jn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function es(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ps(){var e=se.p;return e!==0?e:(e=window.event,e===void 0?32:wg(e.type))}function Cs(e,a){var i=se.p;try{return se.p=e,a()}finally{se.p=i}}var Ii=Math.random().toString(36).slice(2),F="__reactFiber$"+Ii,p="__reactProps$"+Ii,Ae="__reactContainer$"+Ii,ct="__reactEvents$"+Ii,Xe="__reactListeners$"+Ii,Ct="__reactHandles$"+Ii,yt="__reactResources$"+Ii,Lt="__reactMarker$"+Ii;function $t(e){delete e[F],delete e[p],delete e[ct],delete e[Xe],delete e[Ct]}function Ft(e){var a=e[F];if(a)return a;for(var i=e.parentNode;i;){if(a=i[Ae]||i[F]){if(i=a.alternate,a.child!==null||i!==null&&i.child!==null)for(e=mg(e);e!==null;){if(i=e[F])return i;e=mg(e)}return a}e=i,i=e.parentNode}return null}function It(e){if(e=e[F]||e[Ae]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function Ht(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(s(33))}function qe(e){var a=e[yt];return a||(a=e[yt]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function We(e){e[Lt]=!0}var li=new Set,Xa={};function Yt(e,a){sa(e,a),sa(e+"Capture",a)}function sa(e,a){for(Xa[e]=a,e=0;e<a.length;e++)li.add(a[e])}var Oa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vt={},De={};function je(e){return _l.call(De,e)?!0:_l.call(vt,e)?!1:Oa.test(e)?De[e]=!0:(vt[e]=!0,!1)}function Fe(e,a,i){if(je(a))if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var l=a.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+i)}}function He(e,a,i){if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+i)}}function Me(e,a,i,l){if(l===null)e.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(a,i,""+l)}}function be(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Je(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ie(e,a,i){var l=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,f=l.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return u.call(this)},set:function(_){i=""+_,f.call(this,_)}}),Object.defineProperty(e,a,{enumerable:l.enumerable}),{getValue:function(){return i},setValue:function(_){i=""+_},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function rt(e){if(!e._valueTracker){var a=Je(e)?"checked":"value";e._valueTracker=Ie(e,a,""+e[a])}}function it(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var i=a.getValue(),l="";return e&&(l=Je(e)?e.checked?"true":"false":e.value),e=l,e!==i?(a.setValue(e),!0):!1}function T(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ge=/[\n"\\]/g;function ie(e){return e.replace(ge,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function oe(e,a,i,l,u,f,_,R){e.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.type=_:e.removeAttribute("type"),a!=null?_==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+be(a)):e.value!==""+be(a)&&(e.value=""+be(a)):_!=="submit"&&_!=="reset"||e.removeAttribute("value"),a!=null?Se(e,_,be(a)):i!=null?Se(e,_,be(i)):l!=null&&e.removeAttribute("value"),u==null&&f!=null&&(e.defaultChecked=!!f),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.name=""+be(R):e.removeAttribute("name")}function he(e,a,i,l,u,f,_,R){if(f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.type=f),a!=null||i!=null){if(!(f!=="submit"&&f!=="reset"||a!=null)){rt(e);return}i=i!=null?""+be(i):"",a=a!=null?""+be(a):i,R||a===e.value||(e.value=a),e.defaultValue=a}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=R?e.checked:!!l,e.defaultChecked=!!l,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(e.name=_),rt(e)}function Se(e,a,i){a==="number"&&T(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function Ne(e,a,i,l){if(e=e.options,a){a={};for(var u=0;u<i.length;u++)a["$"+i[u]]=!0;for(i=0;i<e.length;i++)u=a.hasOwnProperty("$"+e[i].value),e[i].selected!==u&&(e[i].selected=u),u&&l&&(e[i].defaultSelected=!0)}else{for(i=""+be(i),a=null,u=0;u<e.length;u++){if(e[u].value===i){e[u].selected=!0,l&&(e[u].defaultSelected=!0);return}a!==null||e[u].disabled||(a=e[u])}a!==null&&(a.selected=!0)}}function Ye(e,a,i){if(a!=null&&(a=""+be(a),a!==e.value&&(e.value=a),i==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=i!=null?""+be(i):""}function Pe(e,a,i,l){if(a==null){if(l!=null){if(i!=null)throw Error(s(92));if(at(l)){if(1<l.length)throw Error(s(93));l=l[0]}i=l}i==null&&(i=""),a=i}i=be(a),e.defaultValue=i,l=e.textContent,l===i&&l!==""&&l!==null&&(e.value=l),rt(e)}function $e(e,a){if(a){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=a;return}}e.textContent=a}var ze=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ce(e,a,i){var l=a.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?l?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":l?e.setProperty(a,i):typeof i!="number"||i===0||ze.has(a)?a==="float"?e.cssFloat=i:e[a]=(""+i).trim():e[a]=i+"px"}function Gt(e,a,i){if(a!=null&&typeof a!="object")throw Error(s(62));if(e=e.style,i!=null){for(var l in i)!i.hasOwnProperty(l)||a!=null&&a.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var u in a)l=a[u],a.hasOwnProperty(u)&&i[u]!==l&&Ce(e,u,l)}else for(var f in a)a.hasOwnProperty(f)&&Ce(e,f,a[f])}function ha(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ha=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ya(e){return Ha.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function La(){}var St=null;function Ut(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ze=null,zt=null;function mi(e){var a=It(e);if(a&&(e=a.stateNode)){var i=e[p]||null;e:switch(e=a.stateNode,a.type){case"input":if(oe(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),a=i.name,i.type==="radio"&&a!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ie(""+a)+'"][type="radio"]'),a=0;a<i.length;a++){var l=i[a];if(l!==e&&l.form===e.form){var u=l[p]||null;if(!u)throw Error(s(90));oe(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(a=0;a<i.length;a++)l=i[a],l.form===e.form&&it(l)}break e;case"textarea":Ye(e,i.value,i.defaultValue);break e;case"select":a=i.value,a!=null&&Ne(e,!!i.multiple,a,!1)}}}var yi=!1;function br(e,a,i){if(yi)return e(a,i);yi=!0;try{var l=e(a);return l}finally{if(yi=!1,(Ze!==null||zt!==null)&&(go(),Ze&&(a=Ze,e=zt,zt=Ze=null,mi(a),e)))for(a=0;a<e.length;a++)mi(e[a])}}function ts(e,a){var i=e.stateNode;if(i===null)return null;var l=i[p]||null;if(l===null)return null;i=l[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(s(231,a,typeof i));return i}var Xi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_c=!1;if(Xi)try{var Ml={};Object.defineProperty(Ml,"passive",{get:function(){_c=!0}}),window.addEventListener("test",Ml,Ml),window.removeEventListener("test",Ml,Ml)}catch{_c=!1}var yn=null,Ac=null,xr=null;function od(){if(xr)return xr;var e,a=Ac,i=a.length,l,u="value"in yn?yn.value:yn.textContent,f=u.length;for(e=0;e<i&&a[e]===u[e];e++);var _=i-e;for(l=1;l<=_&&a[i-l]===u[f-l];l++);return xr=u.slice(e,1<l?1-l:void 0)}function Or(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function Lr(){return!0}function cd(){return!1}function ja(e){function a(i,l,u,f,_){this._reactName=i,this._targetInst=u,this.type=l,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(i=e[R],this[R]=i?i(f):f[R]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?Lr:cd,this.isPropagationStopped=cd,this}return E(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Lr)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Lr)},persist:function(){},isPersistent:Lr}),a}var as={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nr=ja(as),bl=E({},as,{view:0,detail:0}),dm=ja(bl),Sc,Tc,xl,Dr=E({},bl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xl&&(xl&&e.type==="mousemove"?(Sc=e.screenX-xl.screenX,Tc=e.screenY-xl.screenY):Tc=Sc=0,xl=e),Sc)},movementY:function(e){return"movementY"in e?e.movementY:Tc}}),ud=ja(Dr),fm=E({},Dr,{dataTransfer:0}),gm=ja(fm),pm=E({},bl,{relatedTarget:0}),vc=ja(pm),mm=E({},as,{animationName:0,elapsedTime:0,pseudoElement:0}),ym=ja(mm),Em=E({},as,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_m=ja(Em),Am=E({},as,{data:0}),hd=ja(Am),Sm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tm={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rm(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=vm[e])?!!a[e]:!1}function Rc(){return Rm}var Mm=E({},bl,{key:function(e){if(e.key){var a=Sm[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=Or(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Tm[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rc,charCode:function(e){return e.type==="keypress"?Or(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Or(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),bm=ja(Mm),xm=E({},Dr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dd=ja(xm),Om=E({},bl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rc}),Lm=ja(Om),Nm=E({},as,{propertyName:0,elapsedTime:0,pseudoElement:0}),Dm=ja(Nm),wm=E({},Dr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pm=ja(wm),Cm=E({},as,{newState:0,oldState:0}),Im=ja(Cm),Bm=[9,13,27,32],Mc=Xi&&"CompositionEvent"in window,Ol=null;Xi&&"documentMode"in document&&(Ol=document.documentMode);var Fm=Xi&&"TextEvent"in window&&!Ol,fd=Xi&&(!Mc||Ol&&8<Ol&&11>=Ol),gd=" ",pd=!1;function md(e,a){switch(e){case"keyup":return Bm.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Is=!1;function Hm(e,a){switch(e){case"compositionend":return yd(a);case"keypress":return a.which!==32?null:(pd=!0,gd);case"textInput":return e=a.data,e===gd&&pd?null:e;default:return null}}function Ym(e,a){if(Is)return e==="compositionend"||!Mc&&md(e,a)?(e=od(),xr=Ac=yn=null,Is=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return fd&&a.locale!=="ko"?null:a.data;default:return null}}var Gm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ed(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!Gm[e.type]:a==="textarea"}function _d(e,a,i,l){Ze?zt?zt.push(l):zt=[l]:Ze=l,a=So(a,"onChange"),0<a.length&&(i=new Nr("onChange","change",null,i,l),e.push({event:i,listeners:a}))}var Ll=null,Nl=null;function Um(e){ag(e,0)}function wr(e){var a=Ht(e);if(it(a))return e}function Ad(e,a){if(e==="change")return a}var Sd=!1;if(Xi){var bc;if(Xi){var xc="oninput"in document;if(!xc){var Td=document.createElement("div");Td.setAttribute("oninput","return;"),xc=typeof Td.oninput=="function"}bc=xc}else bc=!1;Sd=bc&&(!document.documentMode||9<document.documentMode)}function vd(){Ll&&(Ll.detachEvent("onpropertychange",Rd),Nl=Ll=null)}function Rd(e){if(e.propertyName==="value"&&wr(Nl)){var a=[];_d(a,Nl,e,Ut(e)),br(Um,a)}}function zm(e,a,i){e==="focusin"?(vd(),Ll=a,Nl=i,Ll.attachEvent("onpropertychange",Rd)):e==="focusout"&&vd()}function km(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return wr(Nl)}function Vm(e,a){if(e==="click")return wr(a)}function Wm(e,a){if(e==="input"||e==="change")return wr(a)}function Xm(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var ri=typeof Object.is=="function"?Object.is:Xm;function Dl(e,a){if(ri(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var i=Object.keys(e),l=Object.keys(a);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var u=i[l];if(!_l.call(a,u)||!ri(e[u],a[u]))return!1}return!0}function Md(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function bd(e,a){var i=Md(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=a&&l>=a)return{node:i,offset:a-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Md(i)}}function xd(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?xd(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function Od(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=T(e.document);a instanceof e.HTMLIFrameElement;){try{var i=typeof a.contentWindow.location.href=="string"}catch{i=!1}if(i)e=a.contentWindow;else break;a=T(e.document)}return a}function Oc(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var jm=Xi&&"documentMode"in document&&11>=document.documentMode,Bs=null,Lc=null,wl=null,Nc=!1;function Ld(e,a,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Nc||Bs==null||Bs!==T(l)||(l=Bs,"selectionStart"in l&&Oc(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),wl&&Dl(wl,l)||(wl=l,l=So(Lc,"onSelect"),0<l.length&&(a=new Nr("onSelect","select",null,a,i),e.push({event:a,listeners:l}),a.target=Bs)))}function is(e,a){var i={};return i[e.toLowerCase()]=a.toLowerCase(),i["Webkit"+e]="webkit"+a,i["Moz"+e]="moz"+a,i}var Fs={animationend:is("Animation","AnimationEnd"),animationiteration:is("Animation","AnimationIteration"),animationstart:is("Animation","AnimationStart"),transitionrun:is("Transition","TransitionRun"),transitionstart:is("Transition","TransitionStart"),transitioncancel:is("Transition","TransitionCancel"),transitionend:is("Transition","TransitionEnd")},Dc={},Nd={};Xi&&(Nd=document.createElement("div").style,"AnimationEvent"in window||(delete Fs.animationend.animation,delete Fs.animationiteration.animation,delete Fs.animationstart.animation),"TransitionEvent"in window||delete Fs.transitionend.transition);function ns(e){if(Dc[e])return Dc[e];if(!Fs[e])return e;var a=Fs[e],i;for(i in a)if(a.hasOwnProperty(i)&&i in Nd)return Dc[e]=a[i];return e}var Dd=ns("animationend"),wd=ns("animationiteration"),Pd=ns("animationstart"),$m=ns("transitionrun"),qm=ns("transitionstart"),Zm=ns("transitioncancel"),Cd=ns("transitionend"),Id=new Map,wc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wc.push("scrollEnd");function Li(e,a){Id.set(e,a),Yt(a,[e])}var Pr=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Ei=[],Hs=0,Pc=0;function Cr(){for(var e=Hs,a=Pc=Hs=0;a<e;){var i=Ei[a];Ei[a++]=null;var l=Ei[a];Ei[a++]=null;var u=Ei[a];Ei[a++]=null;var f=Ei[a];if(Ei[a++]=null,l!==null&&u!==null){var _=l.pending;_===null?u.next=u:(u.next=_.next,_.next=u),l.pending=u}f!==0&&Bd(i,u,f)}}function Ir(e,a,i,l){Ei[Hs++]=e,Ei[Hs++]=a,Ei[Hs++]=i,Ei[Hs++]=l,Pc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Cc(e,a,i,l){return Ir(e,a,i,l),Br(e)}function ss(e,a){return Ir(e,null,null,a),Br(e)}function Bd(e,a,i){e.lanes|=i;var l=e.alternate;l!==null&&(l.lanes|=i);for(var u=!1,f=e.return;f!==null;)f.childLanes|=i,l=f.alternate,l!==null&&(l.childLanes|=i),f.tag===22&&(e=f.stateNode,e===null||e._visibility&1||(u=!0)),e=f,f=f.return;return e.tag===3?(f=e.stateNode,u&&a!==null&&(u=31-Fa(i),e=f.hiddenUpdates,l=e[u],l===null?e[u]=[a]:l.push(a),a.lane=i|536870912),f):null}function Br(e){if(50<er)throw er=0,ku=null,Error(s(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var Ys={};function Km(e,a,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oi(e,a,i,l){return new Km(e,a,i,l)}function Ic(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ji(e,a){var i=e.alternate;return i===null?(i=oi(e.tag,a,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=a,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,a=e.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Fd(e,a){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,a=i.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function Fr(e,a,i,l,u,f){var _=0;if(l=e,typeof e=="function")Ic(e)&&(_=1);else if(typeof e=="string")_=ay(e,i,ue.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Ee:return e=oi(31,i,a,u),e.elementType=Ee,e.lanes=f,e;case O:return ls(i.children,u,f,a);case L:_=8,u|=24;break;case N:return e=oi(12,i,a,u|2),e.elementType=N,e.lanes=f,e;case W:return e=oi(13,i,a,u),e.elementType=W,e.lanes=f,e;case Q:return e=oi(19,i,a,u),e.elementType=Q,e.lanes=f,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case I:_=10;break e;case x:_=9;break e;case G:_=11;break e;case j:_=14;break e;case q:_=16,l=null;break e}_=29,i=Error(s(130,e===null?"null":typeof e,"")),l=null}return a=oi(_,i,a,u),a.elementType=e,a.type=l,a.lanes=f,a}function ls(e,a,i,l){return e=oi(7,e,l,a),e.lanes=i,e}function Bc(e,a,i){return e=oi(6,e,null,a),e.lanes=i,e}function Hd(e){var a=oi(18,null,null,0);return a.stateNode=e,a}function Fc(e,a,i){return a=oi(4,e.children!==null?e.children:[],e.key,a),a.lanes=i,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var Yd=new WeakMap;function _i(e,a){if(typeof e=="object"&&e!==null){var i=Yd.get(e);return i!==void 0?i:(a={value:e,source:a,stack:Zn(a)},Yd.set(e,a),a)}return{value:e,source:a,stack:Zn(a)}}var Gs=[],Us=0,Hr=null,Pl=0,Ai=[],Si=0,En=null,Bi=1,Fi="";function $i(e,a){Gs[Us++]=Pl,Gs[Us++]=Hr,Hr=e,Pl=a}function Gd(e,a,i){Ai[Si++]=Bi,Ai[Si++]=Fi,Ai[Si++]=En,En=e;var l=Bi;e=Fi;var u=32-Fa(l)-1;l&=~(1<<u),i+=1;var f=32-Fa(a)+u;if(30<f){var _=u-u%5;f=(l&(1<<_)-1).toString(32),l>>=_,u-=_,Bi=1<<32-Fa(a)+u|i<<u|l,Fi=f+e}else Bi=1<<f|i<<u|l,Fi=e}function Hc(e){e.return!==null&&($i(e,1),Gd(e,1,0))}function Yc(e){for(;e===Hr;)Hr=Gs[--Us],Gs[Us]=null,Pl=Gs[--Us],Gs[Us]=null;for(;e===En;)En=Ai[--Si],Ai[Si]=null,Fi=Ai[--Si],Ai[Si]=null,Bi=Ai[--Si],Ai[Si]=null}function Ud(e,a){Ai[Si++]=Bi,Ai[Si++]=Fi,Ai[Si++]=En,Bi=a.id,Fi=a.overflow,En=e}var Aa=null,kt=null,pt=!1,_n=null,Ti=!1,Gc=Error(s(519));function An(e){var a=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Cl(_i(a,e)),Gc}function zd(e){var a=e.stateNode,i=e.type,l=e.memoizedProps;switch(a[F]=e,a[p]=l,i){case"dialog":ht("cancel",a),ht("close",a);break;case"iframe":case"object":case"embed":ht("load",a);break;case"video":case"audio":for(i=0;i<ar.length;i++)ht(ar[i],a);break;case"source":ht("error",a);break;case"img":case"image":case"link":ht("error",a),ht("load",a);break;case"details":ht("toggle",a);break;case"input":ht("invalid",a),he(a,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":ht("invalid",a);break;case"textarea":ht("invalid",a),Pe(a,l.value,l.defaultValue,l.children)}i=l.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||a.textContent===""+i||l.suppressHydrationWarning===!0||lg(a.textContent,i)?(l.popover!=null&&(ht("beforetoggle",a),ht("toggle",a)),l.onScroll!=null&&ht("scroll",a),l.onScrollEnd!=null&&ht("scrollend",a),l.onClick!=null&&(a.onclick=La),a=!0):a=!1,a||An(e,!0)}function kd(e){for(Aa=e.return;Aa;)switch(Aa.tag){case 5:case 31:case 13:Ti=!1;return;case 27:case 3:Ti=!0;return;default:Aa=Aa.return}}function zs(e){if(e!==Aa)return!1;if(!pt)return kd(e),pt=!0,!1;var a=e.tag,i;if((i=a!==3&&a!==27)&&((i=a===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||nh(e.type,e.memoizedProps)),i=!i),i&&kt&&An(e),kd(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));kt=pg(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));kt=pg(e)}else a===27?(a=kt,Cn(e.type)?(e=ch,ch=null,kt=e):kt=a):kt=Aa?Ri(e.stateNode.nextSibling):null;return!0}function rs(){kt=Aa=null,pt=!1}function Uc(){var e=_n;return e!==null&&(Ka===null?Ka=e:Ka.push.apply(Ka,e),_n=null),e}function Cl(e){_n===null?_n=[e]:_n.push(e)}var zc=C(null),os=null,qi=null;function Sn(e,a,i){le(zc,a._currentValue),a._currentValue=i}function Zi(e){e._currentValue=zc.current,ee(zc)}function kc(e,a,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,l!==null&&(l.childLanes|=a)):l!==null&&(l.childLanes&a)!==a&&(l.childLanes|=a),e===i)break;e=e.return}}function Vc(e,a,i,l){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var f=u.dependencies;if(f!==null){var _=u.child;f=f.firstContext;e:for(;f!==null;){var R=f;f=u;for(var w=0;w<a.length;w++)if(R.context===a[w]){f.lanes|=i,R=f.alternate,R!==null&&(R.lanes|=i),kc(f.return,i,e),l||(_=null);break e}f=R.next}}else if(u.tag===18){if(_=u.return,_===null)throw Error(s(341));_.lanes|=i,f=_.alternate,f!==null&&(f.lanes|=i),kc(_,i,e),_=null}else _=u.child;if(_!==null)_.return=u;else for(_=u;_!==null;){if(_===e){_=null;break}if(u=_.sibling,u!==null){u.return=_.return,_=u;break}_=_.return}u=_}}function ks(e,a,i,l){e=null;for(var u=a,f=!1;u!==null;){if(!f){if((u.flags&524288)!==0)f=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var _=u.alternate;if(_===null)throw Error(s(387));if(_=_.memoizedProps,_!==null){var R=u.type;ri(u.pendingProps.value,_.value)||(e!==null?e.push(R):e=[R])}}else if(u===xe.current){if(_=u.alternate,_===null)throw Error(s(387));_.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(rr):e=[rr])}u=u.return}e!==null&&Vc(a,e,i,l),a.flags|=262144}function Yr(e){for(e=e.firstContext;e!==null;){if(!ri(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function cs(e){os=e,qi=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Sa(e){return Vd(os,e)}function Gr(e,a){return os===null&&cs(e),Vd(e,a)}function Vd(e,a){var i=a._currentValue;if(a={context:a,memoizedValue:i,next:null},qi===null){if(e===null)throw Error(s(308));qi=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else qi=qi.next=a;return i}var Qm=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(i,l){e.push(l)}};this.abort=function(){a.aborted=!0,e.forEach(function(i){return i()})}},Jm=o.unstable_scheduleCallback,e1=o.unstable_NormalPriority,la={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wc(){return{controller:new Qm,data:new Map,refCount:0}}function Il(e){e.refCount--,e.refCount===0&&Jm(e1,function(){e.controller.abort()})}var Bl=null,Xc=0,Vs=0,Ws=null;function t1(e,a){if(Bl===null){var i=Bl=[];Xc=0,Vs=qu(),Ws={status:"pending",value:void 0,then:function(l){i.push(l)}}}return Xc++,a.then(Wd,Wd),a}function Wd(){if(--Xc===0&&Bl!==null){Ws!==null&&(Ws.status="fulfilled");var e=Bl;Bl=null,Vs=0,Ws=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function a1(e,a){var i=[],l={status:"pending",value:null,reason:null,then:function(u){i.push(u)}};return e.then(function(){l.status="fulfilled",l.value=a;for(var u=0;u<i.length;u++)(0,i[u])(a)},function(u){for(l.status="rejected",l.reason=u,u=0;u<i.length;u++)(0,i[u])(void 0)}),l}var Xd=U.S;U.S=function(e,a){N0=Ea(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&t1(e,a),Xd!==null&&Xd(e,a)};var us=C(null);function jc(){var e=us.current;return e!==null?e:Pt.pooledCache}function Ur(e,a){a===null?le(us,us.current):le(us,a.pool)}function jd(){var e=jc();return e===null?null:{parent:la._currentValue,pool:e}}var Xs=Error(s(460)),$c=Error(s(474)),zr=Error(s(542)),kr={then:function(){}};function $d(e){return e=e.status,e==="fulfilled"||e==="rejected"}function qd(e,a,i){switch(i=e[i],i===void 0?e.push(a):i!==a&&(a.then(La,La),a=i),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Kd(e),e;default:if(typeof a.status=="string")a.then(La,La);else{if(e=Pt,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=a,e.status="pending",e.then(function(l){if(a.status==="pending"){var u=a;u.status="fulfilled",u.value=l}},function(l){if(a.status==="pending"){var u=a;u.status="rejected",u.reason=l}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Kd(e),e}throw ds=a,Xs}}function hs(e){try{var a=e._init;return a(e._payload)}catch(i){throw i!==null&&typeof i=="object"&&typeof i.then=="function"?(ds=i,Xs):i}}var ds=null;function Zd(){if(ds===null)throw Error(s(459));var e=ds;return ds=null,e}function Kd(e){if(e===Xs||e===zr)throw Error(s(483))}var js=null,Fl=0;function Vr(e){var a=Fl;return Fl+=1,js===null&&(js=[]),qd(js,e,a)}function Hl(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function Wr(e,a){throw a.$$typeof===A?Error(s(525)):(e=Object.prototype.toString.call(a),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function Qd(e){function a(H,B){if(e){var z=H.deletions;z===null?(H.deletions=[B],H.flags|=16):z.push(B)}}function i(H,B){if(!e)return null;for(;B!==null;)a(H,B),B=B.sibling;return null}function l(H){for(var B=new Map;H!==null;)H.key!==null?B.set(H.key,H):B.set(H.index,H),H=H.sibling;return B}function u(H,B){return H=ji(H,B),H.index=0,H.sibling=null,H}function f(H,B,z){return H.index=z,e?(z=H.alternate,z!==null?(z=z.index,z<B?(H.flags|=67108866,B):z):(H.flags|=67108866,B)):(H.flags|=1048576,B)}function _(H){return e&&H.alternate===null&&(H.flags|=67108866),H}function R(H,B,z,ae){return B===null||B.tag!==6?(B=Bc(z,H.mode,ae),B.return=H,B):(B=u(B,z),B.return=H,B)}function w(H,B,z,ae){var we=z.type;return we===O?J(H,B,z.props.children,ae,z.key):B!==null&&(B.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===q&&hs(we)===B.type)?(B=u(B,z.props),Hl(B,z),B.return=H,B):(B=Fr(z.type,z.key,z.props,null,H.mode,ae),Hl(B,z),B.return=H,B)}function k(H,B,z,ae){return B===null||B.tag!==4||B.stateNode.containerInfo!==z.containerInfo||B.stateNode.implementation!==z.implementation?(B=Fc(z,H.mode,ae),B.return=H,B):(B=u(B,z.children||[]),B.return=H,B)}function J(H,B,z,ae,we){return B===null||B.tag!==7?(B=ls(z,H.mode,ae,we),B.return=H,B):(B=u(B,z),B.return=H,B)}function ne(H,B,z){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Bc(""+B,H.mode,z),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case v:return z=Fr(B.type,B.key,B.props,null,H.mode,z),Hl(z,B),z.return=H,z;case b:return B=Fc(B,H.mode,z),B.return=H,B;case q:return B=hs(B),ne(H,B,z)}if(at(B)||re(B))return B=ls(B,H.mode,z,null),B.return=H,B;if(typeof B.then=="function")return ne(H,Vr(B),z);if(B.$$typeof===I)return ne(H,Gr(H,B),z);Wr(H,B)}return null}function X(H,B,z,ae){var we=B!==null?B.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return we!==null?null:R(H,B,""+z,ae);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case v:return z.key===we?w(H,B,z,ae):null;case b:return z.key===we?k(H,B,z,ae):null;case q:return z=hs(z),X(H,B,z,ae)}if(at(z)||re(z))return we!==null?null:J(H,B,z,ae,null);if(typeof z.then=="function")return X(H,B,Vr(z),ae);if(z.$$typeof===I)return X(H,B,Gr(H,z),ae);Wr(H,z)}return null}function $(H,B,z,ae,we){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return H=H.get(z)||null,R(B,H,""+ae,we);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:return H=H.get(ae.key===null?z:ae.key)||null,w(B,H,ae,we);case b:return H=H.get(ae.key===null?z:ae.key)||null,k(B,H,ae,we);case q:return ae=hs(ae),$(H,B,z,ae,we)}if(at(ae)||re(ae))return H=H.get(z)||null,J(B,H,ae,we,null);if(typeof ae.then=="function")return $(H,B,z,Vr(ae),we);if(ae.$$typeof===I)return $(H,B,z,Gr(B,ae),we);Wr(B,ae)}return null}function Re(H,B,z,ae){for(var we=null,Et=null,Oe=B,nt=B=0,ft=null;Oe!==null&&nt<z.length;nt++){Oe.index>nt?(ft=Oe,Oe=null):ft=Oe.sibling;var _t=X(H,Oe,z[nt],ae);if(_t===null){Oe===null&&(Oe=ft);break}e&&Oe&&_t.alternate===null&&a(H,Oe),B=f(_t,B,nt),Et===null?we=_t:Et.sibling=_t,Et=_t,Oe=ft}if(nt===z.length)return i(H,Oe),pt&&$i(H,nt),we;if(Oe===null){for(;nt<z.length;nt++)Oe=ne(H,z[nt],ae),Oe!==null&&(B=f(Oe,B,nt),Et===null?we=Oe:Et.sibling=Oe,Et=Oe);return pt&&$i(H,nt),we}for(Oe=l(Oe);nt<z.length;nt++)ft=$(Oe,H,nt,z[nt],ae),ft!==null&&(e&&ft.alternate!==null&&Oe.delete(ft.key===null?nt:ft.key),B=f(ft,B,nt),Et===null?we=ft:Et.sibling=ft,Et=ft);return e&&Oe.forEach(function(Yn){return a(H,Yn)}),pt&&$i(H,nt),we}function Ge(H,B,z,ae){if(z==null)throw Error(s(151));for(var we=null,Et=null,Oe=B,nt=B=0,ft=null,_t=z.next();Oe!==null&&!_t.done;nt++,_t=z.next()){Oe.index>nt?(ft=Oe,Oe=null):ft=Oe.sibling;var Yn=X(H,Oe,_t.value,ae);if(Yn===null){Oe===null&&(Oe=ft);break}e&&Oe&&Yn.alternate===null&&a(H,Oe),B=f(Yn,B,nt),Et===null?we=Yn:Et.sibling=Yn,Et=Yn,Oe=ft}if(_t.done)return i(H,Oe),pt&&$i(H,nt),we;if(Oe===null){for(;!_t.done;nt++,_t=z.next())_t=ne(H,_t.value,ae),_t!==null&&(B=f(_t,B,nt),Et===null?we=_t:Et.sibling=_t,Et=_t);return pt&&$i(H,nt),we}for(Oe=l(Oe);!_t.done;nt++,_t=z.next())_t=$(Oe,H,nt,_t.value,ae),_t!==null&&(e&&_t.alternate!==null&&Oe.delete(_t.key===null?nt:_t.key),B=f(_t,B,nt),Et===null?we=_t:Et.sibling=_t,Et=_t);return e&&Oe.forEach(function(fy){return a(H,fy)}),pt&&$i(H,nt),we}function wt(H,B,z,ae){if(typeof z=="object"&&z!==null&&z.type===O&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case v:e:{for(var we=z.key;B!==null;){if(B.key===we){if(we=z.type,we===O){if(B.tag===7){i(H,B.sibling),ae=u(B,z.props.children),ae.return=H,H=ae;break e}}else if(B.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===q&&hs(we)===B.type){i(H,B.sibling),ae=u(B,z.props),Hl(ae,z),ae.return=H,H=ae;break e}i(H,B);break}else a(H,B);B=B.sibling}z.type===O?(ae=ls(z.props.children,H.mode,ae,z.key),ae.return=H,H=ae):(ae=Fr(z.type,z.key,z.props,null,H.mode,ae),Hl(ae,z),ae.return=H,H=ae)}return _(H);case b:e:{for(we=z.key;B!==null;){if(B.key===we)if(B.tag===4&&B.stateNode.containerInfo===z.containerInfo&&B.stateNode.implementation===z.implementation){i(H,B.sibling),ae=u(B,z.children||[]),ae.return=H,H=ae;break e}else{i(H,B);break}else a(H,B);B=B.sibling}ae=Fc(z,H.mode,ae),ae.return=H,H=ae}return _(H);case q:return z=hs(z),wt(H,B,z,ae)}if(at(z))return Re(H,B,z,ae);if(re(z)){if(we=re(z),typeof we!="function")throw Error(s(150));return z=we.call(z),Ge(H,B,z,ae)}if(typeof z.then=="function")return wt(H,B,Vr(z),ae);if(z.$$typeof===I)return wt(H,B,Gr(H,z),ae);Wr(H,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,B!==null&&B.tag===6?(i(H,B.sibling),ae=u(B,z),ae.return=H,H=ae):(i(H,B),ae=Bc(z,H.mode,ae),ae.return=H,H=ae),_(H)):i(H,B)}return function(H,B,z,ae){try{Fl=0;var we=wt(H,B,z,ae);return js=null,we}catch(Oe){if(Oe===Xs||Oe===zr)throw Oe;var Et=oi(29,Oe,null,H.mode);return Et.lanes=ae,Et.return=H,Et}finally{}}}var fs=Qd(!0),Jd=Qd(!1),Tn=!1;function qc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Zc(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function vn(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Rn(e,a,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(Tt&2)!==0){var u=l.pending;return u===null?a.next=a:(a.next=u.next,u.next=a),l.pending=a,a=Br(e),Bd(e,null,i),a}return Ir(e,l,a,i),Br(e)}function Yl(e,a,i){if(a=a.updateQueue,a!==null&&(a=a.shared,(i&4194048)!==0)){var l=a.lanes;l&=e.pendingLanes,i|=l,a.lanes=i,Mr(e,i)}}function Kc(e,a){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var u=null,f=null;if(i=i.firstBaseUpdate,i!==null){do{var _={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};f===null?u=f=_:f=f.next=_,i=i.next}while(i!==null);f===null?u=f=a:f=f.next=a}else u=f=a;i={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:l.shared,callbacks:l.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=a:e.next=a,i.lastBaseUpdate=a}var Qc=!1;function Gl(){if(Qc){var e=Ws;if(e!==null)throw e}}function Ul(e,a,i,l){Qc=!1;var u=e.updateQueue;Tn=!1;var f=u.firstBaseUpdate,_=u.lastBaseUpdate,R=u.shared.pending;if(R!==null){u.shared.pending=null;var w=R,k=w.next;w.next=null,_===null?f=k:_.next=k,_=w;var J=e.alternate;J!==null&&(J=J.updateQueue,R=J.lastBaseUpdate,R!==_&&(R===null?J.firstBaseUpdate=k:R.next=k,J.lastBaseUpdate=w))}if(f!==null){var ne=u.baseState;_=0,J=k=w=null,R=f;do{var X=R.lane&-536870913,$=X!==R.lane;if($?(dt&X)===X:(l&X)===X){X!==0&&X===Vs&&(Qc=!0),J!==null&&(J=J.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var Re=e,Ge=R;X=a;var wt=i;switch(Ge.tag){case 1:if(Re=Ge.payload,typeof Re=="function"){ne=Re.call(wt,ne,X);break e}ne=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Ge.payload,X=typeof Re=="function"?Re.call(wt,ne,X):Re,X==null)break e;ne=E({},ne,X);break e;case 2:Tn=!0}}X=R.callback,X!==null&&(e.flags|=64,$&&(e.flags|=8192),$=u.callbacks,$===null?u.callbacks=[X]:$.push(X))}else $={lane:X,tag:R.tag,payload:R.payload,callback:R.callback,next:null},J===null?(k=J=$,w=ne):J=J.next=$,_|=X;if(R=R.next,R===null){if(R=u.shared.pending,R===null)break;$=R,R=$.next,$.next=null,u.lastBaseUpdate=$,u.shared.pending=null}}while(!0);J===null&&(w=ne),u.baseState=w,u.firstBaseUpdate=k,u.lastBaseUpdate=J,f===null&&(u.shared.lanes=0),Ln|=_,e.lanes=_,e.memoizedState=ne}}function ef(e,a){if(typeof e!="function")throw Error(s(191,e));e.call(a)}function tf(e,a){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)ef(i[e],a)}var $s=C(null),Xr=C(0);function af(e,a){e=ln,le(Xr,e),le($s,a),ln=e|a.baseLanes}function Jc(){le(Xr,ln),le($s,$s.current)}function eu(){ln=Xr.current,ee($s),ee(Xr)}var ci=C(null),vi=null;function Mn(e){var a=e.alternate;le(aa,aa.current&1),le(ci,e),vi===null&&(a===null||$s.current!==null||a.memoizedState!==null)&&(vi=e)}function tu(e){le(aa,aa.current),le(ci,e),vi===null&&(vi=e)}function nf(e){e.tag===22?(le(aa,aa.current),le(ci,e),vi===null&&(vi=e)):bn()}function bn(){le(aa,aa.current),le(ci,ci.current)}function ui(e){ee(ci),vi===e&&(vi=null),ee(aa)}var aa=C(0);function jr(e){for(var a=e;a!==null;){if(a.tag===13){var i=a.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||rh(i)||oh(i)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Ki=0,tt=null,Nt=null,ra=null,$r=!1,qs=!1,gs=!1,qr=0,zl=0,Zs=null,i1=0;function Qt(){throw Error(s(321))}function au(e,a){if(a===null)return!1;for(var i=0;i<a.length&&i<e.length;i++)if(!ri(e[i],a[i]))return!1;return!0}function iu(e,a,i,l,u,f){return Ki=f,tt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,U.H=e===null||e.memoizedState===null?Uf:Eu,gs=!1,f=i(l,u),gs=!1,qs&&(f=lf(a,i,l,u)),sf(e),f}function sf(e){U.H=Wl;var a=Nt!==null&&Nt.next!==null;if(Ki=0,ra=Nt=tt=null,$r=!1,zl=0,Zs=null,a)throw Error(s(300));e===null||oa||(e=e.dependencies,e!==null&&Yr(e)&&(oa=!0))}function lf(e,a,i,l){tt=e;var u=0;do{if(qs&&(Zs=null),zl=0,qs=!1,25<=u)throw Error(s(301));if(u+=1,ra=Nt=null,e.updateQueue!=null){var f=e.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,f.memoCache!=null&&(f.memoCache.index=0)}U.H=zf,f=a(i,l)}while(qs);return f}function n1(){var e=U.H,a=e.useState()[0];return a=typeof a.then=="function"?kl(a):a,e=e.useState()[0],(Nt!==null?Nt.memoizedState:null)!==e&&(tt.flags|=1024),a}function nu(){var e=qr!==0;return qr=0,e}function su(e,a,i){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~i}function lu(e){if($r){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}$r=!1}Ki=0,ra=Nt=tt=null,qs=!1,zl=qr=0,Zs=null}function Ga(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ra===null?tt.memoizedState=ra=e:ra=ra.next=e,ra}function ia(){if(Nt===null){var e=tt.alternate;e=e!==null?e.memoizedState:null}else e=Nt.next;var a=ra===null?tt.memoizedState:ra.next;if(a!==null)ra=a,Nt=e;else{if(e===null)throw tt.alternate===null?Error(s(467)):Error(s(310));Nt=e,e={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},ra===null?tt.memoizedState=ra=e:ra=ra.next=e}return ra}function Zr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function kl(e){var a=zl;return zl+=1,Zs===null&&(Zs=[]),e=qd(Zs,e,a),a=tt,(ra===null?a.memoizedState:ra.next)===null&&(a=a.alternate,U.H=a===null||a.memoizedState===null?Uf:Eu),e}function Kr(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return kl(e);if(e.$$typeof===I)return Sa(e)}throw Error(s(438,String(e)))}function ru(e){var a=null,i=tt.updateQueue;if(i!==null&&(a=i.memoCache),a==null){var l=tt.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(a={data:l.data.map(function(u){return u.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),i===null&&(i=Zr(),tt.updateQueue=i),i.memoCache=a,i=a.data[a.index],i===void 0)for(i=a.data[a.index]=Array(e),l=0;l<e;l++)i[l]=ye;return a.index++,i}function Qi(e,a){return typeof a=="function"?a(e):a}function Qr(e){var a=ia();return ou(a,Nt,e)}function ou(e,a,i){var l=e.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=i;var u=e.baseQueue,f=l.pending;if(f!==null){if(u!==null){var _=u.next;u.next=f.next,f.next=_}a.baseQueue=u=f,l.pending=null}if(f=e.baseState,u===null)e.memoizedState=f;else{a=u.next;var R=_=null,w=null,k=a,J=!1;do{var ne=k.lane&-536870913;if(ne!==k.lane?(dt&ne)===ne:(Ki&ne)===ne){var X=k.revertLane;if(X===0)w!==null&&(w=w.next={lane:0,revertLane:0,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),ne===Vs&&(J=!0);else if((Ki&X)===X){k=k.next,X===Vs&&(J=!0);continue}else ne={lane:0,revertLane:k.revertLane,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},w===null?(R=w=ne,_=f):w=w.next=ne,tt.lanes|=X,Ln|=X;ne=k.action,gs&&i(f,ne),f=k.hasEagerState?k.eagerState:i(f,ne)}else X={lane:ne,revertLane:k.revertLane,gesture:k.gesture,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},w===null?(R=w=X,_=f):w=w.next=X,tt.lanes|=ne,Ln|=ne;k=k.next}while(k!==null&&k!==a);if(w===null?_=f:w.next=R,!ri(f,e.memoizedState)&&(oa=!0,J&&(i=Ws,i!==null)))throw i;e.memoizedState=f,e.baseState=_,e.baseQueue=w,l.lastRenderedState=f}return u===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function cu(e){var a=ia(),i=a.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=e;var l=i.dispatch,u=i.pending,f=a.memoizedState;if(u!==null){i.pending=null;var _=u=u.next;do f=e(f,_.action),_=_.next;while(_!==u);ri(f,a.memoizedState)||(oa=!0),a.memoizedState=f,a.baseQueue===null&&(a.baseState=f),i.lastRenderedState=f}return[f,l]}function rf(e,a,i){var l=tt,u=ia(),f=pt;if(f){if(i===void 0)throw Error(s(407));i=i()}else i=a();var _=!ri((Nt||u).memoizedState,i);if(_&&(u.memoizedState=i,oa=!0),u=u.queue,du(uf.bind(null,l,u,e),[e]),u.getSnapshot!==a||_||ra!==null&&ra.memoizedState.tag&1){if(l.flags|=2048,Ks(9,{destroy:void 0},cf.bind(null,l,u,i,a),null),Pt===null)throw Error(s(349));f||(Ki&127)!==0||of(l,a,i)}return i}function of(e,a,i){e.flags|=16384,e={getSnapshot:a,value:i},a=tt.updateQueue,a===null?(a=Zr(),tt.updateQueue=a,a.stores=[e]):(i=a.stores,i===null?a.stores=[e]:i.push(e))}function cf(e,a,i,l){a.value=i,a.getSnapshot=l,hf(a)&&df(e)}function uf(e,a,i){return i(function(){hf(a)&&df(e)})}function hf(e){var a=e.getSnapshot;e=e.value;try{var i=a();return!ri(e,i)}catch{return!0}}function df(e){var a=ss(e,2);a!==null&&Qa(a,e,2)}function uu(e){var a=Ga();if(typeof e=="function"){var i=e;if(e=i(),gs){Va(!0);try{i()}finally{Va(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:e},a}function ff(e,a,i,l){return e.baseState=i,ou(e,Nt,typeof l=="function"?l:Qi)}function s1(e,a,i,l,u){if(to(e))throw Error(s(485));if(e=a.action,e!==null){var f={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){f.listeners.push(_)}};U.T!==null?i(!0):f.isTransition=!1,l(f),i=a.pending,i===null?(f.next=a.pending=f,gf(a,f)):(f.next=i.next,a.pending=i.next=f)}}function gf(e,a){var i=a.action,l=a.payload,u=e.state;if(a.isTransition){var f=U.T,_={};U.T=_;try{var R=i(u,l),w=U.S;w!==null&&w(_,R),pf(e,a,R)}catch(k){hu(e,a,k)}finally{f!==null&&_.types!==null&&(f.types=_.types),U.T=f}}else try{f=i(u,l),pf(e,a,f)}catch(k){hu(e,a,k)}}function pf(e,a,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(l){mf(e,a,l)},function(l){return hu(e,a,l)}):mf(e,a,i)}function mf(e,a,i){a.status="fulfilled",a.value=i,yf(a),e.state=i,a=e.pending,a!==null&&(i=a.next,i===a?e.pending=null:(i=i.next,a.next=i,gf(e,i)))}function hu(e,a,i){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do a.status="rejected",a.reason=i,yf(a),a=a.next;while(a!==l)}e.action=null}function yf(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function Ef(e,a){return a}function _f(e,a){if(pt){var i=Pt.formState;if(i!==null){e:{var l=tt;if(pt){if(kt){t:{for(var u=kt,f=Ti;u.nodeType!==8;){if(!f){u=null;break t}if(u=Ri(u.nextSibling),u===null){u=null;break t}}f=u.data,u=f==="F!"||f==="F"?u:null}if(u){kt=Ri(u.nextSibling),l=u.data==="F!";break e}}An(l)}l=!1}l&&(a=i[0])}}return i=Ga(),i.memoizedState=i.baseState=a,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ef,lastRenderedState:a},i.queue=l,i=Hf.bind(null,tt,l),l.dispatch=i,l=uu(!1),f=yu.bind(null,tt,!1,l.queue),l=Ga(),u={state:a,dispatch:null,action:e,pending:null},l.queue=u,i=s1.bind(null,tt,u,f,i),u.dispatch=i,l.memoizedState=e,[a,i,!1]}function Af(e){var a=ia();return Sf(a,Nt,e)}function Sf(e,a,i){if(a=ou(e,a,Ef)[0],e=Qr(Qi)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var l=kl(a)}catch(_){throw _===Xs?zr:_}else l=a;a=ia();var u=a.queue,f=u.dispatch;return i!==a.memoizedState&&(tt.flags|=2048,Ks(9,{destroy:void 0},l1.bind(null,u,i),null)),[l,f,e]}function l1(e,a){e.action=a}function Tf(e){var a=ia(),i=Nt;if(i!==null)return Sf(a,i,e);ia(),a=a.memoizedState,i=ia();var l=i.queue.dispatch;return i.memoizedState=e,[a,l,!1]}function Ks(e,a,i,l){return e={tag:e,create:i,deps:l,inst:a,next:null},a=tt.updateQueue,a===null&&(a=Zr(),tt.updateQueue=a),i=a.lastEffect,i===null?a.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,a.lastEffect=e),e}function vf(){return ia().memoizedState}function Jr(e,a,i,l){var u=Ga();tt.flags|=e,u.memoizedState=Ks(1|a,{destroy:void 0},i,l===void 0?null:l)}function eo(e,a,i,l){var u=ia();l=l===void 0?null:l;var f=u.memoizedState.inst;Nt!==null&&l!==null&&au(l,Nt.memoizedState.deps)?u.memoizedState=Ks(a,f,i,l):(tt.flags|=e,u.memoizedState=Ks(1|a,f,i,l))}function Rf(e,a){Jr(8390656,8,e,a)}function du(e,a){eo(2048,8,e,a)}function r1(e){tt.flags|=4;var a=tt.updateQueue;if(a===null)a=Zr(),tt.updateQueue=a,a.events=[e];else{var i=a.events;i===null?a.events=[e]:i.push(e)}}function Mf(e){var a=ia().memoizedState;return r1({ref:a,nextImpl:e}),function(){if((Tt&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}function bf(e,a){return eo(4,2,e,a)}function xf(e,a){return eo(4,4,e,a)}function Of(e,a){if(typeof a=="function"){e=e();var i=a(e);return function(){typeof i=="function"?i():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function Lf(e,a,i){i=i!=null?i.concat([e]):null,eo(4,4,Of.bind(null,a,e),i)}function fu(){}function Nf(e,a){var i=ia();a=a===void 0?null:a;var l=i.memoizedState;return a!==null&&au(a,l[1])?l[0]:(i.memoizedState=[e,a],e)}function Df(e,a){var i=ia();a=a===void 0?null:a;var l=i.memoizedState;if(a!==null&&au(a,l[1]))return l[0];if(l=e(),gs){Va(!0);try{e()}finally{Va(!1)}}return i.memoizedState=[l,a],l}function gu(e,a,i){return i===void 0||(Ki&1073741824)!==0&&(dt&261930)===0?e.memoizedState=a:(e.memoizedState=i,e=w0(),tt.lanes|=e,Ln|=e,i)}function wf(e,a,i,l){return ri(i,a)?i:$s.current!==null?(e=gu(e,i,l),ri(e,a)||(oa=!0),e):(Ki&42)===0||(Ki&1073741824)!==0&&(dt&261930)===0?(oa=!0,e.memoizedState=i):(e=w0(),tt.lanes|=e,Ln|=e,a)}function Pf(e,a,i,l,u){var f=se.p;se.p=f!==0&&8>f?f:8;var _=U.T,R={};U.T=R,yu(e,!1,a,i);try{var w=u(),k=U.S;if(k!==null&&k(R,w),w!==null&&typeof w=="object"&&typeof w.then=="function"){var J=a1(w,l);Vl(e,a,J,fi(e))}else Vl(e,a,l,fi(e))}catch(ne){Vl(e,a,{then:function(){},status:"rejected",reason:ne},fi())}finally{se.p=f,_!==null&&R.types!==null&&(_.types=R.types),U.T=_}}function o1(){}function pu(e,a,i,l){if(e.tag!==5)throw Error(s(476));var u=Cf(e).queue;Pf(e,u,a,_e,i===null?o1:function(){return If(e),i(l)})}function Cf(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:_e,baseState:_e,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:_e},next:null};var i={};return a.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:i},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function If(e){var a=Cf(e);a.next===null&&(a=e.alternate.memoizedState),Vl(e,a.next.queue,{},fi())}function mu(){return Sa(rr)}function Bf(){return ia().memoizedState}function Ff(){return ia().memoizedState}function c1(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var i=fi();e=vn(i);var l=Rn(a,e,i);l!==null&&(Qa(l,a,i),Yl(l,a,i)),a={cache:Wc()},e.payload=a;return}a=a.return}}function u1(e,a,i){var l=fi();i={lane:l,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},to(e)?Yf(a,i):(i=Cc(e,a,i,l),i!==null&&(Qa(i,e,l),Gf(i,a,l)))}function Hf(e,a,i){var l=fi();Vl(e,a,i,l)}function Vl(e,a,i,l){var u={lane:l,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null};if(to(e))Yf(a,u);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=a.lastRenderedReducer,f!==null))try{var _=a.lastRenderedState,R=f(_,i);if(u.hasEagerState=!0,u.eagerState=R,ri(R,_))return Ir(e,a,u,0),Pt===null&&Cr(),!1}catch{}finally{}if(i=Cc(e,a,u,l),i!==null)return Qa(i,e,l),Gf(i,a,l),!0}return!1}function yu(e,a,i,l){if(l={lane:2,revertLane:qu(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},to(e)){if(a)throw Error(s(479))}else a=Cc(e,i,l,2),a!==null&&Qa(a,e,2)}function to(e){var a=e.alternate;return e===tt||a!==null&&a===tt}function Yf(e,a){qs=$r=!0;var i=e.pending;i===null?a.next=a:(a.next=i.next,i.next=a),e.pending=a}function Gf(e,a,i){if((i&4194048)!==0){var l=a.lanes;l&=e.pendingLanes,i|=l,a.lanes=i,Mr(e,i)}}var Wl={readContext:Sa,use:Kr,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};Wl.useEffectEvent=Qt;var Uf={readContext:Sa,use:Kr,useCallback:function(e,a){return Ga().memoizedState=[e,a===void 0?null:a],e},useContext:Sa,useEffect:Rf,useImperativeHandle:function(e,a,i){i=i!=null?i.concat([e]):null,Jr(4194308,4,Of.bind(null,a,e),i)},useLayoutEffect:function(e,a){return Jr(4194308,4,e,a)},useInsertionEffect:function(e,a){Jr(4,2,e,a)},useMemo:function(e,a){var i=Ga();a=a===void 0?null:a;var l=e();if(gs){Va(!0);try{e()}finally{Va(!1)}}return i.memoizedState=[l,a],l},useReducer:function(e,a,i){var l=Ga();if(i!==void 0){var u=i(a);if(gs){Va(!0);try{i(a)}finally{Va(!1)}}}else u=a;return l.memoizedState=l.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},l.queue=e,e=e.dispatch=u1.bind(null,tt,e),[l.memoizedState,e]},useRef:function(e){var a=Ga();return e={current:e},a.memoizedState=e},useState:function(e){e=uu(e);var a=e.queue,i=Hf.bind(null,tt,a);return a.dispatch=i,[e.memoizedState,i]},useDebugValue:fu,useDeferredValue:function(e,a){var i=Ga();return gu(i,e,a)},useTransition:function(){var e=uu(!1);return e=Pf.bind(null,tt,e.queue,!0,!1),Ga().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,i){var l=tt,u=Ga();if(pt){if(i===void 0)throw Error(s(407));i=i()}else{if(i=a(),Pt===null)throw Error(s(349));(dt&127)!==0||of(l,a,i)}u.memoizedState=i;var f={value:i,getSnapshot:a};return u.queue=f,Rf(uf.bind(null,l,f,e),[e]),l.flags|=2048,Ks(9,{destroy:void 0},cf.bind(null,l,f,i,a),null),i},useId:function(){var e=Ga(),a=Pt.identifierPrefix;if(pt){var i=Fi,l=Bi;i=(l&~(1<<32-Fa(l)-1)).toString(32)+i,a="_"+a+"R_"+i,i=qr++,0<i&&(a+="H"+i.toString(32)),a+="_"}else i=i1++,a="_"+a+"r_"+i.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:mu,useFormState:_f,useActionState:_f,useOptimistic:function(e){var a=Ga();a.memoizedState=a.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=i,a=yu.bind(null,tt,!0,i),i.dispatch=a,[e,a]},useMemoCache:ru,useCacheRefresh:function(){return Ga().memoizedState=c1.bind(null,tt)},useEffectEvent:function(e){var a=Ga(),i={impl:e};return a.memoizedState=i,function(){if((Tt&2)!==0)throw Error(s(440));return i.impl.apply(void 0,arguments)}}},Eu={readContext:Sa,use:Kr,useCallback:Nf,useContext:Sa,useEffect:du,useImperativeHandle:Lf,useInsertionEffect:bf,useLayoutEffect:xf,useMemo:Df,useReducer:Qr,useRef:vf,useState:function(){return Qr(Qi)},useDebugValue:fu,useDeferredValue:function(e,a){var i=ia();return wf(i,Nt.memoizedState,e,a)},useTransition:function(){var e=Qr(Qi)[0],a=ia().memoizedState;return[typeof e=="boolean"?e:kl(e),a]},useSyncExternalStore:rf,useId:Bf,useHostTransitionStatus:mu,useFormState:Af,useActionState:Af,useOptimistic:function(e,a){var i=ia();return ff(i,Nt,e,a)},useMemoCache:ru,useCacheRefresh:Ff};Eu.useEffectEvent=Mf;var zf={readContext:Sa,use:Kr,useCallback:Nf,useContext:Sa,useEffect:du,useImperativeHandle:Lf,useInsertionEffect:bf,useLayoutEffect:xf,useMemo:Df,useReducer:cu,useRef:vf,useState:function(){return cu(Qi)},useDebugValue:fu,useDeferredValue:function(e,a){var i=ia();return Nt===null?gu(i,e,a):wf(i,Nt.memoizedState,e,a)},useTransition:function(){var e=cu(Qi)[0],a=ia().memoizedState;return[typeof e=="boolean"?e:kl(e),a]},useSyncExternalStore:rf,useId:Bf,useHostTransitionStatus:mu,useFormState:Tf,useActionState:Tf,useOptimistic:function(e,a){var i=ia();return Nt!==null?ff(i,Nt,e,a):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:ru,useCacheRefresh:Ff};zf.useEffectEvent=Mf;function _u(e,a,i,l){a=e.memoizedState,i=i(l,a),i=i==null?a:E({},a,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Au={enqueueSetState:function(e,a,i){e=e._reactInternals;var l=fi(),u=vn(l);u.payload=a,i!=null&&(u.callback=i),a=Rn(e,u,l),a!==null&&(Qa(a,e,l),Yl(a,e,l))},enqueueReplaceState:function(e,a,i){e=e._reactInternals;var l=fi(),u=vn(l);u.tag=1,u.payload=a,i!=null&&(u.callback=i),a=Rn(e,u,l),a!==null&&(Qa(a,e,l),Yl(a,e,l))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var i=fi(),l=vn(i);l.tag=2,a!=null&&(l.callback=a),a=Rn(e,l,i),a!==null&&(Qa(a,e,i),Yl(a,e,i))}};function kf(e,a,i,l,u,f,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,f,_):a.prototype&&a.prototype.isPureReactComponent?!Dl(i,l)||!Dl(u,f):!0}function Vf(e,a,i,l){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(i,l),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(i,l),a.state!==e&&Au.enqueueReplaceState(a,a.state,null)}function ps(e,a){var i=a;if("ref"in a){i={};for(var l in a)l!=="ref"&&(i[l]=a[l])}if(e=e.defaultProps){i===a&&(i=E({},i));for(var u in e)i[u]===void 0&&(i[u]=e[u])}return i}function Wf(e){Pr(e)}function Xf(e){console.error(e)}function jf(e){Pr(e)}function ao(e,a){try{var i=e.onUncaughtError;i(a.value,{componentStack:a.stack})}catch(l){setTimeout(function(){throw l})}}function $f(e,a,i){try{var l=e.onCaughtError;l(i.value,{componentStack:i.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Su(e,a,i){return i=vn(i),i.tag=3,i.payload={element:null},i.callback=function(){ao(e,a)},i}function qf(e){return e=vn(e),e.tag=3,e}function Zf(e,a,i,l){var u=i.type.getDerivedStateFromError;if(typeof u=="function"){var f=l.value;e.payload=function(){return u(f)},e.callback=function(){$f(a,i,l)}}var _=i.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(e.callback=function(){$f(a,i,l),typeof u!="function"&&(Nn===null?Nn=new Set([this]):Nn.add(this));var R=l.stack;this.componentDidCatch(l.value,{componentStack:R!==null?R:""})})}function h1(e,a,i,l,u){if(i.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(a=i.alternate,a!==null&&ks(a,i,u,!0),i=ci.current,i!==null){switch(i.tag){case 31:case 13:return vi===null?po():i.alternate===null&&Jt===0&&(Jt=3),i.flags&=-257,i.flags|=65536,i.lanes=u,l===kr?i.flags|=16384:(a=i.updateQueue,a===null?i.updateQueue=new Set([l]):a.add(l),Xu(e,l,u)),!1;case 22:return i.flags|=65536,l===kr?i.flags|=16384:(a=i.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([l])},i.updateQueue=a):(i=a.retryQueue,i===null?a.retryQueue=new Set([l]):i.add(l)),Xu(e,l,u)),!1}throw Error(s(435,i.tag))}return Xu(e,l,u),po(),!1}if(pt)return a=ci.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=u,l!==Gc&&(e=Error(s(422),{cause:l}),Cl(_i(e,i)))):(l!==Gc&&(a=Error(s(423),{cause:l}),Cl(_i(a,i))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,l=_i(l,i),u=Su(e.stateNode,l,u),Kc(e,u),Jt!==4&&(Jt=2)),!1;var f=Error(s(520),{cause:l});if(f=_i(f,i),Jl===null?Jl=[f]:Jl.push(f),Jt!==4&&(Jt=2),a===null)return!0;l=_i(l,i),i=a;do{switch(i.tag){case 3:return i.flags|=65536,e=u&-u,i.lanes|=e,e=Su(i.stateNode,l,e),Kc(i,e),!1;case 1:if(a=i.type,f=i.stateNode,(i.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(Nn===null||!Nn.has(f))))return i.flags|=65536,u&=-u,i.lanes|=u,u=qf(u),Zf(u,e,i,l),Kc(i,u),!1}i=i.return}while(i!==null);return!1}var Tu=Error(s(461)),oa=!1;function Ta(e,a,i,l){a.child=e===null?Jd(a,null,i,l):fs(a,e.child,i,l)}function Kf(e,a,i,l,u){i=i.render;var f=a.ref;if("ref"in l){var _={};for(var R in l)R!=="ref"&&(_[R]=l[R])}else _=l;return cs(a),l=iu(e,a,i,_,f,u),R=nu(),e!==null&&!oa?(su(e,a,u),Ji(e,a,u)):(pt&&R&&Hc(a),a.flags|=1,Ta(e,a,l,u),a.child)}function Qf(e,a,i,l,u){if(e===null){var f=i.type;return typeof f=="function"&&!Ic(f)&&f.defaultProps===void 0&&i.compare===null?(a.tag=15,a.type=f,Jf(e,a,f,l,u)):(e=Fr(i.type,null,l,a,a.mode,u),e.ref=a.ref,e.return=a,a.child=e)}if(f=e.child,!Nu(e,u)){var _=f.memoizedProps;if(i=i.compare,i=i!==null?i:Dl,i(_,l)&&e.ref===a.ref)return Ji(e,a,u)}return a.flags|=1,e=ji(f,l),e.ref=a.ref,e.return=a,a.child=e}function Jf(e,a,i,l,u){if(e!==null){var f=e.memoizedProps;if(Dl(f,l)&&e.ref===a.ref)if(oa=!1,a.pendingProps=l=f,Nu(e,u))(e.flags&131072)!==0&&(oa=!0);else return a.lanes=e.lanes,Ji(e,a,u)}return vu(e,a,i,l,u)}function e0(e,a,i,l){var u=l.children,f=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((a.flags&128)!==0){if(f=f!==null?f.baseLanes|i:i,e!==null){for(l=a.child=e.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~f}else l=0,a.child=null;return t0(e,a,f,i,l)}if((i&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ur(a,f!==null?f.cachePool:null),f!==null?af(a,f):Jc(),nf(a);else return l=a.lanes=536870912,t0(e,a,f!==null?f.baseLanes|i:i,i,l)}else f!==null?(Ur(a,f.cachePool),af(a,f),bn(),a.memoizedState=null):(e!==null&&Ur(a,null),Jc(),bn());return Ta(e,a,u,i),a.child}function Xl(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function t0(e,a,i,l,u){var f=jc();return f=f===null?null:{parent:la._currentValue,pool:f},a.memoizedState={baseLanes:i,cachePool:f},e!==null&&Ur(a,null),Jc(),nf(a),e!==null&&ks(e,a,l,!0),a.childLanes=u,null}function io(e,a){return a=so({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function a0(e,a,i){return fs(a,e.child,null,i),e=io(a,a.pendingProps),e.flags|=2,ui(a),a.memoizedState=null,e}function d1(e,a,i){var l=a.pendingProps,u=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(pt){if(l.mode==="hidden")return e=io(a,l),a.lanes=536870912,Xl(null,e);if(tu(a),(e=kt)?(e=gg(e,Ti),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:En!==null?{id:Bi,overflow:Fi}:null,retryLane:536870912,hydrationErrors:null},i=Hd(e),i.return=a,a.child=i,Aa=a,kt=null)):e=null,e===null)throw An(a);return a.lanes=536870912,null}return io(a,l)}var f=e.memoizedState;if(f!==null){var _=f.dehydrated;if(tu(a),u)if(a.flags&256)a.flags&=-257,a=a0(e,a,i);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(s(558));else if(oa||ks(e,a,i,!1),u=(i&e.childLanes)!==0,oa||u){if(l=Pt,l!==null&&(_=ws(l,i),_!==0&&_!==f.retryLane))throw f.retryLane=_,ss(e,_),Qa(l,e,_),Tu;po(),a=a0(e,a,i)}else e=f.treeContext,kt=Ri(_.nextSibling),Aa=a,pt=!0,_n=null,Ti=!1,e!==null&&Ud(a,e),a=io(a,l),a.flags|=4096;return a}return e=ji(e.child,{mode:l.mode,children:l.children}),e.ref=a.ref,a.child=e,e.return=a,e}function no(e,a){var i=a.ref;if(i===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(e===null||e.ref!==i)&&(a.flags|=4194816)}}function vu(e,a,i,l,u){return cs(a),i=iu(e,a,i,l,void 0,u),l=nu(),e!==null&&!oa?(su(e,a,u),Ji(e,a,u)):(pt&&l&&Hc(a),a.flags|=1,Ta(e,a,i,u),a.child)}function i0(e,a,i,l,u,f){return cs(a),a.updateQueue=null,i=lf(a,l,i,u),sf(e),l=nu(),e!==null&&!oa?(su(e,a,f),Ji(e,a,f)):(pt&&l&&Hc(a),a.flags|=1,Ta(e,a,i,f),a.child)}function n0(e,a,i,l,u){if(cs(a),a.stateNode===null){var f=Ys,_=i.contextType;typeof _=="object"&&_!==null&&(f=Sa(_)),f=new i(l,f),a.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=Au,a.stateNode=f,f._reactInternals=a,f=a.stateNode,f.props=l,f.state=a.memoizedState,f.refs={},qc(a),_=i.contextType,f.context=typeof _=="object"&&_!==null?Sa(_):Ys,f.state=a.memoizedState,_=i.getDerivedStateFromProps,typeof _=="function"&&(_u(a,i,_,l),f.state=a.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(_=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),_!==f.state&&Au.enqueueReplaceState(f,f.state,null),Ul(a,l,f,u),Gl(),f.state=a.memoizedState),typeof f.componentDidMount=="function"&&(a.flags|=4194308),l=!0}else if(e===null){f=a.stateNode;var R=a.memoizedProps,w=ps(i,R);f.props=w;var k=f.context,J=i.contextType;_=Ys,typeof J=="object"&&J!==null&&(_=Sa(J));var ne=i.getDerivedStateFromProps;J=typeof ne=="function"||typeof f.getSnapshotBeforeUpdate=="function",R=a.pendingProps!==R,J||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(R||k!==_)&&Vf(a,f,l,_),Tn=!1;var X=a.memoizedState;f.state=X,Ul(a,l,f,u),Gl(),k=a.memoizedState,R||X!==k||Tn?(typeof ne=="function"&&(_u(a,i,ne,l),k=a.memoizedState),(w=Tn||kf(a,i,w,l,X,k,_))?(J||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(a.flags|=4194308)):(typeof f.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=l,a.memoizedState=k),f.props=l,f.state=k,f.context=_,l=w):(typeof f.componentDidMount=="function"&&(a.flags|=4194308),l=!1)}else{f=a.stateNode,Zc(e,a),_=a.memoizedProps,J=ps(i,_),f.props=J,ne=a.pendingProps,X=f.context,k=i.contextType,w=Ys,typeof k=="object"&&k!==null&&(w=Sa(k)),R=i.getDerivedStateFromProps,(k=typeof R=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(_!==ne||X!==w)&&Vf(a,f,l,w),Tn=!1,X=a.memoizedState,f.state=X,Ul(a,l,f,u),Gl();var $=a.memoizedState;_!==ne||X!==$||Tn||e!==null&&e.dependencies!==null&&Yr(e.dependencies)?(typeof R=="function"&&(_u(a,i,R,l),$=a.memoizedState),(J=Tn||kf(a,i,J,l,X,$,w)||e!==null&&e.dependencies!==null&&Yr(e.dependencies))?(k||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(l,$,w),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(l,$,w)),typeof f.componentDidUpdate=="function"&&(a.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof f.componentDidUpdate!="function"||_===e.memoizedProps&&X===e.memoizedState||(a.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&X===e.memoizedState||(a.flags|=1024),a.memoizedProps=l,a.memoizedState=$),f.props=l,f.state=$,f.context=w,l=J):(typeof f.componentDidUpdate!="function"||_===e.memoizedProps&&X===e.memoizedState||(a.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&X===e.memoizedState||(a.flags|=1024),l=!1)}return f=l,no(e,a),l=(a.flags&128)!==0,f||l?(f=a.stateNode,i=l&&typeof i.getDerivedStateFromError!="function"?null:f.render(),a.flags|=1,e!==null&&l?(a.child=fs(a,e.child,null,u),a.child=fs(a,null,i,u)):Ta(e,a,i,u),a.memoizedState=f.state,e=a.child):e=Ji(e,a,u),e}function s0(e,a,i,l){return rs(),a.flags|=256,Ta(e,a,i,l),a.child}var Ru={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mu(e){return{baseLanes:e,cachePool:jd()}}function bu(e,a,i){return e=e!==null?e.childLanes&~i:0,a&&(e|=di),e}function l0(e,a,i){var l=a.pendingProps,u=!1,f=(a.flags&128)!==0,_;if((_=f)||(_=e!==null&&e.memoizedState===null?!1:(aa.current&2)!==0),_&&(u=!0,a.flags&=-129),_=(a.flags&32)!==0,a.flags&=-33,e===null){if(pt){if(u?Mn(a):bn(),(e=kt)?(e=gg(e,Ti),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:En!==null?{id:Bi,overflow:Fi}:null,retryLane:536870912,hydrationErrors:null},i=Hd(e),i.return=a,a.child=i,Aa=a,kt=null)):e=null,e===null)throw An(a);return oh(e)?a.lanes=32:a.lanes=536870912,null}var R=l.children;return l=l.fallback,u?(bn(),u=a.mode,R=so({mode:"hidden",children:R},u),l=ls(l,u,i,null),R.return=a,l.return=a,R.sibling=l,a.child=R,l=a.child,l.memoizedState=Mu(i),l.childLanes=bu(e,_,i),a.memoizedState=Ru,Xl(null,l)):(Mn(a),xu(a,R))}var w=e.memoizedState;if(w!==null&&(R=w.dehydrated,R!==null)){if(f)a.flags&256?(Mn(a),a.flags&=-257,a=Ou(e,a,i)):a.memoizedState!==null?(bn(),a.child=e.child,a.flags|=128,a=null):(bn(),R=l.fallback,u=a.mode,l=so({mode:"visible",children:l.children},u),R=ls(R,u,i,null),R.flags|=2,l.return=a,R.return=a,l.sibling=R,a.child=l,fs(a,e.child,null,i),l=a.child,l.memoizedState=Mu(i),l.childLanes=bu(e,_,i),a.memoizedState=Ru,a=Xl(null,l));else if(Mn(a),oh(R)){if(_=R.nextSibling&&R.nextSibling.dataset,_)var k=_.dgst;_=k,l=Error(s(419)),l.stack="",l.digest=_,Cl({value:l,source:null,stack:null}),a=Ou(e,a,i)}else if(oa||ks(e,a,i,!1),_=(i&e.childLanes)!==0,oa||_){if(_=Pt,_!==null&&(l=ws(_,i),l!==0&&l!==w.retryLane))throw w.retryLane=l,ss(e,l),Qa(_,e,l),Tu;rh(R)||po(),a=Ou(e,a,i)}else rh(R)?(a.flags|=192,a.child=e.child,a=null):(e=w.treeContext,kt=Ri(R.nextSibling),Aa=a,pt=!0,_n=null,Ti=!1,e!==null&&Ud(a,e),a=xu(a,l.children),a.flags|=4096);return a}return u?(bn(),R=l.fallback,u=a.mode,w=e.child,k=w.sibling,l=ji(w,{mode:"hidden",children:l.children}),l.subtreeFlags=w.subtreeFlags&65011712,k!==null?R=ji(k,R):(R=ls(R,u,i,null),R.flags|=2),R.return=a,l.return=a,l.sibling=R,a.child=l,Xl(null,l),l=a.child,R=e.child.memoizedState,R===null?R=Mu(i):(u=R.cachePool,u!==null?(w=la._currentValue,u=u.parent!==w?{parent:w,pool:w}:u):u=jd(),R={baseLanes:R.baseLanes|i,cachePool:u}),l.memoizedState=R,l.childLanes=bu(e,_,i),a.memoizedState=Ru,Xl(e.child,l)):(Mn(a),i=e.child,e=i.sibling,i=ji(i,{mode:"visible",children:l.children}),i.return=a,i.sibling=null,e!==null&&(_=a.deletions,_===null?(a.deletions=[e],a.flags|=16):_.push(e)),a.child=i,a.memoizedState=null,i)}function xu(e,a){return a=so({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function so(e,a){return e=oi(22,e,null,a),e.lanes=0,e}function Ou(e,a,i){return fs(a,e.child,null,i),e=xu(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function r0(e,a,i){e.lanes|=a;var l=e.alternate;l!==null&&(l.lanes|=a),kc(e.return,a,i)}function Lu(e,a,i,l,u,f){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:u,treeForkCount:f}:(_.isBackwards=a,_.rendering=null,_.renderingStartTime=0,_.last=l,_.tail=i,_.tailMode=u,_.treeForkCount=f)}function o0(e,a,i){var l=a.pendingProps,u=l.revealOrder,f=l.tail;l=l.children;var _=aa.current,R=(_&2)!==0;if(R?(_=_&1|2,a.flags|=128):_&=1,le(aa,_),Ta(e,a,l,i),l=pt?Pl:0,!R&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&r0(e,i,a);else if(e.tag===19)r0(e,i,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(i=a.child,u=null;i!==null;)e=i.alternate,e!==null&&jr(e)===null&&(u=i),i=i.sibling;i=u,i===null?(u=a.child,a.child=null):(u=i.sibling,i.sibling=null),Lu(a,!1,u,i,f,l);break;case"backwards":case"unstable_legacy-backwards":for(i=null,u=a.child,a.child=null;u!==null;){if(e=u.alternate,e!==null&&jr(e)===null){a.child=u;break}e=u.sibling,u.sibling=i,i=u,u=e}Lu(a,!0,i,null,f,l);break;case"together":Lu(a,!1,null,null,void 0,l);break;default:a.memoizedState=null}return a.child}function Ji(e,a,i){if(e!==null&&(a.dependencies=e.dependencies),Ln|=a.lanes,(i&a.childLanes)===0)if(e!==null){if(ks(e,a,i,!1),(i&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(s(153));if(a.child!==null){for(e=a.child,i=ji(e,e.pendingProps),a.child=i,i.return=a;e.sibling!==null;)e=e.sibling,i=i.sibling=ji(e,e.pendingProps),i.return=a;i.sibling=null}return a.child}function Nu(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&Yr(e)))}function f1(e,a,i){switch(a.tag){case 3:de(a,a.stateNode.containerInfo),Sn(a,la,e.memoizedState.cache),rs();break;case 27:case 5:ta(a);break;case 4:de(a,a.stateNode.containerInfo);break;case 10:Sn(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,tu(a),null;break;case 13:var l=a.memoizedState;if(l!==null)return l.dehydrated!==null?(Mn(a),a.flags|=128,null):(i&a.child.childLanes)!==0?l0(e,a,i):(Mn(a),e=Ji(e,a,i),e!==null?e.sibling:null);Mn(a);break;case 19:var u=(e.flags&128)!==0;if(l=(i&a.childLanes)!==0,l||(ks(e,a,i,!1),l=(i&a.childLanes)!==0),u){if(l)return o0(e,a,i);a.flags|=128}if(u=a.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),le(aa,aa.current),l)break;return null;case 22:return a.lanes=0,e0(e,a,i,a.pendingProps);case 24:Sn(a,la,e.memoizedState.cache)}return Ji(e,a,i)}function c0(e,a,i){if(e!==null)if(e.memoizedProps!==a.pendingProps)oa=!0;else{if(!Nu(e,i)&&(a.flags&128)===0)return oa=!1,f1(e,a,i);oa=(e.flags&131072)!==0}else oa=!1,pt&&(a.flags&1048576)!==0&&Gd(a,Pl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var l=a.pendingProps;if(e=hs(a.elementType),a.type=e,typeof e=="function")Ic(e)?(l=ps(e,l),a.tag=1,a=n0(null,a,e,l,i)):(a.tag=0,a=vu(null,a,e,l,i));else{if(e!=null){var u=e.$$typeof;if(u===G){a.tag=11,a=Kf(null,a,e,l,i);break e}else if(u===j){a.tag=14,a=Qf(null,a,e,l,i);break e}}throw a=Te(e)||e,Error(s(306,a,""))}}return a;case 0:return vu(e,a,a.type,a.pendingProps,i);case 1:return l=a.type,u=ps(l,a.pendingProps),n0(e,a,l,u,i);case 3:e:{if(de(a,a.stateNode.containerInfo),e===null)throw Error(s(387));l=a.pendingProps;var f=a.memoizedState;u=f.element,Zc(e,a),Ul(a,l,null,i);var _=a.memoizedState;if(l=_.cache,Sn(a,la,l),l!==f.cache&&Vc(a,[la],i,!0),Gl(),l=_.element,f.isDehydrated)if(f={element:l,isDehydrated:!1,cache:_.cache},a.updateQueue.baseState=f,a.memoizedState=f,a.flags&256){a=s0(e,a,l,i);break e}else if(l!==u){u=_i(Error(s(424)),a),Cl(u),a=s0(e,a,l,i);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(kt=Ri(e.firstChild),Aa=a,pt=!0,_n=null,Ti=!0,i=Jd(a,null,l,i),a.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(rs(),l===u){a=Ji(e,a,i);break e}Ta(e,a,l,i)}a=a.child}return a;case 26:return no(e,a),e===null?(i=Ag(a.type,null,a.pendingProps,null))?a.memoizedState=i:pt||(i=a.type,e=a.pendingProps,l=To(K.current).createElement(i),l[F]=a,l[p]=e,va(l,i,e),We(l),a.stateNode=l):a.memoizedState=Ag(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return ta(a),e===null&&pt&&(l=a.stateNode=yg(a.type,a.pendingProps,K.current),Aa=a,Ti=!0,u=kt,Cn(a.type)?(ch=u,kt=Ri(l.firstChild)):kt=u),Ta(e,a,a.pendingProps.children,i),no(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&pt&&((u=l=kt)&&(l=k1(l,a.type,a.pendingProps,Ti),l!==null?(a.stateNode=l,Aa=a,kt=Ri(l.firstChild),Ti=!1,u=!0):u=!1),u||An(a)),ta(a),u=a.type,f=a.pendingProps,_=e!==null?e.memoizedProps:null,l=f.children,nh(u,f)?l=null:_!==null&&nh(u,_)&&(a.flags|=32),a.memoizedState!==null&&(u=iu(e,a,n1,null,null,i),rr._currentValue=u),no(e,a),Ta(e,a,l,i),a.child;case 6:return e===null&&pt&&((e=i=kt)&&(i=V1(i,a.pendingProps,Ti),i!==null?(a.stateNode=i,Aa=a,kt=null,e=!0):e=!1),e||An(a)),null;case 13:return l0(e,a,i);case 4:return de(a,a.stateNode.containerInfo),l=a.pendingProps,e===null?a.child=fs(a,null,l,i):Ta(e,a,l,i),a.child;case 11:return Kf(e,a,a.type,a.pendingProps,i);case 7:return Ta(e,a,a.pendingProps,i),a.child;case 8:return Ta(e,a,a.pendingProps.children,i),a.child;case 12:return Ta(e,a,a.pendingProps.children,i),a.child;case 10:return l=a.pendingProps,Sn(a,a.type,l.value),Ta(e,a,l.children,i),a.child;case 9:return u=a.type._context,l=a.pendingProps.children,cs(a),u=Sa(u),l=l(u),a.flags|=1,Ta(e,a,l,i),a.child;case 14:return Qf(e,a,a.type,a.pendingProps,i);case 15:return Jf(e,a,a.type,a.pendingProps,i);case 19:return o0(e,a,i);case 31:return d1(e,a,i);case 22:return e0(e,a,i,a.pendingProps);case 24:return cs(a),l=Sa(la),e===null?(u=jc(),u===null&&(u=Pt,f=Wc(),u.pooledCache=f,f.refCount++,f!==null&&(u.pooledCacheLanes|=i),u=f),a.memoizedState={parent:l,cache:u},qc(a),Sn(a,la,u)):((e.lanes&i)!==0&&(Zc(e,a),Ul(a,null,null,i),Gl()),u=e.memoizedState,f=a.memoizedState,u.parent!==l?(u={parent:l,cache:l},a.memoizedState=u,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=u),Sn(a,la,l)):(l=f.cache,Sn(a,la,l),l!==u.cache&&Vc(a,[la],i,!0))),Ta(e,a,a.pendingProps.children,i),a.child;case 29:throw a.pendingProps}throw Error(s(156,a.tag))}function en(e){e.flags|=4}function Du(e,a,i,l,u){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(B0())e.flags|=8192;else throw ds=kr,$c}else e.flags&=-16777217}function u0(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Mg(a))if(B0())e.flags|=8192;else throw ds=kr,$c}function lo(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?Wi():536870912,e.lanes|=a,tl|=a)}function jl(e,a){if(!pt)switch(e.tailMode){case"hidden":a=e.tail;for(var i=null;a!==null;)a.alternate!==null&&(i=a),a=a.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Vt(e){var a=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(a)for(var u=e.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)i|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=l,e.childLanes=i,a}function g1(e,a,i){var l=a.pendingProps;switch(Yc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(a),null;case 1:return Vt(a),null;case 3:return i=a.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),Zi(la),Ue(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(zs(a)?en(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Uc())),Vt(a),null;case 26:var u=a.type,f=a.memoizedState;return e===null?(en(a),f!==null?(Vt(a),u0(a,f)):(Vt(a),Du(a,u,null,l,i))):f?f!==e.memoizedState?(en(a),Vt(a),u0(a,f)):(Vt(a),a.flags&=-16777217):(e=e.memoizedProps,e!==l&&en(a),Vt(a),Du(a,u,e,l,i)),null;case 27:if(xa(a),i=K.current,u=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==l&&en(a);else{if(!l){if(a.stateNode===null)throw Error(s(166));return Vt(a),null}e=ue.current,zs(a)?zd(a):(e=yg(u,l,i),a.stateNode=e,en(a))}return Vt(a),null;case 5:if(xa(a),u=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==l&&en(a);else{if(!l){if(a.stateNode===null)throw Error(s(166));return Vt(a),null}if(f=ue.current,zs(a))zd(a);else{var _=To(K.current);switch(f){case 1:f=_.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:f=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":f=_.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":f=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":f=_.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof l.is=="string"?_.createElement("select",{is:l.is}):_.createElement("select"),l.multiple?f.multiple=!0:l.size&&(f.size=l.size);break;default:f=typeof l.is=="string"?_.createElement(u,{is:l.is}):_.createElement(u)}}f[F]=a,f[p]=l;e:for(_=a.child;_!==null;){if(_.tag===5||_.tag===6)f.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===a)break e;for(;_.sibling===null;){if(_.return===null||_.return===a)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}a.stateNode=f;e:switch(va(f,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&en(a)}}return Vt(a),Du(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,i),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==l&&en(a);else{if(typeof l!="string"&&a.stateNode===null)throw Error(s(166));if(e=K.current,zs(a)){if(e=a.stateNode,i=a.memoizedProps,l=null,u=Aa,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}e[F]=a,e=!!(e.nodeValue===i||l!==null&&l.suppressHydrationWarning===!0||lg(e.nodeValue,i)),e||An(a,!0)}else e=To(e).createTextNode(l),e[F]=a,a.stateNode=e}return Vt(a),null;case 31:if(i=a.memoizedState,e===null||e.memoizedState!==null){if(l=zs(a),i!==null){if(e===null){if(!l)throw Error(s(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[F]=a}else rs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Vt(a),e=!1}else i=Uc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=i),e=!0;if(!e)return a.flags&256?(ui(a),a):(ui(a),null);if((a.flags&128)!==0)throw Error(s(558))}return Vt(a),null;case 13:if(l=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=zs(a),l!==null&&l.dehydrated!==null){if(e===null){if(!u)throw Error(s(318));if(u=a.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));u[F]=a}else rs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Vt(a),u=!1}else u=Uc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return a.flags&256?(ui(a),a):(ui(a),null)}return ui(a),(a.flags&128)!==0?(a.lanes=i,a):(i=l!==null,e=e!==null&&e.memoizedState!==null,i&&(l=a.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),f=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(f=l.memoizedState.cachePool.pool),f!==u&&(l.flags|=2048)),i!==e&&i&&(a.child.flags|=8192),lo(a,a.updateQueue),Vt(a),null);case 4:return Ue(),e===null&&Ju(a.stateNode.containerInfo),Vt(a),null;case 10:return Zi(a.type),Vt(a),null;case 19:if(ee(aa),l=a.memoizedState,l===null)return Vt(a),null;if(u=(a.flags&128)!==0,f=l.rendering,f===null)if(u)jl(l,!1);else{if(Jt!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(f=jr(e),f!==null){for(a.flags|=128,jl(l,!1),e=f.updateQueue,a.updateQueue=e,lo(a,e),a.subtreeFlags=0,e=i,i=a.child;i!==null;)Fd(i,e),i=i.sibling;return le(aa,aa.current&1|2),pt&&$i(a,l.treeForkCount),a.child}e=e.sibling}l.tail!==null&&Ea()>ho&&(a.flags|=128,u=!0,jl(l,!1),a.lanes=4194304)}else{if(!u)if(e=jr(f),e!==null){if(a.flags|=128,u=!0,e=e.updateQueue,a.updateQueue=e,lo(a,e),jl(l,!0),l.tail===null&&l.tailMode==="hidden"&&!f.alternate&&!pt)return Vt(a),null}else 2*Ea()-l.renderingStartTime>ho&&i!==536870912&&(a.flags|=128,u=!0,jl(l,!1),a.lanes=4194304);l.isBackwards?(f.sibling=a.child,a.child=f):(e=l.last,e!==null?e.sibling=f:a.child=f,l.last=f)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=Ea(),e.sibling=null,i=aa.current,le(aa,u?i&1|2:i&1),pt&&$i(a,l.treeForkCount),e):(Vt(a),null);case 22:case 23:return ui(a),eu(),l=a.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(a.flags|=8192):l&&(a.flags|=8192),l?(i&536870912)!==0&&(a.flags&128)===0&&(Vt(a),a.subtreeFlags&6&&(a.flags|=8192)):Vt(a),i=a.updateQueue,i!==null&&lo(a,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),l=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),l!==i&&(a.flags|=2048),e!==null&&ee(us),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),a.memoizedState.cache!==i&&(a.flags|=2048),Zi(la),Vt(a),null;case 25:return null;case 30:return null}throw Error(s(156,a.tag))}function p1(e,a){switch(Yc(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return Zi(la),Ue(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return xa(a),null;case 31:if(a.memoizedState!==null){if(ui(a),a.alternate===null)throw Error(s(340));rs()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(ui(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(s(340));rs()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return ee(aa),null;case 4:return Ue(),null;case 10:return Zi(a.type),null;case 22:case 23:return ui(a),eu(),e!==null&&ee(us),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return Zi(la),null;case 25:return null;default:return null}}function h0(e,a){switch(Yc(a),a.tag){case 3:Zi(la),Ue();break;case 26:case 27:case 5:xa(a);break;case 4:Ue();break;case 31:a.memoizedState!==null&&ui(a);break;case 13:ui(a);break;case 19:ee(aa);break;case 10:Zi(a.type);break;case 22:case 23:ui(a),eu(),e!==null&&ee(us);break;case 24:Zi(la)}}function $l(e,a){try{var i=a.updateQueue,l=i!==null?i.lastEffect:null;if(l!==null){var u=l.next;i=u;do{if((i.tag&e)===e){l=void 0;var f=i.create,_=i.inst;l=f(),_.destroy=l}i=i.next}while(i!==u)}}catch(R){xt(a,a.return,R)}}function xn(e,a,i){try{var l=a.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var f=u.next;l=f;do{if((l.tag&e)===e){var _=l.inst,R=_.destroy;if(R!==void 0){_.destroy=void 0,u=a;var w=i,k=R;try{k()}catch(J){xt(u,w,J)}}}l=l.next}while(l!==f)}}catch(J){xt(a,a.return,J)}}function d0(e){var a=e.updateQueue;if(a!==null){var i=e.stateNode;try{tf(a,i)}catch(l){xt(e,e.return,l)}}}function f0(e,a,i){i.props=ps(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(l){xt(e,a,l)}}function ql(e,a){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof i=="function"?e.refCleanup=i(l):i.current=l}}catch(u){xt(e,a,u)}}function Hi(e,a){var i=e.ref,l=e.refCleanup;if(i!==null)if(typeof l=="function")try{l()}catch(u){xt(e,a,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(u){xt(e,a,u)}else i.current=null}function g0(e){var a=e.type,i=e.memoizedProps,l=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":i.autoFocus&&l.focus();break e;case"img":i.src?l.src=i.src:i.srcSet&&(l.srcset=i.srcSet)}}catch(u){xt(e,e.return,u)}}function wu(e,a,i){try{var l=e.stateNode;F1(l,e.type,i,a),l[p]=a}catch(u){xt(e,e.return,u)}}function p0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Cn(e.type)||e.tag===4}function Pu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||p0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Cn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Cu(e,a,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,a?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,a):(a=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.appendChild(e),i=i._reactRootContainer,i!=null||a.onclick!==null||(a.onclick=La));else if(l!==4&&(l===27&&Cn(e.type)&&(i=e.stateNode,a=null),e=e.child,e!==null))for(Cu(e,a,i),e=e.sibling;e!==null;)Cu(e,a,i),e=e.sibling}function ro(e,a,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,a?i.insertBefore(e,a):i.appendChild(e);else if(l!==4&&(l===27&&Cn(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(ro(e,a,i),e=e.sibling;e!==null;)ro(e,a,i),e=e.sibling}function m0(e){var a=e.stateNode,i=e.memoizedProps;try{for(var l=e.type,u=a.attributes;u.length;)a.removeAttributeNode(u[0]);va(a,l,i),a[F]=e,a[p]=i}catch(f){xt(e,e.return,f)}}var tn=!1,ca=!1,Iu=!1,y0=typeof WeakSet=="function"?WeakSet:Set,pa=null;function m1(e,a){if(e=e.containerInfo,ah=Lo,e=Od(e),Oc(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var u=l.anchorOffset,f=l.focusNode;l=l.focusOffset;try{i.nodeType,f.nodeType}catch{i=null;break e}var _=0,R=-1,w=-1,k=0,J=0,ne=e,X=null;t:for(;;){for(var $;ne!==i||u!==0&&ne.nodeType!==3||(R=_+u),ne!==f||l!==0&&ne.nodeType!==3||(w=_+l),ne.nodeType===3&&(_+=ne.nodeValue.length),($=ne.firstChild)!==null;)X=ne,ne=$;for(;;){if(ne===e)break t;if(X===i&&++k===u&&(R=_),X===f&&++J===l&&(w=_),($=ne.nextSibling)!==null)break;ne=X,X=ne.parentNode}ne=$}i=R===-1||w===-1?null:{start:R,end:w}}else i=null}i=i||{start:0,end:0}}else i=null;for(ih={focusedElem:e,selectionRange:i},Lo=!1,pa=a;pa!==null;)if(a=pa,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,pa=e;else for(;pa!==null;){switch(a=pa,f=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(i=0;i<e.length;i++)u=e[i],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&f!==null){e=void 0,i=a,u=f.memoizedProps,f=f.memoizedState,l=i.stateNode;try{var Re=ps(i.type,u);e=l.getSnapshotBeforeUpdate(Re,f),l.__reactInternalSnapshotBeforeUpdate=e}catch(Ge){xt(i,i.return,Ge)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,i=e.nodeType,i===9)lh(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":lh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=a.sibling,e!==null){e.return=a.return,pa=e;break}pa=a.return}}function E0(e,a,i){var l=i.flags;switch(i.tag){case 0:case 11:case 15:nn(e,i),l&4&&$l(5,i);break;case 1:if(nn(e,i),l&4)if(e=i.stateNode,a===null)try{e.componentDidMount()}catch(_){xt(i,i.return,_)}else{var u=ps(i.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(u,a,e.__reactInternalSnapshotBeforeUpdate)}catch(_){xt(i,i.return,_)}}l&64&&d0(i),l&512&&ql(i,i.return);break;case 3:if(nn(e,i),l&64&&(e=i.updateQueue,e!==null)){if(a=null,i.child!==null)switch(i.child.tag){case 27:case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}try{tf(e,a)}catch(_){xt(i,i.return,_)}}break;case 27:a===null&&l&4&&m0(i);case 26:case 5:nn(e,i),a===null&&l&4&&g0(i),l&512&&ql(i,i.return);break;case 12:nn(e,i);break;case 31:nn(e,i),l&4&&S0(e,i);break;case 13:nn(e,i),l&4&&T0(e,i),l&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=M1.bind(null,i),W1(e,i))));break;case 22:if(l=i.memoizedState!==null||tn,!l){a=a!==null&&a.memoizedState!==null||ca,u=tn;var f=ca;tn=l,(ca=a)&&!f?sn(e,i,(i.subtreeFlags&8772)!==0):nn(e,i),tn=u,ca=f}break;case 30:break;default:nn(e,i)}}function _0(e){var a=e.alternate;a!==null&&(e.alternate=null,_0(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&$t(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Xt=null,$a=!1;function an(e,a,i){for(i=i.child;i!==null;)A0(e,a,i),i=i.sibling}function A0(e,a,i){if(Ba&&typeof Ba.onCommitFiberUnmount=="function")try{Ba.onCommitFiberUnmount(_a,i)}catch{}switch(i.tag){case 26:ca||Hi(i,a),an(e,a,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:ca||Hi(i,a);var l=Xt,u=$a;Cn(i.type)&&(Xt=i.stateNode,$a=!1),an(e,a,i),nr(i.stateNode),Xt=l,$a=u;break;case 5:ca||Hi(i,a);case 6:if(l=Xt,u=$a,Xt=null,an(e,a,i),Xt=l,$a=u,Xt!==null)if($a)try{(Xt.nodeType===9?Xt.body:Xt.nodeName==="HTML"?Xt.ownerDocument.body:Xt).removeChild(i.stateNode)}catch(f){xt(i,a,f)}else try{Xt.removeChild(i.stateNode)}catch(f){xt(i,a,f)}break;case 18:Xt!==null&&($a?(e=Xt,dg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),cl(e)):dg(Xt,i.stateNode));break;case 4:l=Xt,u=$a,Xt=i.stateNode.containerInfo,$a=!0,an(e,a,i),Xt=l,$a=u;break;case 0:case 11:case 14:case 15:xn(2,i,a),ca||xn(4,i,a),an(e,a,i);break;case 1:ca||(Hi(i,a),l=i.stateNode,typeof l.componentWillUnmount=="function"&&f0(i,a,l)),an(e,a,i);break;case 21:an(e,a,i);break;case 22:ca=(l=ca)||i.memoizedState!==null,an(e,a,i),ca=l;break;default:an(e,a,i)}}function S0(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{cl(e)}catch(i){xt(a,a.return,i)}}}function T0(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{cl(e)}catch(i){xt(a,a.return,i)}}function y1(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new y0),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new y0),a;default:throw Error(s(435,e.tag))}}function oo(e,a){var i=y1(e);a.forEach(function(l){if(!i.has(l)){i.add(l);var u=b1.bind(null,e,l);l.then(u,u)}})}function qa(e,a){var i=a.deletions;if(i!==null)for(var l=0;l<i.length;l++){var u=i[l],f=e,_=a,R=_;e:for(;R!==null;){switch(R.tag){case 27:if(Cn(R.type)){Xt=R.stateNode,$a=!1;break e}break;case 5:Xt=R.stateNode,$a=!1;break e;case 3:case 4:Xt=R.stateNode.containerInfo,$a=!0;break e}R=R.return}if(Xt===null)throw Error(s(160));A0(f,_,u),Xt=null,$a=!1,f=u.alternate,f!==null&&(f.return=null),u.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)v0(a,e),a=a.sibling}var Ni=null;function v0(e,a){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:qa(a,e),Za(e),l&4&&(xn(3,e,e.return),$l(3,e),xn(5,e,e.return));break;case 1:qa(a,e),Za(e),l&512&&(ca||i===null||Hi(i,i.return)),l&64&&tn&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?l:i.concat(l))));break;case 26:var u=Ni;if(qa(a,e),Za(e),l&512&&(ca||i===null||Hi(i,i.return)),l&4){var f=i!==null?i.memoizedState:null;if(l=e.memoizedState,i===null)if(l===null)if(e.stateNode===null){e:{l=e.type,i=e.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":f=u.getElementsByTagName("title")[0],(!f||f[Lt]||f[F]||f.namespaceURI==="http://www.w3.org/2000/svg"||f.hasAttribute("itemprop"))&&(f=u.createElement(l),u.head.insertBefore(f,u.querySelector("head > title"))),va(f,l,i),f[F]=e,We(f),l=f;break e;case"link":var _=vg("link","href",u).get(l+(i.href||""));if(_){for(var R=0;R<_.length;R++)if(f=_[R],f.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&f.getAttribute("rel")===(i.rel==null?null:i.rel)&&f.getAttribute("title")===(i.title==null?null:i.title)&&f.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){_.splice(R,1);break t}}f=u.createElement(l),va(f,l,i),u.head.appendChild(f);break;case"meta":if(_=vg("meta","content",u).get(l+(i.content||""))){for(R=0;R<_.length;R++)if(f=_[R],f.getAttribute("content")===(i.content==null?null:""+i.content)&&f.getAttribute("name")===(i.name==null?null:i.name)&&f.getAttribute("property")===(i.property==null?null:i.property)&&f.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&f.getAttribute("charset")===(i.charSet==null?null:i.charSet)){_.splice(R,1);break t}}f=u.createElement(l),va(f,l,i),u.head.appendChild(f);break;default:throw Error(s(468,l))}f[F]=e,We(f),l=f}e.stateNode=l}else Rg(u,e.type,e.stateNode);else e.stateNode=Tg(u,l,e.memoizedProps);else f!==l?(f===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):f.count--,l===null?Rg(u,e.type,e.stateNode):Tg(u,l,e.memoizedProps)):l===null&&e.stateNode!==null&&wu(e,e.memoizedProps,i.memoizedProps)}break;case 27:qa(a,e),Za(e),l&512&&(ca||i===null||Hi(i,i.return)),i!==null&&l&4&&wu(e,e.memoizedProps,i.memoizedProps);break;case 5:if(qa(a,e),Za(e),l&512&&(ca||i===null||Hi(i,i.return)),e.flags&32){u=e.stateNode;try{$e(u,"")}catch(Re){xt(e,e.return,Re)}}l&4&&e.stateNode!=null&&(u=e.memoizedProps,wu(e,u,i!==null?i.memoizedProps:u)),l&1024&&(Iu=!0);break;case 6:if(qa(a,e),Za(e),l&4){if(e.stateNode===null)throw Error(s(162));l=e.memoizedProps,i=e.stateNode;try{i.nodeValue=l}catch(Re){xt(e,e.return,Re)}}break;case 3:if(Mo=null,u=Ni,Ni=vo(a.containerInfo),qa(a,e),Ni=u,Za(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{cl(a.containerInfo)}catch(Re){xt(e,e.return,Re)}Iu&&(Iu=!1,R0(e));break;case 4:l=Ni,Ni=vo(e.stateNode.containerInfo),qa(a,e),Za(e),Ni=l;break;case 12:qa(a,e),Za(e);break;case 31:qa(a,e),Za(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,oo(e,l)));break;case 13:qa(a,e),Za(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(uo=Ea()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,oo(e,l)));break;case 22:u=e.memoizedState!==null;var w=i!==null&&i.memoizedState!==null,k=tn,J=ca;if(tn=k||u,ca=J||w,qa(a,e),ca=J,tn=k,Za(e),l&8192)e:for(a=e.stateNode,a._visibility=u?a._visibility&-2:a._visibility|1,u&&(i===null||w||tn||ca||ms(e)),i=null,a=e;;){if(a.tag===5||a.tag===26){if(i===null){w=i=a;try{if(f=w.stateNode,u)_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{R=w.stateNode;var ne=w.memoizedProps.style,X=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;R.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(Re){xt(w,w.return,Re)}}}else if(a.tag===6){if(i===null){w=a;try{w.stateNode.nodeValue=u?"":w.memoizedProps}catch(Re){xt(w,w.return,Re)}}}else if(a.tag===18){if(i===null){w=a;try{var $=w.stateNode;u?fg($,!0):fg(w.stateNode,!1)}catch(Re){xt(w,w.return,Re)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;i===a&&(i=null),a=a.return}i===a&&(i=null),a.sibling.return=a.return,a=a.sibling}l&4&&(l=e.updateQueue,l!==null&&(i=l.retryQueue,i!==null&&(l.retryQueue=null,oo(e,i))));break;case 19:qa(a,e),Za(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,oo(e,l)));break;case 30:break;case 21:break;default:qa(a,e),Za(e)}}function Za(e){var a=e.flags;if(a&2){try{for(var i,l=e.return;l!==null;){if(p0(l)){i=l;break}l=l.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var u=i.stateNode,f=Pu(e);ro(e,f,u);break;case 5:var _=i.stateNode;i.flags&32&&($e(_,""),i.flags&=-33);var R=Pu(e);ro(e,R,_);break;case 3:case 4:var w=i.stateNode.containerInfo,k=Pu(e);Cu(e,k,w);break;default:throw Error(s(161))}}catch(J){xt(e,e.return,J)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function R0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;R0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function nn(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)E0(e,a.alternate,a),a=a.sibling}function ms(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:xn(4,a,a.return),ms(a);break;case 1:Hi(a,a.return);var i=a.stateNode;typeof i.componentWillUnmount=="function"&&f0(a,a.return,i),ms(a);break;case 27:nr(a.stateNode);case 26:case 5:Hi(a,a.return),ms(a);break;case 22:a.memoizedState===null&&ms(a);break;case 30:ms(a);break;default:ms(a)}e=e.sibling}}function sn(e,a,i){for(i=i&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var l=a.alternate,u=e,f=a,_=f.flags;switch(f.tag){case 0:case 11:case 15:sn(u,f,i),$l(4,f);break;case 1:if(sn(u,f,i),l=f,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(k){xt(l,l.return,k)}if(l=f,u=l.updateQueue,u!==null){var R=l.stateNode;try{var w=u.shared.hiddenCallbacks;if(w!==null)for(u.shared.hiddenCallbacks=null,u=0;u<w.length;u++)ef(w[u],R)}catch(k){xt(l,l.return,k)}}i&&_&64&&d0(f),ql(f,f.return);break;case 27:m0(f);case 26:case 5:sn(u,f,i),i&&l===null&&_&4&&g0(f),ql(f,f.return);break;case 12:sn(u,f,i);break;case 31:sn(u,f,i),i&&_&4&&S0(u,f);break;case 13:sn(u,f,i),i&&_&4&&T0(u,f);break;case 22:f.memoizedState===null&&sn(u,f,i),ql(f,f.return);break;case 30:break;default:sn(u,f,i)}a=a.sibling}}function Bu(e,a){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Il(i))}function Fu(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Il(e))}function Di(e,a,i,l){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)M0(e,a,i,l),a=a.sibling}function M0(e,a,i,l){var u=a.flags;switch(a.tag){case 0:case 11:case 15:Di(e,a,i,l),u&2048&&$l(9,a);break;case 1:Di(e,a,i,l);break;case 3:Di(e,a,i,l),u&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Il(e)));break;case 12:if(u&2048){Di(e,a,i,l),e=a.stateNode;try{var f=a.memoizedProps,_=f.id,R=f.onPostCommit;typeof R=="function"&&R(_,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(w){xt(a,a.return,w)}}else Di(e,a,i,l);break;case 31:Di(e,a,i,l);break;case 13:Di(e,a,i,l);break;case 23:break;case 22:f=a.stateNode,_=a.alternate,a.memoizedState!==null?f._visibility&2?Di(e,a,i,l):Zl(e,a):f._visibility&2?Di(e,a,i,l):(f._visibility|=2,Qs(e,a,i,l,(a.subtreeFlags&10256)!==0||!1)),u&2048&&Bu(_,a);break;case 24:Di(e,a,i,l),u&2048&&Fu(a.alternate,a);break;default:Di(e,a,i,l)}}function Qs(e,a,i,l,u){for(u=u&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var f=e,_=a,R=i,w=l,k=_.flags;switch(_.tag){case 0:case 11:case 15:Qs(f,_,R,w,u),$l(8,_);break;case 23:break;case 22:var J=_.stateNode;_.memoizedState!==null?J._visibility&2?Qs(f,_,R,w,u):Zl(f,_):(J._visibility|=2,Qs(f,_,R,w,u)),u&&k&2048&&Bu(_.alternate,_);break;case 24:Qs(f,_,R,w,u),u&&k&2048&&Fu(_.alternate,_);break;default:Qs(f,_,R,w,u)}a=a.sibling}}function Zl(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var i=e,l=a,u=l.flags;switch(l.tag){case 22:Zl(i,l),u&2048&&Bu(l.alternate,l);break;case 24:Zl(i,l),u&2048&&Fu(l.alternate,l);break;default:Zl(i,l)}a=a.sibling}}var Kl=8192;function Js(e,a,i){if(e.subtreeFlags&Kl)for(e=e.child;e!==null;)b0(e,a,i),e=e.sibling}function b0(e,a,i){switch(e.tag){case 26:Js(e,a,i),e.flags&Kl&&e.memoizedState!==null&&iy(i,Ni,e.memoizedState,e.memoizedProps);break;case 5:Js(e,a,i);break;case 3:case 4:var l=Ni;Ni=vo(e.stateNode.containerInfo),Js(e,a,i),Ni=l;break;case 22:e.memoizedState===null&&(l=e.alternate,l!==null&&l.memoizedState!==null?(l=Kl,Kl=16777216,Js(e,a,i),Kl=l):Js(e,a,i));break;default:Js(e,a,i)}}function x0(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function Ql(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var l=a[i];pa=l,L0(l,e)}x0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)O0(e),e=e.sibling}function O0(e){switch(e.tag){case 0:case 11:case 15:Ql(e),e.flags&2048&&xn(9,e,e.return);break;case 3:Ql(e);break;case 12:Ql(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,co(e)):Ql(e);break;default:Ql(e)}}function co(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var l=a[i];pa=l,L0(l,e)}x0(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:xn(8,a,a.return),co(a);break;case 22:i=a.stateNode,i._visibility&2&&(i._visibility&=-3,co(a));break;default:co(a)}e=e.sibling}}function L0(e,a){for(;pa!==null;){var i=pa;switch(i.tag){case 0:case 11:case 15:xn(8,i,a);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var l=i.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Il(i.memoizedState.cache)}if(l=i.child,l!==null)l.return=i,pa=l;else e:for(i=e;pa!==null;){l=pa;var u=l.sibling,f=l.return;if(_0(l),l===i){pa=null;break e}if(u!==null){u.return=f,pa=u;break e}pa=f}}}var E1={getCacheForType:function(e){var a=Sa(la),i=a.data.get(e);return i===void 0&&(i=e(),a.data.set(e,i)),i},cacheSignal:function(){return Sa(la).controller.signal}},_1=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Pt=null,ut=null,dt=0,bt=0,hi=null,On=!1,el=!1,Hu=!1,ln=0,Jt=0,Ln=0,ys=0,Yu=0,di=0,tl=0,Jl=null,Ka=null,Gu=!1,uo=0,N0=0,ho=1/0,fo=null,Nn=null,da=0,Dn=null,al=null,rn=0,Uu=0,zu=null,D0=null,er=0,ku=null;function fi(){return(Tt&2)!==0&&dt!==0?dt&-dt:U.T!==null?qu():Ps()}function w0(){if(di===0)if((dt&536870912)===0||pt){var e=gn;gn<<=1,(gn&3932160)===0&&(gn=262144),di=e}else di=536870912;return e=ci.current,e!==null&&(e.flags|=32),di}function Qa(e,a,i){(e===Pt&&(bt===2||bt===9)||e.cancelPendingCommit!==null)&&(il(e,0),wn(e,dt,di,!1)),Ci(e,i),((Tt&2)===0||e!==Pt)&&(e===Pt&&((Tt&2)===0&&(ys|=i),Jt===4&&wn(e,dt,di,!1)),Yi(e))}function P0(e,a,i){if((Tt&6)!==0)throw Error(s(327));var l=!i&&(a&127)===0&&(a&e.expiredLanes)===0||Kn(e,a),u=l?T1(e,a):Wu(e,a,!0),f=l;do{if(u===0){el&&!l&&wn(e,a,0,!1);break}else{if(i=e.current.alternate,f&&!A1(i)){u=Wu(e,a,!1),f=!1;continue}if(u===2){if(f=a,e.errorRecoveryDisabledLanes&f)var _=0;else _=e.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){a=_;e:{var R=e;u=Jl;var w=R.current.memoizedState.isDehydrated;if(w&&(il(R,_).flags|=256),_=Wu(R,_,!1),_!==2){if(Hu&&!w){R.errorRecoveryDisabledLanes|=f,ys|=f,u=4;break e}f=Ka,Ka=u,f!==null&&(Ka===null?Ka=f:Ka.push.apply(Ka,f))}u=_}if(f=!1,u!==2)continue}}if(u===1){il(e,0),wn(e,a,0,!0);break}e:{switch(l=e,f=u,f){case 0:case 1:throw Error(s(345));case 4:if((a&4194048)!==a)break;case 6:wn(l,a,di,!On);break e;case 2:Ka=null;break;case 3:case 5:break;default:throw Error(s(329))}if((a&62914560)===a&&(u=uo+300-Ea(),10<u)){if(wn(l,a,di,!On),mn(l,0,!0)!==0)break e;rn=a,l.timeoutHandle=ug(C0.bind(null,l,i,Ka,fo,Gu,a,di,ys,tl,On,f,"Throttled",-0,0),u);break e}C0(l,i,Ka,fo,Gu,a,di,ys,tl,On,f,null,-0,0)}}break}while(!0);Yi(e)}function C0(e,a,i,l,u,f,_,R,w,k,J,ne,X,$){if(e.timeoutHandle=-1,ne=a.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:La},b0(a,f,ne);var Re=(f&62914560)===f?uo-Ea():(f&4194048)===f?N0-Ea():0;if(Re=ny(ne,Re),Re!==null){rn=f,e.cancelPendingCommit=Re(z0.bind(null,e,a,f,i,l,u,_,R,w,J,ne,null,X,$)),wn(e,f,_,!k);return}}z0(e,a,f,i,l,u,_,R,w)}function A1(e){for(var a=e;;){var i=a.tag;if((i===0||i===11||i===15)&&a.flags&16384&&(i=a.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var l=0;l<i.length;l++){var u=i[l],f=u.getSnapshot;u=u.value;try{if(!ri(f(),u))return!1}catch{return!1}}if(i=a.child,a.subtreeFlags&16384&&i!==null)i.return=a,a=i;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function wn(e,a,i,l){a&=~Yu,a&=~ys,e.suspendedLanes|=a,e.pingedLanes&=~a,l&&(e.warmLanes|=a),l=e.expirationTimes;for(var u=a;0<u;){var f=31-Fa(u),_=1<<f;l[f]=-1,u&=~_}i!==0&&Rr(e,i,a)}function go(){return(Tt&6)===0?(tr(0),!1):!0}function Vu(){if(ut!==null){if(bt===0)var e=ut.return;else e=ut,qi=os=null,lu(e),js=null,Fl=0,e=ut;for(;e!==null;)h0(e.alternate,e),e=e.return;ut=null}}function il(e,a){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,G1(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),rn=0,Vu(),Pt=e,ut=i=ji(e.current,null),dt=a,bt=0,hi=null,On=!1,el=Kn(e,a),Hu=!1,tl=di=Yu=ys=Ln=Jt=0,Ka=Jl=null,Gu=!1,(a&8)!==0&&(a|=a&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=a;0<l;){var u=31-Fa(l),f=1<<u;a|=e[u],l&=~f}return ln=a,Cr(),i}function I0(e,a){tt=null,U.H=Wl,a===Xs||a===zr?(a=Zd(),bt=3):a===$c?(a=Zd(),bt=4):bt=a===Tu?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,hi=a,ut===null&&(Jt=1,ao(e,_i(a,e.current)))}function B0(){var e=ci.current;return e===null?!0:(dt&4194048)===dt?vi===null:(dt&62914560)===dt||(dt&536870912)!==0?e===vi:!1}function F0(){var e=U.H;return U.H=Wl,e===null?Wl:e}function H0(){var e=U.A;return U.A=E1,e}function po(){Jt=4,On||(dt&4194048)!==dt&&ci.current!==null||(el=!0),(Ln&134217727)===0&&(ys&134217727)===0||Pt===null||wn(Pt,dt,di,!1)}function Wu(e,a,i){var l=Tt;Tt|=2;var u=F0(),f=H0();(Pt!==e||dt!==a)&&(fo=null,il(e,a)),a=!1;var _=Jt;e:do try{if(bt!==0&&ut!==null){var R=ut,w=hi;switch(bt){case 8:Vu(),_=6;break e;case 3:case 2:case 9:case 6:ci.current===null&&(a=!0);var k=bt;if(bt=0,hi=null,nl(e,R,w,k),i&&el){_=0;break e}break;default:k=bt,bt=0,hi=null,nl(e,R,w,k)}}S1(),_=Jt;break}catch(J){I0(e,J)}while(!0);return a&&e.shellSuspendCounter++,qi=os=null,Tt=l,U.H=u,U.A=f,ut===null&&(Pt=null,dt=0,Cr()),_}function S1(){for(;ut!==null;)Y0(ut)}function T1(e,a){var i=Tt;Tt|=2;var l=F0(),u=H0();Pt!==e||dt!==a?(fo=null,ho=Ea()+500,il(e,a)):el=Kn(e,a);e:do try{if(bt!==0&&ut!==null){a=ut;var f=hi;t:switch(bt){case 1:bt=0,hi=null,nl(e,a,f,1);break;case 2:case 9:if($d(f)){bt=0,hi=null,G0(a);break}a=function(){bt!==2&&bt!==9||Pt!==e||(bt=7),Yi(e)},f.then(a,a);break e;case 3:bt=7;break e;case 4:bt=5;break e;case 7:$d(f)?(bt=0,hi=null,G0(a)):(bt=0,hi=null,nl(e,a,f,7));break;case 5:var _=null;switch(ut.tag){case 26:_=ut.memoizedState;case 5:case 27:var R=ut;if(_?Mg(_):R.stateNode.complete){bt=0,hi=null;var w=R.sibling;if(w!==null)ut=w;else{var k=R.return;k!==null?(ut=k,mo(k)):ut=null}break t}}bt=0,hi=null,nl(e,a,f,5);break;case 6:bt=0,hi=null,nl(e,a,f,6);break;case 8:Vu(),Jt=6;break e;default:throw Error(s(462))}}v1();break}catch(J){I0(e,J)}while(!0);return qi=os=null,U.H=l,U.A=u,Tt=i,ut!==null?0:(Pt=null,dt=0,Cr(),Jt)}function v1(){for(;ut!==null&&!Al();)Y0(ut)}function Y0(e){var a=c0(e.alternate,e,ln);e.memoizedProps=e.pendingProps,a===null?mo(e):ut=a}function G0(e){var a=e,i=a.alternate;switch(a.tag){case 15:case 0:a=i0(i,a,a.pendingProps,a.type,void 0,dt);break;case 11:a=i0(i,a,a.pendingProps,a.type.render,a.ref,dt);break;case 5:lu(a);default:h0(i,a),a=ut=Fd(a,ln),a=c0(i,a,ln)}e.memoizedProps=e.pendingProps,a===null?mo(e):ut=a}function nl(e,a,i,l){qi=os=null,lu(a),js=null,Fl=0;var u=a.return;try{if(h1(e,u,a,i,dt)){Jt=1,ao(e,_i(i,e.current)),ut=null;return}}catch(f){if(u!==null)throw ut=u,f;Jt=1,ao(e,_i(i,e.current)),ut=null;return}a.flags&32768?(pt||l===1?e=!0:el||(dt&536870912)!==0?e=!1:(On=e=!0,(l===2||l===9||l===3||l===6)&&(l=ci.current,l!==null&&l.tag===13&&(l.flags|=16384))),U0(a,e)):mo(a)}function mo(e){var a=e;do{if((a.flags&32768)!==0){U0(a,On);return}e=a.return;var i=g1(a.alternate,a,ln);if(i!==null){ut=i;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=e}while(a!==null);Jt===0&&(Jt=5)}function U0(e,a){do{var i=p1(e.alternate,e);if(i!==null){i.flags&=32767,ut=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!a&&(e=e.sibling,e!==null)){ut=e;return}ut=e=i}while(e!==null);Jt=6,ut=null}function z0(e,a,i,l,u,f,_,R,w){e.cancelPendingCommit=null;do yo();while(da!==0);if((Tt&6)!==0)throw Error(s(327));if(a!==null){if(a===e.current)throw Error(s(177));if(f=a.lanes|a.childLanes,f|=Pc,Ec(e,i,f,_,R,w),e===Pt&&(ut=Pt=null,dt=0),al=a,Dn=e,rn=i,Uu=f,zu=u,D0=l,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,x1(Ns,function(){return j0(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||l){l=U.T,U.T=null,u=se.p,se.p=2,_=Tt,Tt|=4;try{m1(e,a,i)}finally{Tt=_,se.p=u,U.T=l}}da=1,k0(),V0(),W0()}}function k0(){if(da===1){da=0;var e=Dn,a=al,i=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||i){i=U.T,U.T=null;var l=se.p;se.p=2;var u=Tt;Tt|=4;try{v0(a,e);var f=ih,_=Od(e.containerInfo),R=f.focusedElem,w=f.selectionRange;if(_!==R&&R&&R.ownerDocument&&xd(R.ownerDocument.documentElement,R)){if(w!==null&&Oc(R)){var k=w.start,J=w.end;if(J===void 0&&(J=k),"selectionStart"in R)R.selectionStart=k,R.selectionEnd=Math.min(J,R.value.length);else{var ne=R.ownerDocument||document,X=ne&&ne.defaultView||window;if(X.getSelection){var $=X.getSelection(),Re=R.textContent.length,Ge=Math.min(w.start,Re),wt=w.end===void 0?Ge:Math.min(w.end,Re);!$.extend&&Ge>wt&&(_=wt,wt=Ge,Ge=_);var H=bd(R,Ge),B=bd(R,wt);if(H&&B&&($.rangeCount!==1||$.anchorNode!==H.node||$.anchorOffset!==H.offset||$.focusNode!==B.node||$.focusOffset!==B.offset)){var z=ne.createRange();z.setStart(H.node,H.offset),$.removeAllRanges(),Ge>wt?($.addRange(z),$.extend(B.node,B.offset)):(z.setEnd(B.node,B.offset),$.addRange(z))}}}}for(ne=[],$=R;$=$.parentNode;)$.nodeType===1&&ne.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<ne.length;R++){var ae=ne[R];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}Lo=!!ah,ih=ah=null}finally{Tt=u,se.p=l,U.T=i}}e.current=a,da=2}}function V0(){if(da===2){da=0;var e=Dn,a=al,i=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||i){i=U.T,U.T=null;var l=se.p;se.p=2;var u=Tt;Tt|=4;try{E0(e,a.alternate,a)}finally{Tt=u,se.p=l,U.T=i}}da=3}}function W0(){if(da===4||da===3){da=0,Ls();var e=Dn,a=al,i=rn,l=D0;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?da=5:(da=0,al=Dn=null,X0(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(Nn=null),es(i),a=a.stateNode,Ba&&typeof Ba.onCommitFiberRoot=="function")try{Ba.onCommitFiberRoot(_a,a,void 0,(a.current.flags&128)===128)}catch{}if(l!==null){a=U.T,u=se.p,se.p=2,U.T=null;try{for(var f=e.onRecoverableError,_=0;_<l.length;_++){var R=l[_];f(R.value,{componentStack:R.stack})}}finally{U.T=a,se.p=u}}(rn&3)!==0&&yo(),Yi(e),u=e.pendingLanes,(i&261930)!==0&&(u&42)!==0?e===ku?er++:(er=0,ku=e):er=0,tr(0)}}function X0(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,Il(a)))}function yo(){return k0(),V0(),W0(),j0()}function j0(){if(da!==5)return!1;var e=Dn,a=Uu;Uu=0;var i=es(rn),l=U.T,u=se.p;try{se.p=32>i?32:i,U.T=null,i=zu,zu=null;var f=Dn,_=rn;if(da=0,al=Dn=null,rn=0,(Tt&6)!==0)throw Error(s(331));var R=Tt;if(Tt|=4,O0(f.current),M0(f,f.current,_,i),Tt=R,tr(0,!1),Ba&&typeof Ba.onPostCommitFiberRoot=="function")try{Ba.onPostCommitFiberRoot(_a,f)}catch{}return!0}finally{se.p=u,U.T=l,X0(e,a)}}function $0(e,a,i){a=_i(i,a),a=Su(e.stateNode,a,2),e=Rn(e,a,2),e!==null&&(Ci(e,2),Yi(e))}function xt(e,a,i){if(e.tag===3)$0(e,e,i);else for(;a!==null;){if(a.tag===3){$0(a,e,i);break}else if(a.tag===1){var l=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Nn===null||!Nn.has(l))){e=_i(i,e),i=qf(2),l=Rn(a,i,2),l!==null&&(Zf(i,l,a,e),Ci(l,2),Yi(l));break}}a=a.return}}function Xu(e,a,i){var l=e.pingCache;if(l===null){l=e.pingCache=new _1;var u=new Set;l.set(a,u)}else u=l.get(a),u===void 0&&(u=new Set,l.set(a,u));u.has(i)||(Hu=!0,u.add(i),e=R1.bind(null,e,a,i),a.then(e,e))}function R1(e,a,i){var l=e.pingCache;l!==null&&l.delete(a),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Pt===e&&(dt&i)===i&&(Jt===4||Jt===3&&(dt&62914560)===dt&&300>Ea()-uo?(Tt&2)===0&&il(e,0):Yu|=i,tl===dt&&(tl=0)),Yi(e)}function q0(e,a){a===0&&(a=Wi()),e=ss(e,a),e!==null&&(Ci(e,a),Yi(e))}function M1(e){var a=e.memoizedState,i=0;a!==null&&(i=a.retryLane),q0(e,i)}function b1(e,a){var i=0;switch(e.tag){case 31:case 13:var l=e.stateNode,u=e.memoizedState;u!==null&&(i=u.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(s(314))}l!==null&&l.delete(a),q0(e,i)}function x1(e,a){return fn(e,a)}var Eo=null,sl=null,ju=!1,_o=!1,$u=!1,Pn=0;function Yi(e){e!==sl&&e.next===null&&(sl===null?Eo=sl=e:sl=sl.next=e),_o=!0,ju||(ju=!0,L1())}function tr(e,a){if(!$u&&_o){$u=!0;do for(var i=!1,l=Eo;l!==null;){if(e!==0){var u=l.pendingLanes;if(u===0)var f=0;else{var _=l.suspendedLanes,R=l.pingedLanes;f=(1<<31-Fa(42|e)+1)-1,f&=u&~(_&~R),f=f&201326741?f&201326741|1:f?f|2:0}f!==0&&(i=!0,J0(l,f))}else f=dt,f=mn(l,l===Pt?f:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(f&3)===0||Kn(l,f)||(i=!0,J0(l,f));l=l.next}while(i);$u=!1}}function O1(){Z0()}function Z0(){_o=ju=!1;var e=0;Pn!==0&&Y1()&&(e=Pn);for(var a=Ea(),i=null,l=Eo;l!==null;){var u=l.next,f=K0(l,a);f===0?(l.next=null,i===null?Eo=u:i.next=u,u===null&&(sl=i)):(i=l,(e!==0||(f&3)!==0)&&(_o=!0)),l=u}da!==0&&da!==5||tr(e),Pn!==0&&(Pn=0)}function K0(e,a){for(var i=e.suspendedLanes,l=e.pingedLanes,u=e.expirationTimes,f=e.pendingLanes&-62914561;0<f;){var _=31-Fa(f),R=1<<_,w=u[_];w===-1?((R&i)===0||(R&l)!==0)&&(u[_]=vr(R,a)):w<=a&&(e.expiredLanes|=R),f&=~R}if(a=Pt,i=dt,i=mn(e,e===a?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,i===0||e===a&&(bt===2||bt===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&Ar(l),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||Kn(e,i)){if(a=i&-i,a===e.callbackPriority)return a;switch(l!==null&&Ar(l),es(i)){case 2:case 8:i=Sl;break;case 32:i=Ns;break;case 268435456:i=Tr;break;default:i=Ns}return l=Q0.bind(null,e),i=fn(i,l),e.callbackPriority=a,e.callbackNode=i,a}return l!==null&&l!==null&&Ar(l),e.callbackPriority=2,e.callbackNode=null,2}function Q0(e,a){if(da!==0&&da!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(yo()&&e.callbackNode!==i)return null;var l=dt;return l=mn(e,e===Pt?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(P0(e,l,a),K0(e,Ea()),e.callbackNode!=null&&e.callbackNode===i?Q0.bind(null,e):null)}function J0(e,a){if(yo())return null;P0(e,a,!0)}function L1(){U1(function(){(Tt&6)!==0?fn(Sr,O1):Z0()})}function qu(){if(Pn===0){var e=Vs;e===0&&(e=Wa,Wa<<=1,(Wa&261888)===0&&(Wa=256)),Pn=e}return Pn}function eg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ya(""+e)}function tg(e,a){var i=a.ownerDocument.createElement("input");return i.name=a.name,i.value=a.value,e.id&&i.setAttribute("form",e.id),a.parentNode.insertBefore(i,a),e=new FormData(e),i.parentNode.removeChild(i),e}function N1(e,a,i,l,u){if(a==="submit"&&i&&i.stateNode===u){var f=eg((u[p]||null).action),_=l.submitter;_&&(a=(a=_[p]||null)?eg(a.formAction):_.getAttribute("formAction"),a!==null&&(f=a,_=null));var R=new Nr("action","action",null,l,u);e.push({event:R,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Pn!==0){var w=_?tg(u,_):new FormData(u);pu(i,{pending:!0,data:w,method:u.method,action:f},null,w)}}else typeof f=="function"&&(R.preventDefault(),w=_?tg(u,_):new FormData(u),pu(i,{pending:!0,data:w,method:u.method,action:f},f,w))},currentTarget:u}]})}}for(var Zu=0;Zu<wc.length;Zu++){var Ku=wc[Zu],D1=Ku.toLowerCase(),w1=Ku[0].toUpperCase()+Ku.slice(1);Li(D1,"on"+w1)}Li(Dd,"onAnimationEnd"),Li(wd,"onAnimationIteration"),Li(Pd,"onAnimationStart"),Li("dblclick","onDoubleClick"),Li("focusin","onFocus"),Li("focusout","onBlur"),Li($m,"onTransitionRun"),Li(qm,"onTransitionStart"),Li(Zm,"onTransitionCancel"),Li(Cd,"onTransitionEnd"),sa("onMouseEnter",["mouseout","mouseover"]),sa("onMouseLeave",["mouseout","mouseover"]),sa("onPointerEnter",["pointerout","pointerover"]),sa("onPointerLeave",["pointerout","pointerover"]),Yt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Yt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Yt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Yt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Yt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Yt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ar="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ar));function ag(e,a){a=(a&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],u=l.event;l=l.listeners;e:{var f=void 0;if(a)for(var _=l.length-1;0<=_;_--){var R=l[_],w=R.instance,k=R.currentTarget;if(R=R.listener,w!==f&&u.isPropagationStopped())break e;f=R,u.currentTarget=k;try{f(u)}catch(J){Pr(J)}u.currentTarget=null,f=w}else for(_=0;_<l.length;_++){if(R=l[_],w=R.instance,k=R.currentTarget,R=R.listener,w!==f&&u.isPropagationStopped())break e;f=R,u.currentTarget=k;try{f(u)}catch(J){Pr(J)}u.currentTarget=null,f=w}}}}function ht(e,a){var i=a[ct];i===void 0&&(i=a[ct]=new Set);var l=e+"__bubble";i.has(l)||(ig(a,e,2,!1),i.add(l))}function Qu(e,a,i){var l=0;a&&(l|=4),ig(i,e,l,a)}var Ao="_reactListening"+Math.random().toString(36).slice(2);function Ju(e){if(!e[Ao]){e[Ao]=!0,li.forEach(function(i){i!=="selectionchange"&&(P1.has(i)||Qu(i,!1,e),Qu(i,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[Ao]||(a[Ao]=!0,Qu("selectionchange",!1,a))}}function ig(e,a,i,l){switch(wg(a)){case 2:var u=ry;break;case 8:u=oy;break;default:u=gh}i=u.bind(null,a,i,e),u=void 0,!_c||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(u=!0),l?u!==void 0?e.addEventListener(a,i,{capture:!0,passive:u}):e.addEventListener(a,i,!0):u!==void 0?e.addEventListener(a,i,{passive:u}):e.addEventListener(a,i,!1)}function eh(e,a,i,l,u){var f=l;if((a&1)===0&&(a&2)===0&&l!==null)e:for(;;){if(l===null)return;var _=l.tag;if(_===3||_===4){var R=l.stateNode.containerInfo;if(R===u)break;if(_===4)for(_=l.return;_!==null;){var w=_.tag;if((w===3||w===4)&&_.stateNode.containerInfo===u)return;_=_.return}for(;R!==null;){if(_=Ft(R),_===null)return;if(w=_.tag,w===5||w===6||w===26||w===27){l=f=_;continue e}R=R.parentNode}}l=l.return}br(function(){var k=f,J=Ut(i),ne=[];e:{var X=Id.get(e);if(X!==void 0){var $=Nr,Re=e;switch(e){case"keypress":if(Or(i)===0)break e;case"keydown":case"keyup":$=bm;break;case"focusin":Re="focus",$=vc;break;case"focusout":Re="blur",$=vc;break;case"beforeblur":case"afterblur":$=vc;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=ud;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=gm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=Lm;break;case Dd:case wd:case Pd:$=ym;break;case Cd:$=Dm;break;case"scroll":case"scrollend":$=dm;break;case"wheel":$=Pm;break;case"copy":case"cut":case"paste":$=_m;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=dd;break;case"toggle":case"beforetoggle":$=Im}var Ge=(a&4)!==0,wt=!Ge&&(e==="scroll"||e==="scrollend"),H=Ge?X!==null?X+"Capture":null:X;Ge=[];for(var B=k,z;B!==null;){var ae=B;if(z=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||z===null||H===null||(ae=ts(B,H),ae!=null&&Ge.push(ir(B,ae,z))),wt)break;B=B.return}0<Ge.length&&(X=new $(X,Re,null,i,J),ne.push({event:X,listeners:Ge}))}}if((a&7)===0){e:{if(X=e==="mouseover"||e==="pointerover",$=e==="mouseout"||e==="pointerout",X&&i!==St&&(Re=i.relatedTarget||i.fromElement)&&(Ft(Re)||Re[Ae]))break e;if(($||X)&&(X=J.window===J?J:(X=J.ownerDocument)?X.defaultView||X.parentWindow:window,$?(Re=i.relatedTarget||i.toElement,$=k,Re=Re?Ft(Re):null,Re!==null&&(wt=c(Re),Ge=Re.tag,Re!==wt||Ge!==5&&Ge!==27&&Ge!==6)&&(Re=null)):($=null,Re=k),$!==Re)){if(Ge=ud,ae="onMouseLeave",H="onMouseEnter",B="mouse",(e==="pointerout"||e==="pointerover")&&(Ge=dd,ae="onPointerLeave",H="onPointerEnter",B="pointer"),wt=$==null?X:Ht($),z=Re==null?X:Ht(Re),X=new Ge(ae,B+"leave",$,i,J),X.target=wt,X.relatedTarget=z,ae=null,Ft(J)===k&&(Ge=new Ge(H,B+"enter",Re,i,J),Ge.target=z,Ge.relatedTarget=wt,ae=Ge),wt=ae,$&&Re)t:{for(Ge=C1,H=$,B=Re,z=0,ae=H;ae;ae=Ge(ae))z++;ae=0;for(var we=B;we;we=Ge(we))ae++;for(;0<z-ae;)H=Ge(H),z--;for(;0<ae-z;)B=Ge(B),ae--;for(;z--;){if(H===B||B!==null&&H===B.alternate){Ge=H;break t}H=Ge(H),B=Ge(B)}Ge=null}else Ge=null;$!==null&&ng(ne,X,$,Ge,!1),Re!==null&&wt!==null&&ng(ne,wt,Re,Ge,!0)}}e:{if(X=k?Ht(k):window,$=X.nodeName&&X.nodeName.toLowerCase(),$==="select"||$==="input"&&X.type==="file")var Et=Ad;else if(Ed(X))if(Sd)Et=Wm;else{Et=km;var Oe=zm}else $=X.nodeName,!$||$.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?k&&ha(k.elementType)&&(Et=Ad):Et=Vm;if(Et&&(Et=Et(e,k))){_d(ne,Et,i,J);break e}Oe&&Oe(e,X,k),e==="focusout"&&k&&X.type==="number"&&k.memoizedProps.value!=null&&Se(X,"number",X.value)}switch(Oe=k?Ht(k):window,e){case"focusin":(Ed(Oe)||Oe.contentEditable==="true")&&(Bs=Oe,Lc=k,wl=null);break;case"focusout":wl=Lc=Bs=null;break;case"mousedown":Nc=!0;break;case"contextmenu":case"mouseup":case"dragend":Nc=!1,Ld(ne,i,J);break;case"selectionchange":if(jm)break;case"keydown":case"keyup":Ld(ne,i,J)}var nt;if(Mc)e:{switch(e){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else Is?md(e,i)&&(ft="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ft="onCompositionStart");ft&&(fd&&i.locale!=="ko"&&(Is||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&Is&&(nt=od()):(yn=J,Ac="value"in yn?yn.value:yn.textContent,Is=!0)),Oe=So(k,ft),0<Oe.length&&(ft=new hd(ft,e,null,i,J),ne.push({event:ft,listeners:Oe}),nt?ft.data=nt:(nt=yd(i),nt!==null&&(ft.data=nt)))),(nt=Fm?Hm(e,i):Ym(e,i))&&(ft=So(k,"onBeforeInput"),0<ft.length&&(Oe=new hd("onBeforeInput","beforeinput",null,i,J),ne.push({event:Oe,listeners:ft}),Oe.data=nt)),N1(ne,e,k,i,J)}ag(ne,a)})}function ir(e,a,i){return{instance:e,listener:a,currentTarget:i}}function So(e,a){for(var i=a+"Capture",l=[];e!==null;){var u=e,f=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||f===null||(u=ts(e,i),u!=null&&l.unshift(ir(e,u,f)),u=ts(e,a),u!=null&&l.push(ir(e,u,f))),e.tag===3)return l;e=e.return}return[]}function C1(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function ng(e,a,i,l,u){for(var f=a._reactName,_=[];i!==null&&i!==l;){var R=i,w=R.alternate,k=R.stateNode;if(R=R.tag,w!==null&&w===l)break;R!==5&&R!==26&&R!==27||k===null||(w=k,u?(k=ts(i,f),k!=null&&_.unshift(ir(i,k,w))):u||(k=ts(i,f),k!=null&&_.push(ir(i,k,w)))),i=i.return}_.length!==0&&e.push({event:a,listeners:_})}var I1=/\r\n?/g,B1=/\u0000|\uFFFD/g;function sg(e){return(typeof e=="string"?e:""+e).replace(I1,`
`).replace(B1,"")}function lg(e,a){return a=sg(a),sg(e)===a}function Dt(e,a,i,l,u,f){switch(i){case"children":typeof l=="string"?a==="body"||a==="textarea"&&l===""||$e(e,l):(typeof l=="number"||typeof l=="bigint")&&a!=="body"&&$e(e,""+l);break;case"className":He(e,"class",l);break;case"tabIndex":He(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":He(e,i,l);break;case"style":Gt(e,l,f);break;case"data":if(a!=="object"){He(e,"data",l);break}case"src":case"href":if(l===""&&(a!=="a"||i!=="href")){e.removeAttribute(i);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Ya(""+l),e.setAttribute(i,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof f=="function"&&(i==="formAction"?(a!=="input"&&Dt(e,a,"name",u.name,u,null),Dt(e,a,"formEncType",u.formEncType,u,null),Dt(e,a,"formMethod",u.formMethod,u,null),Dt(e,a,"formTarget",u.formTarget,u,null)):(Dt(e,a,"encType",u.encType,u,null),Dt(e,a,"method",u.method,u,null),Dt(e,a,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(i);break}l=Ya(""+l),e.setAttribute(i,l);break;case"onClick":l!=null&&(e.onclick=La);break;case"onScroll":l!=null&&ht("scroll",e);break;case"onScrollEnd":l!=null&&ht("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(i=l.__html,i!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}i=Ya(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""+l):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":l===!0?e.setAttribute(i,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(i,l):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(i,l):e.removeAttribute(i);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(i):e.setAttribute(i,l);break;case"popover":ht("beforetoggle",e),ht("toggle",e),Fe(e,"popover",l);break;case"xlinkActuate":Me(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Me(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Me(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Me(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Me(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Me(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Me(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Me(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Me(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Fe(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Kt.get(i)||i,Fe(e,i,l))}}function th(e,a,i,l,u,f){switch(i){case"style":Gt(e,l,f);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(i=l.__html,i!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"children":typeof l=="string"?$e(e,l):(typeof l=="number"||typeof l=="bigint")&&$e(e,""+l);break;case"onScroll":l!=null&&ht("scroll",e);break;case"onScrollEnd":l!=null&&ht("scrollend",e);break;case"onClick":l!=null&&(e.onclick=La);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xa.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(u=i.endsWith("Capture"),a=i.slice(2,u?i.length-7:void 0),f=e[p]||null,f=f!=null?f[i]:null,typeof f=="function"&&e.removeEventListener(a,f,u),typeof l=="function")){typeof f!="function"&&f!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(a,l,u);break e}i in e?e[i]=l:l===!0?e.setAttribute(i,""):Fe(e,i,l)}}}function va(e,a,i){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ht("error",e),ht("load",e);var l=!1,u=!1,f;for(f in i)if(i.hasOwnProperty(f)){var _=i[f];if(_!=null)switch(f){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:Dt(e,a,f,_,i,null)}}u&&Dt(e,a,"srcSet",i.srcSet,i,null),l&&Dt(e,a,"src",i.src,i,null);return;case"input":ht("invalid",e);var R=f=_=u=null,w=null,k=null;for(l in i)if(i.hasOwnProperty(l)){var J=i[l];if(J!=null)switch(l){case"name":u=J;break;case"type":_=J;break;case"checked":w=J;break;case"defaultChecked":k=J;break;case"value":f=J;break;case"defaultValue":R=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,a));break;default:Dt(e,a,l,J,i,null)}}he(e,f,R,w,k,_,u,!1);return;case"select":ht("invalid",e),l=_=f=null;for(u in i)if(i.hasOwnProperty(u)&&(R=i[u],R!=null))switch(u){case"value":f=R;break;case"defaultValue":_=R;break;case"multiple":l=R;default:Dt(e,a,u,R,i,null)}a=f,i=_,e.multiple=!!l,a!=null?Ne(e,!!l,a,!1):i!=null&&Ne(e,!!l,i,!0);return;case"textarea":ht("invalid",e),f=u=l=null;for(_ in i)if(i.hasOwnProperty(_)&&(R=i[_],R!=null))switch(_){case"value":l=R;break;case"defaultValue":u=R;break;case"children":f=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(s(91));break;default:Dt(e,a,_,R,i,null)}Pe(e,l,u,f);return;case"option":for(w in i)if(i.hasOwnProperty(w)&&(l=i[w],l!=null))switch(w){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Dt(e,a,w,l,i,null)}return;case"dialog":ht("beforetoggle",e),ht("toggle",e),ht("cancel",e),ht("close",e);break;case"iframe":case"object":ht("load",e);break;case"video":case"audio":for(l=0;l<ar.length;l++)ht(ar[l],e);break;case"image":ht("error",e),ht("load",e);break;case"details":ht("toggle",e);break;case"embed":case"source":case"link":ht("error",e),ht("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(k in i)if(i.hasOwnProperty(k)&&(l=i[k],l!=null))switch(k){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:Dt(e,a,k,l,i,null)}return;default:if(ha(a)){for(J in i)i.hasOwnProperty(J)&&(l=i[J],l!==void 0&&th(e,a,J,l,i,void 0));return}}for(R in i)i.hasOwnProperty(R)&&(l=i[R],l!=null&&Dt(e,a,R,l,i,null))}function F1(e,a,i,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,f=null,_=null,R=null,w=null,k=null,J=null;for($ in i){var ne=i[$];if(i.hasOwnProperty($)&&ne!=null)switch($){case"checked":break;case"value":break;case"defaultValue":w=ne;default:l.hasOwnProperty($)||Dt(e,a,$,null,l,ne)}}for(var X in l){var $=l[X];if(ne=i[X],l.hasOwnProperty(X)&&($!=null||ne!=null))switch(X){case"type":f=$;break;case"name":u=$;break;case"checked":k=$;break;case"defaultChecked":J=$;break;case"value":_=$;break;case"defaultValue":R=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(s(137,a));break;default:$!==ne&&Dt(e,a,X,$,l,ne)}}oe(e,_,R,w,k,J,f,u);return;case"select":$=_=R=X=null;for(f in i)if(w=i[f],i.hasOwnProperty(f)&&w!=null)switch(f){case"value":break;case"multiple":$=w;default:l.hasOwnProperty(f)||Dt(e,a,f,null,l,w)}for(u in l)if(f=l[u],w=i[u],l.hasOwnProperty(u)&&(f!=null||w!=null))switch(u){case"value":X=f;break;case"defaultValue":R=f;break;case"multiple":_=f;default:f!==w&&Dt(e,a,u,f,l,w)}a=R,i=_,l=$,X!=null?Ne(e,!!i,X,!1):!!l!=!!i&&(a!=null?Ne(e,!!i,a,!0):Ne(e,!!i,i?[]:"",!1));return;case"textarea":$=X=null;for(R in i)if(u=i[R],i.hasOwnProperty(R)&&u!=null&&!l.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Dt(e,a,R,null,l,u)}for(_ in l)if(u=l[_],f=i[_],l.hasOwnProperty(_)&&(u!=null||f!=null))switch(_){case"value":X=u;break;case"defaultValue":$=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(s(91));break;default:u!==f&&Dt(e,a,_,u,l,f)}Ye(e,X,$);return;case"option":for(var Re in i)if(X=i[Re],i.hasOwnProperty(Re)&&X!=null&&!l.hasOwnProperty(Re))switch(Re){case"selected":e.selected=!1;break;default:Dt(e,a,Re,null,l,X)}for(w in l)if(X=l[w],$=i[w],l.hasOwnProperty(w)&&X!==$&&(X!=null||$!=null))switch(w){case"selected":e.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:Dt(e,a,w,X,l,$)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in i)X=i[Ge],i.hasOwnProperty(Ge)&&X!=null&&!l.hasOwnProperty(Ge)&&Dt(e,a,Ge,null,l,X);for(k in l)if(X=l[k],$=i[k],l.hasOwnProperty(k)&&X!==$&&(X!=null||$!=null))switch(k){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(s(137,a));break;default:Dt(e,a,k,X,l,$)}return;default:if(ha(a)){for(var wt in i)X=i[wt],i.hasOwnProperty(wt)&&X!==void 0&&!l.hasOwnProperty(wt)&&th(e,a,wt,void 0,l,X);for(J in l)X=l[J],$=i[J],!l.hasOwnProperty(J)||X===$||X===void 0&&$===void 0||th(e,a,J,X,l,$);return}}for(var H in i)X=i[H],i.hasOwnProperty(H)&&X!=null&&!l.hasOwnProperty(H)&&Dt(e,a,H,null,l,X);for(ne in l)X=l[ne],$=i[ne],!l.hasOwnProperty(ne)||X===$||X==null&&$==null||Dt(e,a,ne,X,l,$)}function rg(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function H1(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,i=performance.getEntriesByType("resource"),l=0;l<i.length;l++){var u=i[l],f=u.transferSize,_=u.initiatorType,R=u.duration;if(f&&R&&rg(_)){for(_=0,R=u.responseEnd,l+=1;l<i.length;l++){var w=i[l],k=w.startTime;if(k>R)break;var J=w.transferSize,ne=w.initiatorType;J&&rg(ne)&&(w=w.responseEnd,_+=J*(w<R?1:(R-k)/(w-k)))}if(--l,a+=8*(f+_)/(u.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var ah=null,ih=null;function To(e){return e.nodeType===9?e:e.ownerDocument}function og(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cg(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function nh(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var sh=null;function Y1(){var e=window.event;return e&&e.type==="popstate"?e===sh?!1:(sh=e,!0):(sh=null,!1)}var ug=typeof setTimeout=="function"?setTimeout:void 0,G1=typeof clearTimeout=="function"?clearTimeout:void 0,hg=typeof Promise=="function"?Promise:void 0,U1=typeof queueMicrotask=="function"?queueMicrotask:typeof hg<"u"?function(e){return hg.resolve(null).then(e).catch(z1)}:ug;function z1(e){setTimeout(function(){throw e})}function Cn(e){return e==="head"}function dg(e,a){var i=a,l=0;do{var u=i.nextSibling;if(e.removeChild(i),u&&u.nodeType===8)if(i=u.data,i==="/$"||i==="/&"){if(l===0){e.removeChild(u),cl(a);return}l--}else if(i==="$"||i==="$?"||i==="$~"||i==="$!"||i==="&")l++;else if(i==="html")nr(e.ownerDocument.documentElement);else if(i==="head"){i=e.ownerDocument.head,nr(i);for(var f=i.firstChild;f;){var _=f.nextSibling,R=f.nodeName;f[Lt]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&f.rel.toLowerCase()==="stylesheet"||i.removeChild(f),f=_}}else i==="body"&&nr(e.ownerDocument.body);i=u}while(i);cl(a)}function fg(e,a){var i=e;e=0;do{var l=i.nextSibling;if(i.nodeType===1?a?(i._stashedDisplay=i.style.display,i.style.display="none"):(i.style.display=i._stashedDisplay||"",i.getAttribute("style")===""&&i.removeAttribute("style")):i.nodeType===3&&(a?(i._stashedText=i.nodeValue,i.nodeValue=""):i.nodeValue=i._stashedText||""),l&&l.nodeType===8)if(i=l.data,i==="/$"){if(e===0)break;e--}else i!=="$"&&i!=="$?"&&i!=="$~"&&i!=="$!"||e++;i=l}while(i)}function lh(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var i=a;switch(a=a.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":lh(i),$t(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function k1(e,a,i,l){for(;e.nodeType===1;){var u=i;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Lt])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(f=e.getAttribute("rel"),f==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(f!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(f=e.getAttribute("src"),(f!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&f&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var f=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===f)return e}else return e;if(e=Ri(e.nextSibling),e===null)break}return null}function V1(e,a,i){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Ri(e.nextSibling),e===null))return null;return e}function gg(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Ri(e.nextSibling),e===null))return null;return e}function rh(e){return e.data==="$?"||e.data==="$~"}function oh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function W1(e,a){var i=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||i.readyState!=="loading")a();else{var l=function(){a(),i.removeEventListener("DOMContentLoaded",l)};i.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Ri(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var ch=null;function pg(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"||i==="/&"){if(a===0)return Ri(e.nextSibling);a--}else i!=="$"&&i!=="$!"&&i!=="$?"&&i!=="$~"&&i!=="&"||a++}e=e.nextSibling}return null}function mg(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"){if(a===0)return e;a--}else i!=="/$"&&i!=="/&"||a++}e=e.previousSibling}return null}function yg(e,a,i){switch(a=To(i),e){case"html":if(e=a.documentElement,!e)throw Error(s(452));return e;case"head":if(e=a.head,!e)throw Error(s(453));return e;case"body":if(e=a.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function nr(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);$t(e)}var Mi=new Map,Eg=new Set;function vo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var on=se.d;se.d={f:X1,r:j1,D:$1,C:q1,L:Z1,m:K1,X:J1,S:Q1,M:ey};function X1(){var e=on.f(),a=go();return e||a}function j1(e){var a=It(e);a!==null&&a.tag===5&&a.type==="form"?If(a):on.r(e)}var ll=typeof document>"u"?null:document;function _g(e,a,i){var l=ll;if(l&&typeof a=="string"&&a){var u=ie(a);u='link[rel="'+e+'"][href="'+u+'"]',typeof i=="string"&&(u+='[crossorigin="'+i+'"]'),Eg.has(u)||(Eg.add(u),e={rel:e,crossOrigin:i,href:a},l.querySelector(u)===null&&(a=l.createElement("link"),va(a,"link",e),We(a),l.head.appendChild(a)))}}function $1(e){on.D(e),_g("dns-prefetch",e,null)}function q1(e,a){on.C(e,a),_g("preconnect",e,a)}function Z1(e,a,i){on.L(e,a,i);var l=ll;if(l&&e&&a){var u='link[rel="preload"][as="'+ie(a)+'"]';a==="image"&&i&&i.imageSrcSet?(u+='[imagesrcset="'+ie(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(u+='[imagesizes="'+ie(i.imageSizes)+'"]')):u+='[href="'+ie(e)+'"]';var f=u;switch(a){case"style":f=rl(e);break;case"script":f=ol(e)}Mi.has(f)||(e=E({rel:"preload",href:a==="image"&&i&&i.imageSrcSet?void 0:e,as:a},i),Mi.set(f,e),l.querySelector(u)!==null||a==="style"&&l.querySelector(sr(f))||a==="script"&&l.querySelector(lr(f))||(a=l.createElement("link"),va(a,"link",e),We(a),l.head.appendChild(a)))}}function K1(e,a){on.m(e,a);var i=ll;if(i&&e){var l=a&&typeof a.as=="string"?a.as:"script",u='link[rel="modulepreload"][as="'+ie(l)+'"][href="'+ie(e)+'"]',f=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":f=ol(e)}if(!Mi.has(f)&&(e=E({rel:"modulepreload",href:e},a),Mi.set(f,e),i.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(lr(f)))return}l=i.createElement("link"),va(l,"link",e),We(l),i.head.appendChild(l)}}}function Q1(e,a,i){on.S(e,a,i);var l=ll;if(l&&e){var u=qe(l).hoistableStyles,f=rl(e);a=a||"default";var _=u.get(f);if(!_){var R={loading:0,preload:null};if(_=l.querySelector(sr(f)))R.loading=5;else{e=E({rel:"stylesheet",href:e,"data-precedence":a},i),(i=Mi.get(f))&&uh(e,i);var w=_=l.createElement("link");We(w),va(w,"link",e),w._p=new Promise(function(k,J){w.onload=k,w.onerror=J}),w.addEventListener("load",function(){R.loading|=1}),w.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Ro(_,a,l)}_={type:"stylesheet",instance:_,count:1,state:R},u.set(f,_)}}}function J1(e,a){on.X(e,a);var i=ll;if(i&&e){var l=qe(i).hoistableScripts,u=ol(e),f=l.get(u);f||(f=i.querySelector(lr(u)),f||(e=E({src:e,async:!0},a),(a=Mi.get(u))&&hh(e,a),f=i.createElement("script"),We(f),va(f,"link",e),i.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},l.set(u,f))}}function ey(e,a){on.M(e,a);var i=ll;if(i&&e){var l=qe(i).hoistableScripts,u=ol(e),f=l.get(u);f||(f=i.querySelector(lr(u)),f||(e=E({src:e,async:!0,type:"module"},a),(a=Mi.get(u))&&hh(e,a),f=i.createElement("script"),We(f),va(f,"link",e),i.head.appendChild(f)),f={type:"script",instance:f,count:1,state:null},l.set(u,f))}}function Ag(e,a,i,l){var u=(u=K.current)?vo(u):null;if(!u)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(a=rl(i.href),i=qe(u).hoistableStyles,l=i.get(a),l||(l={type:"style",instance:null,count:0,state:null},i.set(a,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=rl(i.href);var f=qe(u).hoistableStyles,_=f.get(e);if(_||(u=u.ownerDocument||u,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},f.set(e,_),(f=u.querySelector(sr(e)))&&!f._p&&(_.instance=f,_.state.loading=5),Mi.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},Mi.set(e,i),f||ty(u,e,i,_.state))),a&&l===null)throw Error(s(528,""));return _}if(a&&l!==null)throw Error(s(529,""));return null;case"script":return a=i.async,i=i.src,typeof i=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=ol(i),i=qe(u).hoistableScripts,l=i.get(a),l||(l={type:"script",instance:null,count:0,state:null},i.set(a,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function rl(e){return'href="'+ie(e)+'"'}function sr(e){return'link[rel="stylesheet"]['+e+"]"}function Sg(e){return E({},e,{"data-precedence":e.precedence,precedence:null})}function ty(e,a,i,l){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?l.loading=1:(a=e.createElement("link"),l.preload=a,a.addEventListener("load",function(){return l.loading|=1}),a.addEventListener("error",function(){return l.loading|=2}),va(a,"link",i),We(a),e.head.appendChild(a))}function ol(e){return'[src="'+ie(e)+'"]'}function lr(e){return"script[async]"+e}function Tg(e,a,i){if(a.count++,a.instance===null)switch(a.type){case"style":var l=e.querySelector('style[data-href~="'+ie(i.href)+'"]');if(l)return a.instance=l,We(l),l;var u=E({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),We(l),va(l,"style",u),Ro(l,i.precedence,e),a.instance=l;case"stylesheet":u=rl(i.href);var f=e.querySelector(sr(u));if(f)return a.state.loading|=4,a.instance=f,We(f),f;l=Sg(i),(u=Mi.get(u))&&uh(l,u),f=(e.ownerDocument||e).createElement("link"),We(f);var _=f;return _._p=new Promise(function(R,w){_.onload=R,_.onerror=w}),va(f,"link",l),a.state.loading|=4,Ro(f,i.precedence,e),a.instance=f;case"script":return f=ol(i.src),(u=e.querySelector(lr(f)))?(a.instance=u,We(u),u):(l=i,(u=Mi.get(f))&&(l=E({},i),hh(l,u)),e=e.ownerDocument||e,u=e.createElement("script"),We(u),va(u,"link",l),e.head.appendChild(u),a.instance=u);case"void":return null;default:throw Error(s(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(l=a.instance,a.state.loading|=4,Ro(l,i.precedence,e));return a.instance}function Ro(e,a,i){for(var l=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,f=u,_=0;_<l.length;_++){var R=l[_];if(R.dataset.precedence===a)f=R;else if(f!==u)break}f?f.parentNode.insertBefore(e,f.nextSibling):(a=i.nodeType===9?i.head:i,a.insertBefore(e,a.firstChild))}function uh(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function hh(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var Mo=null;function vg(e,a,i){if(Mo===null){var l=new Map,u=Mo=new Map;u.set(i,l)}else u=Mo,l=u.get(i),l||(l=new Map,u.set(i,l));if(l.has(e))return l;for(l.set(e,null),i=i.getElementsByTagName(e),u=0;u<i.length;u++){var f=i[u];if(!(f[Lt]||f[F]||e==="link"&&f.getAttribute("rel")==="stylesheet")&&f.namespaceURI!=="http://www.w3.org/2000/svg"){var _=f.getAttribute(a)||"";_=e+_;var R=l.get(_);R?R.push(f):l.set(_,[f])}}return l}function Rg(e,a,i){e=e.ownerDocument||e,e.head.insertBefore(i,a==="title"?e.querySelector("head > title"):null)}function ay(e,a,i){if(i===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Mg(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function iy(e,a,i,l){if(i.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var u=rl(l.href),f=a.querySelector(sr(u));if(f){a=f._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=bo.bind(e),a.then(e,e)),i.state.loading|=4,i.instance=f,We(f);return}f=a.ownerDocument||a,l=Sg(l),(u=Mi.get(u))&&uh(l,u),f=f.createElement("link"),We(f);var _=f;_._p=new Promise(function(R,w){_.onload=R,_.onerror=w}),va(f,"link",l),i.instance=f}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(i,a),(a=i.state.preload)&&(i.state.loading&3)===0&&(e.count++,i=bo.bind(e),a.addEventListener("load",i),a.addEventListener("error",i))}}var dh=0;function ny(e,a){return e.stylesheets&&e.count===0&&Oo(e,e.stylesheets),0<e.count||0<e.imgCount?function(i){var l=setTimeout(function(){if(e.stylesheets&&Oo(e,e.stylesheets),e.unsuspend){var f=e.unsuspend;e.unsuspend=null,f()}},6e4+a);0<e.imgBytes&&dh===0&&(dh=62500*H1());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Oo(e,e.stylesheets),e.unsuspend)){var f=e.unsuspend;e.unsuspend=null,f()}},(e.imgBytes>dh?50:800)+a);return e.unsuspend=i,function(){e.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function bo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Oo(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var xo=null;function Oo(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,xo=new Map,a.forEach(sy,e),xo=null,bo.call(e))}function sy(e,a){if(!(a.state.loading&4)){var i=xo.get(e);if(i)var l=i.get(null);else{i=new Map,xo.set(e,i);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<u.length;f++){var _=u[f];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(i.set(_.dataset.precedence,_),l=_)}l&&i.set(null,l)}u=a.instance,_=u.getAttribute("data-precedence"),f=i.get(_)||l,f===l&&i.set(null,u),i.set(_,u),this.count++,l=bo.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),f?f.parentNode.insertBefore(u,f.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),a.state.loading|=4}}var rr={$$typeof:I,Provider:null,Consumer:null,_currentValue:_e,_currentValue2:_e,_threadCount:0};function ly(e,a,i,l,u,f,_,R,w){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qn(0),this.hiddenUpdates=Qn(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=f,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=w,this.incompleteTransitions=new Map}function bg(e,a,i,l,u,f,_,R,w,k,J,ne){return e=new ly(e,a,i,_,w,k,J,ne,R),a=1,f===!0&&(a|=24),f=oi(3,null,null,a),e.current=f,f.stateNode=e,a=Wc(),a.refCount++,e.pooledCache=a,a.refCount++,f.memoizedState={element:l,isDehydrated:i,cache:a},qc(f),e}function xg(e){return e?(e=Ys,e):Ys}function Og(e,a,i,l,u,f){u=xg(u),l.context===null?l.context=u:l.pendingContext=u,l=vn(a),l.payload={element:i},f=f===void 0?null:f,f!==null&&(l.callback=f),i=Rn(e,l,a),i!==null&&(Qa(i,e,a),Yl(i,e,a))}function Lg(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<a?i:a}}function fh(e,a){Lg(e,a),(e=e.alternate)&&Lg(e,a)}function Ng(e){if(e.tag===13||e.tag===31){var a=ss(e,67108864);a!==null&&Qa(a,e,67108864),fh(e,67108864)}}function Dg(e){if(e.tag===13||e.tag===31){var a=fi();a=Jn(a);var i=ss(e,a);i!==null&&Qa(i,e,a),fh(e,a)}}var Lo=!0;function ry(e,a,i,l){var u=U.T;U.T=null;var f=se.p;try{se.p=2,gh(e,a,i,l)}finally{se.p=f,U.T=u}}function oy(e,a,i,l){var u=U.T;U.T=null;var f=se.p;try{se.p=8,gh(e,a,i,l)}finally{se.p=f,U.T=u}}function gh(e,a,i,l){if(Lo){var u=ph(l);if(u===null)eh(e,a,l,No,i),Pg(e,l);else if(uy(u,e,a,i,l))l.stopPropagation();else if(Pg(e,l),a&4&&-1<cy.indexOf(e)){for(;u!==null;){var f=It(u);if(f!==null)switch(f.tag){case 3:if(f=f.stateNode,f.current.memoizedState.isDehydrated){var _=Oi(f.pendingLanes);if(_!==0){var R=f;for(R.pendingLanes|=2,R.entangledLanes|=2;_;){var w=1<<31-Fa(_);R.entanglements[1]|=w,_&=~w}Yi(f),(Tt&6)===0&&(ho=Ea()+500,tr(0))}}break;case 31:case 13:R=ss(f,2),R!==null&&Qa(R,f,2),go(),fh(f,2)}if(f=ph(l),f===null&&eh(e,a,l,No,i),f===u)break;u=f}u!==null&&l.stopPropagation()}else eh(e,a,l,null,i)}}function ph(e){return e=Ut(e),mh(e)}var No=null;function mh(e){if(No=null,e=Ft(e),e!==null){var a=c(e);if(a===null)e=null;else{var i=a.tag;if(i===13){if(e=h(a),e!==null)return e;e=null}else if(i===31){if(e=d(a),e!==null)return e;e=null}else if(i===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return No=e,null}function wg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pc()){case Sr:return 2;case Sl:return 8;case Ns:case mc:return 32;case Tr:return 268435456;default:return 32}default:return 32}}var yh=!1,In=null,Bn=null,Fn=null,or=new Map,cr=new Map,Hn=[],cy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pg(e,a){switch(e){case"focusin":case"focusout":In=null;break;case"dragenter":case"dragleave":Bn=null;break;case"mouseover":case"mouseout":Fn=null;break;case"pointerover":case"pointerout":or.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":cr.delete(a.pointerId)}}function ur(e,a,i,l,u,f){return e===null||e.nativeEvent!==f?(e={blockedOn:a,domEventName:i,eventSystemFlags:l,nativeEvent:f,targetContainers:[u]},a!==null&&(a=It(a),a!==null&&Ng(a)),e):(e.eventSystemFlags|=l,a=e.targetContainers,u!==null&&a.indexOf(u)===-1&&a.push(u),e)}function uy(e,a,i,l,u){switch(a){case"focusin":return In=ur(In,e,a,i,l,u),!0;case"dragenter":return Bn=ur(Bn,e,a,i,l,u),!0;case"mouseover":return Fn=ur(Fn,e,a,i,l,u),!0;case"pointerover":var f=u.pointerId;return or.set(f,ur(or.get(f)||null,e,a,i,l,u)),!0;case"gotpointercapture":return f=u.pointerId,cr.set(f,ur(cr.get(f)||null,e,a,i,l,u)),!0}return!1}function Cg(e){var a=Ft(e.target);if(a!==null){var i=c(a);if(i!==null){if(a=i.tag,a===13){if(a=h(i),a!==null){e.blockedOn=a,Cs(e.priority,function(){Dg(i)});return}}else if(a===31){if(a=d(i),a!==null){e.blockedOn=a,Cs(e.priority,function(){Dg(i)});return}}else if(a===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Do(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var i=ph(e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);St=l,i.target.dispatchEvent(l),St=null}else return a=It(i),a!==null&&Ng(a),e.blockedOn=i,!1;a.shift()}return!0}function Ig(e,a,i){Do(e)&&i.delete(a)}function hy(){yh=!1,In!==null&&Do(In)&&(In=null),Bn!==null&&Do(Bn)&&(Bn=null),Fn!==null&&Do(Fn)&&(Fn=null),or.forEach(Ig),cr.forEach(Ig)}function wo(e,a){e.blockedOn===a&&(e.blockedOn=null,yh||(yh=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,hy)))}var Po=null;function Bg(e){Po!==e&&(Po=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Po===e&&(Po=null);for(var a=0;a<e.length;a+=3){var i=e[a],l=e[a+1],u=e[a+2];if(typeof l!="function"){if(mh(l||i)===null)continue;break}var f=It(i);f!==null&&(e.splice(a,3),a-=3,pu(f,{pending:!0,data:u,method:i.method,action:l},l,u))}}))}function cl(e){function a(w){return wo(w,e)}In!==null&&wo(In,e),Bn!==null&&wo(Bn,e),Fn!==null&&wo(Fn,e),or.forEach(a),cr.forEach(a);for(var i=0;i<Hn.length;i++){var l=Hn[i];l.blockedOn===e&&(l.blockedOn=null)}for(;0<Hn.length&&(i=Hn[0],i.blockedOn===null);)Cg(i),i.blockedOn===null&&Hn.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(l=0;l<i.length;l+=3){var u=i[l],f=i[l+1],_=u[p]||null;if(typeof f=="function")_||Bg(i);else if(_){var R=null;if(f&&f.hasAttribute("formAction")){if(u=f,_=f[p]||null)R=_.formAction;else if(mh(u)!==null)continue}else R=_.action;typeof R=="function"?i[l+1]=R:(i.splice(l,3),l-=3),Bg(i)}}}function Fg(){function e(f){f.canIntercept&&f.info==="react-transition"&&f.intercept({handler:function(){return new Promise(function(_){return u=_})},focusReset:"manual",scroll:"manual"})}function a(){u!==null&&(u(),u=null),l||setTimeout(i,20)}function i(){if(!l&&!navigation.transition){var f=navigation.currentEntry;f&&f.url!=null&&navigation.navigate(f.url,{state:f.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(i,100),function(){l=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),u!==null&&(u(),u=null)}}}function Eh(e){this._internalRoot=e}Co.prototype.render=Eh.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(s(409));var i=a.current,l=fi();Og(i,l,e,a,null,null)},Co.prototype.unmount=Eh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;Og(e.current,2,null,e,null,null),go(),a[Ae]=null}};function Co(e){this._internalRoot=e}Co.prototype.unstable_scheduleHydration=function(e){if(e){var a=Ps();e={blockedOn:null,target:e,priority:a};for(var i=0;i<Hn.length&&a!==0&&a<Hn[i].priority;i++);Hn.splice(i,0,e),i===0&&Cg(e)}};var Hg=t.version;if(Hg!=="19.2.0")throw Error(s(527,Hg,"19.2.0"));se.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=m(a),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var dy={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Io=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Io.isDisabled&&Io.supportsFiber)try{_a=Io.inject(dy),Ba=Io}catch{}}return dr.createRoot=function(e,a){if(!r(e))throw Error(s(299));var i=!1,l="",u=Wf,f=Xf,_=jf;return a!=null&&(a.unstable_strictMode===!0&&(i=!0),a.identifierPrefix!==void 0&&(l=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(f=a.onCaughtError),a.onRecoverableError!==void 0&&(_=a.onRecoverableError)),a=bg(e,1,!1,null,null,i,l,null,u,f,_,Fg),e[Ae]=a.current,Ju(e),new Eh(a)},dr.hydrateRoot=function(e,a,i){if(!r(e))throw Error(s(299));var l=!1,u="",f=Wf,_=Xf,R=jf,w=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(f=i.onUncaughtError),i.onCaughtError!==void 0&&(_=i.onCaughtError),i.onRecoverableError!==void 0&&(R=i.onRecoverableError),i.formState!==void 0&&(w=i.formState)),a=bg(e,1,!0,a,i??null,l,u,w,f,_,R,Fg),a.context=xg(null),i=a.current,l=fi(),l=Jn(l),u=vn(l),u.callback=null,Rn(i,u,l),i=l,a.current.lanes=i,Ci(a,i),Yi(a),e[Ae]=a.current,Ju(e),new Co(a)},dr.version="19.2.0",dr}var $g;function vy(){if($g)return Sh.exports;$g=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(t){console.error(t)}}return o(),Sh.exports=Ty(),Sh.exports}var Ry=vy();const My=Vp(Ry),by="modulepreload",xy=function(o){return"/play-wwii-sky-ace/"+o},qg={},Wt=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){let h=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=h(n.map(m=>{if(m=xy(m),m in qg)return;qg[m]=!0;const y=m.endsWith(".css"),E=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${E}`))return;const A=document.createElement("link");if(A.rel=y?"stylesheet":by,y||(A.as="script"),A.crossOrigin="",A.href=m,g&&A.setAttribute("nonce",g),document.head.appendChild(A),y)return new Promise((v,b)=>{A.addEventListener("load",v),A.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function c(h){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=h,window.dispatchEvent(d),!d.defaultPrevented)throw h}return r.then(h=>{for(const d of h||[])d.status==="rejected"&&c(d.reason);return t().catch(c)})},ke=(o,t={})=>({type:o,params:{speedMultiplier:1,amplitude:1,frequency:.03,trackingStrength:0,phaseShift:0,...t}}),Ve=(o,t)=>({type:o,params:{bulletCount:3,spreadAngle:.3,fireRate:30,bulletSpeed:1,aimAtPlayer:!0,...t}}),Ko={SCOUT_WING:{variantId:"SCOUT_WING",displayName:"SCOUT WING",subtitle:"Reconnaissance Unit",spriteKey:"bossScoutWing",baseBossType:"ACE_SQUADRON",hpMultiplier:.75,size:{width:180,height:180},phases:[{hpThreshold:1,movementPattern:ke("sine",{speedMultiplier:.7,frequency:.02}),attackPattern:Ve("spread",{bulletCount:3,spreadAngle:.25,fireRate:40}),fireRateMultiplier:.8,speedMultiplier:.7},{hpThreshold:.5,movementPattern:ke("sine",{speedMultiplier:.9,frequency:.03}),attackPattern:Ve("spread",{bulletCount:4,spreadAngle:.3,fireRate:35}),fireRateMultiplier:.9,speedMultiplier:.9}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{}},PATROL_FORTRESS:{variantId:"PATROL_FORTRESS",displayName:"PATROL FORTRESS",subtitle:"Defensive Outpost",spriteKey:"bossPatrolFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:.8,size:{width:220,height:220},phases:[{hpThreshold:1,movementPattern:ke("sweep",{speedMultiplier:.6}),attackPattern:Ve("spread",{bulletCount:2,spreadAngle:.2,fireRate:50}),fireRateMultiplier:.7,speedMultiplier:.6},{hpThreshold:.4,movementPattern:ke("sweep",{speedMultiplier:.8}),attackPattern:Ve("spread",{bulletCount:3,spreadAngle:.3,fireRate:40}),fireRateMultiplier:.85,speedMultiplier:.8}],turretConfig:{count:2,fireRateMultiplier:.8,hpMultiplier:.8},specialMechanics:{}},COASTAL_CRUISER:{variantId:"COASTAL_CRUISER",displayName:"COASTAL CRUISER",subtitle:"Naval Patrol",spriteKey:"bossCoastalCruiser",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:.85,size:{width:200,height:260},phases:[{hpThreshold:1,movementPattern:ke("erratic",{speedMultiplier:.5}),attackPattern:Ve("spread",{bulletCount:3,spreadAngle:.35,fireRate:55}),fireRateMultiplier:.75,speedMultiplier:.5},{hpThreshold:.6,movementPattern:ke("erratic",{speedMultiplier:.7}),attackPattern:Ve("barrage",{bulletCount:4,spreadAngle:.3,fireRate:45,burstCount:2,burstDelay:8}),fireRateMultiplier:.85,speedMultiplier:.7},{hpThreshold:.3,movementPattern:ke("erratic",{speedMultiplier:.9}),attackPattern:Ve("barrage",{bulletCount:5,spreadAngle:.35,fireRate:40,burstCount:3,burstDelay:6}),fireRateMultiplier:.95,speedMultiplier:.9}],turretConfig:{count:3,fireRateMultiplier:.85,hpMultiplier:.85},specialMechanics:{}},RECON_AIRSHIP:{variantId:"RECON_AIRSHIP",displayName:"RECON AIRSHIP",subtitle:"Scout Carrier",spriteKey:"bossReconAirship",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:.9,size:{width:230,height:200},phases:[{hpThreshold:1,movementPattern:ke("figure8",{speedMultiplier:.8}),attackPattern:Ve("spread",{bulletCount:4,spreadAngle:.3,fireRate:45}),fireRateMultiplier:.85,speedMultiplier:.8},{hpThreshold:.4,movementPattern:ke("figure8",{speedMultiplier:1}),attackPattern:Ve("spiral",{bulletCount:5,spreadAngle:.4,fireRate:35,spiralSpeed:.04}),fireRateMultiplier:.95,speedMultiplier:1}],turretConfig:{count:2,fireRateMultiplier:.9,hpMultiplier:.9},specialMechanics:{hasMinions:!0,minionSpawnRate:300,minionCount:2}},PROTOTYPE_WEAPON:{variantId:"PROTOTYPE_WEAPON",displayName:"PROTOTYPE WEAPON",subtitle:"Experimental Unit",spriteKey:"bossPrototypeWeapon",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:.95,size:{width:260,height:260},phases:[{hpThreshold:1,movementPattern:ke("sine",{speedMultiplier:.7}),attackPattern:Ve("spiral",{bulletCount:4,spreadAngle:.5,fireRate:50,spiralSpeed:.03}),fireRateMultiplier:.8,speedMultiplier:.7},{hpThreshold:.6,movementPattern:ke("sine",{speedMultiplier:.9}),attackPattern:Ve("spiral",{bulletCount:5,spreadAngle:.6,fireRate:40,spiralSpeed:.04}),fireRateMultiplier:.9,speedMultiplier:.9},{hpThreshold:.3,movementPattern:ke("aggressive",{speedMultiplier:1,trackingStrength:.3}),attackPattern:Ve("mixed",{bulletCount:5,spreadAngle:.5,fireRate:35}),fireRateMultiplier:1,speedMultiplier:1}],turretConfig:{count:3,fireRateMultiplier:.9,hpMultiplier:.9},specialMechanics:{hasFlareSpray:!0,flareSprayInterval:300,flareDuration:90,flareDeflectRadius:120}},ACE_VETERANS:{variantId:"ACE_VETERANS",displayName:"ACE VETERANS",subtitle:"Elite Squadron",spriteKey:"bossAceVeterans",baseBossType:"ACE_SQUADRON",hpMultiplier:1,size:{width:195,height:195},phases:[{hpThreshold:1,movementPattern:ke("sine",{speedMultiplier:1}),attackPattern:Ve("spread",{bulletCount:4,spreadAngle:.3,fireRate:30}),fireRateMultiplier:1,speedMultiplier:1},{hpThreshold:.6,movementPattern:ke("sine",{speedMultiplier:1.2,frequency:.04}),attackPattern:Ve("spiral",{bulletCount:5,spreadAngle:.4,fireRate:25,spiralSpeed:.05}),fireRateMultiplier:1.1,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:ke("aggressive",{speedMultiplier:1.4,trackingStrength:.4}),attackPattern:Ve("spiral",{bulletCount:6,spreadAngle:.5,fireRate:20,spiralSpeed:.06}),fireRateMultiplier:1.2,speedMultiplier:1.4}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.5,enrageFireRateBoost:1.25}},IRON_FORTRESS:{variantId:"IRON_FORTRESS",displayName:"IRON FORTRESS",subtitle:"Armored Bastion",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.05,size:{width:234,height:234},phases:[{hpThreshold:1,movementPattern:ke("sweep",{speedMultiplier:.8}),attackPattern:Ve("mixed",{bulletCount:4,spreadAngle:.35,fireRate:40}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.5,movementPattern:ke("sweep",{speedMultiplier:1}),attackPattern:Ve("barrage",{bulletCount:5,spreadAngle:.4,fireRate:30,burstCount:3,burstDelay:5}),fireRateMultiplier:1.1,speedMultiplier:1}],turretConfig:{count:4,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{}},DREADNOUGHT:{variantId:"DREADNOUGHT",displayName:"DREADNOUGHT",subtitle:"Assault Cruiser",spriteKey:"bossDreadnought",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.1,size:{width:195,height:273},phases:[{hpThreshold:1,movementPattern:ke("aggressive",{speedMultiplier:.8,trackingStrength:.3}),attackPattern:Ve("barrage",{bulletCount:4,spreadAngle:.3,fireRate:45,burstCount:3,burstDelay:6}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.6,movementPattern:ke("aggressive",{speedMultiplier:1,trackingStrength:.4}),attackPattern:Ve("barrage",{bulletCount:5,spreadAngle:.35,fireRate:35,burstCount:4,burstDelay:5}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.3,movementPattern:ke("aggressive",{speedMultiplier:1.3,trackingStrength:.5}),attackPattern:Ve("barrage",{bulletCount:6,spreadAngle:.4,fireRate:28,burstCount:5,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.3}],turretConfig:{count:5,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.4,enrageFireRateBoost:1.2}},DREADNOUGHT_ELITE:{variantId:"DREADNOUGHT_ELITE",displayName:"DREADNOUGHT ELITE",subtitle:"Command Vessel",spriteKey:"bossDreadnoughtElite",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.15,size:{width:210,height:290},phases:[{hpThreshold:1,movementPattern:ke("aggressive",{speedMultiplier:.9,trackingStrength:.35}),attackPattern:Ve("barrage",{bulletCount:5,spreadAngle:.35,fireRate:40,burstCount:4,burstDelay:5}),fireRateMultiplier:1.05,speedMultiplier:.9},{hpThreshold:.6,movementPattern:ke("aggressive",{speedMultiplier:1.1,trackingStrength:.45}),attackPattern:Ve("mixed",{bulletCount:6,spreadAngle:.4,fireRate:32}),fireRateMultiplier:1.15,speedMultiplier:1.1},{hpThreshold:.3,movementPattern:ke("chase",{speedMultiplier:1.4,trackingStrength:.55}),attackPattern:Ve("barrage",{bulletCount:7,spreadAngle:.45,fireRate:25,burstCount:5,burstDelay:4}),fireRateMultiplier:1.3,speedMultiplier:1.4}],turretConfig:{count:6,fireRateMultiplier:1.1,hpMultiplier:1.1},specialMechanics:{hasArmorPlating:!0,armorPlateCount:2,armorPlateHP:35,hasSmokeScreen:!0,smokeScreenInterval:420,smokeScreenDuration:120}},STORM_CARRIER:{variantId:"STORM_CARRIER",displayName:"STORM CARRIER",subtitle:"Fighter Bay",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.1,size:{width:234,height:195},phases:[{hpThreshold:1,movementPattern:ke("orbit",{speedMultiplier:.9,amplitude:.8}),attackPattern:Ve("mixed",{bulletCount:4,spreadAngle:.35,fireRate:45}),fireRateMultiplier:1,speedMultiplier:.9},{hpThreshold:.5,movementPattern:ke("orbit",{speedMultiplier:1.1,amplitude:1}),attackPattern:Ve("missiles",{bulletCount:3,spreadAngle:.5,fireRate:60,aimAtPlayer:!0}),fireRateMultiplier:1.1,speedMultiplier:1.1}],turretConfig:{count:3,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasMinions:!0,minionSpawnRate:180,minionCount:4}},JUGGERNAUT:{variantId:"JUGGERNAUT",displayName:"JUGGERNAUT",subtitle:"Super Weapon",spriteKey:"bossJuggernaut",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:1.2,size:{width:273,height:273},phases:[{hpThreshold:1,movementPattern:ke("sine",{speedMultiplier:.8}),attackPattern:Ve("spiral",{bulletCount:5,spreadAngle:.6,fireRate:50,spiralSpeed:.04}),fireRateMultiplier:1,speedMultiplier:.8},{hpThreshold:.7,movementPattern:ke("aggressive",{speedMultiplier:1,trackingStrength:.4}),attackPattern:Ve("mixed",{bulletCount:6,spreadAngle:.5,fireRate:40}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.5,movementPattern:ke("chase",{speedMultiplier:1.2,trackingStrength:.5}),attackPattern:Ve("spiral",{bulletCount:6,spreadAngle:.7,fireRate:35,spiralSpeed:.05}),fireRateMultiplier:1.2,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:ke("chase",{speedMultiplier:1.4,trackingStrength:.6}),attackPattern:Ve("barrage",{bulletCount:7,spreadAngle:.5,fireRate:28,burstCount:4,burstDelay:4}),fireRateMultiplier:1.35,speedMultiplier:1.4}],turretConfig:{count:5,fireRateMultiplier:1.1,hpMultiplier:1.1},specialMechanics:{hasArmorPlating:!0,armorPlateCount:3,armorPlateHP:40,hasFlareSpray:!0,flareSprayInterval:240,flareDuration:75,flareDeflectRadius:150,hasMinions:!0,minionSpawnRate:240,minionCount:3}},DEATH_SQUADRON:{variantId:"DEATH_SQUADRON",displayName:"DEATH SQUADRON",subtitle:"Hunter-Killer",spriteKey:"bossDeathSquadron",baseBossType:"ACE_SQUADRON",hpMultiplier:1.1,size:{width:195,height:195},phases:[{hpThreshold:1,movementPattern:ke("chase",{speedMultiplier:1.1,trackingStrength:.45}),attackPattern:Ve("aimed",{bulletCount:2,spreadAngle:.1,fireRate:25,bulletSpeed:1.2}),fireRateMultiplier:1.1,speedMultiplier:1.1},{hpThreshold:.6,movementPattern:ke("chase",{speedMultiplier:1.3,trackingStrength:.55}),attackPattern:Ve("aimed",{bulletCount:2,spreadAngle:.15,fireRate:20,bulletSpeed:1.3}),fireRateMultiplier:1.25,speedMultiplier:1.3},{hpThreshold:.3,movementPattern:ke("chase",{speedMultiplier:1.5,trackingStrength:.65}),attackPattern:Ve("mixed",{bulletCount:3,spreadAngle:.2,fireRate:18,bulletSpeed:1.4}),fireRateMultiplier:1.4,speedMultiplier:1.5}],turretConfig:{count:0,fireRateMultiplier:1,hpMultiplier:1},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.6,enrageFireRateBoost:1.3,hasMinions:!0,minionSpawnRate:240,minionCount:2}},SKY_FORTRESS:{variantId:"SKY_FORTRESS",displayName:"SKY FORTRESS",subtitle:"Aerial Stronghold",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.15,size:{width:234,height:234},phases:[{hpThreshold:1,movementPattern:ke("orbit",{speedMultiplier:1,amplitude:.9}),attackPattern:Ve("mixed",{bulletCount:3,spreadAngle:.4,fireRate:35}),fireRateMultiplier:1.1,speedMultiplier:1},{hpThreshold:.5,movementPattern:ke("aggressive",{speedMultiplier:1.2,trackingStrength:.45}),attackPattern:Ve("barrage",{bulletCount:4,spreadAngle:.45,fireRate:28,burstCount:4,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.2}],turretConfig:{count:4,fireRateMultiplier:1.15,hpMultiplier:1.1},specialMechanics:{hasSmokeScreen:!0,smokeScreenInterval:360,smokeScreenDuration:100,hasFlareSpray:!0,flareSprayInterval:270,flareDuration:60,flareDeflectRadius:100}},SKY_FORTRESS_OMEGA:{variantId:"SKY_FORTRESS_OMEGA",displayName:"SKY FORTRESS OMEGA",subtitle:"Command Citadel",spriteKey:"bossIronFortress",baseBossType:"FLYING_FORTRESS",hpMultiplier:1.25,size:{width:250,height:250},phases:[{hpThreshold:1,movementPattern:ke("aggressive",{speedMultiplier:1.1,trackingStrength:.5}),attackPattern:Ve("spiral",{bulletCount:3,spreadAngle:.5,fireRate:35,spiralSpeed:.05}),fireRateMultiplier:1.15,speedMultiplier:1.1},{hpThreshold:.5,movementPattern:ke("chase",{speedMultiplier:1.3,trackingStrength:.55}),attackPattern:Ve("mixed",{bulletCount:4,spreadAngle:.55,fireRate:28}),fireRateMultiplier:1.3,speedMultiplier:1.3}],turretConfig:{count:6,fireRateMultiplier:1.2,hpMultiplier:1.15},specialMechanics:{hasMinions:!0,minionSpawnRate:150,minionCount:4}},LEVIATHAN:{variantId:"LEVIATHAN",displayName:"LEVIATHAN",subtitle:"Sea Monster",spriteKey:"bossDreadnoughtElite",baseBossType:"SUPER_BATTLESHIP",hpMultiplier:1.3,size:{width:220,height:300},phases:[{hpThreshold:1,movementPattern:ke("orbit",{speedMultiplier:1,amplitude:1}),attackPattern:Ve("barrage",{bulletCount:3,spreadAngle:.4,fireRate:38,burstCount:4,burstDelay:5}),fireRateMultiplier:1.15,speedMultiplier:1},{hpThreshold:.6,movementPattern:ke("orbit",{speedMultiplier:1.2,amplitude:1.2}),attackPattern:Ve("barrage",{bulletCount:4,spreadAngle:.45,fireRate:30,burstCount:5,burstDelay:4}),fireRateMultiplier:1.25,speedMultiplier:1.2},{hpThreshold:.3,movementPattern:ke("aggressive",{speedMultiplier:1.4,trackingStrength:.5}),attackPattern:Ve("barrage",{bulletCount:4,spreadAngle:.5,fireRate:25,burstCount:6,burstDelay:3}),fireRateMultiplier:1.4,speedMultiplier:1.4}],turretConfig:{count:6,fireRateMultiplier:1.2,hpMultiplier:1.2},specialMechanics:{hasEnrage:!0,enrageThreshold:.3,enrageSpeedBoost:1.5,enrageFireRateBoost:1.3}},APOCALYPSE_CARRIER:{variantId:"APOCALYPSE_CARRIER",displayName:"APOCALYPSE CARRIER",subtitle:"Doom Bringer",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.25,size:{width:234,height:195},phases:[{hpThreshold:1,movementPattern:ke("figure8",{speedMultiplier:1.2,amplitude:1.1}),attackPattern:Ve("missiles",{bulletCount:1,spreadAngle:.6,fireRate:50,aimAtPlayer:!0}),fireRateMultiplier:1.15,speedMultiplier:1.2},{hpThreshold:.5,movementPattern:ke("aggressive",{speedMultiplier:1.4,trackingStrength:.4}),attackPattern:Ve("missiles",{bulletCount:2,spreadAngle:.7,fireRate:40,aimAtPlayer:!0}),fireRateMultiplier:1.3,speedMultiplier:1.4}],turretConfig:{count:3,fireRateMultiplier:1.15,hpMultiplier:1.15},specialMechanics:{hasMinions:!0,minionSpawnRate:120,minionCount:6}},APOCALYPSE_OMEGA:{variantId:"APOCALYPSE_OMEGA",displayName:"APOCALYPSE OMEGA",subtitle:"Final Carrier",spriteKey:"bossStormCarrier",baseBossType:"EXPERIMENTAL_AIRSHIP",hpMultiplier:1.35,size:{width:250,height:210},phases:[{hpThreshold:1,movementPattern:ke("orbit",{speedMultiplier:1.3,orbitSpeed:.02}),attackPattern:Ve("missiles",{bulletCount:2,spreadAngle:.65,fireRate:45,aimAtPlayer:!0}),fireRateMultiplier:1.2,speedMultiplier:1.3},{hpThreshold:.5,movementPattern:ke("chase",{speedMultiplier:1.5,trackingStrength:.45}),attackPattern:Ve("mixed",{bulletCount:2,spreadAngle:.7,fireRate:35}),fireRateMultiplier:1.35,speedMultiplier:1.5}],turretConfig:{count:4,fireRateMultiplier:1.2,hpMultiplier:1.2},specialMechanics:{hasArmorPlating:!0,armorPlateCount:2,armorPlateHP:45,hasFlareSpray:!0,flareSprayInterval:180,flareDuration:90,flareDeflectRadius:140,hasMinions:!0,minionSpawnRate:100,minionCount:8}},EXTINCTION_ENGINE:{variantId:"EXTINCTION_ENGINE",displayName:"EXTINCTION ENGINE",subtitle:"World Ender",spriteKey:"bossExtinctionEngine",baseBossType:"ULTIMATE_WEAPON",hpMultiplier:1.5,size:{width:300,height:300},phases:[{hpThreshold:1,movementPattern:ke("figure8",{speedMultiplier:1.1,amplitude:1}),attackPattern:Ve("spiral",{bulletCount:2,spreadAngle:.7,fireRate:45,spiralSpeed:.05}),fireRateMultiplier:1.1,speedMultiplier:1.1},{hpThreshold:.8,movementPattern:ke("orbit",{speedMultiplier:1.1,amplitude:1}),attackPattern:Ve("barrage",{bulletCount:2,spreadAngle:.5,fireRate:38,burstCount:4,burstDelay:4}),fireRateMultiplier:1.2,speedMultiplier:1.1},{hpThreshold:.6,movementPattern:ke("aggressive",{speedMultiplier:1.3,trackingStrength:.5}),attackPattern:Ve("mixed",{bulletCount:3,spreadAngle:.6,fireRate:32}),fireRateMultiplier:1.3,speedMultiplier:1.3},{hpThreshold:.4,movementPattern:ke("chase",{speedMultiplier:1.5,trackingStrength:.6}),attackPattern:Ve("spiral",{bulletCount:3,spreadAngle:.8,fireRate:28,spiralSpeed:.06}),fireRateMultiplier:1.4,speedMultiplier:1.5},{hpThreshold:.2,movementPattern:ke("chase",{speedMultiplier:1.7,trackingStrength:.7}),attackPattern:Ve("barrage",{bulletCount:3,spreadAngle:.6,fireRate:22,burstCount:6,burstDelay:3}),fireRateMultiplier:1.6,speedMultiplier:1.7}],turretConfig:{count:6,fireRateMultiplier:1.3,hpMultiplier:1.3},specialMechanics:{hasArmorPlating:!0,armorPlateCount:4,armorPlateHP:50,hasFlareSpray:!0,flareSprayInterval:150,flareDuration:100,flareDeflectRadius:180,hasSmokeScreen:!0,smokeScreenInterval:300,smokeScreenDuration:90,hasMinions:!0,minionSpawnRate:150,minionCount:4,hasEnrage:!0,enrageThreshold:.2,enrageSpeedBoost:1.7,enrageFireRateBoost:1.5}}},Oy={DAWN_PATROL:["SCOUT_WING","PATROL_FORTRESS","COASTAL_CRUISER","RECON_AIRSHIP","PROTOTYPE_WEAPON"],STEEL_VANGUARD:["ACE_VETERANS","IRON_FORTRESS","DREADNOUGHT","DREADNOUGHT_ELITE","STORM_CARRIER","JUGGERNAUT"],HELLFIRE_HORIZON:["DEATH_SQUADRON","SKY_FORTRESS","SKY_FORTRESS_OMEGA","LEVIATHAN","APOCALYPSE_CARRIER","APOCALYPSE_OMEGA","EXTINCTION_ENGINE"]};function Ly(o,t){const n=Oy[o];if(!n||t<1||t>n.length)return null;const s=n[t-1];return Ko[s]||null}var pe=(o=>(o.DAWN_PATROL="DAWN_PATROL",o.STEEL_VANGUARD="STEEL_VANGUARD",o.HELLFIRE_HORIZON="HELLFIRE_HORIZON",o))(pe||{});const Mh={DAWN_PATROL:{speed:.6,spawn:.63,fireRate:.63,bulletSpeed:.83,enemyHP:.41,bulletCount:.34},STEEL_VANGUARD:{speed:.68,spawn:.72,fireRate:.096,bulletSpeed:.92,enemyHP:.44,bulletCount:.39},HELLFIRE_HORIZON:{speed:.75,spawn:.71,fireRate:.094,bulletSpeed:.95,enemyHP:.39,bulletCount:.25}},Wn={DAWN_PATROL:{id:"DAWN_PATROL",displayName:"Dawn Patrol",subtitle:"Rookie Training",levelCount:5,baseMultiplier:Mh.DAWN_PATROL,levelProgression:[.85,.9,.95,1,1.05],storyText:["December 1941. The Pacific erupts in flames. You've been assigned to the carrier USS Wasp.","INTEL: Japanese forces fortifying island chains. Atolls crawling with enemy fighters.","OBJECTIVE: Clear the skies. Support beach landings. Push inland to the fortress.","From carrier deck to jungle canopy - this is the road to Tokyo.","PACIFIC INFERNO - Launch from the carrier!"],victoryText:["VICTORY! The island fortress has fallen. The Pacific campaign is secure. From carrier strikes to jungle warfare, you've proven yourself in every theater.","But Europe calls. Intelligence reports a massive industrial complex. Iron Sky Blitz needs aces like you. The bombing campaign awaits."],endingText:["The enemy fortress crumbles into the volcanic rock.","From coral atolls to jungle highlands - every island secured.","The Pacific sky belongs to the Allies.","The carriers sail home. You've earned your place among legends.","PACIFIC INFERNO COMPLETE - The Rising Sun sets!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,3,4,5]},STEEL_VANGUARD:{id:"STEEL_VANGUARD",displayName:"Steel Vanguard",subtitle:"Veterans Only",levelCount:6,baseMultiplier:Mh.STEEL_VANGUARD,levelProgression:[.85,.9,.95,1,1.05,1.1],storyText:["1944. The bombing campaign over Europe intensifies. Tonight, we hit the Reich's industrial heart.","INTEL: Six strategic targets - factories, refineries, rail yards. Heavy flak expected.","OBJECTIVE: Cripple enemy production. From dusk to midnight, we fly through the searchlights.","The twilight sky will burn with steel and fire.","IRON SKY BLITZ - All squadrons, form up!"],victoryText:["VICTORY! The industrial heartland lies in ruins. Refineries burn. Rail yards shattered. The Reich's war machine grinds to a halt.","But the desert war rages on. Rommel's Afrika Korps threatens our supply lines. Desert Thunder awaits - sandstorms and tank battles ahead."],endingText:["The searchlights fall silent. The factories burn.","Six strategic targets reduced to rubble and ash.","From dusk patrol to midnight bombing - victory in the European sky.","The Iron Sky belongs to us. The Reich trembles.","IRON SKY BLITZ COMPLETE - The darkness serves the brave!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","SUPER_BATTLESHIP","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,3,3,4,5]},HELLFIRE_HORIZON:{id:"HELLFIRE_HORIZON",displayName:"Hellfire Horizon",subtitle:"No Mercy",levelCount:7,baseMultiplier:Mh.HELLFIRE_HORIZON,levelProgression:[.85,.9,.95,1,1.05,1.12,1.2],storyText:["1942. North Africa. Rommel's Afrika Korps controls the desert. We're taking it back.","INTEL: Seven fortified positions from oasis outposts to the mountain fortress.","OBJECTIVE: Air superiority over the sand. Support our tanks. Destroy their oil supply.","Sandstorms are coming. Visibility will be zero. Trust your instruments.","DESERT THUNDER - Into the storm!"],victoryText:["VICTORY! The desert fortress has fallen. Rommel's supply lines are cut. From sandstorm to sandstorm, you've conquered the Afrika Korps.","The war is won. The desert thunder fades to silence. Legends will speak of the aces who ruled the burning sands. Welcome home, hero."],endingText:["The sandstorm clears. The fortress lies in ruins.","Seven positions destroyed. The Afrika Korps is broken.","Through blinding dust and burning oil - you prevailed.","The desert wind carries tales of your victory.","DESERT THUNDER COMPLETE - The sands remember the brave!"],bossSequence:["ACE_SQUADRON","FLYING_FORTRESS","FLYING_FORTRESS","SUPER_BATTLESHIP","EXPERIMENTAL_AIRSHIP","EXPERIMENTAL_AIRSHIP","ULTIMATE_WEAPON"],levelConfigs:[1,2,2,3,4,4,5]}};function ml(o){return Wn[o]}function nd(o){return Wn[o].levelCount}function Ny(o,t){const n=Wn[o];return t<1||t>n.levelCount?null:n.bossSequence[t-1]}function yr(o,t){const n=Wn[o],s=n.baseMultiplier,r=Math.min(Math.max(t-1,0),n.levelProgression.length-1),c=n.levelProgression[r];return{speed:s.speed*c,spawn:s.spawn*c,fireRate:s.fireRate*c,bulletSpeed:s.bulletSpeed*c,enemyHP:s.enemyHP*c,bulletCount:s.bulletCount*c}}function Zg(o,t){const c=["DAWN_PATROL","STEEL_VANGUARD","HELLFIRE_HORIZON"].indexOf(o),g=((c===0?0:c===1?5:11)+t-1)/17;return(1.1+(1.4-1.1)*g)*(o==="DAWN_PATROL"?1.4:o==="STEEL_VANGUARD"?1.2:1.1)}const Dy=["DAWN_PATROL","STEEL_VANGUARD","HELLFIRE_HORIZON"];function wy(o){return Wn[o].victoryText}const Ot={MAP_WIDTH:640,MAP_WIDTH_EXTENDED:960,PLAYER_PARALLAX_MAX:.15,SLICE_HEIGHT:1280,SLICE_COUNT:4,TILE_SIZE:64,TERRAIN_SCALE:2,get TERRAIN_IMAGE_WIDTH(){return this.MAP_WIDTH*this.TERRAIN_SCALE},get TERRAIN_IMAGE_WIDTH_EXTENDED(){return this.MAP_WIDTH_EXTENDED*this.TERRAIN_SCALE},get TERRAIN_IMAGE_HEIGHT(){return this.TOTAL_MAP_HEIGHT*this.TERRAIN_SCALE},get MAX_PARALLAX_OFFSET(){return(this.MAP_WIDTH_EXTENDED-this.MAP_WIDTH)/2},LEVEL_DURATION:1800,SCREEN_HEIGHT:960,get TOTAL_MAP_HEIGHT(){return this.SLICE_HEIGHT*this.SLICE_COUNT},get MAP_HEIGHT_TILES(){return this.TOTAL_MAP_HEIGHT/this.TILE_SIZE},get SCROLL_SPEED(){return(this.TOTAL_MAP_HEIGHT-this.SCREEN_HEIGHT)/this.LEVEL_DURATION},get TOTAL_SCROLL_DISTANCE(){return this.SCROLL_SPEED*this.LEVEL_DURATION},get SCROLL_BUFFER(){return this.TOTAL_MAP_HEIGHT-this.TOTAL_SCROLL_DISTANCE}};function oc(o,t=600){const n=t/2;return(o-n)/n*Ot.MAX_PARALLAX_OFFSET}function yl(o,t,n,s=600){const r=Math.floor((o-s)/2),c=r-t,h=n-r-s,d=Math.max(c,h,0);return Math.max(d,Ot.MAX_PARALLAX_OFFSET)}const Py={mapWidthExtended:960},Cy={DAWN_PATROL_1:{mapWidthExtended:960},DAWN_PATROL_2:{mapWidthExtended:960},DAWN_PATROL_3:{mapWidthExtended:1024},DAWN_PATROL_4:{mapWidthExtended:1024},DAWN_PATROL_5:{mapWidthExtended:780},STEEL_VANGUARD_1:{mapWidthExtended:960},STEEL_VANGUARD_2:{mapWidthExtended:960},STEEL_VANGUARD_3:{mapWidthExtended:960},STEEL_VANGUARD_4:{mapWidthExtended:960},STEEL_VANGUARD_5:{mapWidthExtended:960},STEEL_VANGUARD_6:{mapWidthExtended:960},HELLFIRE_HORIZON_1:{mapWidthExtended:960},HELLFIRE_HORIZON_2:{mapWidthExtended:960},HELLFIRE_HORIZON_3:{mapWidthExtended:960},HELLFIRE_HORIZON_4:{mapWidthExtended:960},HELLFIRE_HORIZON_5:{mapWidthExtended:960},HELLFIRE_HORIZON_6:{mapWidthExtended:960},HELLFIRE_HORIZON_7:{mapWidthExtended:960}};function ga(o,t){const n=`${o}_${t}`;return Cy[n]||Py}typeof window<"u"&&console.log("[TERRAIN_CONFIG] Loaded:",{slices:Ot.SLICE_COUNT,totalHeight:Ot.TOTAL_MAP_HEIGHT,scrollSpeed:Ot.SCROLL_SPEED.toFixed(3),scrollDistance:Ot.TOTAL_SCROLL_DISTANCE.toFixed(0),buffer:Ot.SCROLL_BUFFER.toFixed(0),maxParallaxOffset:Ot.MAX_PARALLAX_OFFSET});const Iy={};var By={};const xi=(typeof Iy<"u"?"false":By.VITE_DESIGN_TIME)==="true",P=600,Y=880,Fy=60,fr=6,Bo=12,Fo=3,bh=.8,xh=1.05,Oh=1,fa=Ot.SCROLL_SPEED,Kg=83,Hy=83,lt={WHITE:"#e8e6d9",RED:"#8b2e1f",ORANGE:"#d4743e",GREY:"#7a8085",YELLOW:"#c9a961",GREEN:"#4a5f3a"},Ra={LEFT:["ArrowLeft","a"],RIGHT:["ArrowRight","d"],UP:["ArrowUp","w"],DOWN:["ArrowDown","s"],FIRE:["z"," ","Control"],EVADE:["Alt"],BOMB:["b","v"],COIN:["5","c"],START:["1","Enter"]},ot={NORMAL:1,CALM_THRESHOLD:.15,MODERATE_THRESHOLD:.35,INTENSE_THRESHOLD:.6,CALM_ZOOM:1,MODERATE_ZOOM:1.15,INTENSE_ZOOM:1.3,EXTREME_ZOOM:1.5,CALM_TIMESCALE:1,MODERATE_TIMESCALE:.95,INTENSE_TIMESCALE:.85,EXTREME_TIMESCALE:.75,SMOOTH_DURATION:30,HYSTERESIS:.1,FAST_TRANSITION:15,ENEMY_WEIGHT:.3,BULLET_WEIGHT:.25,BOSS_WEIGHT:.2,HEALTH_WEIGHT:.15,COMBO_WEIGHT:.1,ENEMY_RADIUS:400,BULLET_RADIUS:350,MAX_ENEMIES_NORMALIZE:5,MAX_BULLETS_NORMALIZE:20,BOSS_VULNERABLE_ZOOM:1.3,BOSS_VULNERABLE_TIMESCALE:.7,BOSS_VULNERABLE_DURATION:180,NEAR_DEATH_ZOOM:1.25,NEAR_DEATH_TIMESCALE:.8,NEAR_DEATH_THRESHOLD:.2,NEAR_DEATH_RELEASE:.3,BULLET_HELL_ZOOM:1.3,BULLET_HELL_TIMESCALE:.75,BULLET_HELL_THRESHOLD:30,BULLET_HELL_RELEASE:20};var Ja=(o=>(o.CALM="CALM",o.MODERATE="MODERATE",o.INTENSE="INTENSE",o.EXTREME="EXTREME",o))(Ja||{}),wa=(o=>(o.NONE="NONE",o.BOSS_VULNERABLE="BOSS_VULNERABLE",o.NEAR_DEATH="NEAR_DEATH",o.BULLET_HELL="BULLET_HELL",o.BOSS_INTRO="BOSS_INTRO",o.PLAYER_DEATH="PLAYER_DEATH",o.DIVE_BOMB="DIVE_BOMB",o.CLIMB_UP="CLIMB_UP",o.SEA_LEVEL_ATTACK="SEA_LEVEL_ATTACK",o.GROUND_ATTACK="GROUND_ATTACK",o))(wa||{});const ei={HIGH_ALTITUDE:1,LOW_ALTITUDE:1.15,SEA_LEVEL:1.35,DIVE_TRANSITION_FRAMES:45,CLIMB_TRANSITION_FRAMES:60,DIVE_TIME_SCALE:.85,CLIMB_TIME_SCALE:.95,DIVE_ROTATION_MAX:-.08,DIVE_SHAKE_INTENSITY:3,SEA_ATTACK_MULTIPLIER:2,GROUND_ATTACK_MULTIPLIER:1.5,PARALLAX_SEA_LEVEL:.3};var jt=(o=>(o.COLD="COLD",o.WARM="WARM",o.HOT="HOT",o.ON_FIRE="ON_FIRE",o.BLAZING="BLAZING",o))(jt||{});const Es={THRESHOLDS:{WARM:5,HOT:15,ON_FIRE:30,BLAZING:50},MULTIPLIERS:{COLD:1,WARM:1.25,HOT:1.5,ON_FIRE:2,BLAZING:3},HEAT_PER_KILL:1,HEAT_PER_COMBO_POINT:.5,HEAT_PER_TARGET:2,DECAY_DELAY:180,DECAY_PER_FRAME:.5/60},Yy=[{score:5e4,bonus:5e3,label:"50K BONUS!"},{score:1e5,bonus:1e4,label:"100K JACKPOT!"},{score:25e4,bonus:25e3,label:"QUARTER MILLION!"},{score:5e5,bonus:5e4,label:"HALF MILLION!"},{score:1e6,bonus:1e5,label:"MILLIONAIRE!"}],Gy=[{combo:3,bonus:500,label:"NICE!"},{combo:5,bonus:1e3,label:"SUPER COMBO!"},{combo:8,bonus:5e3,label:"MEGA COMBO!"},{combo:10,bonus:1e4,label:"UNSTOPPABLE!"},{combo:15,bonus:25e3,label:"LEGENDARY!"}],Rt={VILLAGE:{width:160,height:120,hp:50,score:1e3},FORTRESS:{width:200,height:200,hp:200,score:5e3},AA_EMPLACEMENT:{width:64,height:64,hp:30,score:500,turretFireRate:45},RADAR_STATION:{width:80,height:80,hp:40,score:750},FUEL_DEPOT:{width:100,height:80,hp:25,score:600},AIRFIELD:{width:300,height:150,hp:100,score:3e3},SUPPLY_CONVOY:{width:120,height:40,hp:35,score:400}},ua={AIRCRAFT_CARRIER:{width:180,height:400,hp:300,score:1e4},DESTROYER:{width:100,height:250,hp:120,score:4e3},SUPPLY_SHIP:{width:80,height:180,hp:80,score:2e3},SUBMARINE:{width:60,height:150,hp:60,score:1500},PT_BOAT:{width:50,height:80,hp:20,score:300}},ai={JOYSTICK_DEAD_ZONE:.2,JOYSTICK_MAX_DISTANCE:150,DOUBLE_TAP_WINDOW:300,DOUBLE_TAP_DISTANCE:50,CIRCLE_MIN_POINTS:8,CIRCLE_MIN_ANGLE:270,CIRCLE_MIN_RADIUS:25,CIRCLE_MAX_RADIUS:80,CIRCLE_MAX_DURATION:1e3,CIRCLE_SAMPLE_INTERVAL:16},At={DROP_DURATION:60,INITIAL_FORWARD_FRAMES:23,COOLDOWN:60,MAX_BOMBS:9,TIERS:{1:{radius:200,damage:120,clusters:0,name:"Standard"},2:{radius:240,damage:160,clusters:3,name:"Heavy"},3:{radius:280,damage:220,clusters:6,name:"Cluster"},4:{radius:340,damage:320,clusters:9,name:"Mega"}},CLUSTER_SPREAD_BASE:60,CLUSTER_SPREAD_PER_TIER:20,CLUSTER_DELAY_FRAMES:3,CLUSTER_DAMAGE_RATIO:.25,CLUSTER_RADIUS:60,INITIAL_VELOCITY:-3,INITIAL_SCALE:1.4,SHRINK_FACTOR:.7,SHADOW_MAX_ALPHA:.4,SCREEN_SHAKE_BASE:30,SCREEN_SHAKE_PER_TIER:10,SCREEN_SHAKE_ROTATION:.03,TIER_THRESHOLDS:{HEAVY:3,CLUSTER:5,MEGA:7}},pi={BULLETS_PER_POWERUP:75,MAX_STACKS:4,TIERS:{1:{bullets:4,damageMultiplier:1,name:"Standard",offsets:[-15,15,-30,30]},2:{bullets:6,damageMultiplier:2,name:"Enhanced",offsets:[-10,10,-25,25,-40,40]}},TIER_THRESHOLDS:{ENHANCED:3},ENHANCED_CHANCE:{BEGINNER:0,NORMAL:.3,VETERAN:.6}},Ho={BASE_SIZE:64,CANNON_SIZE:105,COLLISION_RADIUS:32,SCALE_FACTOR:1.3},Gn={WIDTH:4,HEIGHT:12,BASE_SPEED:7.5,DAMAGE:10,PARALLEL_OFFSET:8,BURST_DELAY:3,BURST_COUNT:2},qt=[{x:.65,y:-.65},{x:-.65,y:-.65},{x:-.65,y:.65},{x:.65,y:.65}],Wp={ACE_SQUADRON:{positions:qt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},FLYING_FORTRESS:{positions:qt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.14,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},SUPER_BATTLESHIP:{positions:qt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.12,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},EXPERIMENTAL_AIRSHIP:{positions:qt,bladeCount:6,bladeLength:22,bladeWidth:5,hubRadius:7,baseRotationSpeed:.13,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},ULTIMATE_WEAPON:{positions:qt,bladeCount:6,bladeLength:27,bladeWidth:6,hubRadius:8,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.5},SCOUT_WING:{positions:qt,bladeCount:4,bladeLength:14,bladeWidth:3,hubRadius:4,baseRotationSpeed:.18,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2},PATROL_FORTRESS:{positions:qt,bladeCount:4,bladeLength:16,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},COASTAL_CRUISER:{positions:qt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.14,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},RECON_AIRSHIP:{positions:qt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.16,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},PROTOTYPE_WEAPON:{positions:qt,bladeCount:4,bladeLength:19,bladeWidth:4,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},ACE_VETERANS:{positions:qt,bladeCount:4,bladeLength:17,bladeWidth:4,hubRadius:5,baseRotationSpeed:.15,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},IRON_FORTRESS:{positions:qt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.12,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:1.8},DREADNOUGHT:{positions:qt,bladeCount:6,bladeLength:20,bladeWidth:5,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2},DREADNOUGHT_ELITE:{positions:qt,bladeCount:6,bladeLength:21,bladeWidth:5,hubRadius:7,baseRotationSpeed:.12,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},STORM_CARRIER:{positions:qt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.11,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:1.8},JUGGERNAUT:{positions:qt,bladeCount:6,bladeLength:25,bladeWidth:6,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.5},DEATH_SQUADRON:{positions:qt,bladeCount:4,bladeLength:19,bladeWidth:4,hubRadius:6,baseRotationSpeed:.16,attackSpeedMultiplier:1.8,damagedSpeedMultiplier:2.5},SKY_FORTRESS:{positions:qt,bladeCount:4,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.12,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},SKY_FORTRESS_OMEGA:{positions:qt,bladeCount:6,bladeLength:21,bladeWidth:5,hubRadius:6,baseRotationSpeed:.13,attackSpeedMultiplier:1.6,damagedSpeedMultiplier:2.2},LEVIATHAN:{positions:qt,bladeCount:6,bladeLength:22,bladeWidth:5,hubRadius:7,baseRotationSpeed:.11,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2},APOCALYPSE_CARRIER:{positions:qt,bladeCount:6,bladeLength:23,bladeWidth:5,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.4,damagedSpeedMultiplier:2},APOCALYPSE_OMEGA:{positions:qt,bladeCount:6,bladeLength:24,bladeWidth:6,hubRadius:7,baseRotationSpeed:.1,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:2.2},EXTINCTION_ENGINE:{positions:qt,bladeCount:6,bladeLength:30,bladeWidth:7,hubRadius:9,baseRotationSpeed:.08,attackSpeedMultiplier:1.5,damagedSpeedMultiplier:3}};var Zt=(o=>(o[o.SEA_LEVEL=0]="SEA_LEVEL",o[o.LOW_ALTITUDE=1]="LOW_ALTITUDE",o[o.HIGH_ALTITUDE=2]="HIGH_ALTITUDE",o))(Zt||{}),S=(o=>(o.PLAYER="PLAYER",o.ENEMY_SMALL="ENEMY_SMALL",o.ENEMY_RED="ENEMY_RED",o.ENEMY_BIG="ENEMY_BIG",o.ENEMY_BATTLESHIP="ENEMY_BATTLESHIP",o.ENEMY_HELICOPTER="ENEMY_HELICOPTER",o.BOSS="BOSS",o.SUPPORT_FIGHTER="SUPPORT_FIGHTER",o.BULLET_PLAYER="BULLET_PLAYER",o.BULLET_ENEMY="BULLET_ENEMY",o.BULLET_CANNON="BULLET_CANNON",o.BULLET_TURRET="BULLET_TURRET",o.BULLET_BOMB="BULLET_BOMB",o.EXPLOSION="EXPLOSION",o.EXPLOSION_SMALL="EXPLOSION_SMALL",o.EXPLOSION_MEDIUM="EXPLOSION_MEDIUM",o.EXPLOSION_LARGE="EXPLOSION_LARGE",o.EXPLOSION_MASSIVE="EXPLOSION_MASSIVE",o.BOMB_DROPPED="BOMB_DROPPED",o.BLAST_WAVE="BLAST_WAVE",o.POWERUP="POWERUP",o.ISLAND="ISLAND",o.PARTICLE="PARTICLE",o.SMOKE="SMOKE",o.WAKE="WAKE",o.CRASHING_AIRCRAFT="CRASHING_AIRCRAFT",o.VILLAGE="VILLAGE",o.FORTRESS="FORTRESS",o.AA_EMPLACEMENT="AA_EMPLACEMENT",o.RADAR_STATION="RADAR_STATION",o.FUEL_DEPOT="FUEL_DEPOT",o.AIRFIELD="AIRFIELD",o.SUPPLY_CONVOY="SUPPLY_CONVOY",o.ENEMY_TANK="ENEMY_TANK",o.ENEMY_LARGE_TANK="ENEMY_LARGE_TANK",o.AIRCRAFT_CARRIER="AIRCRAFT_CARRIER",o.DESTROYER="DESTROYER",o.SUPPLY_SHIP="SUPPLY_SHIP",o.SUBMARINE="SUBMARINE",o.PT_BOAT="PT_BOAT",o))(S||{}),ma=(o=>(o.FIREPOWER="FIREPOWER",o.BOMB="BOMB",o.INVINCIBILITY="INVINCIBILITY",o.SPREAD="SPREAD",o))(ma||{}),ya=(o=>(o[o.STANDARD=1]="STANDARD",o[o.HEAVY=2]="HEAVY",o[o.CLUSTER=3]="CLUSTER",o[o.MEGA=4]="MEGA",o))(ya||{}),za=(o=>(o[o.STANDARD=1]="STANDARD",o[o.ENHANCED=2]="ENHANCED",o))(za||{}),te=(o=>(o.ATTRACT="ATTRACT",o.STORY="STORY",o.POWERUP_LEGEND="POWERUP_LEGEND",o.PLAYING="PLAYING",o.PAUSED="PAUSED",o.DESIGN_MODE="DESIGN_MODE",o.BOSS_INTRO="BOSS_INTRO",o.BOSS_BATTLE="BOSS_BATTLE",o.LEVEL_COMPLETE="LEVEL_COMPLETE",o.MISSION_DEBRIEF="MISSION_DEBRIEF",o.GAME_OVER="GAME_OVER",o.VICTORY="VICTORY",o.ENDING="ENDING",o))(te||{}),mt=(o=>(o.BEGINNER="BEGINNER",o.NORMAL="NORMAL",o.VETERAN="VETERAN",o))(mt||{}),Ia=(o=>(o.ACE_SQUADRON="ACE_SQUADRON",o.FLYING_FORTRESS="FLYING_FORTRESS",o.SUPER_BATTLESHIP="SUPER_BATTLESHIP",o.EXPERIMENTAL_AIRSHIP="EXPERIMENTAL_AIRSHIP",o.ULTIMATE_WEAPON="ULTIMATE_WEAPON",o))(Ia||{});function Uy(o,t,n,s){switch(o){case"v_formation":return Qg(t,n,s,32,38);case"line_abreast":return zy(t,n,s,32);case"echelon_left":return Jg(t,n,s,32,38,-1);case"echelon_right":return Jg(t,n,s,32,38,1);case"diamond":return ky(t,n,s,32,38);case"trail":return Vy(t,n,s,38);default:return Qg(t,n,s,32,38)}}function Qg(o,t,n,s,r){const c=[];c.push({x:t,y:n});for(let h=1;h<o;h++){const d=Math.ceil(h/2),g=h%2===1?1:-1;c.push({x:t+g*d*s,y:n-d*r})}return c}function zy(o,t,n,s){const r=[],c=-(o-1)*s/2;for(let h=0;h<o;h++)r.push({x:t+c+h*s,y:n});return r}function Jg(o,t,n,s,r,c){const h=[];for(let d=0;d<o;d++)h.push({x:t+d*s*c,y:n-d*r});return h}function ky(o,t,n,s,r){const c=[],h=Math.min(o,5);h>=1&&c.push({x:t,y:n}),h>=2&&c.push({x:t-s,y:n-r}),h>=3&&c.push({x:t+s,y:n-r}),h>=4&&c.push({x:t,y:n-r*2}),h>=5&&c.push({x:t,y:n-r});for(let d=5;d<o;d++)c.push({x:t,y:n-r*(d-2)});return c}function Vy(o,t,n,s){const r=[];for(let c=0;c<o;c++)r.push({x:t,y:n-c*s});return r}function Wy(o,t,n){switch(o){case"straight_dive":return ep(t,n);case"sweep_left":return tp(t,n,-1);case"sweep_right":return tp(t,n,1);case"loop_back":return Xy(t,n);case"figure_8":return jy(t,n);case"pincer_attack":return $y(t,n);default:return ep(t,n)}}function ep(o,t){return[{x:o,y:120,speed:t},{x:o,y:320,speed:t*1.05},{x:o,y:Y+150,speed:t*1.1}]}function tp(o,t,n){const s=n>0?P+120:-120,r=Math.max(50,Math.min(P-50,o+n*180));return[{x:o,y:140,speed:t},{x:r,y:320,speed:t*.9},{x:s,y:480,speed:t*1.2}]}function Xy(o,t){const s=o>P/2?-1:1;return[{x:o,y:160,speed:t},{x:o+140*s,y:280,speed:t*.85},{x:o+140*1.8*s,y:160,speed:t*.7},{x:o+280*s,y:-80,speed:t*.6},{x:o+140*1.5*s,y:-150,speed:t*.6},{x:o+140*.5*s,y:80,speed:t*.9},{x:o,y:300,speed:t*1},{x:o,y:Y+150,speed:t*1.15}]}function jy(o,t){const s=Math.max(170,Math.min(P-120-50,o));return[{x:s,y:100,speed:t},{x:s+120,y:180,speed:t*.85},{x:s,y:260,speed:t*.85},{x:s-120,y:340,speed:t*.85},{x:s,y:420,speed:t*.9},{x:s+120*.5,y:500,speed:t*.95},{x:s,y:Y+150,speed:t*1.1}]}function $y(o,t){const n=o>P/2?1:-1,s=n>0?P-80:80,r=P/2;return[{x:o,y:100,speed:t},{x:s,y:220,speed:t*.9},{x:s,y:380,speed:t*.95},{x:r+n*60,y:500,speed:t*1},{x:r,y:Y+150,speed:t*1.1}]}function Xp(o){switch(o){case pe.DAWN_PATROL:return{min:2,max:3};case pe.STEEL_VANGUARD:return{min:3,max:4};case pe.HELLFIRE_HORIZON:return{min:3,max:6};default:return{min:2,max:4}}}function qy(o){const t=Xp(o);return t.min+Math.floor(Math.random()*(t.max-t.min+1))}function Zy(o){const t=Xp(o),n=["v_formation","line_abreast","echelon_left","echelon_right","diamond","trail"],s=["straight_dive","sweep_left","sweep_right","loop_back","figure_8","pincer_attack"],r=Math.random()<.4;let c;r?c=3+Math.floor(Math.random()*3):c=Math.floor(Math.random()*3);const h=n[Math.floor(Math.random()*n.length)],d=s[c];return{type:h,movementPattern:d,squadronSize:t,spawnDelay:120+Math.floor(Math.random()*80)}}function ap(o,t,n){const s=t.x-o.x,r=t.y-o.y,c=Math.sqrt(s*s+r*r);if(c<1)return{vx:0,vy:n*t.speed};const h=n*t.speed,d=s/c*h*.7;let g=r/c*h;return g=Math.max(fa*.8,g),{vx:d,vy:g}}function ip(o){return Math.atan2(o.vy,o.vx)-Math.PI/2}function Ky(o,t,n=.12){let s=t-o;for(;s>Math.PI;)s-=Math.PI*2;for(;s<-Math.PI;)s+=Math.PI*2;return o+s*n}function Qy(o,t,n=25){const s=t.x-o.x,r=t.y-o.y;return Math.sqrt(s*s+r*r)<n}function Jy(o,t,n){return{waypoints:o,currentWaypointIndex:0,waypointProgress:0,leaderId:t,offsetFromLeader:n}}const ki={tileSize:Ot.TILE_SIZE,mapWidthTiles:Math.ceil(Ot.MAP_WIDTH_EXTENDED/Ot.TILE_SIZE),mapHeightTiles:Ot.MAP_HEIGHT_TILES,chunkSize:4};var zi=(o=>(o[o.BACKGROUND=0]="BACKGROUND",o[o.TERRAIN=1]="TERRAIN",o[o.COLLISION=2]="COLLISION",o[o.DECORATION=3]="DECORATION",o[o.ENTITY=4]="ENTITY",o))(zi||{}),vs=(o=>(o[o.OCEAN_DEEP=0]="OCEAN_DEEP",o[o.OCEAN_MEDIUM=1]="OCEAN_MEDIUM",o[o.OCEAN_SHALLOW=2]="OCEAN_SHALLOW",o[o.OCEAN_WAVES_1=3]="OCEAN_WAVES_1",o[o.OCEAN_WAVES_2=4]="OCEAN_WAVES_2",o[o.OCEAN_REEF=5]="OCEAN_REEF",o[o.SAND_LIGHT=10]="SAND_LIGHT",o[o.SAND_DARK=11]="SAND_DARK",o[o.SAND_WET=12]="SAND_WET",o[o.SAND_ROCKY=13]="SAND_ROCKY",o[o.SAND_DEBRIS=14]="SAND_DEBRIS",o[o.GRASS_LIGHT=20]="GRASS_LIGHT",o[o.GRASS_DARK=21]="GRASS_DARK",o[o.GRASS_TALL=22]="GRASS_TALL",o[o.DIRT_PATH=23]="DIRT_PATH",o[o.ROAD_HORIZONTAL=24]="ROAD_HORIZONTAL",o[o.ROAD_VERTICAL=25]="ROAD_VERTICAL",o[o.ROAD_INTERSECTION=26]="ROAD_INTERSECTION",o[o.CONCRETE_LIGHT=30]="CONCRETE_LIGHT",o[o.CONCRETE_DARK=31]="CONCRETE_DARK",o[o.CONCRETE_CRACKED=32]="CONCRETE_CRACKED",o[o.STONE_GREY=33]="STONE_GREY",o[o.STONE_MOSSY=34]="STONE_MOSSY",o[o.RUNWAY_CENTER=35]="RUNWAY_CENTER",o[o.RUNWAY_EDGE=36]="RUNWAY_EDGE",o[o.JUNGLE_DENSE=40]="JUNGLE_DENSE",o[o.JUNGLE_SPARSE=41]="JUNGLE_SPARSE",o[o.JUNGLE_CLEARING=42]="JUNGLE_CLEARING",o[o.JUNGLE_PATH=43]="JUNGLE_PATH",o[o.JUNGLE_RIVER=44]="JUNGLE_RIVER",o[o.TRANS_OCEAN_SAND_N=50]="TRANS_OCEAN_SAND_N",o[o.TRANS_OCEAN_SAND_S=51]="TRANS_OCEAN_SAND_S",o[o.TRANS_OCEAN_SAND_E=52]="TRANS_OCEAN_SAND_E",o[o.TRANS_OCEAN_SAND_W=53]="TRANS_OCEAN_SAND_W",o[o.TRANS_OCEAN_SAND_NE=54]="TRANS_OCEAN_SAND_NE",o[o.TRANS_OCEAN_SAND_NW=55]="TRANS_OCEAN_SAND_NW",o[o.TRANS_OCEAN_SAND_SE=56]="TRANS_OCEAN_SAND_SE",o[o.TRANS_OCEAN_SAND_SW=57]="TRANS_OCEAN_SAND_SW",o[o.TRANS_OCEAN_SAND_INNER_NE=58]="TRANS_OCEAN_SAND_INNER_NE",o[o.TRANS_OCEAN_SAND_INNER_NW=59]="TRANS_OCEAN_SAND_INNER_NW",o[o.TRANS_SAND_GRASS_N=60]="TRANS_SAND_GRASS_N",o[o.TRANS_SAND_GRASS_S=61]="TRANS_SAND_GRASS_S",o[o.TRANS_SAND_GRASS_E=62]="TRANS_SAND_GRASS_E",o[o.TRANS_SAND_GRASS_W=63]="TRANS_SAND_GRASS_W",o[o.TRANS_SAND_GRASS_NE=64]="TRANS_SAND_GRASS_NE",o[o.TRANS_SAND_GRASS_NW=65]="TRANS_SAND_GRASS_NW",o[o.TRANS_SAND_GRASS_SE=66]="TRANS_SAND_GRASS_SE",o[o.TRANS_SAND_GRASS_SW=67]="TRANS_SAND_GRASS_SW",o[o.TRANS_GRASS_JUNGLE_N=70]="TRANS_GRASS_JUNGLE_N",o[o.TRANS_GRASS_JUNGLE_S=71]="TRANS_GRASS_JUNGLE_S",o[o.TRANS_GRASS_JUNGLE_E=72]="TRANS_GRASS_JUNGLE_E",o[o.TRANS_GRASS_JUNGLE_W=73]="TRANS_GRASS_JUNGLE_W",o[o.TRANS_GRASS_CONCRETE_N=80]="TRANS_GRASS_CONCRETE_N",o[o.TRANS_GRASS_CONCRETE_S=81]="TRANS_GRASS_CONCRETE_S",o[o.TRANS_GRASS_CONCRETE_E=82]="TRANS_GRASS_CONCRETE_E",o[o.TRANS_GRASS_CONCRETE_W=83]="TRANS_GRASS_CONCRETE_W",o[o.FORTRESS_TL=100]="FORTRESS_TL",o[o.FORTRESS_TC=101]="FORTRESS_TC",o[o.FORTRESS_TR=102]="FORTRESS_TR",o[o.FORTRESS_ML=103]="FORTRESS_ML",o[o.FORTRESS_MC=104]="FORTRESS_MC",o[o.FORTRESS_MR=105]="FORTRESS_MR",o[o.FORTRESS_BL=106]="FORTRESS_BL",o[o.FORTRESS_BC=107]="FORTRESS_BC",o[o.FORTRESS_BR=108]="FORTRESS_BR",o[o.FORTRESS_TURRET=109]="FORTRESS_TURRET",o[o.BUNKER_SMALL=120]="BUNKER_SMALL",o[o.BUNKER_LARGE_L=121]="BUNKER_LARGE_L",o[o.BUNKER_LARGE_R=122]="BUNKER_LARGE_R",o[o.BUNKER_AA=123]="BUNKER_AA",o[o.AIRFIELD_RUNWAY_START=130]="AIRFIELD_RUNWAY_START",o[o.AIRFIELD_RUNWAY_MID=131]="AIRFIELD_RUNWAY_MID",o[o.AIRFIELD_RUNWAY_END=132]="AIRFIELD_RUNWAY_END",o[o.AIRFIELD_HANGAR_L=133]="AIRFIELD_HANGAR_L",o[o.AIRFIELD_HANGAR_R=134]="AIRFIELD_HANGAR_R",o[o.AIRFIELD_TOWER=135]="AIRFIELD_TOWER",o[o.AIRFIELD_APRON=136]="AIRFIELD_APRON",o[o.BUILDING_SMALL=150]="BUILDING_SMALL",o[o.BUILDING_MEDIUM_TL=151]="BUILDING_MEDIUM_TL",o[o.BUILDING_MEDIUM_TR=152]="BUILDING_MEDIUM_TR",o[o.BUILDING_MEDIUM_BL=153]="BUILDING_MEDIUM_BL",o[o.BUILDING_MEDIUM_BR=154]="BUILDING_MEDIUM_BR",o[o.BUILDING_LARGE_1=155]="BUILDING_LARGE_1",o[o.BUILDING_LARGE_2=156]="BUILDING_LARGE_2",o[o.BUILDING_FACTORY=157]="BUILDING_FACTORY",o[o.BUILDING_WAREHOUSE=158]="BUILDING_WAREHOUSE",o[o.BUILDING_RUINS=159]="BUILDING_RUINS",o[o.WALL_H=180]="WALL_H",o[o.WALL_V=181]="WALL_V",o[o.WALL_CORNER_NE=182]="WALL_CORNER_NE",o[o.WALL_CORNER_NW=183]="WALL_CORNER_NW",o[o.WALL_CORNER_SE=184]="WALL_CORNER_SE",o[o.WALL_CORNER_SW=185]="WALL_CORNER_SW",o[o.SANDBAG=186]="SANDBAG",o[o.BARRICADE=187]="BARRICADE",o[o.TANK_TRAP=188]="TANK_TRAP",o[o.CRATE_WOOD=200]="CRATE_WOOD",o[o.CRATE_METAL=201]="CRATE_METAL",o[o.BARREL_FUEL=202]="BARREL_FUEL",o[o.BARREL_WATER=203]="BARREL_WATER",o[o.TREE_PALM=204]="TREE_PALM",o[o.TREE_DECIDUOUS=205]="TREE_DECIDUOUS",o[o.FENCE=206]="FENCE",o[o.TURRET_MG=220]="TURRET_MG",o[o.TURRET_AA=221]="TURRET_AA",o[o.TURRET_CANNON=222]="TURRET_CANNON",o[o.TURRET_MISSILE=223]="TURRET_MISSILE",o[o.SPAWN_TANK=240]="SPAWN_TANK",o[o.SPAWN_TRUCK=241]="SPAWN_TRUCK",o[o.SPAWN_AA_VEHICLE=242]="SPAWN_AA_VEHICLE",o[o.SPAWN_INFANTRY=243]="SPAWN_INFANTRY",o))(vs||{});const np={fortress_small:{id:"fortress_small",name:"Small Fortress",widthTiles:3,heightTiles:3,tiles:[[100,101,102],[103,104,105],[106,107,108]],collisionMask:[[!0,!0,!0],[!0,!1,!0],[!0,!0,!0]],destructible:!0,hp:200,scoreValue:500,turretPositions:[{x:1,y:0,fireRate:90,turretType:"cannon"}]},bunker_aa:{id:"bunker_aa",name:"AA Bunker",widthTiles:2,heightTiles:2,tiles:[[123,123],[31,31]],collisionMask:[[!0,!0],[!0,!0]],destructible:!0,hp:100,scoreValue:200,turretPositions:[{x:.5,y:0,fireRate:45,turretType:"aa"}]},airfield:{id:"airfield",name:"Airfield",widthTiles:6,heightTiles:3,tiles:[[133,134,null,null,135,null],[136,136,130,131,131,132],[20,20,20,20,20,20]],collisionMask:[[!0,!0,!1,!1,!0,!1],[!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1]],destructible:!0,hp:300,scoreValue:1e3,entityType:S.AIRFIELD},fuel_depot:{id:"fuel_depot",name:"Fuel Depot",widthTiles:2,heightTiles:2,tiles:[[202,202],[202,202]],collisionMask:[[!0,!0],[!0,!0]],destructible:!0,hp:50,scoreValue:300,dropsPowerup:!0}},eE=[{tileId:200,type:"destroyable",hp:10,scoreValue:10},{tileId:201,type:"destroyable",hp:25,scoreValue:25},{tileId:202,type:"explosive",hp:15,explosionRadius:64,scoreValue:50},{tileId:204,type:"destroyable",hp:5,scoreValue:5},{tileId:205,type:"destroyable",hp:5,scoreValue:5},{tileId:206,type:"destroyable",hp:5,scoreValue:5},{tileId:220,type:"turret_mount",hp:50,fireRate:30,scoreValue:100},{tileId:221,type:"turret_mount",hp:75,fireRate:45,scoreValue:150},{tileId:222,type:"turret_mount",hp:100,fireRate:90,scoreValue:200},{tileId:223,type:"turret_mount",hp:80,fireRate:120,scoreValue:250},{tileId:240,type:"spawn_point",entityType:S.SUPPLY_CONVOY},{tileId:241,type:"spawn_point",entityType:S.SUPPLY_CONVOY},{tileId:242,type:"spawn_point",entityType:S.AA_EMPLACEMENT}],bi=ki.tileSize,kn=Ot.TOTAL_MAP_HEIGHT,tE="/play-wwii-sky-ace/",sp=tE,aE=!0;async function jp(o){const t=await fetch(o);if(!t.ok)throw new Error(`Failed to load image: ${o} (${t.status})`);const n=await t.blob(),s=new Image;return new Promise((r,c)=>{s.onload=()=>r(s),s.onerror=()=>c(new Error(`Failed to decode image: ${o}`)),s.src=URL.createObjectURL(n)})}function $p(o){return o.startsWith("campaigns/")?`${sp}dist-assets/progressive/graphics/${o}.webp`:`${sp}dist-assets/progressive/graphics/terrain/${o}.webp`}async function iE(o){const t=$p(o);console.log(`[TerrainSpriteGenerator] Loading terrain from path: ${o}`),console.log(`[TerrainSpriteGenerator] Full URL: ${t}`),console.log(`[TerrainSpriteGenerator] USE_STATIC_ASSETS: ${aE}`);const n=await jp(t);console.log(`[TerrainSpriteGenerator] Loaded terrain: ${n.width}${n.height} (source resolution)`);const s=n.width,r=n.height,c=n.width/n.height,h=Math.round(kn*c);console.log(`[TerrainSpriteGenerator] Using full source: ${s}${r}`),console.log(`[TerrainSpriteGenerator] Scaling to game resolution: ${h}${kn} (actual aspect ratio: ${c.toFixed(4)})`);const d=document.createElement("canvas");d.width=h,d.height=kn;const g=d.getContext("2d");return g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(n,0,0,s,r,0,0,h,kn),{canvas:d,detectedWidthGamePixels:h}}async function nE(o){console.log(`[TerrainSpriteGenerator] Loading terrain for level ${o}...`);const t=$p(`terrainLevel${o}`);console.log(`[TerrainSpriteGenerator] Full URL: ${t}`);const n=await jp(t);console.log(`[TerrainSpriteGenerator] Loaded terrain: ${n.width}${n.height} (source resolution)`);const s=n.width,r=n.height,c=n.width/n.height,h=Math.round(kn*c);console.log(`[TerrainSpriteGenerator] Using full source: ${s}${r}`),console.log(`[TerrainSpriteGenerator] Scaling to game resolution: ${h}${kn} (actual aspect ratio: ${c.toFixed(4)})`);const d=document.createElement("canvas");d.width=h,d.height=kn;const g=d.getContext("2d");return g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(n,0,0,s,r,0,0,h,kn),{canvas:d,detectedWidthGamePixels:h}}function qp(o,t){const n=o.width,s=o.height,r=Math.floor(n/bi),c=Math.floor(s/bi),h=r*c,d=document.createElement("canvas");d.width=r*bi,d.height=c*bi;const g=d.getContext("2d"),m=[];for(let y=0;y<c;y++){m[y]=[];for(let E=0;E<r;E++){const A=E*bi,v=y*bi,b=y*r+E;m[y][E]=b;const O=E*bi,L=y*bi;g.drawImage(o,A,v,bi,bi,O,L,bi,bi)}}return{tileset:d,tileGrid:m,tileCount:h,detectedWidthGamePixels:t,fullTerrainCanvas:o}}async function sE(o){const{canvas:t,detectedWidthGamePixels:n}=await nE(o);return qp(t,n)}async function lE(o){const{canvas:t,detectedWidthGamePixels:n}=await iE(o);return qp(t,n)}class rE{constructor(){this.cachedTerrains=new Map,this.loadingPromises=new Map,this.campaignTerrainCache=new Map,this.campaignLoadingPromises=new Map}async generateForLevelAsync(t){if(this.cachedTerrains.has(t))return this.cachedTerrains.get(t);if(this.loadingPromises.has(t))return this.loadingPromises.get(t);const n=sE(t).then(s=>(this.cachedTerrains.set(t,s),this.loadingPromises.delete(t),console.log(`[TerrainSpriteGenerator] Level ${t} terrain ready: ${s.tileCount} tiles`),s));return this.loadingPromises.set(t,n),n}async generateForCampaignAsync(t,n){const s=`${t}_${n}`,c=`campaigns/${t.toLowerCase().replace(/_/g,"-")}-${n}`;if(console.log("[TerrainSpriteGenerator] generateForCampaignAsync called:"),console.log(`[TerrainSpriteGenerator]   campaign: "${t}"`),console.log(`[TerrainSpriteGenerator]   level: ${n}`),console.log(`[TerrainSpriteGenerator]   cacheKey: "${s}"`),console.log(`[TerrainSpriteGenerator]   terrainPath: "${c}"`),this.campaignTerrainCache.has(s))return this.campaignTerrainCache.get(s);if(this.campaignLoadingPromises.has(s))return this.campaignLoadingPromises.get(s);console.log(`[TerrainSpriteGenerator] Loading campaign terrain: ${c}`);const h=lE(c).then(d=>(this.campaignTerrainCache.set(s,d),this.campaignLoadingPromises.delete(s),console.log(`[TerrainSpriteGenerator] Campaign terrain ${s} ready: ${d.tileCount} tiles`),d)).catch(d=>(console.warn(`[TerrainSpriteGenerator] Campaign terrain not found: ${c}`),console.warn("[TerrainSpriteGenerator] Error details:",d),console.warn(`[TerrainSpriteGenerator] Falling back to legacy terrainLevel${Math.min(n,5)}.png`),this.campaignLoadingPromises.delete(s),this.generateForLevelAsync(Math.min(n,5))));return this.campaignLoadingPromises.set(s,h),h}hasCached(t){return this.cachedTerrains.has(t)}hasCampaignCached(t,n){return this.campaignTerrainCache.has(`${t}_${n}`)}getCached(t){return this.cachedTerrains.get(t)||null}getCampaignCached(t,n){return this.campaignTerrainCache.get(`${t}_${n}`)||null}getDetectedTerrainWidth(t,n){const s=this.campaignTerrainCache.get(`${t}_${n}`);return(s==null?void 0:s.detectedWidthGamePixels)??null}getDetectedTerrainWidthLegacy(t){const n=this.cachedTerrains.get(t);return(n==null?void 0:n.detectedWidthGamePixels)??null}clearCache(){this.cachedTerrains.clear(),this.loadingPromises.clear(),this.campaignTerrainCache.clear(),this.campaignLoadingPromises.clear()}}const ba=new rE,oE=new Map([["DAWN_PATROL-1",{campaign:"DAWN_PATROL",level:1,entityOverrides:{Enemy_Heli_Pad_1_L2:{x:611.373262334117,y:188.3957366667288},Enemy_Heli_Pad_0_L2:{x:543.5324583794784,y:758.3987233845414},Enemy_Landing_Strip_0_L1:{x:363.99331662489556,y:1644.812030075188},added_turret_DAWN_PATROL_1_1766182104410_rhjy:{x:601.9537358818419,y:2287.1827637802876},added_turret_DAWN_PATROL_1_1766182630987_2xpq:{x:665.698639752628,y:663.7481344876729},added_turret_DAWN_PATROL_1_1766182075631_8odw:{x:497.97428564533243,y:4674.550571966406},added_game_target_DAWN_PATROL_1_1766182620863_qybj:{x:720.352428084255,y:291.42689267732055},added_game_target_DAWN_PATROL_1_1766182092809_nxyb:{x:821.2337254858951,y:3652.8005364841338},left_boundary:{x:0,y:0},added_game_target_DAWN_PATROL_1_1766255279987_jeex:{x:779.819657348963,y:3682.0811541929666},added_game_target_DAWN_PATROL_1_1766255267475_90cs:{x:546.7620979861737,y:335.49187205690816},added_turret_DAWN_PATROL_1_1766350019087_0r2k:{x:587.0486111111111,y:2518.9236111111104},added_turret_DAWN_PATROL_1_1766350045503_yyvl:{x:449.9143026004727,y:3438.222222222222},added_game_target_DAWN_PATROL_1_1766350075327_b9ch:{x:806.6097813238771,y:2076.8594858156025},added_game_target_DAWN_PATROL_1_1766349974178_6gv5:{x:451.07638888888897,y:356.7361111111111},turret_2_1:{x:255.3059398674809,y:2088.2957321841645},added_turret_DAWN_PATROL_1_1766349995386_kl7g:{x:101.00694444444446,y:1449.0972222222222},turret_1_0:{x:372.88026622744326,y:1598.7123043779213},turret_X_0:{x:491.4047218285068,y:760.4288784009278},added_game_target_DAWN_PATROL_1_1766362767550_oehm:{x:711.0992907801419,y:2060.283687943262},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:709.5390070921985,y:3632.7304964539017}},pathOverrides:{battleship_path_3:{horizontalOffset:-242.22974101921477}},deletedEntities:["added_game_target_DAWN_PATROL_1_1766182620863_qybj","added_turret_DAWN_PATROL_1_1766182630987_2xpq","Enemy_Heli_Pad_0_L2","added_game_target_DAWN_PATROL_1_1766255279987_jeex","added_turret_DAWN_PATROL_1_1766182104410_rhjy","added_turret_DAWN_PATROL_1_1766254791882_2yhs","added_game_target_DAWN_PATROL_1_1766255267475_90cs","turret_3_5","added_turret_DAWN_PATROL_1_1766350045503_yyvl","added_turret_DAWN_PATROL_1_1766350019087_0r2k","added_game_target_DAWN_PATROL_1_1766349960650_zbh5","added_game_target_DAWN_PATROL_1_1766349974178_6gv5","turret_3_8","turret_3_9","turret_2_1","turret_2_0","added_turret_DAWN_PATROL_1_1766349995386_kl7g","turret_7_8","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452913488_2co7"],terrainBoundaries:{leftX:634.6107784431135,rightX:1544.3455945252354},terrainHorizontalOffset:0,addedEntities:[{id:"added_turret_DAWN_PATROL_1_1766360227953_kq2n",entityType:"turret",x:514.5390070921987,y:4085.9929078014193,hp:30,fireRate:1.5},{id:"added_game_target_DAWN_PATROL_1_1766360232002_k1ct",entityType:"game-target",x:709.5390070921985,y:3632.7304964539017,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766362767550_oehm",entityType:"game-target",x:711.0992907801419,y:2060.283687943262,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766367288051_q86i",entityType:"game-target",x:405.7240788346186,y:2403.149842902028,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_1_1766367444098_6fmq",entityType:"game-target",x:479.6229648671808,y:287.30077120822625,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_1_1766681075483_uvvf",pathId:"path_1766681075483_uvvf",entityType:"battleship",waypoints:[{x:621.132075471698,y:2491.9248577418393},{x:633.7825696316261,y:2724.3776879305187},{x:531.7879604672056,y:2841.3947589098534},{x:644.8517520215632,y:3112.589727463313},{x:530.2066486972146,y:3345.427553159629},{x:381.56334231805914,y:3531.2316861335735},{x:357.84366576819394,y:3742.280203653789},{x:360.21563342318046,y:3838.911829889189},{x:353.0997304582209,y:3917.429350104822}],speed:.002,direction:"down",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1,spawnPoint:"top"},{id:"added_path_DAWN_PATROL_1_1766688948290_xpzp",pathId:"path_1766688948290_xpzp",entityType:"battleship",waypoints:[{x:119.50398582816655,y:1850.25206180494},{x:94.56155890168293,y:1579.0031689794307},{x:115.60673162090347,y:1409.8623363842137},{x:207.5819309123118,y:1150.4004231866938},{x:135.8724534986714,y:875.2542761539214},{x:202.1257750221435,y:568.440281468359},{x:158.47652790079718,y:388.38713709280546},{x:156.1381753764394,y:158.22852081488043}],speed:.002,direction:"up",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{Enemy_Landing_Strip_0_L1:{points:1e4}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_1_1766360315981_8f56",cropArea:{x:545.7078378531179,y:1829.0229496594204,width:239.50354609929082,height:462.6241134751774},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766362767550_oehm",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766360315981_8f56.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766367297838_x3dc",cropArea:{x:343.13624678663234,y:2282.498600399886,width:193.0419880034276,height:282.02227934875737},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766367288051_q86i",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766367297838_x3dc.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766367450382_fwjt",cropArea:{x:358.97172236503854,y:181.73093401885183,width:263.9245929734361,height:259.40017137960587},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766367444098_6fmq",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766367450382_fwjt.png"},{id:"destroyed_overlay_DAWN_PATROL_1_1766371172980_lxrl",cropArea:{x:575.7778717055045,y:3452.640255267844,width:368.7403598971722,height:337.06940874035945},linkedTargetId:"added_game_target_DAWN_PATROL_1_1766360232002_k1ct",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_1_1766371172980_lxrl.png"}]}],["DAWN_PATROL-2",{campaign:"DAWN_PATROL",level:2,entityOverrides:{turret_2_1:{x:324.99214947829444,y:4626.485441872181},turret_3_1:{x:674.3779209068659,y:4553.1698219089485},turret_0_0:{x:292.7579428571429,y:897.5835497835498},Enemy_Heli_Pad_0_L2:{x:218.92322961135557,y:702.7666156891426},Enemy_Heli_Pad_1_L2:{x:716.4390620895429,y:486.00848146145256},turret_1_0:{x:543.5000000000001,y:1561.6580086580086},turret_1_1:{x:683.9285714285713,y:2148.4735426751067},turret_2_Y:{x:545.7820163042063,y:2773.2384642770567},turret_2_x:{x:675.8998869227764,y:3355.1340498008663},turret_3_0:{x:299.81339795285857,y:3658.7483713939387},turret_3_2:{x:678.5355094948491,y:4554.9016364463805},added_game_target_DAWN_PATROL_1_1766255267475_90cs:{x:611.6847783985447,y:188.06131650135262},added_game_target_DAWN_PATROL_1_1766367444098_6fmq:{x:479.6229648671808,y:286.5467009425879},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:709.5390070921985,y:3632.7304964539017},added_game_target_DAWN_PATROL_2_1766372135981_09eh:{x:221.5998286203942,y:693.7952013710368},added_game_target_DAWN_PATROL_4_1766254547372_saqq:{x:628.5554676647777,y:3717.5834084761036},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:388.004697204319,y:2594.9799320463344}},pathOverrides:{tank_path_1:{horizontalOffset:240.4328223624887}},deletedEntities:["turret_0_0","Enemy_Landing_Strip_0_L1","turret_3_1","added_game_target_DAWN_PATROL_1_1766182620863_qybj","added_game_target_DAWN_PATROL_1_1766255267475_90cs","added_game_target_DAWN_PATROL_1_1766367444098_6fmq","Enemy_Heli_Pad_0_L2","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452913488_2co7","tank_path_1"],terrainBoundaries:{leftX:689.9401197604789,rightX:1489.7690333618475},terrainHorizontalOffset:-1,addedEntities:[{id:"added_game_target_DAWN_PATROL_2_1766372144389_3oub",entityType:"game-target",x:724.8500428449015,y:467.5235646958012,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372166154_wccr",entityType:"game-target",x:725.6041131105399,y:1464.4044558697517,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372183570_t6wy",entityType:"game-target",x:736.9151670951157,y:2978.063410454156,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_2_1766372352579_3411",entityType:"game-target",x:217.0522707797772,y:694.8757497857752,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_2_1766688993649_4n8r",pathId:"path_1766688993649_4n8r",entityType:"battleship",waypoints:[{x:445.53498671390616,y:3557.9805137289636},{x:453.32949512843237,y:3298.4233835252435},{x:401.8857395925598,y:3090.3100088573965},{x:385.51727192205493,y:2792.8454384410984},{x:370.7077059344554,y:2633.0580159433125},{x:390.9734278122233,y:2247.900354295837},{x:391.75287865367596,y:2129.42382639504},{x:395.65013286093887,y:1841.189105403012},{x:379.2816651904341,y:1657.2453498671393},{x:426.0487156775908,y:1525.5181576616474},{x:394.8706820194863,y:1245.4769707705946},{x:421.3720106288751,y:985.9579273693538},{x:396.42958370239154,y:762.8976970770599},{x:432.2843224092117,y:478.88662533215285},{x:423.710363153233,y:335.46767050487193}],speed:.004,direction:"down",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1},{id:"added_path_DAWN_PATROL_2_1766697447395_rhg0",pathId:"path_1766697447395_rhg0",entityType:"tank",waypoints:[{x:745.9956483899042,y:4416.654917319408},{x:742.166231505657,y:4157.02045256745},{x:747.5274151436031,y:3969.3790252393383},{x:738.3368146214099,y:3717.942993907746},{x:728.3803307223673,y:3542.5557006092254},{x:740.6344647519583,y:3486.5487380330724},{x:783.5239338555266,y:3449.02045256745},{x:804.9686684073106,y:3403.067449956484},{x:821.0522193211489,y:3341.0308964316796},{x:803.4369016536118,y:3277.4625761531765},{x:764.3768494342906,y:3244.5295909486513},{x:725.3167972149695,y:3216.191906005222},{x:728.3803307223673,y:2852.046127067015},{x:720.7214969538729,y:2466.3250652741517},{x:723.0191470844212,y:2334.8851174934725},{x:732.2097476066144,y:2308.845082680592},{x:774.3333333333333,y:2288.1662315056574},{x:819.52045256745,y:2253.7014795474324},{x:839.4334203655353,y:2198.5578764142733},{x:844.7946040034813,y:2123.697127937337},{x:830.242819843342,y:2063.1923411662315},{x:790.4168842471714,y:2022.6005221932114},{x:743.6979982593559,y:1998.858137510879},{x:721.4873803307223,y:1966.6910356832027},{x:726.8485639686685,y:1877.7902523933856},{x:719.189730200174,y:1749.1218450826805},{x:729.1462140992166,y:1617.389904264578},{x:739.8685813751088,y:1157.3720626631853},{x:742.9321148825065,y:1011.0522193211489},{x:745.2297650130548,y:850.7193211488251},{x:742.9321148825065,y:784.0874673629244}],speed:.001,direction:"down",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{turret_2_1:{fireRate:40},turret_3_1:{fireRate:40},turret_3_2:{fireRate:40},turret_3_0:{fireRate:40},turret_2_x:{fireRate:40},turret_2_Y:{fireRate:40},turret_1_1:{fireRate:40},turret_1_0:{fireRate:40}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_2_1766372211306_wd28",cropArea:{x:656.4755784061697,y:2807.64353041988,width:220.94258783204793,height:318.97172236503866},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372183570_t6wy",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372211306_wd28.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372221429_g03l",cropArea:{x:579.2982005141388,y:1349.2463581833763,width:292.5792630676949,height:370.248500428449},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372166154_wccr",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372221429_g03l.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372231422_laxz",cropArea:{x:640.3941730934018,y:378.5432733504713,width:192.28791773778926,height:202.09083119108834},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372144389_3oub",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372231422_laxz.png"},{id:"destroyed_overlay_DAWN_PATROL_2_1766372358470_p3ab",cropArea:{x:130.07197943444726,y:528.2262210796913,width:176.45244215938305,height:344.6101113967437},linkedTargetId:"added_game_target_DAWN_PATROL_2_1766372352579_3411",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_2_1766372358470_p3ab.png"}]}],["DAWN_PATROL-3",{campaign:"DAWN_PATROL",level:3,entityOverrides:{turret_3_2:{x:577.2894185374073,y:3277.9377518472897},turret_3_0:{x:706.92696122633,y:4906.891922011429},turret_3_1:{x:638.7554000545406,y:4221.6692319880585},Enemy_Heli_Pad_0_L2:{x:384.37801513241703,y:364.1124546577357},turret_0_0:{x:393.63669460324,y:350.46095721991355},Enemy_Heli_Pad_1_L2:{x:808.9652117739433,y:207.4623168680846},turret_2_0:{x:262.39127729657196,y:3027.863641908902},turret_2_1:{x:652.8394656581678,y:2734.5176228553687},turret_1_0:{x:668.9816396242529,y:2012.6554874103979},turret_1_1:{x:641.3428571428573,y:1439.4345816361456},Enemy_Landing_Strip_0_L1:{x:329.01136218966394,y:1458.7301737963787},added_game_target_DAWN_PATROL_3_1766202395078_1zfn:{x:372.8813132047665,y:502.4679794835995},added_game_target_DAWN_PATROL_1_1766182092809_nxyb:{x:823.614248479583,y:3664.7031514525734},added_game_target_DAWN_PATROL_2_1766372144389_3oub:{x:724.8500428449015,y:466.7694944301628},added_game_target_DAWN_PATROL_3_1766374240674_kgq5:{x:293.8270588054505,y:3760.36732203633},added_game_target_DAWN_PATROL_3_1766374223298_esk9:{x:515.2989769179039,y:649.0194554636213},added_turret_DAWN_PATROL_3_1766452875789_9lto:{x:398.82152006831757,y:384.38941076003437},added_game_target_DAWN_PATROL_3_1766452913488_2co7:{x:502.31298145070224,y:640.2771146701729}},pathOverrides:{},deletedEntities:["added_game_target_DAWN_PATROL_3_1766202395078_1zfn","added_game_target_DAWN_PATROL_1_1766182620863_qybj","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_1_1766182092809_nxyb","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_3_1766202380146_mfti","turret_3_0","turret_1_1","added_game_target_DAWN_PATROL_3_1766374240674_kgq5","added_game_target_DAWN_PATROL_3_1766374223298_esk9","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367444098_6fmq"],terrainBoundaries:{leftX:689.1873396065014,rightX:1491.6509837467922},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_3_1766452462996_1d7t",entityType:"game-target",x:388.7549103330487,y:2595.730145175064,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452492754_thml",entityType:"game-target",x:321.8719043552519,y:1411.3748932536294,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452800297_hs2a",entityType:"game-target",x:270.69171648163956,y:3761.229718189582,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_3_1766452913488_2co7",entityType:"game-target",x:504.5636208368916,y:642.5277540563621,points:5e3,label:"New Target"}],addedPaths:[{id:"added_path_DAWN_PATROL_3_1766698464629_eopp",pathId:"path_1766698464629_eopp",entityType:"tank",waypoints:[{x:525.9026473099914,y:4405.704526046115},{x:516.8847139197267,y:4101.34927412468},{x:490.58240819812124,y:3956.3108454312555},{x:492.0853970964987,y:3579.4188727583264},{x:477.05550811272417,y:3418.8134073441506},{x:485.32194705380016,y:3353.4333902647313},{x:482.31596925704525,y:3303.834756618275},{x:466.53458582408194,y:3242.2122117847994},{x:453.00768573868487,y:3027.3825789923144},{x:443.2382578992314,y:2910.9009393680617},{x:445.4927412467976,y:2752.2032450896672},{x:416.1844577284372,y:2455.8082835183604},{x:416.1844577284372,y:2455.8082835183604},{x:410.92399658411614,y:2249.4188727583264},{x:390.6336464560205,y:2115.00853970965},{x:386.87617421007684,y:1978.8048676345006},{x:386.87617421007684,y:1818.5802732707089},{x:368.0888129803587,y:1723.8919726729293},{x:385.3731853116994,y:1620.5264730999147},{x:366.58582408198123,y:1558.1524338172503},{x:344.7924850555081,y:1205.1643894107601},{x:345.54397950469684,y:1061.9039282664392},{x:320.7446626814688,y:909.1370623398806},{x:322.999146029035,y:748.8795900939369},{x:310.22374039282664,y:578.9632792485057},{x:316.9871904355252,y:458.7241673783093},{x:294.4423569598634,y:296.84030742954747},{x:295.19385140905206,y:84.91887275832619}],speed:.002,direction:"up",spawnPoint:"bottom",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1}],entityMetadataOverrides:{turret_1_1:{fireRate:50},turret_1_0:{fireRate:50},turret_2_1:{fireRate:50},turret_2_0:{fireRate:50},turret_3_2:{fireRate:50},turret_3_1:{fireRate:50},turret_3_0:{fireRate:50},turret_0_0:{fireRate:50}},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_3_1766452500126_46uh",cropArea:{x:287.3031596925705,y:1298.65072587532,width:150.2988898377455,height:238.22374039282658},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452492754_thml",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452500126_46uh.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766452765765_11f7",cropArea:{x:339.82920580700255,y:2392.7583262169087,width:177.35269000853964,height:394.5345858240821},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452462996_1d7t",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452765765_11f7.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766452806820_scda",cropArea:{x:113.25362937660103,y:3635.7301451750636,width:471.93851409052104,height:292.33134073441533},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452800297_hs2a",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766452806820_scda.png"},{id:"destroyed_overlay_DAWN_PATROL_3_1766453243291_3xxi",cropArea:{x:348.0956447480786,y:566.2510674637067,width:422.3398804440649,height:202.90350128095633},linkedTargetId:"added_game_target_DAWN_PATROL_3_1766452913488_2co7",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_3_1766453243291_3xxi.png"}]}],["DAWN_PATROL-4",{campaign:"DAWN_PATROL",level:4,entityOverrides:{turret_3_5:{x:268.6285714285714,y:4575.909090909091},turret_3_0:{x:371.7714285714286,y:4254.480519480519},turret_3_6:{x:668.5285714285717,y:4403.285714285715},turret_3_4:{x:331.79999999999995,y:3658.686147186148},turret_3_2:{x:544.7,y:4033.9458874458874},turret_3_3:{x:834.6714285714286,y:4125.967532467533},turret_3_1:{x:285.061045987376,y:4078.458579743071},turret_2_2:{x:394.98571428571415,y:3336.8259751970304},turret_2_1:{x:733.4857142857143,y:3475.54329004329},turret_2_3:{x:728.2714285714285,y:2963.004329004329},turret_2_0:{x:246.30000000000007,y:3021.835497835498},turret_1_1:{x:714.4569236390209,y:1990.5743348722885},turret_1_0:{x:207.65714285714284,y:1548.8809523809527},Enemy_Heli_Pad_0_L2:{x:423.1777703816764,y:634.9287952588966},turret_0_0:{x:157.17142857142858,y:426.13419913419926},Enemy_Heli_Pad_1_L2:{x:420.2247763752571,y:495.48759591425096},added_game_target_DAWN_PATROL_4_1766254479099_m2wy:{x:412.4147880973851,y:627.6645626690713},added_game_target_DAWN_PATROL_3_1766452800297_hs2a:{x:270.69171648163956,y:3761.229718189582},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:388.7549103330487,y:2594.9799320463344}},pathOverrides:{},deletedEntities:["turret_2_2","turret_2_1","turret_3_1","turret_3_6","turret_3_5","Enemy_Landing_Strip_0_L1","added_game_target_DAWN_PATROL_4_1766254479099_m2wy","Enemy_Heli_Pad_1_L2","added_game_target_DAWN_PATROL_3_1766202380146_mfti","added_game_target_DAWN_PATROL_1_1766367444098_6fmq","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","turret_2_3","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_3_1766452913488_2co7","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_3_1766452462996_1d7t"],terrainBoundaries:{leftX:616.1676646706587,rightX:1616.2360992301114},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_4_1766533189224_bwym",entityType:"game-target",x:661.6675191815862,y:3696.845694799659,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_4_1766533197600_bjqs",entityType:"game-target",x:453.1082693947151,y:633.7254901960787,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_4_1766533501122_jjty",cropArea:{x:549.5106564364877,y:3550.5541346973573,width:225.06393861892593,height:292.5831202046038},linkedTargetId:"added_game_target_DAWN_PATROL_4_1766533189224_bwym",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_4_1766533501122_jjty.png"},{id:"destroyed_overlay_DAWN_PATROL_4_1766533527580_m3l7",cropArea:{x:337.95055413469765,y:465.30264279624953,width:253.5720375106564,height:321.84143222506395},linkedTargetId:"added_game_target_DAWN_PATROL_4_1766533197600_bjqs",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_4_1766533527580_m3l7.png"}]}],["DAWN_PATROL-5",{campaign:"DAWN_PATROL",level:5,entityOverrides:{Enemy_Heli_Pad_0_L2:{x:263.76485011889133,y:1336.9528514115682},turret_1_0:{x:432.7714285714285,y:1660.385214347692},turret_3_4:{x:565.8285714285714,y:4567.3744588744585},turret_3_0:{x:260.0631206538978,y:4491.893394109448},turret_3_6:{x:73.6464560204953,y:3157.2032025759613},turret_2_3:{x:287.7857142857143,y:3683.4069264069262},turret_2_2:{x:406.69238876788904,y:3317.712503933814},turret_2_0:{x:579.0285714285712,y:3078.5064935064934},turret_0_0:{x:346.308661705502,y:924.9762718067586},Enemy_Heli_Pad_1_L2:{x:685.7962049466857,y:1160.9875959142514},Enemy_Landing_Strip_0_L1:{x:504.4110275689223,y:2277.059314954052},added_game_target_DAWN_PATROL_5_1766254439163_33ri:{x:464.9233543733093,y:406.27592425608657},added_game_target_DAWN_PATROL_5_1766254462632_p2gw:{x:583.5527502254283,y:169.01713255184836},turret_2_1:{x:491.94842015371484,y:3265.950159149135},turret_3_3:{x:525.7417591801878,y:4490.541210568538},turret_3_5:{x:349.4814688300596,y:3595.7382190823696},added_game_target_DAWN_PATROL_5_1766254421122_vgdp:{x:584.1927741273748,y:2791.4098676528065},added_game_target_DAWN_PATROL_5_1766254413284_77ml:{x:575.2629329628944,y:2181.7018887610593},turret_1_1:{x:482.26671273775486,y:2355.873684020383},added_game_target_DAWN_PATROL_4_1766254547372_saqq:{x:960,y:3880.9367018892767},added_game_target_DAWN_PATROL_3_1766452800297_hs2a:{x:486.73962067325624,y:3701.7600860253388},added_game_target_DAWN_PATROL_5_1766508221572_vo2e:{x:527.7587681779299,y:3474.584687767322},added_game_target_DAWN_PATROL_1_1766360232002_k1ct:{x:640.2832329262446,y:3621.4387941442355},added_game_target_DAWN_PATROL_3_1766452462996_1d7t:{x:369.93540648360477,y:2753.0611973564155}},pathOverrides:{},deletedEntities:["turret_3_4","turret_2_3","turret_2_0","added_game_target_DAWN_PATROL_4_1766254479099_m2wy","turret_3_1","turret_3_2","turret_3_5","turret_2_1","added_game_target_DAWN_PATROL_5_1766254421122_vgdp","added_game_target_DAWN_PATROL_5_1766254413284_77ml","turret_1_0","added_game_target_DAWN_PATROL_4_1766254547372_saqq","added_game_target_DAWN_PATROL_1_1766360232002_k1ct","added_game_target_DAWN_PATROL_3_1766452800297_hs2a","added_game_target_DAWN_PATROL_2_1766372183570_t6wy","added_game_target_DAWN_PATROL_3_1766452462996_1d7t","added_game_target_DAWN_PATROL_1_1766367288051_q86i","added_game_target_DAWN_PATROL_1_1766362767550_oehm","added_game_target_DAWN_PATROL_2_1766372166154_wccr","added_game_target_DAWN_PATROL_3_1766452492754_thml","added_game_target_DAWN_PATROL_2_1766372352579_3411","added_game_target_DAWN_PATROL_3_1766452913488_2co7","added_game_target_DAWN_PATROL_2_1766372144389_3oub","added_game_target_DAWN_PATROL_1_1766367444098_6fmq"],terrainBoundaries:{leftX:405.96071733561075,rightX:1765.7899231426131},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_DAWN_PATROL_5_1766508221572_vo2e",entityType:"game-target",x:527.0059880239521,y:3474.584687767322,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508765654_b0ey",entityType:"game-target",x:370.8041060735671,y:2762.0782720273733,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508899787_euan",entityType:"game-target",x:97.54491017964074,y:2448.221129170231,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766508995635_pu5m",entityType:"game-target",x:580.4533789563732,y:1192.0273738237815,points:5e3,label:"New Target"},{id:"added_game_target_DAWN_PATROL_5_1766509112159_nf8g",entityType:"game-target",x:489.36698032506433,y:337.245508982036,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_DAWN_PATROL_5_1766508794665_3ohd",cropArea:{x:250.35928143712556,y:2361.2228400342174,width:242.39520958083833,height:710.6244653550043},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508765654_b0ey",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766508794665_3ohd.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766508910661_kqwp",cropArea:{x:-24.029084687767437,y:2249.1107784431138,width:261.2147134302823,height:337.245508982036},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508899787_euan",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766508910661_kqwp.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509013371_1089",cropArea:{x:371.1804961505562,y:998.562874251497,width:343.267750213858,height:388.43455945252333},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508995635_pu5m",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509013371_1089.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509119226_3tq2",cropArea:{x:243.960650128315,y:157.33105218135165,width:407.25406330196745,height:328.9649272882805},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766509112159_nf8g",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509119226_3tq2.png"},{id:"destroyed_overlay_DAWN_PATROL_5_1766509511164_axg2",cropArea:{x:380.2138579982892,y:3223.9572664195416,width:389.940119760479,height:378.64841745081276},linkedTargetId:"added_game_target_DAWN_PATROL_5_1766508221572_vo2e",imagePath:"destroyed-overlays/destroyed_overlay_DAWN_PATROL_5_1766509511164_axg2.png"}]}],["STEEL_VANGUARD-1",{campaign:"STEEL_VANGUARD",level:1,entityOverrides:{turret_1_0:{x:132.1991393826006,y:1541.8317884173823},turret_2_2:{x:287.1301777362021,y:2758.9897100093544},turret_2_3:{x:525.0787652011227,y:2623.5650423788875},turret_2_1:{x:168.6774929840974,y:3760.7016469654454},turret_3_5:{x:771.6800000000001,y:4237.575757575758},turret_3_3:{x:656.9977174929841,y:4115.651104118831},turret_3_0:{x:412.4292609915809,y:4677.038070130681},turret_3_1:{x:194.50469597754915,y:4794.551464126769},turret_3_6:{x:680.9080636108513,y:4621.505003259915},turret_3_2:{x:549.2776028732144,y:3748.185143824606},turret_1_1:{x:511.93541627689433,y:1626.4820704708452},turret_0_0:{x:488.2322170252572,y:933.8612693823176}},pathOverrides:{},deletedEntities:["turret_3_5","turret_3_4","turret_3_1","turret_2_0"],terrainBoundaries:{leftX:683.4714661984196,rightX:1490.4600526777874},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_1_1766247667040_ay7u",entityType:"game-target",x:217.6800748362956,y:1817.2123479887746,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_1_1766247683222_2w4s",entityType:"game-target",x:260.07483629560335,y:3411.33769878391,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_1_1766247688552_zi39",entityType:"game-target",x:680.5799812909261,y:3483.77923292797,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628526424_xhnl",cropArea:{x:133.48551360842836,y:3294.282255389718,width:281.2291483757682,height:394.8024582967514},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247683222_2w4s",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628526424_xhnl.png"},{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628589455_hbjm",cropArea:{x:447.9367866549602,y:3229.383221149156,width:279.6839332748026,height:480.5618964003511},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247688552_zi39",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628589455_hbjm.png"},{id:"destroyed_overlay_STEEL_VANGUARD_1_1766628673711_06ny",cropArea:{x:93.69622475856022,y:1672.5790069261532,width:317.5417032484636,height:476.69885864793673},linkedTargetId:"added_game_target_STEEL_VANGUARD_1_1766247667040_ay7u",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_1_1766628673711_06ny.png"}]}],["STEEL_VANGUARD-2",{campaign:"STEEL_VANGUARD",level:2,entityOverrides:{turret_3_1:{x:323.302265144864,y:4554.2418389336735},turret_3_6:{x:758.4306935908694,y:4488.143666693271},turret_3_2:{x:536.3928358208956,y:3987.5910288131536},turret_3_5:{x:762.4691132572432,y:3737.09207970841},turret_2_0:{x:268.41882352941184,y:3381.3409955569746},turret_2_3:{x:724.7912906057945,y:3300.4219543991276},turret_2_2:{x:796.6400000000001,y:3608.2424242424245},turret_1_0:{x:268.6836874451273,y:1972.7178013674938},turret_1_1:{x:640.2197014925374,y:1683.3156144411632},turret_0_0:{x:592.6149956101845,y:881.6835608055976},added_game_target_STEEL_VANGUARD_2_1766607888648_3zww:{x:254.52677787532912,y:4304.126426690079}},pathOverrides:{},deletedEntities:["turret_3_4","turret_3_0","turret_3_2","turret_3_3","turret_2_1","turret_2_2","turret_3_5"],terrainBoundaries:{leftX:690.5531167690958,rightX:1485.5662862159788},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_2_1766607888648_3zww",entityType:"game-target",x:254.52677787532915,y:4304.126426690079,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607900135_hr5h",entityType:"game-target",x:715.0008779631253,y:2247.8314310798946,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607906746_ds7s",entityType:"game-target",x:317.49429323968377,y:1277.8226514486391,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_2_1766607912700_8uvx",entityType:"game-target",x:690.2774363476733,y:631.9929762949956,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_2_1766628982172_lbvs",cropArea:{x:97.55926251097446,y:3991.6066725197543,width:283.54697102721684,height:463.5645302897274},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607888648_3zww",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766628982172_lbvs.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629035391_rz1z",cropArea:{x:537.9455662862158,y:1942.2651448639149,width:336.0842844600528,height:424.1615452151009},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607900135_hr5h",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629035391_rz1z.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629098597_x7b1",cropArea:{x:107.21685689201036,y:1141.45741878841,width:321.404741000878,height:221.73836698858645},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607906746_ds7s",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629098597_x7b1.png"},{id:"destroyed_overlay_STEEL_VANGUARD_2_1766629180316_pvo6",cropArea:{x:553.011413520632,y:386.2335381913948,width:237.1905179982441,height:336.0842844600527},linkedTargetId:"added_game_target_STEEL_VANGUARD_2_1766607912700_8uvx",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_2_1766629180316_pvo6.png"}]}],["STEEL_VANGUARD-3",{campaign:"STEEL_VANGUARD",level:3,entityOverrides:{turret_3_6:{x:482.755118525022,y:4557.1649772527735},turret_3_1:{x:537.3158208955225,y:4884.442386995504},turret_3_0:{x:708.2657769973661,y:4259.656157714104},turret_3_3:{x:57.19999999999999,y:4472.242424242424},turret_3_4:{x:318.90697102721685,y:3775.6922340170804},turret_3_5:{x:723.84,y:3944.727272727273},turret_2_1:{x:365.4987181738367,y:3202.340809322372},turret_2_0:{x:749.80790166813,y:3199.243568254982},turret_2_2:{x:451.58138718173836,y:2421.32481975151},turret_1_0:{x:783.0312906057945,y:1698.7592518689976},turret_1_1:{x:451.7338015803337,y:1629.3131135765022}},pathOverrides:{},deletedEntities:["turret_3_3","turret_3_2","turret_3_5","turret_2_3"],terrainBoundaries:{leftX:687.8489903424056,rightX:1483.6347673397718},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_3_1766629419577_0rpo",entityType:"game-target",x:704.4424934152762,y:2815.6979806848112,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_3_1766629433608_c0fk",entityType:"game-target",x:392.6953467954341,y:2871.3257243195785,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_3_1766629489318_mxmx",entityType:"game-target",x:490.81650570676,y:937.1027216856893,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629525244_g2hm",cropArea:{x:264.44249341527615,y:2692.467076382792,width:278.91132572431957,height:317.54170324846336},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629433608_c0fk",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629525244_g2hm.png"},{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629569376_296f",cropArea:{x:568.4635645302894,y:2548.3757682177343,width:285.8647936786655,height:493.6962247585602},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629419577_0rpo",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629569376_296f.png"},{id:"destroyed_overlay_STEEL_VANGUARD_3_1766629636725_5uw4",cropArea:{x:349.42932396839285,y:573.5908691834936,width:236.4179104477612,height:533.0992098331869},linkedTargetId:"added_game_target_STEEL_VANGUARD_3_1766629489318_mxmx",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_3_1766629636725_5uw4.png"}]}],["STEEL_VANGUARD-4",{campaign:"STEEL_VANGUARD",level:4,entityOverrides:{turret_3_1:{x:187.4724495171203,y:4177.712932662888},turret_3_7:{x:300.0340649692713,y:4295.6771224093445},turret_3_2:{x:708.24,y:4345.409210631335},turret_2_2:{x:726.1290254609307,y:3502.6020698645807},turret_2_4:{x:723.5405092186128,y:2862.43520366084},turret_1_1:{x:246.75294117647053,y:1936.41290871844},turret_0_1:{x:149.28737489025448,y:998.2200228802509},turret_0_0:{x:488.7860930640913,y:553.7906190970282}},pathOverrides:{},deletedEntities:["turret_3_3","turret_3_4","turret_3_6","turret_3_2","turret_3_5","turret_2_3","turret_3_0","turret_2_0","turret_2_1","turret_2_5","turret_1_3"],terrainBoundaries:{leftX:693.643546971027,rightX:1486.7251975417032},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_4_1766630292763_tul3",entityType:"game-target",x:276.4179104477612,y:3453.5557506584723,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_4_1766630341802_txrj",entityType:"game-target",x:402.3529411764704,y:2920.070237050044,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_4_1766630398236_s2ry",entityType:"game-target",x:209.973661106233,y:1706.3037752414402,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630312217_t7x7",cropArea:{x:151.25548726953463,y:3251.905179982441,width:269.6400351185251,height:376.2598770851623},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630292763_tul3",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630312217_t7x7.png"},{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630356641_ik0o",cropArea:{x:254.01229148375745,y:2842.809482001756,width:409.4820017559262,height:183.88059701492512},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630341802_txrj",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630356641_ik0o.png"},{id:"destroyed_overlay_STEEL_VANGUARD_4_1766630407761_cl70",cropArea:{x:101.42230026338831,y:1518.9464442493418,width:238.73573309920994,height:332.22124670763833},linkedTargetId:"added_game_target_STEEL_VANGUARD_4_1766630398236_s2ry",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_4_1766630407761_cl70.png"}]}],["STEEL_VANGUARD-5",{campaign:"STEEL_VANGUARD",level:5,entityOverrides:{turret_3_3:{x:515.8293942054434,y:4707.871551334239},turret_3_4:{x:508.25116769095695,y:4492.969164870833},turret_3_0:{x:744.64,y:4198.787878787879},turret_3_7:{x:363.1505531167692,y:3884.5741346742225},turret_3_2:{x:158.11209833187007,y:3508.3304333945252},turret_2_1:{x:40.56,y:3653.818181818182},added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7:{x:221.9490781387184,y:3844.0386303775244},turret_2_5:{x:315.30928884986827,y:3339.1791842924417},turret_2_4:{x:149.0791220368743,y:2949.983345305558},turret_2_2:{x:382.76474100087796,y:2323.3845744539335},turret_2_3:{x:40.56,y:2749.287998510123},turret_2_0:{x:575.3206672519755,y:2118.7533987814936},turret_1_2:{x:632.2545390693591,y:1369.2351078830445},turret_0_1:{x:530.4806321334505,y:652.8572112698542},turret_1_0:{x:367.10433713784016,y:731.5346263335728}},pathOverrides:{},deletedEntities:["turret_3_1","turret_3_5","turret_3_0","turret_2_1","turret_3_6","turret_2_3","turret_1_1","turret_1_3","turret_0_0"],terrainBoundaries:{leftX:692.4846356453031,rightX:1483.6347673397718},terrainHorizontalOffset:0,addedEntities:[{id:"added_game_target_STEEL_VANGUARD_5_1766630548636_i2x0",entityType:"game-target",x:756.593503072871,y:3589.850746268657,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7",entityType:"game-target",x:224.266900790167,y:3875.7155399473227,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630771918_2rt9",entityType:"game-target",x:496.22475856014046,y:3100.4038630377518,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630847899_nmfs",entityType:"game-target",x:533.3099209833188,y:1735.5926251097453,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_5_1766630928676_fvcn",entityType:"game-target",x:197.99824407374877,y:1230.763827919227,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630554201_nuza",cropArea:{x:581.9841966637402,y:3385.882352941177,width:288.95522388059703,height:331.4486391571554},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630548636_i2x0",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630554201_nuza.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630680675_0l7v",cropArea:{x:113.01141352063243,y:3685.267778753292,width:240.2809482001757,height:370.85162423178235},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630587657_i0e7",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630680675_0l7v.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630783412_rdih",cropArea:{x:291.48375768217727,y:2816.084284460053,width:335.3116769095699,height:435.7506584723442},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630771918_2rt9",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630783412_rdih.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630856577_6a1e",cropArea:{x:415.87357330992097,y:1591.8876207199296,width:401.75592625109755,height:281.2291483757681},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630847899_nmfs",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630856577_6a1e.png"},{id:"destroyed_overlay_STEEL_VANGUARD_5_1766630937210_196u",cropArea:{x:102.19490781387168,y:871.5013169446879,width:294.36347673397717,height:587.1817383669886},linkedTargetId:"added_game_target_STEEL_VANGUARD_5_1766630928676_fvcn",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_5_1766630937210_196u.png"}]}],["STEEL_VANGUARD-6",{campaign:"STEEL_VANGUARD",level:6,entityOverrides:{turret_3_3:{x:215.07856014047408,y:4939.849628861043},turret_3_2:{x:229.04337137840201,y:4237.826908239551},turret_3_1:{x:408.974258121159,y:4710.495862931333},turret_3_0:{x:659.3549429323967,y:3901.9499294969005},turret_2_2:{x:139.2725548726953,y:3594.902918562269},turret_3_6:{x:785.9746444249341,y:3637.8684119509408},turret_2_1:{x:35.62739244951712,y:3240.727272727273},turret_2_4:{x:294.41805092186127,y:2756.7382339638707},turret_2_3:{x:74.88000000000002,y:2784.969696969697},turret_1_2:{x:816.0464266900791,y:2553.916194428925},turret_1_0:{x:173.68302019315183,y:1655.5724053529148},turret_0_1:{x:709.28,y:1274.9633649932157}},pathOverrides:{},deletedEntities:["turret_3_7","turret_3_4","turret_3_5","turret_2_1","turret_2_5","turret_2_0","turret_2_3","turret_1_3"],terrainBoundaries:{leftX:595.13608428446,rightX:1586.0052677787533},terrainHorizontalOffset:0,addedEntities:[{id:"added_turret_STEEL_VANGUARD_6_1766631100074_heu7",entityType:"turret",x:708.305531167691,y:4266.654960491659,hp:30,fireRate:1.5},{id:"added_game_target_STEEL_VANGUARD_6_1766631112271_ji6a",entityType:"game-target",x:267.53292361720827,y:3228.6567164179105,points:5e3,label:"New Target"},{id:"added_game_target_STEEL_VANGUARD_6_1766631186163_pfhu",entityType:"game-target",x:719.5083406496929,y:1792.3792800702372,points:5e3,label:"New Target"},{id:"added_turret_STEEL_VANGUARD_6_1766631227579_sl6v",entityType:"turret",x:771.6593503072872,y:498.26163301141406,hp:30,fireRate:1.5},{id:"added_game_target_STEEL_VANGUARD_6_1766631232649_kqpg",entityType:"game-target",x:405.8296751536436,y:370.0790166812994,points:5e3,label:"New Target"}],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631120611_t7ol",cropArea:{x:175.97892888498697,y:3105.812115891133,width:282.7743634767339,height:249.55223880596986},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631112271_ji6a",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631120611_t7ol.png"},{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631191302_1hr7",cropArea:{x:593.5733099209835,y:1631.6769095697982,width:257.2783143107989,height:357.7172958735732},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631186163_pfhu",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631191302_1hr7.png"},{id:"destroyed_overlay_STEEL_VANGUARD_6_1766631245129_qp6y",cropArea:{x:233.5381913959615,y:117.43634767339722,width:385.531167690957,height:575.5926251097454},linkedTargetId:"added_game_target_STEEL_VANGUARD_6_1766631232649_kqpg",imagePath:"destroyed-overlays/destroyed_overlay_STEEL_VANGUARD_6_1766631245129_qp6y.png"}]}]]);function Vi(o,t){const n=`${o.toUpperCase().replace(/-/g,"_")}-${t}`;return oE.get(n)}function cE(o,t,n){const s=Vi(o,t);return s!=null&&s.pathOverrides[n]?s.pathOverrides[n].horizontalOffset:0}function qh(o,t,n){const s=Vi(o,t);return s==null?void 0:s.entityOverrides[n]}function Pi(o,t,n){const s=Vi(o,t);return(s==null?void 0:s.deletedEntities.includes(n))??!1}function Xn(o,t){const n=Vi(o,t);return n==null?void 0:n.terrainBoundaries}function Zp(o,t){const n=Vi(o,t);return(n==null?void 0:n.addedEntities)??[]}function uE(o,t){const n=Vi(o,t);return(n==null?void 0:n.addedPaths)??[]}function Zh(o,t,n){var r;const s=Vi(o,t);return(r=s==null?void 0:s.entityMetadataOverrides)==null?void 0:r[n]}function hE(o,t,n){var r;const s=Vi(o,t);return(r=s==null?void 0:s.pathMetadataOverrides)==null?void 0:r[n]}function Kp(o,t){const n=Vi(o,t);return(n==null?void 0:n.destroyedOverlays)??[]}function lp(o,t,n){return Kp(o,t).find(r=>r.linkedTargetId===n)}function ul(){return xi?V:null}class dE{constructor(){this.turrets=new Map,this.structures=new Map,this.totalMapHeight=0,this.currentLevel=0,this.currentCampaign="DAWN_PATROL",this.turretSprite=null,this.structureSprites=new Map,this.turretSprites=new Map,this.horizontalOffset=0,this._isDesignMode=!1,this.reset()}getEffectiveAdjustments(){if(this._isDesignMode){const n=ul();if(n)return n.getEffectiveTerrainAdjustments()}const t=ul();return t&&t.isEnabled()?t.getEffectiveTerrainAdjustments():ga(this.currentCampaign,this.currentLevel)}getEntityOverride(t){if(this._isDesignMode){const s=ul();if(s){const r=s.getPendingChanges().entityOverrides;if(r[t])return r[t]}}return qh(this.currentCampaign,this.currentLevel,t)||null}isDesignModeActive(){if(this._isDesignMode)return!0;const t=ul();return t?t.isEnabled():!1}getEffectiveHorizontalOffset(){return this._isDesignMode||this.isDesignModeActive()?0:this.horizontalOffset}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n,console.log(`[TERRAIN OVERLAY] setLevelContext: campaign=${t}, level=${n}`)}getDynamicParallaxOffset(t){const n=Xn(this.currentCampaign,this.currentLevel);if(n){const s=ba.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel),r=ga(this.currentCampaign,this.currentLevel),c=s??r.mapWidthExtended,h=yl(c,n.leftX,n.rightX,P),d=P/2,g=(t-d)/d;return Math.floor(g*h)}return oc(t,P)}reset(){this.turrets.clear(),this.structures.clear(),this.totalMapHeight=0,this.currentLevel=0}loadFromMetadata(t,n,s,r){const c=n*s;this.totalMapHeight=r;for(const h of t){if(Pi(this.currentCampaign,this.currentLevel,h.id))continue;const d=qh(this.currentCampaign,this.currentLevel,h.id);h.type==="turret"&&console.log(`[OVERLAY LOAD] turret ${h.id}: campaign=${this.currentCampaign}, level=${this.currentLevel}, override=`,d);const g=(d==null?void 0:d.x)??h.x,m=(d==null?void 0:d.y)??h.y+c,y=d?m:h.y+c;if(h.type==="turret"){const v=Zh(this.currentCampaign,this.currentLevel,h.id),b=(v==null?void 0:v.hp)??h.hp??30,O=(v==null?void 0:v.fireRate)??h.fireRate??100,L=Math.max(60,O),N={metadata:{...h,x:g,y,hp:b,fireRate:L},hp:b,maxHp:b,cooldown:120,fireRate:L,angle:0,destroyed:!1,hitFlash:0,lastFireFrame:0,turretType:"aa",burstPending:0,burstNextFrame:0};this.turrets.set(h.id,N)}if(h.type==="structure"){const E={metadata:{...h,y},hp:h.hp||100,maxHp:h.hp||100,destroyed:!1,hitFlash:0};this.structures.set(h.id,E)}}console.log(`[OVERLAY] Loaded ${this.turrets.size} turrets, ${this.structures.size} structures`)}loadAddedTurrets(){const n=Zp(this.currentCampaign,this.currentLevel).filter(s=>s.entityType==="turret");if(n.length!==0){for(const s of n){const r=Zh(this.currentCampaign,this.currentLevel,s.id),c=(r==null?void 0:r.hp)??s.hp??30,h=(r==null?void 0:r.fireRate)??s.fireRate??100,d=Math.max(60,h),g={metadata:{id:s.id,type:"turret",shape:"circle",label:s.label||"added_turret",x:s.x,y:s.y,radius:8,hp:c,fireRate:d},hp:c,maxHp:c,cooldown:120,fireRate:d,angle:0,destroyed:!1,hitFlash:0,lastFireFrame:0,turretType:"aa",burstPending:0,burstNextFrame:0};this.turrets.set(s.id,g)}console.log(`[OVERLAY] Loaded ${n.length} added turrets from design overrides`)}}setTurretSprite(t){this.turretSprite=t}setTurretSprites(t,n,s){this.turretSprites.set(t,{base:n,cannon:s})}hasTurretSprites(t){return this.turretSprites.has(t)}setStructureSprite(t,n){this.structureSprites.set(t,n)}setTotalMapHeight(t){this.totalMapHeight=t}getTotalMapHeight(){return this.totalMapHeight}update(t,n,s=1){const r=this.getDynamicParallaxOffset(n.x),c=this.getEffectiveAdjustments(),h=Math.floor((c.mapWidthExtended-P)/2);for(const d of this.turrets.values()){if(d.destroyed)continue;d.hitFlash>0&&(d.hitFlash-=s),d.cooldown>0&&(d.cooldown-=s);const g=this.getScreenY(d.metadata.y,t);if(g<-100||g>Y+100)continue;const m=d.metadata.x-h-r,y=n.x-m,E=n.y-g;d.angle=Math.atan2(E,y)}}getFiringTurrets(t,n,s=1){const r=[];for(const c of this.turrets.values()){if(c.destroyed||c.cooldown>0)continue;const h=this.getScreenY(c.metadata.y,t);h<0||h>Y||c.angle<0||c.angle>Math.PI||(c.cooldown=Math.max(30,Math.floor(6e3/(c.fireRate*s))),c.lastFireFrame=n,r.push(c))}return r}damageTurret(t,n){const s=this.turrets.get(t);return!s||s.destroyed?!1:(s.hp-=n,s.hitFlash=5,s.hp<=0?(s.destroyed=!0,!0):!1)}damageStructure(t,n){const s=this.structures.get(t);return!s||s.destroyed?!1:(s.hp-=n,s.hitFlash=5,s.hp<=0?(s.destroyed=!0,!0):!1)}getTurret(t){return this.turrets.get(t)}getTurrets(){return this.turrets}getActiveTurrets(){return Array.from(this.turrets.values()).filter(t=>!t.destroyed)}getVisibleTurrets(t){return this.getActiveTurrets().filter(n=>{const s=this.getScreenY(n.metadata.y,t);return s>=-50&&s<=Y+50})}getTurretScreenPosition(t,n,s=P/2){const r=this.turrets.get(t);if(!r||r.destroyed)return null;const c=this.getEffectiveAdjustments(),h=Math.floor((c.mapWidthExtended-P)/2),d=this.getDynamicParallaxOffset(s);return{x:r.metadata.x-h-d,y:this.getScreenY(r.metadata.y,n)}}applyBombDamage(t,n,s,r,c,h=P/2){const d=[],g=[],m=this.getEffectiveAdjustments(),y=Math.floor((m.mapWidthExtended-P)/2),E=this.getDynamicParallaxOffset(h);for(const A of this.turrets.values()){if(A.destroyed)continue;const v=this.getScreenY(A.metadata.y,c);if(v<-100||v>Y+100)continue;const O=A.metadata.x-y-E-t,L=v-n,N=Math.sqrt(O*O+L*L);if(N>s)continue;const x=Math.pow(1-N/s,2),I=Math.floor(r*x);A.hp-=I,A.hitFlash=5,A.hp<=0?(A.destroyed=!0,d.push(A.metadata.id)):g.push(A.metadata.id)}return{destroyed:d,damaged:g}}getActiveStructures(){return Array.from(this.structures.values()).filter(t=>!t.destroyed)}getScreenY(t,n){const s=this.totalMapHeight-n;return Y-(s-t)}render(t,n,s=P/2,r=!1){this._isDesignMode=r,this.horizontalOffset=this.getDynamicParallaxOffset(s),!r&&(this.renderStructures(t,n),this.renderTurrets(t,n))}renderStructures(t,n){for(const[s,r]of this.structures.entries()){if(r.destroyed)continue;const c=this.getEntityOverride(s),h=(c==null?void 0:c.x)??r.metadata.x,d=(c==null?void 0:c.y)??r.metadata.y,g=this.getScreenY(d,n);if(g<-100||g>Y+100)continue;const m=this.getEffectiveAdjustments(),y=Math.floor((m.mapWidthExtended-P)/2);let E;if(this._isDesignMode){const N=ul(),x=(N==null?void 0:N.getDesignScrollX())??0;E=h-y-x}else E=h-y-this.getEffectiveHorizontalOffset();const A=r.metadata.width||40,v=r.metadata.height||30,b=this.structureSprites.get(r.metadata.label),O=Math.round(E-A/2),L=Math.round(g-v/2);b&&b.complete?t.drawImage(b,O,L,A,v):(t.fillStyle=r.hitFlash>0?"#ffffff":"#606060",t.fillRect(O,L,A,v),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(O+3,L+3,A,v))}}renderTurrets(t,n){const s=Ho.BASE_SIZE,r=Ho.CANNON_SIZE,c=s/2;for(const[h,d]of this.turrets.entries()){if(d.destroyed)continue;const g=this.getEntityOverride(h),m=(g==null?void 0:g.x)??d.metadata.x,y=(g==null?void 0:g.y)??d.metadata.y,E=this.getScreenY(y,n);if(E<-50||E>Y+50)continue;const A=this.getEffectiveAdjustments(),v=Math.floor((A.mapWidthExtended-P)/2);let b;if(this._isDesignMode){const L=ul(),N=(L==null?void 0:L.getDesignScrollX())??0;b=m-v-N}else b=m-v-this.getEffectiveHorizontalOffset();const O=this.turretSprites.get(d.turretType);if(t.save(),t.translate(Math.round(b),Math.round(E)),O&&O.base&&O.cannon)d.hitFlash>0&&(t.filter="brightness(2)"),t.drawImage(O.base,-c,-c,s,s),t.save(),t.rotate(d.angle+Math.PI/2),t.drawImage(O.cannon,-52.5,-52.5,r,r),t.restore(),d.hitFlash>0&&(t.filter="none");else{const L=(d.metadata.radius||8)*Ho.SCALE_FACTOR;t.fillStyle=d.hitFlash>0?"#ffffff":"#444444",t.fillRect(-L*1.2,-L*1.2,L*2.4,L*2.4),t.fillStyle=d.hitFlash>0?"#ffffff":"#222222",t.rotate(d.angle),t.fillRect(0,-3,L*2.5,6),t.fillStyle="#ff4444",t.beginPath(),t.arc(L*2.5,0,3,0,Math.PI*2),t.fill()}if(t.restore(),d.hp<d.maxHp){const x=d.hp/d.maxHp,I=E-c-10;t.fillStyle="#333333",t.fillRect(b-30/2,I,30,3),t.fillStyle=x>.5?"#44ff44":x>.25?"#ffff44":"#ff4444",t.fillRect(b-30/2,I,30*x,3)}}}getDebugInfo(){return{totalTurrets:this.turrets.size,activeTurrets:this.getActiveTurrets().length,totalStructures:this.structures.size,activeStructures:this.getActiveStructures().length}}checkBulletCollision(t,n,s,r,c=P/2){const h=this.getEffectiveAdjustments(),d=Math.floor((h.mapWidthExtended-P)/2),g=this.getDynamicParallaxOffset(c);for(const m of this.turrets.values()){if(m.destroyed)continue;const y=this.getScreenY(m.metadata.y,r);if(y<-50||y>Y+50)continue;const E=m.metadata.x-d-g,A=Ho.COLLISION_RADIUS,v=t-E,b=n-y;if(Math.sqrt(v*v+b*b)<s+A)return m.metadata.id}return null}}const gt=new dE;function fE(){return xi?V:null}const gE=32,pE=15,mE=60,yE=100,rp=1.5;class EE{constructor(){this.targets=new Map,this.floatingScores=[],this.crosshairsFlashFrame=0,this.totalMapHeight=0,this.currentCampaign="DAWN_PATROL",this.currentLevel=1,this.progress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0},this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0}}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n}getDynamicParallaxOffsetForPlayer(t){const n=Xn(this.currentCampaign,this.currentLevel);if(n){const s=ba.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel),r=ga(this.currentCampaign,this.currentLevel),c=s??r.mapWidthExtended,h=yl(c,n.leftX,n.rightX,P),d=P/2,g=(t-d)/d;return Math.floor(g*h)}return oc(t,P)}getBaseOffsetX(){const t=ga(this.currentCampaign,this.currentLevel);return Math.floor((t.mapWidthExtended-P)/2)}reset(){this.targets.clear(),this.floatingScores=[],this.crosshairsFlashFrame=0,this.totalMapHeight=0,this.progress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0},this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0}}loadFromMetadata(t,n,s=0){this.totalMapHeight=n;const r=`_L${s}`;for(const h of this.targets.keys())h.endsWith(r)&&this.targets.delete(h);this.levelProgress={totalGameTargets:0,destroyedGameTargets:0,totalPointsTargets:0,destroyedPointsTargets:0,pointsEarned:0};const c=t.filter(h=>h.type==="target"&&h.targetType);for(const h of c){const d=`${h.id}_L${s}`;if(Pi(this.currentCampaign,this.currentLevel,d)||Pi(this.currentCampaign,this.currentLevel,h.id))continue;const g=h.targetType,m=h.scoreValue||yE,y=(h.radius||20)*rp,E=qh(this.currentCampaign,this.currentLevel,d),A=(E==null?void 0:E.x)??h.x,v=(E==null?void 0:E.y)??h.y,b={id:d,targetType:g,points:m,x:A,y:v,radius:y,destroyed:!1,hitFlash:0};this.targets.set(d,b),g==="game-target"?(this.progress.totalGameTargets++,this.levelProgress.totalGameTargets++):(this.progress.totalPointsTargets++,this.levelProgress.totalPointsTargets++)}}loadAddedTargets(){const t=`added_game_target_${this.currentCampaign}_`;for(const r of this.targets.keys())r.startsWith(t)&&this.targets.delete(r);const s=Zp(this.currentCampaign,this.currentLevel).filter(r=>r.entityType==="game-target"&&!Pi(this.currentCampaign,this.currentLevel,r.id));if(s.length!==0){for(const r of s){const c=Zh(this.currentCampaign,this.currentLevel,r.id),h=(c==null?void 0:c.points)??r.points??5e3,d="game-target",g=20*rp,m={id:r.id,targetType:d,points:h,x:r.x,y:r.y,radius:g,destroyed:!1,hitFlash:0};this.targets.set(r.id,m),this.progress.totalGameTargets++,this.levelProgress.totalGameTargets++}console.log(`[TARGETS] Loaded ${s.length} added targets from design overrides`)}}update(t=1){this.crosshairsFlashFrame+=t;for(let n=this.floatingScores.length-1;n>=0;n--){const s=this.floatingScores[n];s.frame+=t,s.frame>=s.maxFrames&&this.floatingScores.splice(n,1)}for(const n of this.targets.values())n.hitFlash>0&&(n.hitFlash-=t)}applyBombDamage(t,n,s,r,c){const h=[];let d=0;const g=this.getBaseOffsetX(),m=this.getDynamicParallaxOffsetForPlayer(c);for(const y of this.targets.values()){if(y.destroyed)continue;const E=this.getScreenY(y.y,r),A=y.x-g-m;if(E<-200||E>Y+200)continue;const v=A-t,b=E-n;Math.sqrt(v*v+b*b)<=s+y.radius&&(y.destroyed=!0,h.push(y.id),d+=y.points,y.targetType==="game-target"?(this.progress.destroyedGameTargets++,this.levelProgress.destroyedGameTargets++):(this.progress.destroyedPointsTargets++,this.levelProgress.destroyedPointsTargets++),this.progress.pointsEarned+=y.points,this.levelProgress.pointsEarned+=y.points,this.spawnFloatingScore(A,E,y.points))}return{destroyed:h,pointsAwarded:d}}allGameTargetsDestroyed(){return this.progress.destroyedGameTargets>=this.progress.totalGameTargets}getProgress(){return{...this.progress}}getLevelProgress(){return{...this.levelProgress}}getTarget(t){return this.targets.get(t)}getTargetScreenPosition(t,n,s){const r=this.targets.get(t);if(!r)return null;const c=this.getBaseOffsetX(),h=this.getDynamicParallaxOffsetForPlayer(s);return{x:r.x-c-h,y:this.getScreenY(r.y,n)}}getVisibleTargets(t){const n=[];for(const s of this.targets.values()){if(s.destroyed)continue;const r=this.getScreenY(s.y,t);r>=-50&&r<=Y+50&&n.push(s)}return n}getAllTargetsForDesignMode(t){return Array.from(this.targets.values())}getAllTargetsForMiniMap(){return Array.from(this.targets.values()).map(t=>({id:t.id,x:t.x,y:t.y,targetType:t.targetType,destroyed:t.destroyed}))}getTotalMapHeight(){return this.totalMapHeight}spawnFloatingScore(t,n,s){this.floatingScores.push({x:t,y:n,points:s,frame:0,maxFrames:mE})}getFloatingScores(){return this.floatingScores}renderCrosshairs(t,n,s){const r=fE();if(((r==null?void 0:r.isEnabled())??!1)||!(Math.floor(this.crosshairsFlashFrame/pE)%2===0))return;const d=this.getBaseOffsetX(),g=this.getDynamicParallaxOffsetForPlayer(s);for(const m of this.targets.values()){if(m.destroyed)continue;const y=this.getScreenY(m.y,n);if(y<-50||y>Y+50)continue;const E=m.x-d-g,A=gE;t.save();const v=m.targetType==="game-target"?"#ff0000":"#ffaa00";t.strokeStyle=v,t.lineWidth=2,t.globalAlpha=.85,t.beginPath(),t.moveTo(E-A,y),t.lineTo(E-A/3,y),t.moveTo(E+A/3,y),t.lineTo(E+A,y),t.moveTo(E,y-A),t.lineTo(E,y-A/3),t.moveTo(E,y+A/3),t.lineTo(E,y+A),t.moveTo(E-A,y-A*.6),t.lineTo(E-A,y-A),t.lineTo(E-A*.6,y-A),t.moveTo(E+A,y-A*.6),t.lineTo(E+A,y-A),t.lineTo(E+A*.6,y-A),t.moveTo(E-A,y+A*.6),t.lineTo(E-A,y+A),t.lineTo(E-A*.6,y+A),t.moveTo(E+A,y+A*.6),t.lineTo(E+A,y+A),t.lineTo(E+A*.6,y+A),t.stroke(),t.fillStyle=v,t.beginPath(),t.arc(E,y,3,0,Math.PI*2),t.fill(),m.targetType==="game-target"&&(t.font='10px "Black Ops One", monospace',t.fillStyle=v,t.textAlign="center",t.fillText("TARGET",E,y-A-8)),t.restore()}}renderFloatingScores(t){for(const n of this.floatingScores){const s=n.frame/n.maxFrames,r=-50*s,c=1-s*.8,h=1+s*.4;t.save(),t.globalAlpha=c,t.font=`bold ${Math.floor(18*h)}px "Black Ops One", monospace`,t.textAlign="center",t.strokeStyle="#000000",t.lineWidth=3,t.fillStyle="#ffff00";const d=`+${n.points}`;t.strokeText(d,n.x,n.y+r),t.fillText(d,n.x,n.y+r),t.restore()}}getScreenY(t,n){const s=this.totalMapHeight-n;return Y-(s-t)}}const ea=new EE,Gi="#00BFFF",Yo="#FFA500",_E="#FFFF00",hl="#88FF88",dl="#8888FF",Go=8,Da=30,Lh="#44FF88",Nh="#FF88FF",gr="#88FFFF",AE="#FFA500",SE="#FF4444",Dh="#FF6600",op="rgba(0, 0, 0, 0.85)",Uo="#00BFFF",Un="rgba(50, 50, 50, 0.9)",TE="rgba(0, 191, 255, 0.5)",ti=90,Pa=P-ti-30,na=280,Kh=192,Mt=Pa,_s=na+Kh+10,Ma=ti,wh=215,cn=140,Ph=130,wi=24;class vE{constructor(){this.overlayImageCache=new Map,this.loadingImages=new Set}clearOverlayImageCache(t){this.overlayImageCache.delete(t),this.loadingImages.delete(t)}shouldRender(){return xi&&V.isEnabled()}render(t){var c,h;if(!this.shouldRender())return;const n=V.getState(),s=n.designScrollX,r=n.designScrollY;this.renderGrid(t,r),this.renderBoundaries(t,s,n.pendingChanges.terrainBoundaries,n.selectedElement),this.renderEntityPaths(t,s,r,n.pendingChanges.pathOverrides,n.selectedElement),this.renderSelectableElements(t,s,r,n.pendingChanges.entityOverrides),this.renderAddedEntities(t,s,r),this.renderAddedPaths(t,s,r),this.renderDestroyedOverlays(t,s,r),this.renderDestroySelectionPreview(t,s,r),this.renderPlacementPreview(t,s,r),this.renderPathDrawingPreview(t,s,r),n.selectedElement&&this.renderSelection(t,n.selectedElement,s,r),this.renderHeader(t),this.renderEntityPalette(t),this.renderScrollIndicator(t,r),n.selectedElement&&this.renderCoordinateDisplay(t,n.selectedElement),((c=n.selectedElement)==null?void 0:c.type)==="destroyed-overlay"&&this.renderOverlayActionPanel(t,n.selectedElement,s,r),n.isSelectingLinkTarget&&this.renderTargetSelectionMode(t,s,r),this.renderHelpOverlay(t),((h=n.selectedElement)==null?void 0:h.type)==="added-path"&&this.renderPathEditor(t)}getTotalMapHeight(){const t=gt.getTotalMapHeight();return t>0?t:Ot.TOTAL_MAP_HEIGHT}getBaseOffsetX(){const t=V.getLevelInfo(),n=ga(t.campaign,t.level);return Math.floor((n.mapWidthExtended-P)/2)}getTerrainHorizontalOffset(){return V.getTerrainHorizontalOffset()}renderGrid(t,n){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=1;const s=100,r=this.getTotalMapHeight()-n;for(let h=0;h<=P;h+=s)t.beginPath(),t.moveTo(h,0),t.lineTo(h,Y),t.stroke();const c=Math.floor((r-Y)/s)*s;for(let h=c;h<=r;h+=s){const d=Y-(r-h);t.beginPath(),t.moveTo(0,d),t.lineTo(P,d),t.stroke()}t.restore()}renderBoundaries(t,n,s,r){t.save();const c=(r==null?void 0:r.id)==="left_boundary",h=(r==null?void 0:r.id)==="right_boundary",d=V.getBaseOffsetXForPanning(),g=this.getTerrainHorizontalOffset(),m=s.leftX-d-n+g,y=s.rightX-d-n+g,E="#FF6600",A=Gi;m>=-50&&m<=P+50&&(t.strokeStyle=c?A:E,t.lineWidth=c?4:2,t.setLineDash(c?[]:[8,4]),t.globalAlpha=c?1:.7,t.beginPath(),t.moveTo(m,0),t.lineTo(m,Y),t.stroke(),t.setLineDash([]),t.fillStyle=c?A:E,t.font="10px monospace",t.textAlign="center",t.fillText("LEFT",m,55),t.fillText(`${Math.round(s.leftX)}`,m,68)),y>=-50&&y<=P+50&&(t.strokeStyle=h?A:E,t.lineWidth=h?4:2,t.setLineDash(h?[]:[8,4]),t.globalAlpha=h?1:.7,t.beginPath(),t.moveTo(y,0),t.lineTo(y,Y),t.stroke(),t.setLineDash([]),t.fillStyle=h?A:E,t.font="10px monospace",t.textAlign="center",t.fillText("RIGHT",y,55),t.fillText(`${Math.round(s.rightX)}`,y,68)),m<0&&(t.fillStyle=E,t.font="10px monospace",t.textAlign="left",t.fillText(` LEFT: ${Math.round(s.leftX)}`,5,55)),y>P&&(t.fillStyle=E,t.font="10px monospace",t.textAlign="right",t.fillText(`RIGHT: ${Math.round(s.rightX)} `,P-5,55)),t.restore()}renderEntityPaths(t,n,s,r,c){var y;const h=V.getEntityPaths();if(h.length===0)return;const d=this.getTotalMapHeight()-s,g=this.getBaseOffsetX(),m=this.getTerrainHorizontalOffset();for(const E of h){if(E.waypoints.length<2)continue;const A=((y=r[E.id])==null?void 0:y.horizontalOffset)??0,v=(c==null?void 0:c.id)===E.id,b=A!==0;let O;E.entityType===S.ENEMY_BATTLESHIP?O=dl:E.entityType===S.ENEMY_TANK||E.entityType===S.ENEMY_LARGE_TANK?O=hl:O=_E,b&&!v&&(O=Yo),v&&(O=Gi),t.save(),t.strokeStyle=O,t.lineWidth=v?3:2,t.setLineDash(v?[]:[8,4]),t.globalAlpha=v?1:.6,t.beginPath();let L=!0,N=!1;for(let x=0;x<E.waypoints.length;x++){const I=E.waypoints[x],G=I.x+A-g-n+m,W=Y-(d-I.y);if(W<-500||W>Y+500){L=!0;continue}N=!0,L?(t.moveTo(G,W),L=!1):t.lineTo(G,W)}if(N&&t.stroke(),v){t.fillStyle=O;for(let x=0;x<E.waypoints.length;x+=Math.max(1,Math.floor(E.waypoints.length/20))){const I=E.waypoints[x],G=I.x+A-g-n+m,W=Y-(d-I.y);W>=-50&&W<=Y+50&&(t.beginPath(),t.arc(G,W,4,0,Math.PI*2),t.fill())}}for(let x=0;x<E.waypoints.length;x++){const I=E.waypoints[x],G=Y-(d-I.y);if(G>=0&&G<=Y){const W=I.x+A-g-n+m;t.fillStyle=O,t.font="10px monospace",t.textAlign="left",t.fillText(E.id,W+10,G-5);const Q=E.entityType.replace("ENEMY_","");t.fillText(Q,W+10,G+10);break}}t.restore()}}renderSelectableElements(t,n,s,r){const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=V.getState(),m=g.pendingChanges.deletedEntities,y=g.currentCampaign,E=g.currentLevel,A=gt.getTurrets();for(const[b,O]of A){if(m.includes(b)||y&&Pi(y,E,b))continue;const L=r[b],N=(L==null?void 0:L.x)??O.metadata.x,x=(L==null?void 0:L.y)??O.metadata.y,I=N-h-n+d,G=Y-(c-x);G>=-50&&G<=Y+50&&I>=-50&&I<=P+50&&this.renderElementMarker(t,I,G,"turret",!!L)}const v=ea.getAllTargetsForDesignMode(s);for(const b of v){if(m.includes(b.id)||y&&Pi(y,E,b.id))continue;const O=r[b.id],L=(O==null?void 0:O.x)??b.x,N=(O==null?void 0:O.y)??b.y,x=L-h-n+d,I=Y-(c-N);if(I>=-50&&I<=Y+50&&x>=-50&&x<=P+50){const G=b.targetType==="game-target";this.renderElementMarker(t,x,I,G?"game-target":"target",!!O)}}}renderElementMarker(t,n,s,r,c){t.save();let h;if(c?h=Yo:r==="turret"?h="#4488FF":r==="game-target"?h="#FF4444":h="#FFAA44",t.strokeStyle=h,t.lineWidth=2,t.setLineDash([4,4]),r==="game-target"){const d=Da;t.strokeRect(n-d,s-d,d*2,d*2),t.setLineDash([]);const g=d*.6;t.strokeRect(n-g,s-g,g*2,g*2),t.beginPath(),t.moveTo(n-12,s),t.lineTo(n+12,s),t.moveTo(n,s-12),t.lineTo(n,s+12),t.stroke(),t.lineWidth=3;const m=8;t.beginPath(),t.moveTo(n-d,s-d+m),t.lineTo(n-d,s-d),t.lineTo(n-d+m,s-d),t.stroke(),t.beginPath(),t.moveTo(n+d-m,s-d),t.lineTo(n+d,s-d),t.lineTo(n+d,s-d+m),t.stroke(),t.beginPath(),t.moveTo(n-d,s+d-m),t.lineTo(n-d,s+d),t.lineTo(n-d+m,s+d),t.stroke(),t.beginPath(),t.moveTo(n+d-m,s+d),t.lineTo(n+d,s+d),t.lineTo(n+d,s+d-m),t.stroke(),t.fillStyle=h,t.font="bold 8px monospace",t.textAlign="center",t.fillText("TARGET",n,s-d-5)}else t.beginPath(),t.arc(n,s,Da,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.beginPath(),t.arc(n,s,Da*.6,0,Math.PI*2),t.stroke(),t.beginPath(),t.moveTo(n-10,s),t.lineTo(n+10,s),t.moveTo(n,s-10),t.lineTo(n,s+10),t.stroke(),r==="turret"&&(t.fillStyle=h,t.font="8px monospace",t.textAlign="center",t.fillText("TURRET",n,s-Da-5));t.restore()}renderSelection(t,n,s,r){if(n.type==="path"||n.type==="added-path"||n.type==="boundary"||n.type==="destroyed-overlay")return;const c=this.getTotalMapHeight()-r,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=Y-(c-n.currentPosition.y),m=n.currentPosition.x-h-s+d;t.save(),t.strokeStyle=Gi,t.lineWidth=3,t.setLineDash([]);const y=Da*2;t.strokeRect(m-y/2,g-y/2,y,y),t.fillStyle=Gi;const E=[{x:m-y/2,y:g-y/2},{x:m+y/2,y:g-y/2},{x:m-y/2,y:g+y/2},{x:m+y/2,y:g+y/2}];for(const A of E)t.fillRect(A.x-Go/2,A.y-Go/2,Go,Go);t.fillStyle=Gi,t.font="bold 12px monospace",t.textAlign="center",t.fillText(n.type.toUpperCase(),m,g-y/2-8),t.restore()}renderHeader(t){t.save(),t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,P,40),t.fillStyle="#00FF00",t.font="bold 16px monospace",t.textAlign="left",t.fillText("DESIGN MODE",10,26);const n=V.getLevelInfo();t.fillStyle="#FFFFFF",t.font="14px monospace",t.textAlign="center",t.fillText(`${n.campaign} - Level ${n.level}`,P/2,26),V.hasUnsavedChanges()&&(t.fillStyle="#FFA500",t.textAlign="right",t.fillText("* UNSAVED",P-10,26)),t.restore()}renderScrollIndicator(t,n){t.save();const s=this.getTotalMapHeight(),r=200,c=20,h=P-c-10,d=50;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(h,d,c,r);const g=n/(s-Y),m=Math.max(20,Y/s*r),y=d+(1-g)*(r-m),E=t.createLinearGradient(h,y,h+c,y);E.addColorStop(0,"rgba(0, 191, 255, 0.9)"),E.addColorStop(.5,"rgba(100, 220, 255, 0.95)"),E.addColorStop(1,"rgba(0, 191, 255, 0.9)"),t.fillStyle=E,t.fillRect(h,y,c,m),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1;const A=y+m/2;for(let b=-2;b<=2;b++)t.beginPath(),t.moveTo(h+4,A+b*4),t.lineTo(h+c-4,A+b*4),t.stroke();t.strokeStyle="#00BFFF",t.lineWidth=2,t.strokeRect(h,d,c,r),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="9px monospace",t.textAlign="left",t.fillText("TOP",h+c+4,d+8),t.fillText("END",h+c+4,d+r),t.fillStyle="#FFFFFF",t.font="10px monospace",t.textAlign="center";const v=Math.round(n/(s-Y)*100);t.fillText(`${v}%`,h+c/2,d+r+15),t.restore()}renderCoordinateDisplay(t,n){t.save();let s=60;n.type==="path"||n.type==="added-path"||n.type==="boundary"?s=75:n.type==="turret"?s=110:n.type==="target"&&(s=90);const r=220,c=10,h=Y-s-10;if(t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(c,h,r,s),t.strokeStyle=Gi,t.lineWidth=1,t.strokeRect(c,h,r,s),t.fillStyle="#FFFFFF",t.font="12px monospace",t.textAlign="left",t.fillText(`ID: ${n.id}`,c+10,h+20),n.type==="path"||n.type==="added-path")if(n.type==="added-path"){const d=V.getAddedPath(n.id);t.fillText("Type: ADDED PATH",c+10,h+36),d&&(t.fillText(`Entity: ${d.entityType}`,c+10,h+52),n.selectedVertexIndex!==void 0&&t.fillText(`Vertex: ${n.selectedVertexIndex+1}`,c+10,h+68))}else{const d=V.getPathOffset(n.id);t.fillText("Type: PATH",c+10,h+36),t.fillText(`H-Offset: ${d}px`,c+10,h+52),d!==0?(t.fillStyle=Yo,t.fillText("Drag left/right to adjust",c+10,h+68)):(t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillText("Drag left/right to adjust",c+10,h+68))}else if(n.type==="boundary"){const d=n.id==="left_boundary"?"LEFT":"RIGHT";t.fillText(`Type: ${d} BOUNDARY`,c+10,h+36),t.fillText(`X: ${Math.round(n.currentPosition.x)}px`,c+10,h+52),t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillText("Drag left/right to adjust",c+10,h+68)}else if(n.type==="turret"){t.fillText(`X: ${Math.round(n.currentPosition.x)}`,c+10,h+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,c+100,h+36);const d=V.getEntityMetadata(n.id),g=(d==null?void 0:d.hp)??30,m=(d==null?void 0:d.fireRate)??1.5;t.fillStyle="#88FF88",t.fillText(`HP: ${g}`,c+10,h+56),t.fillText("[/] to adjust",c+100,h+56),t.fillStyle="#FFFF88",t.fillText(`Fire Rate: ${m.toFixed(1)}`,c+10,h+72),t.fillText("[,/.] to adjust",c+140,h+72),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="10px monospace",t.fillText("[ ] = HP 10, , . = Rate 0.1",c+10,h+90),t.fillText("+Shift for 1 / 0.5",c+10,h+102)}else if(n.type==="target"){t.fillText(`X: ${Math.round(n.currentPosition.x)}`,c+10,h+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,c+100,h+36);const d=V.getEntityMetadata(n.id),g=(d==null?void 0:d.points)??5e3;t.fillStyle="#FF88FF",t.fillText(`Points: ${g}`,c+10,h+56),t.fillText("[/] to adjust",c+130,h+56),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="10px monospace",t.fillText("[ ] = 1000, +Shift = 100",c+10,h+74)}else{t.fillText(`X: ${Math.round(n.currentPosition.x)}`,c+10,h+36),t.fillText(`Y: ${Math.round(n.currentPosition.y)}`,c+100,h+36);const d=Math.round(n.currentPosition.x-n.originalPosition.x),g=Math.round(n.currentPosition.y-n.originalPosition.y);(d!==0||g!==0)&&(t.fillStyle=Yo,t.fillText(`Delta: (${d>0?"+":""}${d}, ${g>0?"+":""}${g})`,c+10,h+52))}t.restore()}renderHelpOverlay(t){t.save();const n=["D: Exit","ESC: Exit","Arrows: Nudge","+Shift: x10","Ctrl+/: Bounds","Ctrl+Shift+/: L","Ctrl+Alt+/: R","Del: Delete","Drag: Move","Pan: Scroll","Scrollbar: Jump"],s=10,r=50,c=14;t.font="10px monospace",t.textAlign="left";for(let h=0;h<n.length;h++)t.fillStyle="rgba(255, 255, 255, 0.6)",t.fillText(n[h],s,r+h*c);t.restore()}renderAddedEntities(t,n,s){var v;const r=V.getAddedEntities();if(r.length===0)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=V.getState(),m=(v=g.selectedElement)==null?void 0:v.id,y=g.pendingChanges.deletedEntities,E=g.currentCampaign,A=g.currentLevel;for(const b of r){if(y.includes(b.id)||E&&Pi(E,A,b.id))continue;const O=b.x-h-n+d,L=Y-(c-b.y);if(L<-50||L>Y+50||O<-50||O>P+50)continue;const N=m===b.id;this.renderAddedEntityMarker(t,O,L,b,N)}}renderAddedEntityMarker(t,n,s,r,c){t.save();const h=r.entityType==="turret"?Lh:Nh;if(t.strokeStyle=c?Gi:h,t.lineWidth=c?3:2,t.setLineDash([6,3]),r.entityType==="turret")t.beginPath(),t.arc(n,s,Da,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.beginPath(),t.arc(n,s,Da*.6,0,Math.PI*2),t.stroke();else{const d=Da;t.strokeRect(n-d,s-d,d*2,d*2),t.setLineDash([]);const g=d*.6;t.strokeRect(n-g,s-g,g*2,g*2)}t.setLineDash([]),t.beginPath(),t.moveTo(n-10,s),t.lineTo(n+10,s),t.moveTo(n,s-10),t.lineTo(n,s+10),t.stroke(),t.fillStyle=h,t.font="bold 8px monospace",t.textAlign="center",t.fillText("NEW",n,s-Da-12),t.fillText(r.entityType.toUpperCase(),n,s-Da-3),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="7px monospace",r.entityType==="turret"?t.fillText(`HP:${r.hp??30} FR:${r.fireRate??1.5}`,n,s+Da+10):t.fillText(`${r.points??5e3} pts`,n,s+Da+10),t.restore()}renderAddedPaths(t,n,s){const r=V.getAddedPaths();if(r.length===0)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=V.getState().selectedElement,m=g==null?void 0:g.id,y=g==null?void 0:g.selectedVertexIndex;for(const E of r){if(E.waypoints.length<1)continue;const A=m===E.id,v=A?Gi:gr;if(t.save(),t.strokeStyle=v,t.lineWidth=A?3:2,t.setLineDash([8,4]),E.waypoints.length>=2){t.beginPath();let N=!0;for(const x of E.waypoints){const I=x.x-h-n+d,G=Y-(c-x.y);N?(t.moveTo(I,G),N=!1):t.lineTo(I,G)}t.stroke()}t.setLineDash([]);for(let N=0;N<E.waypoints.length;N++){const x=E.waypoints[N],I=x.x-h-n+d,G=Y-(c-x.y),W=A&&y===N,Q=W?10:A?6:4,j=W?"#FFFF00":v;t.fillStyle=j,t.beginPath(),t.arc(I,G,Q,0,Math.PI*2),t.fill(),W&&(t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()),A&&(t.fillStyle="#000000",t.font="bold 8px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(String(N+1),I,G))}const b=E.waypoints[0],O=b.x-h-n+d,L=Y-(c-b.y);t.fillStyle=v,t.font="bold 9px monospace",t.textAlign="center",t.textBaseline="alphabetic",t.fillText("NEW PATH",O,L-20),t.font="8px monospace",t.fillText(`${E.entityType} | ${E.direction}`,O,L-10),t.restore()}}renderPlacementPreview(t,n,s){const r=V.getState();if(r.placementMode==="none"||r.placementMode==="path"||!r.placementPreview)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=r.placementPreview.x-h-n+d,m=Y-(c-r.placementPreview.y);t.save(),t.globalAlpha=.6;const y=r.placementMode==="turret"?Lh:Nh;if(t.strokeStyle=y,t.lineWidth=2,t.setLineDash([4,4]),r.placementMode==="turret")t.beginPath(),t.arc(g,m,Da,0,Math.PI*2),t.stroke();else{const E=Da;t.strokeRect(g-E,m-E,E*2,E*2)}t.setLineDash([]),t.beginPath(),t.moveTo(g-15,m),t.lineTo(g+15,m),t.moveTo(g,m-15),t.lineTo(g,m+15),t.stroke(),t.globalAlpha=1,t.fillStyle="#FFFFFF",t.font="bold 10px monospace",t.textAlign="center",t.fillText(`PLACE ${r.placementMode.toUpperCase()}`,g,m-Da-8),t.restore()}renderPathDrawingPreview(t,n,s){const r=V.getPathDrawingPoints();if(r.length===0)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset();t.save(),t.strokeStyle=gr,t.lineWidth=3,t.setLineDash([6,3]),t.beginPath();let g=!0;for(const A of r){const v=A.x-h-n+d,b=Y-(c-A.y);g?(t.moveTo(v,b),g=!1):t.lineTo(v,b)}t.stroke(),t.setLineDash([]),t.fillStyle=gr;for(let A=0;A<r.length;A++){const v=r[A],b=v.x-h-n+d,O=Y-(c-v.y);t.beginPath(),t.arc(b,O,A===0?8:5,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.font="bold 8px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(String(A+1),b,O),t.fillStyle=gr}const m=r[r.length-1],y=m.x-h-n+d,E=Y-(c-m.y);t.fillStyle="#FFFFFF",t.font="10px monospace",t.textAlign="left",t.fillText("Click to add point",y+15,E),t.fillText("Enter to finish",y+15,E+12),t.fillText("ESC to cancel",y+15,E+24),t.restore()}renderEntityPalette(t){const s=V.getState().placementMode;t.save(),t.fillStyle=op,t.strokeStyle=Uo,t.lineWidth=2,t.beginPath(),t.roundRect(Pa,na,ti,Kh,4),t.fill(),t.stroke(),t.fillStyle=Uo,t.font="bold 10px monospace",t.textAlign="center",t.fillText("ADD ENTITY",Pa+ti/2,na+14);const r=[{mode:"turret",label:"Turret",color:Lh,y:na+28},{mode:"game-target",label:"Target",color:Nh,y:na+60},{mode:"path",label:"Path",color:gr,y:na+92},{mode:"destroy-select",label:"Destroy",color:Dh,y:na+124}];for(const c of r){const h=s===c.mode;t.fillStyle=h?TE:Un,t.strokeStyle=c.color,t.lineWidth=h?2:1,t.beginPath(),t.roundRect(Pa+6,c.y,ti-12,26,3),t.fill(),t.stroke(),t.fillStyle=c.color;const d=Pa+20,g=c.y+13;c.mode==="turret"?(t.beginPath(),t.arc(d,g,6,0,Math.PI*2),t.fill()):c.mode==="game-target"?t.fillRect(d-6,g-6,12,12):c.mode==="path"?(t.strokeStyle=c.color,t.lineWidth=2,t.beginPath(),t.moveTo(d-6,g),t.quadraticCurveTo(d-2,g-5,d+2,g),t.quadraticCurveTo(d+6,g+5,d+10,g),t.stroke()):c.mode==="destroy-select"&&(t.strokeStyle=c.color,t.lineWidth=2,t.beginPath(),t.moveTo(d,g-6),t.lineTo(d,g+6),t.moveTo(d-6,g),t.lineTo(d+6,g),t.moveTo(d-4,g-4),t.lineTo(d+4,g+4),t.moveTo(d+4,g-4),t.lineTo(d-4,g+4),t.stroke()),t.fillStyle=h?"#FFFFFF":c.color,t.font="10px monospace",t.textAlign="left",t.fillText(c.label,Pa+34,c.y+17)}s!=="none"?(t.fillStyle="#FFFFFF",t.font="8px monospace",t.textAlign="center",s==="path"?V.isDrawingPath()?(t.fillText("Click to add points",Pa+ti/2,na+167),t.fillText("Enter to finish",Pa+ti/2,na+179)):t.fillText("Click to start path",Pa+ti/2,na+172):s==="destroy-select"?V.isDestroySelecting()?(t.fillText("Drag to select area",Pa+ti/2,na+167),t.fillText("Release to confirm",Pa+ti/2,na+179)):t.fillText("Click+drag to select",Pa+ti/2,na+172):t.fillText("Click to place",Pa+ti/2,na+172)):(t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="8px monospace",t.textAlign="center",t.fillText("Press N to cycle",Pa+ti/2,na+172)),t.restore()}isPointInPalette(t,n){return t>=Pa&&t<=Pa+ti&&n>=na&&n<=na+Kh}handlePaletteClick(t,n){if(!this.isPointInPalette(t,n))return null;const s=[{mode:"turret",y:na+28},{mode:"game-target",y:na+60},{mode:"path",y:na+92},{mode:"destroy-select",y:na+124}];for(const r of s)if(n>=r.y&&n<=r.y+26)return r.mode;return null}isPointInPathEditor(t,n){var r;return((r=V.getState().selectedElement)==null?void 0:r.type)!=="added-path"?!1:t>=Mt&&t<=Mt+Ma&&n>=_s&&n<=_s+wh}handlePathEditorClick(t,n){const s=V.getState();if(!s.selectedElement||s.selectedElement.type!=="added-path"||!this.isPointInPathEditor(t,n))return!1;const r=V.getAddedPath(s.selectedElement.id);if(!r)return!1;const c=20,h=4,d=_s+26,g=(Ma-18)/2,m=(Ma-20)/3;if(n>=d&&n<d+c){const v=t-(Mt+6);if(v>=0&&v<g)return V.updateAddedPathAttribute(r.id,{entityType:"tank"}),!0;if(v>=g+6&&v<Ma-12)return V.updateAddedPathAttribute(r.id,{entityType:"battleship"}),!0}const y=d+c+h+12;if(n>=y&&n<y+c){const v=t-(Mt+6);if(v>=0&&v<m)return V.updateAddedPathAttribute(r.id,{direction:"up"}),!0;if(v>=m+4&&v<m*2+4)return V.updateAddedPathAttribute(r.id,{direction:"down"}),!0;if(v>=m*2+8)return V.updateAddedPathAttribute(r.id,{direction:"random"}),!0}const E=y+c+h+12;if(n>=E&&n<E+c){const v=t-(Mt+6),b=24;if(v>=0&&v<b){const O=Math.max(.001,(r.speed??.004)-.001);return V.updateAddedPathAttribute(r.id,{speed:parseFloat(O.toFixed(3))}),!0}else if(v>=Ma-12-b&&v<Ma-12){const O=Math.min(.02,(r.speed??.004)+.001);return V.updateAddedPathAttribute(r.id,{speed:parseFloat(O.toFixed(3))}),!0}}const A=E+c+h+12;if(n>=A&&n<A+c){const v=t-(Mt+6);if(v>=0&&v<g)return V.updateAddedPathAttribute(r.id,{spawnPoint:"top"}),!0;if(v>=g+6&&v<Ma-12)return V.updateAddedPathAttribute(r.id,{spawnPoint:"bottom"}),!0}return!0}renderPathEditor(t){const n=V.getState();if(!n.selectedElement||n.selectedElement.type!=="added-path")return;const s=V.getAddedPath(n.selectedElement.id);if(!s)return;t.save(),t.fillStyle=op,t.strokeStyle=Uo,t.lineWidth=2,t.beginPath(),t.roundRect(Mt,_s,Ma,wh,4),t.fill(),t.stroke(),t.fillStyle=Uo,t.font="bold 10px monospace",t.textAlign="center",t.fillText("PATH EDITOR",Mt+Ma/2,_s+14);const r=20,c=4,h=_s+26,d=(Ma-18)/2,g=(Ma-20)/3;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Entity:",Mt+6,h-2);const m=s.entityType==="tank";t.fillStyle=m?"rgba(0, 191, 255, 0.5)":Un,t.strokeStyle=hl,t.lineWidth=m?2:1,t.beginPath(),t.roundRect(Mt+6,h,d,r,3),t.fill(),t.stroke(),t.fillStyle=m?"#FFFFFF":hl,t.font="9px monospace",t.textAlign="center",t.fillText("Tank",Mt+6+d/2,h+13);const y=s.entityType==="battleship";t.fillStyle=y?"rgba(0, 191, 255, 0.5)":Un,t.strokeStyle=dl,t.lineWidth=y?2:1,t.beginPath(),t.roundRect(Mt+6+d+6,h,d,r,3),t.fill(),t.stroke(),t.fillStyle=y?"#FFFFFF":dl,t.fillText("Ship",Mt+6+d+6+d/2,h+13);const E=h+r+c+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Direction:",Mt+6,E-2);const A=[{label:"Up",value:"up"},{label:"Down",value:"down"},{label:"Rnd",value:"random"}];for(let Q=0;Q<A.length;Q++){const j=A[Q],q=s.direction===j.value,Ee=Mt+6+(g+4)*Q;t.fillStyle=q?"rgba(0, 191, 255, 0.5)":Un,t.strokeStyle="#FFFF88",t.lineWidth=q?2:1,t.beginPath(),t.roundRect(Ee,E,g,r,3),t.fill(),t.stroke(),t.fillStyle=q?"#FFFFFF":"#FFFF88",t.font="9px monospace",t.textAlign="center",t.fillText(j.label,Ee+g/2,E+13)}const v=E+r+c+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Speed:",Mt+6,v-2);const b=24,O=s.speed??.004;t.fillStyle=Un,t.strokeStyle="#FF8888",t.lineWidth=1,t.beginPath(),t.roundRect(Mt+6,v,b,r,3),t.fill(),t.stroke(),t.fillStyle="#FF8888",t.font="bold 14px monospace",t.textAlign="center",t.fillText("-",Mt+6+b/2,v+15),t.fillStyle="#FFFFFF",t.font="10px monospace",t.fillText(O.toFixed(3),Mt+Ma/2,v+14),t.fillStyle=Un,t.strokeStyle="#88FF88",t.lineWidth=1,t.beginPath(),t.roundRect(Mt+Ma-6-b,v,b,r,3),t.fill(),t.stroke(),t.fillStyle="#88FF88",t.font="bold 14px monospace",t.textAlign="center",t.fillText("+",Mt+Ma-6-b/2,v+15);const L=v+r+c+12;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Spawn:",Mt+6,L-2);const x=(s.spawnPoint??"top")==="top";t.fillStyle=x?hl:Un,t.strokeStyle=hl,t.lineWidth=1,t.beginPath(),t.roundRect(Mt+6,L,d,r,3),t.fill(),t.stroke(),t.fillStyle=x?"#FFFFFF":hl,t.font="9px monospace",t.textAlign="center",t.fillText("Top",Mt+6+d/2,L+13),t.fillStyle=x?Un:dl,t.strokeStyle=dl,t.lineWidth=1,t.beginPath(),t.roundRect(Mt+6+d+6,L,d,r,3),t.fill(),t.stroke(),t.fillStyle=x?dl:"#FFFFFF",t.fillText("Bottom",Mt+6+d+6+d/2,L+13);const I=L+r+c+8;t.fillStyle="#AAAAAA",t.font="8px monospace",t.textAlign="left",t.fillText("Path ID:",Mt+6,I),t.fillStyle="#FFFFFF",t.font="8px monospace",t.textAlign="center";const G=s.pathId.length>12?s.pathId.slice(0,12)+"...":s.pathId;t.fillText(G,Mt+Ma/2,I+12);const W=I+24;t.fillStyle="#888888",t.font="8px monospace",t.textAlign="center",t.fillText(`${s.waypoints.length} vertices`,Mt+Ma/2,W),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="7px monospace",t.textAlign="center",t.fillText("Del = remove vertex",Mt+Ma/2,_s+wh-10),t.restore()}renderDestroyedOverlays(t,n,s){var m;const r=V.getDestroyedOverlays();if(r.length===0)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=(m=V.getState().selectedElement)==null?void 0:m.id;for(const y of r){const{cropArea:E,linkedTargetId:A,showInDesignMode:v,imageGenerated:b,id:O}=y,L=g===O,N=E.x-h-n+d,x=N+E.width,I=Y-(c-E.y),G=Y-(c-(E.y+E.height)),W=Math.min(I,G),Q=Math.max(I,G);if(x<-50||N>P+50||W>Y+50||Q<-50)continue;const j=E.width,q=Q-W;t.save();const Ee=L?Gi:A?SE:AE;t.strokeStyle=Ee,t.lineWidth=L?4:2,t.setLineDash(L?[]:[8,4]),t.strokeRect(N,W,j,q),t.setLineDash([]),t.lineWidth=3;const ye=10;t.beginPath(),t.moveTo(N,W+ye),t.lineTo(N,W),t.lineTo(N+ye,W),t.stroke(),t.beginPath(),t.moveTo(x-ye,W),t.lineTo(x,W),t.lineTo(x,W+ye),t.stroke(),t.beginPath(),t.moveTo(N,Q-ye),t.lineTo(N,Q),t.lineTo(N+ye,Q),t.stroke(),t.beginPath(),t.moveTo(x-ye,Q),t.lineTo(x,Q),t.lineTo(x,Q-ye),t.stroke(),t.fillStyle=Ee,t.font="bold 10px monospace",t.textAlign="center";const fe=(N+x)/2;let re="DESTROY OVERLAY";if(A?re=`LINKED: ${A.slice(0,15)}...`:b||(re="DESTROY (no image)"),t.fillText(re,fe,W-8),t.font="8px monospace",t.fillStyle="rgba(255, 255, 255, 0.7)",t.fillText(O.slice(-20),fe,W-20),b&&v&&y.imagePath){const ce=this.overlayImageCache.get(O);if(!ce&&!this.loadingImages.has(O)){this.loadingImages.add(O);const Te=new Image,at=y.imageTimestamp?`?t=${y.imageTimestamp}`:"";Te.src=`/game-assets/${y.imagePath}${at}`,Te.onload=()=>{this.overlayImageCache.set(O,Te),this.loadingImages.delete(O)},Te.onerror=()=>{console.warn(`Failed to load overlay image: ${y.imagePath}`),this.loadingImages.delete(O)}}ce&&ce.complete?(t.globalAlpha=.9,t.drawImage(ce,N,W,j,q),t.globalAlpha=1):(t.fillStyle="rgba(0, 100, 0, 0.3)",t.fillRect(N+2,W+2,j-4,q-4),t.fillStyle="#00FF00",t.font="bold 10px monospace",t.fillText("Loading...",fe,(W+Q)/2))}else b&&(t.fillStyle="rgba(100, 100, 100, 0.3)",t.fillRect(N+2,W+2,j-4,q-4),t.fillStyle="#888888",t.font="bold 12px monospace",t.fillText("IMAGE HIDDEN",fe,(W+Q)/2));t.restore()}}renderDestroySelectionPreview(t,n,s){const r=V.getDestroySelectionBounds();if(!r)return;const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=r.start.x-h-n+d,m=r.end.x-h-n+d,y=Y-(c-r.start.y),E=Y-(c-r.end.y),A=Math.min(g,m),v=Math.max(g,m),b=Math.min(y,E),O=Math.max(y,E),L=v-A,N=O-b;t.save(),t.fillStyle="rgba(255, 102, 0, 0.2)",t.fillRect(A,b,L,N),t.strokeStyle=Dh,t.lineWidth=2;const x=Date.now()/100;t.setLineDash([8,4]),t.lineDashOffset=-x%12,t.strokeRect(A,b,L,N),t.setLineDash([]),t.fillStyle="#FFFFFF",t.font="bold 12px monospace",t.textAlign="center",t.fillText(`${Math.round(L)} x ${Math.round(N)}`,(A+v)/2,b-10),t.fillStyle=Dh,t.font="bold 14px monospace",t.fillText("DESTROY SELECTION",(A+v)/2,(b+O)/2),t.restore()}renderOverlayActionPanel(t,n,s,r){const c=V.getDestroyedOverlays().find(I=>I.id===n.id);if(!c)return;const h=this.getTotalMapHeight()-r,d=this.getBaseOffsetX(),g=this.getTerrainHorizontalOffset(),m=c.cropArea.x-d-s+g,y=Y-(h-(c.cropArea.y+c.cropArea.height));let E=m+c.cropArea.width+10;E+cn>P-30&&(E=m-cn-10);const A=Math.max(50,Math.min(Y-Ph-50,y-20));t.save(),t.fillStyle="rgba(0, 0, 0, 0.9)",t.strokeStyle=Gi,t.lineWidth=2,t.beginPath(),t.roundRect(E,A,cn,Ph,6),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.font="bold 11px monospace",t.textAlign="center",t.fillText("OVERLAY ACTIONS",E+cn/2,A+16);const v=A+26,b=V.isGeneratingOverlay(),O=V.getState().isSelectingLinkTarget,L=c.linkedTargetId?`Unlink: ${c.linkedTargetId.slice(0,10)}...`:O?"Click Target...":"Link to Target",N=c.linkedTargetId?"#FF8844":O?"#FFFF00":"#44FFFF",x=[{id:"generate",label:b?"Generating...":c.imageGenerated?"Regenerate":"Generate",color:b?"#888888":"#44FF44",y:v,disabled:b},{id:"toggle",label:c.showInDesignMode?"Hide Image":"Show Image",color:"#FFFF44",y:v+wi+2,disabled:!c.imageGenerated||b},{id:"link",label:L,color:N,y:v+(wi+2)*2,disabled:b},{id:"delete",label:"Delete",color:"#FF4444",y:v+(wi+2)*3,disabled:b}];for(const I of x){const G=I.disabled??!1,W=G?"#666666":I.color;t.fillStyle=G?"rgba(30, 30, 30, 0.9)":"rgba(50, 50, 50, 0.9)",t.strokeStyle=W,t.lineWidth=1,t.beginPath(),t.roundRect(E+6,I.y,cn-12,wi-2,3),t.fill(),t.stroke(),t.fillStyle=W,t.font="10px monospace",t.textAlign="center",t.fillText(I.label,E+cn/2,I.y+14)}t.restore()}getOverlayPanelButtons(t,n,s){const r=V.getDestroyedOverlays().find(O=>O.id===t.id);if(!r)return[];const c=this.getTotalMapHeight()-s,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=r.cropArea.x-h-n+d,m=Y-(c-(r.cropArea.y+r.cropArea.height));let y=g+r.cropArea.width+10;y+cn>P-30&&(y=g-cn-10);const A=Math.max(50,Math.min(Y-Ph-50,m-20))+26,v=y+6,b=cn-12;return[{id:"generate",x:v,y:A,width:b,height:wi-2,disabled:!1},{id:"toggle",x:v,y:A+wi+2,width:b,height:wi-2,disabled:!r.imageGenerated},{id:"link",x:v,y:A+(wi+2)*2,width:b,height:wi-2,disabled:!1},{id:"delete",x:v,y:A+(wi+2)*3,width:b,height:wi-2,disabled:!1}]}renderTargetSelectionMode(t,n,s){t.save(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,P,Y);const r=50;t.fillStyle="rgba(0, 100, 200, 0.9)",t.fillRect(0,0,P,r),t.strokeStyle="#00FFFF",t.lineWidth=2,t.strokeRect(0,0,P,r),t.fillStyle="#FFFFFF",t.font="bold 16px monospace",t.textAlign="center",t.fillText("TARGET SELECTION MODE",P/2,20),t.font="12px monospace",t.fillStyle="#CCFFFF",t.fillText("Click a game-target marker to link | Click elsewhere to cancel",P/2,38);const c=V.getState(),h=c.pendingChanges.deletedEntities,d=c.currentCampaign,g=c.currentLevel,m=ea.getAllTargetsForDesignMode(s).filter(b=>b.targetType==="game-target").filter(b=>!h.includes(b.id)&&!(d&&Pi(d,g,b.id))),y=this.getTotalMapHeight()-s,E=this.getBaseOffsetX(),A=this.getTerrainHorizontalOffset(),v=Math.sin(Date.now()/200)*.3+.7;for(const b of m){const O=b.x-E-n+A,L=Y-(y-b.y);if(O<-50||O>P+50||L<r||L>Y+50)continue;t.globalAlpha=v,t.strokeStyle="#00FFFF",t.lineWidth=4,t.beginPath(),t.arc(O,L,45,0,Math.PI*2),t.stroke(),t.globalAlpha=v*.4,t.fillStyle="rgba(0, 255, 255, 0.3)",t.beginPath(),t.arc(O,L,40,0,Math.PI*2),t.fill(),t.globalAlpha=1;const N="#FF4444",x=Da;t.strokeStyle=N,t.lineWidth=2,t.setLineDash([4,4]),t.strokeRect(O-x,L-x,x*2,x*2),t.setLineDash([]);const I=x*.6;t.strokeRect(O-I,L-I,I*2,I*2),t.beginPath(),t.moveTo(O-12,L),t.lineTo(O+12,L),t.moveTo(O,L-12),t.lineTo(O,L+12),t.stroke(),t.lineWidth=3;const G=8;t.beginPath(),t.moveTo(O-x,L-x+G),t.lineTo(O-x,L-x),t.lineTo(O-x+G,L-x),t.stroke(),t.beginPath(),t.moveTo(O+x-G,L-x),t.lineTo(O+x,L-x),t.lineTo(O+x,L-x+G),t.stroke(),t.beginPath(),t.moveTo(O-x,L+x-G),t.lineTo(O-x,L+x),t.lineTo(O-x+G,L+x),t.stroke(),t.beginPath(),t.moveTo(O+x-G,L+x),t.lineTo(O+x,L+x),t.lineTo(O+x,L+x-G),t.stroke(),t.fillStyle="#FFFFFF",t.font="bold 10px monospace",t.textAlign="center",t.fillText(b.id.slice(-12),O,L+x+14)}t.restore()}}const Qh=new vE,Ch=40,cp=25,RE=12,up=1.5,Qp=20,hp=200,zo=140,dp=100,ko=24,fp=P-Qp-10,Ih=50;function ME(){return{enabled:!1,previousGameState:te.PLAYING,selectedElement:null,pendingChanges:mr(),isDirty:!1,designScrollX:0,designScrollY:0,isPanning:!1,isDragging:!1,placementMode:"none",placementPreview:null,pathDrawingPoints:[],isDrawingPath:!1,destroySelectionStart:null,destroySelectionEnd:null,isSelectingDestroyArea:!1,currentCampaign:"DAWN_PATROL",currentLevel:1,isSelectingLinkTarget:!1,linkingOverlayId:null}}function mr(){return{terrainAdjustments:{mapWidthExtended:Ot.MAP_WIDTH_EXTENDED,terrainHorizontalOffset:0},entityOverrides:{},pathOverrides:{},deletedEntities:[],terrainBoundaries:{leftX:50,rightX:P-50},addedEntities:[],addedPaths:[],entityMetadataOverrides:{},pathMetadataOverrides:{},destroyedOverlays:[]}}class bE{constructor(){this.state=ME(),this.campaign="DAWN_PATROL",this.level=1,this.entityPaths=[],this.panStartX=0,this.panStartY=0,this.scrollXAtPanStart=0,this.scrollYAtPanStart=0,this.dragStartX=0,this.dragStartY=0,this.dragOffsetX=0,this.dragOffsetY=0,this.pathDragStartX=0,this.pathOriginalOffset=0,this.isDraggingScrollBar=!1,this.scrollBarDragStartY=0,this.scrollYAtScrollBarDragStart=0,this.addedEntitiesCache=new Map,this.addedPathsCache=new Map,this.terrainCaptureCallback=null,this.isGenerating=!1}isAvailable(){return xi}isEnabled(){return this.state.enabled}getState(){return this.state}getDesignScrollY(){return this.state.designScrollY}getDesignScrollX(){return this.state.designScrollX}getTerrainHorizontalOffset(){return this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset??0}adjustTerrainHorizontalOffset(t){const n=this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset??0;this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset=n+t,this.state.isDirty=!0,console.log(`[DESIGN MODE] Terrain horizontal offset: ${this.state.pendingChanges.terrainAdjustments.terrainHorizontalOffset}`)}setLevelContext(t,n){this.campaign=t,this.level=n,this.state.currentCampaign=t,this.state.currentLevel=n;const s=Xn(t,n);s&&(this.state.pendingChanges.terrainBoundaries={...s})}setEntityPaths(t){this.entityPaths=t}getEntityPaths(){return this.entityPaths}getPathOffset(t){var n;return((n=this.state.pendingChanges.pathOverrides[t])==null?void 0:n.horizontalOffset)??0}setPlacementMode(t){this.state.placementMode=t,this.state.placementPreview=null,this.state.selectedElement=null,t==="path"&&(this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1),this.cancelDestroySelection(),console.log(`[DESIGN MODE] Placement mode: ${t}`)}getPlacementMode(){return this.state.placementMode}updatePlacementPreview(t,n){if(this.state.placementMode==="none"){this.state.placementPreview=null;return}const s=this.screenToWorld(t,n);this.state.placementPreview=s}screenToWorld(t,n){const s=this.getBaseOffsetX(),r=t+s+this.state.designScrollX-this.getTerrainHorizontalOffset(),d=this.getTotalMapHeight()-this.state.designScrollY-(Y-n);return{x:r,y:d}}placeEntity(){if(this.state.placementMode==="none"||this.state.placementMode==="path"||this.state.placementMode==="destroy-select"||!this.state.placementPreview)return null;const{x:t,y:n}=this.state.placementPreview,s=this.state.placementMode,r=Date.now(),c=Math.random().toString(36).substring(2,6),h=`added_${s.replace("-","_")}_${this.campaign}_${this.level}_${r}_${c}`,d={id:h,entityType:s,x:t,y:n,...s==="turret"?{hp:30,fireRate:1.5}:{points:5e3,label:"New Target"}};return this.state.pendingChanges.addedEntities.push(d),this.addedEntitiesCache.set(h,d),this.state.isDirty=!0,this.state.placementMode="none",this.state.placementPreview=null,this.state.selectedElement={id:h,type:s==="turret"?"turret":"target",originalPosition:{x:t,y:n},currentPosition:{x:t,y:n}},console.log(`[DESIGN MODE] Placed new ${s} at (${t.toFixed(1)}, ${n.toFixed(1)})`),d}getAddedEntities(){return this.state.pendingChanges.addedEntities}getAddedEntity(t){return this.addedEntitiesCache.get(t)}isAddedEntity(t){return t.startsWith("added_")}startPathDrawing(t,n){if(this.state.placementMode!=="path")return;const s=this.screenToWorld(t,n);this.state.pathDrawingPoints=[s],this.state.isDrawingPath=!0,console.log(`[DESIGN MODE] Started path drawing at (${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}addPathWaypoint(t,n){if(!this.state.isDrawingPath)return;const s=this.screenToWorld(t,n);this.state.pathDrawingPoints.push(s),console.log(`[DESIGN MODE] Added waypoint (${s.x.toFixed(1)}, ${s.y.toFixed(1)}), total: ${this.state.pathDrawingPoints.length}`)}finishPathDrawing(){if(!this.state.isDrawingPath||this.state.pathDrawingPoints.length<2)return this.cancelPathDrawing(),null;const t=Date.now(),n=Math.random().toString(36).substring(2,6),s=`added_path_${this.campaign}_${this.level}_${t}_${n}`,r=`path_${t}_${n}`,c={id:s,pathId:r,entityType:"tank",waypoints:[...this.state.pathDrawingPoints],speed:.0035,direction:"down",spawnPoint:"top",spawnDelay:0,spawnInterval:600,maxEntities:1,loop:!1};return this.state.pendingChanges.addedPaths.push(c),this.addedPathsCache.set(s,c),this.state.isDirty=!0,this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1,this.state.placementMode="none",this.state.selectedElement={id:s,type:"path",originalPosition:{x:0,y:0},currentPosition:{x:0,y:0}},console.log(`[DESIGN MODE] Finished path with ${c.waypoints.length} waypoints`),c}cancelPathDrawing(){this.state.pathDrawingPoints=[],this.state.isDrawingPath=!1,this.state.placementMode="none",console.log("[DESIGN MODE] Path drawing cancelled")}getPathDrawingPoints(){return this.state.pathDrawingPoints}isDrawingPath(){return this.state.isDrawingPath}getAddedPaths(){return this.state.pendingChanges.addedPaths}getAddedPath(t){return this.addedPathsCache.get(t)}updateEntityMetadata(t,n){const s=this.addedEntitiesCache.get(t);if(s){Object.assign(s,n);const r=this.state.pendingChanges.addedEntities.findIndex(c=>c.id===t);r>=0&&Object.assign(this.state.pendingChanges.addedEntities[r],n)}else this.state.pendingChanges.entityMetadataOverrides[t]||(this.state.pendingChanges.entityMetadataOverrides[t]={}),Object.assign(this.state.pendingChanges.entityMetadataOverrides[t],n);this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated metadata for ${t}:`,n)}getEntityMetadata(t){const n=this.addedEntitiesCache.get(t);if(n)return{hp:n.hp,fireRate:n.fireRate,points:n.points,label:n.label};const s=this.state.pendingChanges.entityMetadataOverrides[t];return s?{...s}:{}}updatePathMetadata(t,n){const s=this.addedPathsCache.get(t);if(s){n.speed!==void 0&&(s.speed=n.speed),n.direction!==void 0&&(s.direction=n.direction),n.entityType!==void 0&&(s.entityType=n.entityType),n.spawnPoint!==void 0&&(s.spawnPoint=n.spawnPoint);const r=this.state.pendingChanges.addedPaths.findIndex(c=>c.id===t);if(r>=0){const c=this.state.pendingChanges.addedPaths[r];n.speed!==void 0&&(c.speed=n.speed),n.direction!==void 0&&(c.direction=n.direction),n.entityType!==void 0&&(c.entityType=n.entityType),n.spawnPoint!==void 0&&(c.spawnPoint=n.spawnPoint)}}else this.state.pendingChanges.pathMetadataOverrides[t]||(this.state.pendingChanges.pathMetadataOverrides[t]={}),Object.assign(this.state.pendingChanges.pathMetadataOverrides[t],n);this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated path metadata for ${t}:`,n)}getPathMetadata(t){const n=this.addedPathsCache.get(t);if(n)return{speed:n.speed,direction:n.direction,entityType:n.entityType,spawnPoint:n.spawnPoint};const s=this.state.pendingChanges.pathMetadataOverrides[t];return s?{...s}:{}}deleteAddedEntity(t){var s;const n=this.state.pendingChanges.addedEntities.findIndex(r=>r.id===t);return n>=0?(this.state.pendingChanges.addedEntities.splice(n,1),this.addedEntitiesCache.delete(t),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted added entity: ${t}`),!0):!1}deleteAddedPath(t){var s;const n=this.state.pendingChanges.addedPaths.findIndex(r=>r.id===t);return n>=0?(this.state.pendingChanges.addedPaths.splice(n,1),this.addedPathsCache.delete(t),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted added path: ${t}`),!0):!1}deleteSelectedVertex(){const t=this.state.selectedElement;if(!t||t.type!=="path"&&t.type!=="added-path"||t.selectedVertexIndex===void 0)return!1;const n=this.addedPathsCache.get(t.id);if(!n)return!1;const s=t.selectedVertexIndex;if(n.waypoints.length<=2)return console.log(`[DESIGN MODE] Deleting entire path (only ${n.waypoints.length} vertices)`),this.deleteAddedPath(t.id);n.waypoints.splice(s,1);const r=this.state.pendingChanges.addedPaths.findIndex(d=>d.id===t.id);r>=0&&this.state.pendingChanges.addedPaths[r].waypoints.splice(s,1),console.log(`[DESIGN MODE] Deleted vertex ${s} from path ${t.id}`);const c=s>=n.waypoints.length?n.waypoints.length-1:s,h=n.waypoints[c];return this.state.selectedElement={id:t.id,type:t.type,originalPosition:{x:h.x,y:h.y},currentPosition:{x:h.x,y:h.y},selectedVertexIndex:c,originalWaypoints:n.waypoints.map(d=>({x:d.x,y:d.y}))},this.state.isDirty=!0,!0}updateAddedPathAttribute(t,n){const s=this.addedPathsCache.get(t);if(!s)return!1;n.entityType!==void 0&&(s.entityType=n.entityType),n.direction!==void 0&&(s.direction=n.direction),n.spawnPoint!==void 0&&(s.spawnPoint=n.spawnPoint),n.pathId!==void 0&&(s.pathId=n.pathId),n.speed!==void 0&&(s.speed=n.speed);const r=this.state.pendingChanges.addedPaths.findIndex(c=>c.id===t);if(r>=0){const c=this.state.pendingChanges.addedPaths[r];n.entityType!==void 0&&(c.entityType=n.entityType),n.direction!==void 0&&(c.direction=n.direction),n.spawnPoint!==void 0&&(c.spawnPoint=n.spawnPoint),n.pathId!==void 0&&(c.pathId=n.pathId),n.speed!==void 0&&(c.speed=n.speed)}return this.state.isDirty=!0,console.log(`[DESIGN MODE] Updated path ${t} attributes:`,n),!0}enterDesignMode(t,n){return xi?t!==te.PLAYING&&t!==te.BOSS_INTRO&&t!==te.BOSS_BATTLE?(console.warn("[DESIGN MODE] Can only enter from gameplay states"),!1):(this.state.enabled=!0,this.state.previousGameState=t,this.state.designScrollY=n,this.state.selectedElement=null,this.state.isPanning=!1,this.state.isDragging=!1,this.loadCompiledOverrides(),console.log(`[DESIGN MODE] Entered for ${this.campaign} level ${this.level}`),!0):(console.warn("[DESIGN MODE] Not available - VITE_DESIGN_TIME not set"),!1)}exitDesignMode(){if(!this.state.enabled)return te.PLAYING;const t=this.state.previousGameState;return this.state.enabled=!1,this.state.selectedElement=null,this.state.isPanning=!1,this.state.isDragging=!1,console.log("[DESIGN MODE] Exited"),t}toggleDesignMode(t,n){return this.state.enabled?this.exitDesignMode():this.enterDesignMode(t,n)?te.DESIGN_MODE:t}onMouseDown(t,n,s=!1){var d,g;if(!this.state.enabled)return!1;if(s)return this.state.selectedElement=null,this.startPan(t,n),!0;if(this.state.isSelectingLinkTarget){const m=this.screenToWorldY(n),y=this.findElementAt(t,m);return y&&y.type==="target"?(this.completeTargetSelection(y.id),!0):(this.cancelTargetSelection(),!0)}if(this.isClickOnScrollIndicator(t,n))return this.startScrollBarDrag(n),!0;const r=this.handlePaletteClick(t,n);if(r!==null)return r===this.state.placementMode?this.setPlacementMode("none"):this.setPlacementMode(r),!0;if(((d=this.state.selectedElement)==null?void 0:d.type)==="destroyed-overlay"&&this.handleOverlayPanelClick(t,n)||((g=this.state.selectedElement)==null?void 0:g.type)==="added-path"&&Qh.handlePathEditorClick(t,n))return!0;if(this.state.placementMode==="turret"||this.state.placementMode==="game-target"){this.updatePlacementPreview(t,n);const m=this.placeEntity();if(m)return console.log(`[DESIGN MODE] Placed ${m.entityType} at (${m.x.toFixed(1)}, ${m.y.toFixed(1)})`),!0}if(this.state.placementMode==="path")return this.state.isDrawingPath?this.addPathWaypoint(t,n):this.startPathDrawing(t,n),!0;if(this.state.placementMode==="destroy-select")return this.startDestroySelection(t,n),console.log("[DESIGN MODE] Started destroy selection"),!0;const c=this.screenToWorldY(n),h=this.findElementAt(t,c);return h?(this.selectElement(h),this.startDrag(t,n,h),!0):(this.state.selectedElement=null,this.startPan(t,n),!0)}getPalettePosition(){return{x:P-90-30,y:280,width:90,height:192}}isPointInPalette(t,n){const s=this.getPalettePosition();return t>=s.x&&t<=s.x+s.width&&n>=s.y&&n<=s.y+s.height}handlePaletteClick(t,n){if(!this.isPointInPalette(t,n))return null;const s=this.getPalettePosition(),r=[{mode:"turret",y:s.y+28},{mode:"game-target",y:s.y+60},{mode:"path",y:s.y+92},{mode:"destroy-select",y:s.y+124}];for(const c of r)if(n>=c.y&&n<=c.y+26)return c.mode;return null}handleOverlayPanelClick(t,n){if(!this.state.selectedElement||this.state.selectedElement.type!=="destroyed-overlay")return!1;const s=this.state.pendingChanges.destroyedOverlays.find(O=>O.id===this.state.selectedElement.id);if(!s)return!1;const r=this.getTotalMapHeight()-this.state.designScrollY,c=this.getBaseOffsetX(),h=this.getTerrainHorizontalOffset(),d=s.cropArea.x-c-this.state.designScrollX+h,g=Y-(r-(s.cropArea.y+s.cropArea.height));let m=d+s.cropArea.width+10;m+zo>P-30&&(m=d-zo-10);const y=Math.max(50,Math.min(Y-dp-50,g-20));if(t<m||t>m+zo||n<y||n>y+dp)return!1;const E=y+26,A=m+6,v=zo-12,b=[{id:"generate",y:E,disabled:this.isGenerating},{id:"toggle",y:E+ko+2,disabled:!s.imageGenerated||this.isGenerating},{id:"link",y:E+(ko+2)*2,disabled:this.isGenerating},{id:"delete",y:E+(ko+2)*3,disabled:this.isGenerating}];for(const O of b)if(!O.disabled&&t>=A&&t<=A+v&&n>=O.y&&n<=O.y+ko-2)return O.id==="generate"?this.triggerOverlayGeneration(s.id):O.id==="toggle"?this.toggleOverlayVisibility(s.id):O.id==="link"?s.linkedTargetId?this.unlinkOverlayFromTarget(s.id):(this.state.isSelectingLinkTarget=!0,this.state.linkingOverlayId=s.id,console.log("[DesignMode] Entering target selection mode for overlay:",s.id)):O.id==="delete"&&this.deleteSelected(),!0;return!1}setTerrainCaptureCallback(t){this.terrainCaptureCallback=t}isGeneratingOverlay(){return this.isGenerating}async triggerOverlayGeneration(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);if(!n){console.error("[DESIGN MODE] Overlay not found:",t);return}if(this.isGenerating){console.log("[DESIGN MODE] Generation already in progress");return}if(!this.terrainCaptureCallback){console.error("[DESIGN MODE] Terrain capture callback not set");return}console.log(`[DESIGN MODE] Triggering generation for overlay: ${t}`),console.log(`[DESIGN MODE] Crop area: ${JSON.stringify(n.cropArea)}`),this.isGenerating=!0;try{const s=await this.terrainCaptureCallback(n.cropArea);if(!s){console.error("[DESIGN MODE] Failed to capture terrain area"),this.isGenerating=!1;return}console.log("[DESIGN MODE] Captured terrain area, sending to API...");const{generateDestroyedOverlay:r}=await Wt(async()=>{const{generateDestroyedOverlay:h}=await Promise.resolve().then(()=>B2);return{generateDestroyedOverlay:h}},void 0),c=await r(t,s,n.cropArea.width,n.cropArea.height,n.imageGenerated);c.success?(Qh.clearOverlayImageCache(t),n.imageGenerated=!0,n.imagePath=c.imagePath||`destroyed-overlays/${t}.png`,n.imageTimestamp=Date.now(),n.showInDesignMode=!0,this.state.isDirty=!0,console.log(`[DESIGN MODE] Overlay generated successfully: ${n.imagePath}`)):console.error("[DESIGN MODE] Generation failed:",c.error)}catch(s){console.error("[DESIGN MODE] Generation error:",s)}finally{this.isGenerating=!1}}isClickOnScrollIndicator(t,n){return t>=fp&&t<=fp+Qp&&n>=Ih&&n<=Ih+hp}startScrollBarDrag(t){this.isDraggingScrollBar=!0,this.scrollBarDragStartY=t,this.scrollYAtScrollBarDragStart=this.state.designScrollY}onMouseMove(t,n){return this.state.enabled?this.isDraggingScrollBar?(this.updateScrollBarDrag(n),!0):this.state.isPanning?(this.updatePan(t,n),!0):this.state.isDragging&&this.state.selectedElement?(this.updateDrag(t,n),!0):this.state.isSelectingDestroyArea?(this.updateDestroySelection(t,n),!0):this.state.placementMode!=="none"?(this.updatePlacementPreview(t,n),!0):!1:!1}updateScrollBarDrag(t){const s=this.getTotalMapHeight()-Y,r=(t-Ih)/hp,c=Math.max(0,Math.min(1,r));this.state.designScrollY=s*(1-c)}onMouseUp(){if(this.state.isSelectingDestroyArea){const t=this.completeDestroySelection();t&&console.log(`[DESIGN MODE] Created destroy overlay: ${t.id}`)}this.state.isPanning=!1,this.state.isDragging=!1,this.isDraggingScrollBar=!1}onWheel(t){if(!this.state.enabled)return;const n=t*.5;this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-Y,this.state.designScrollY+n))}nudgeSelected(t,n){if(!this.state.selectedElement)return;const s=this.state.selectedElement,r=Math.max(0,Math.min(Ot.MAP_WIDTH_EXTENDED,s.currentPosition.x+t)),c=this.getTotalMapHeight(),h=Math.max(0,Math.min(c,s.currentPosition.y+n));s.currentPosition={x:r,y:h},this.state.pendingChanges.entityOverrides[s.id]={x:r,y:h},this.state.isDirty=!0}updatePathOffset(t,n){this.state.pendingChanges.pathOverrides[t]={horizontalOffset:n},this.state.isDirty=!0}deleteSelected(){if(!this.state.selectedElement)return;const t=this.state.selectedElement.id;if(this.state.selectedElement.type==="destroyed-overlay"){this.deleteDestroyedOverlay(t),this.state.selectedElement=null,this.state.isDirty=!0;return}this.deleteAddedEntity(t)||this.deleteAddedPath(t)||(this.state.pendingChanges.deletedEntities.includes(t)||this.state.pendingChanges.deletedEntities.push(t),this.state.selectedElement=null,this.state.isDirty=!0)}jumpToY(t){this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-Y,t))}jumpToTop(){this.state.designScrollY=this.getTotalMapHeight()-Y}jumpToBottom(){this.state.designScrollY=0}pageScroll(t){const n=Y*.8;this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-Y,this.state.designScrollY+n*t))}getPendingChanges(){return this.state.pendingChanges}getTerrainBoundaries(){return this.state.pendingChanges.terrainBoundaries}adjustBoundaryWidth(t){const n=this.state.pendingChanges.terrainBoundaries,s=100,r=0,h=this.getTerrainWidthForPanning();let d=n.leftX-t,g=n.rightX+t;g-d<s||(d=Math.max(r,Math.min(d,h-s)),g=Math.max(r+s,Math.min(g,h)),this.state.pendingChanges.terrainBoundaries.leftX=d,this.state.pendingChanges.terrainBoundaries.rightX=g,this.state.isDirty=!0,console.log(`[DESIGN MODE] Boundary width adjusted: leftX=${d.toFixed(0)}, rightX=${g.toFixed(0)}`))}adjustSingleBoundary(t,n){const s=this.state.pendingChanges.terrainBoundaries,r=100,c=0,d=this.getTerrainWidthForPanning();if(t==="left"){let g=s.leftX+n;g=Math.max(c,Math.min(g,s.rightX-r)),this.state.pendingChanges.terrainBoundaries.leftX=g,console.log(`[DESIGN MODE] Left boundary adjusted: leftX=${g.toFixed(0)}`)}else{let g=s.rightX+n;g=Math.max(s.leftX+r,Math.min(g,d)),this.state.pendingChanges.terrainBoundaries.rightX=g,console.log(`[DESIGN MODE] Right boundary adjusted: rightX=${g.toFixed(0)}`)}this.state.isDirty=!0}hasUnsavedChanges(){return this.state.isDirty}markSaved(){this.state.isDirty=!1}loadOverrides(t){const n=mr();this.state.pendingChanges={terrainAdjustments:t.terrainAdjustments??n.terrainAdjustments,entityOverrides:t.entityOverrides??n.entityOverrides,pathOverrides:t.pathOverrides??n.pathOverrides,deletedEntities:t.deletedEntities??n.deletedEntities,terrainBoundaries:t.terrainBoundaries??n.terrainBoundaries,addedEntities:t.addedEntities??n.addedEntities,addedPaths:t.addedPaths??n.addedPaths,entityMetadataOverrides:t.entityMetadataOverrides??n.entityMetadataOverrides,pathMetadataOverrides:t.pathMetadataOverrides??n.pathMetadataOverrides,destroyedOverlays:t.destroyedOverlays??n.destroyedOverlays},this.addedEntitiesCache.clear();for(const s of this.state.pendingChanges.addedEntities)this.addedEntitiesCache.set(s.id,s);this.addedPathsCache.clear();for(const s of this.state.pendingChanges.addedPaths)this.addedPathsCache.set(s.id,s);console.log("[DESIGN MODE] Loaded overrides:",`${this.state.pendingChanges.addedEntities.length} added entities,`,`${this.state.pendingChanges.addedPaths.length} added paths,`,`${this.state.pendingChanges.destroyedOverlays.length} destroyed overlays`),this.state.isDirty=!1}resetToDefaults(){this.state.pendingChanges=mr(),this.state.selectedElement=null,this.state.isDirty=!0}loadCompiledOverrides(){const t=Vi(this.campaign,this.level),n=mr();if(t){const s=(t.destroyedOverlays??[]).map(r=>({id:r.id,cropArea:r.cropArea,linkedTargetId:r.linkedTargetId,imageGenerated:!0,imagePath:r.imagePath,showInDesignMode:!1}));this.state.pendingChanges={terrainAdjustments:{mapWidthExtended:n.terrainAdjustments.mapWidthExtended,terrainHorizontalOffset:t.terrainHorizontalOffset??0},entityOverrides:t.entityOverrides??{},pathOverrides:t.pathOverrides??{},deletedEntities:t.deletedEntities??[],terrainBoundaries:t.terrainBoundaries??n.terrainBoundaries,addedEntities:t.addedEntities??[],addedPaths:t.addedPaths??[],entityMetadataOverrides:t.entityMetadataOverrides??{},pathMetadataOverrides:t.pathMetadataOverrides??{},destroyedOverlays:s},this.addedEntitiesCache.clear();for(const r of this.state.pendingChanges.addedEntities)this.addedEntitiesCache.set(r.id,r);this.addedPathsCache.clear();for(const r of this.state.pendingChanges.addedPaths)this.addedPathsCache.set(r.id,r);console.log(`[DESIGN MODE] Loaded compiled overrides for ${this.campaign} level ${this.level}:`,`${Object.keys(t.entityOverrides||{}).length} entity positions,`,`${Object.keys(t.pathOverrides||{}).length} path offsets,`,`${(t.addedEntities||[]).length} added entities,`,`${(t.addedPaths||[]).length} added paths,`,`${s.length} destroyed overlays`)}else this.state.pendingChanges=n,this.addedEntitiesCache.clear(),this.addedPathsCache.clear(),console.log(`[DESIGN MODE] No compiled overrides for ${this.campaign} level ${this.level}, using defaults`);this.state.isDirty=!1}getTotalMapHeight(){const t=gt.getTotalMapHeight();return t>0?t:Ot.TOTAL_MAP_HEIGHT}getBaseOffsetX(){const t=ga(this.campaign,this.level);return Math.floor((t.mapWidthExtended-P)/2)}getTerrainWidthForPanning(){const t=ba.getDetectedTerrainWidth(this.campaign,this.level);return t!==null?t:ga(this.campaign,this.level).mapWidthExtended}getBaseOffsetXForPanning(){const t=this.getTerrainWidthForPanning();return Math.floor((t-P)/2)}screenToWorldY(t){return this.getTotalMapHeight()-this.state.designScrollY-(Y-t)}screenToWorldX(t){const n=this.getBaseOffsetX();return t+n+this.state.designScrollX-this.getTerrainHorizontalOffset()}worldToScreenY(t){const n=this.getTotalMapHeight()-this.state.designScrollY;return Y-(n-t)}findElementAt(t,n){const s=this.state.pendingChanges.entityOverrides,r=this.worldToScreenY(n),c=this.state.designScrollX,h=this.getBaseOffsetX(),d=this.getTerrainHorizontalOffset(),g=this.state.pendingChanges.deletedEntities,m=this.state.currentCampaign,y=this.state.currentLevel;for(const x of this.state.pendingChanges.addedEntities){if(g.includes(x.id)||m&&Pi(m,y,x.id))continue;const I=x.x-h-c+d,G=this.worldToScreenY(x.y),W=t-I,Q=r-G;if(Math.sqrt(W*W+Q*Q)<Ch)return{id:x.id,type:x.entityType==="turret"?"turret":"target",originalPosition:{x:x.x,y:x.y},currentPosition:{x:x.x,y:x.y}}}for(const x of this.state.pendingChanges.addedPaths)if(!(x.waypoints.length<1))for(let I=0;I<x.waypoints.length;I++){const G=x.waypoints[I],W=G.x-h-c+d,Q=this.worldToScreenY(G.y),j=t-W,q=r-Q;if(Math.sqrt(j*j+q*q)<RE)return{id:x.id,type:"added-path",originalPosition:{x:G.x,y:G.y},currentPosition:{x:G.x,y:G.y},selectedVertexIndex:I,originalWaypoints:x.waypoints.map(ye=>({x:ye.x,y:ye.y}))}}for(const x of this.state.pendingChanges.addedPaths)if(!(x.waypoints.length<2))for(let I=0;I<x.waypoints.length-1;I++){const G=x.waypoints[I],W=x.waypoints[I+1],Q=G.x-h-c+d,j=this.worldToScreenY(G.y),q=W.x-h-c+d,Ee=this.worldToScreenY(W.y);if(this.pointToSegmentDistance(t,r,Q,j,q,Ee)<cp){const fe=Math.min(...x.waypoints.map(se=>se.x)),re=Math.max(...x.waypoints.map(se=>se.x)),ce=Math.min(...x.waypoints.map(se=>se.y)),Te=Math.max(...x.waypoints.map(se=>se.y)),at=(fe+re)/2,U=(ce+Te)/2;return{id:x.id,type:"added-path",originalPosition:{x:at,y:U},currentPosition:{x:at,y:U},isLineDrag:!0,originalWaypoints:x.waypoints.map(se=>({x:se.x,y:se.y}))}}}for(const x of this.state.pendingChanges.destroyedOverlays){const{cropArea:I,id:G}=x,W=I.x-h-c+d,Q=W+I.width,j=this.worldToScreenY(I.y),q=this.worldToScreenY(I.y+I.height),Ee=Math.min(j,q),ye=Math.max(j,q);if(t>=W&&t<=Q&&r>=Ee&&r<=ye){const fe=I.x+I.width/2,re=I.y+I.height/2;return{id:G,type:"destroyed-overlay",originalPosition:{x:fe,y:re},currentPosition:{x:fe,y:re}}}}const E=gt.getTurrets();for(const[x,I]of E){if(g.includes(x)||m&&Pi(m,y,x))continue;const G=s[x],W=(G==null?void 0:G.x)??I.metadata.x,Q=(G==null?void 0:G.y)??I.metadata.y,j=W-h-c,q=this.worldToScreenY(Q),Ee=t-j,ye=r-q;if(Math.sqrt(Ee*Ee+ye*ye)<Ch)return{id:x,type:"turret",originalPosition:{x:I.metadata.x,y:I.metadata.y},currentPosition:{x:W,y:Q}}}const A=ea.getAllTargetsForDesignMode(this.state.designScrollY);for(const x of A){if(g.includes(x.id)||m&&Pi(m,y,x.id))continue;const I=s[x.id],G=(I==null?void 0:I.x)??x.x,W=(I==null?void 0:I.y)??x.y,Q=G-h-c,j=this.worldToScreenY(W),q=t-Q,Ee=r-j;if(Math.sqrt(q*q+Ee*Ee)<Ch)return{id:x.id,type:"target",originalPosition:{x:x.x,y:x.y},currentPosition:{x:G,y:W}}}for(const x of this.entityPaths){if(x.waypoints.length<2)continue;const I=this.getPathOffset(x.id);for(let G=0;G<x.waypoints.length-1;G++){const W=x.waypoints[G],Q=x.waypoints[G+1],j=W.x+I-h-c,q=this.worldToScreenY(W.y),Ee=Q.x+I-h-c,ye=this.worldToScreenY(Q.y);if(q<-100&&ye<-100||q>Y+100&&ye>Y+100)continue;if(this.pointToSegmentDistance(t,r,j,q,Ee,ye)<cp){const re=Math.min(...x.waypoints.map(_e=>_e.x)),ce=Math.max(...x.waypoints.map(_e=>_e.x)),Te=Math.min(...x.waypoints.map(_e=>_e.y)),at=Math.max(...x.waypoints.map(_e=>_e.y)),U=(re+ce)/2,se=(Te+at)/2;return{id:x.id,type:"path",originalPosition:{x:U,y:se},currentPosition:{x:U+I,y:se}}}}}const v=this.state.pendingChanges.terrainBoundaries,b=20,O=this.getBaseOffsetXForPanning(),L=v.leftX-O-this.state.designScrollX+d,N=v.rightX-O-this.state.designScrollX+d;return L>=-b&&L<=P+b&&Math.abs(t-L)<b?{id:"left_boundary",type:"boundary",originalPosition:{x:v.leftX,y:0},currentPosition:{x:v.leftX,y:0}}:N>=-b&&N<=P+b&&Math.abs(t-N)<b?{id:"right_boundary",type:"boundary",originalPosition:{x:v.rightX,y:0},currentPosition:{x:v.rightX,y:0}}:null}pointToSegmentDistance(t,n,s,r,c,h){const d=c-s,g=h-r,m=d*d+g*g;if(m===0)return Math.sqrt((t-s)*(t-s)+(n-r)*(n-r));let y=((t-s)*d+(n-r)*g)/m;y=Math.max(0,Math.min(1,y));const E=s+y*d,A=r+y*g;return Math.sqrt((t-E)*(t-E)+(n-A)*(n-A))}selectElement(t){this.state.selectedElement=t}startDrag(t,n,s){if(this.state.isDragging=!0,this.dragStartX=t,this.dragStartY=n,s.type==="path"||s.type==="added-path")this.addedPathsCache.get(s.id)&&(s.selectedVertexIndex!==void 0||s.isLineDrag)?(this.pathDragStartX=t,this.dragStartY=n):(this.pathDragStartX=t,this.pathOriginalOffset=this.getPathOffset(s.id));else{const r=this.getBaseOffsetX(),c=s.currentPosition.x-r-this.state.designScrollX;this.dragOffsetX=t-c,this.dragOffsetY=n-this.worldToScreenY(s.currentPosition.y)}}updateDrag(t,n){if(this.state.selectedElement)if(this.state.selectedElement.type==="path"||this.state.selectedElement.type==="added-path"){const s=this.state.selectedElement,r=this.addedPathsCache.get(s.id);if(r&&s.originalWaypoints){const c=t-this.pathDragStartX,h=n-this.dragStartY;if(this.getBaseOffsetX(),this.getTerrainHorizontalOffset(),s.selectedVertexIndex!==void 0){const d=s.selectedVertexIndex,g=s.originalWaypoints[d],m=g.x+c,y=g.y-h;r.waypoints[d]={x:m,y};const E=this.state.pendingChanges.addedPaths.findIndex(A=>A.id===s.id);E>=0&&(this.state.pendingChanges.addedPaths[E].waypoints[d]={x:m,y}),s.currentPosition={x:m,y},this.state.isDirty=!0}else if(s.isLineDrag){const d=s.originalWaypoints.map(v=>({x:v.x+c,y:v.y-h}));r.waypoints=d;const g=this.state.pendingChanges.addedPaths.findIndex(v=>v.id===s.id);g>=0&&(this.state.pendingChanges.addedPaths[g].waypoints=d);const m=Math.min(...d.map(v=>v.x)),y=Math.max(...d.map(v=>v.x)),E=Math.min(...d.map(v=>v.y)),A=Math.max(...d.map(v=>v.y));s.currentPosition={x:(m+y)/2,y:(E+A)/2},this.state.isDirty=!0}}else{const c=t-this.pathDragStartX,h=this.pathOriginalOffset+c;this.state.pendingChanges.pathOverrides[s.id]={horizontalOffset:h},s.currentPosition={x:s.originalPosition.x+h,y:s.originalPosition.y},this.state.isDirty=!0}}else if(this.state.selectedElement.type==="boundary"){const s=this.getBaseOffsetXForPanning(),r=this.getTerrainHorizontalOffset(),c=t+s+this.state.designScrollX-r,h=this.getTerrainWidthForPanning(),d=Math.max(0,Math.min(h,c));if(this.state.selectedElement.id==="left_boundary"){const g=this.state.pendingChanges.terrainBoundaries.rightX,m=Math.min(d,g-50);this.state.pendingChanges.terrainBoundaries.leftX=m,this.state.selectedElement.currentPosition={x:m,y:0},this.state.selectedElement.originalPosition={x:m,y:0}}else if(this.state.selectedElement.id==="right_boundary"){const g=this.state.pendingChanges.terrainBoundaries.leftX,m=Math.max(d,g+50);this.state.pendingChanges.terrainBoundaries.rightX=m,this.state.selectedElement.currentPosition={x:m,y:0},this.state.selectedElement.originalPosition={x:m,y:0}}this.state.isDirty=!0}else if(this.state.selectedElement.type==="destroyed-overlay"){const s=this.getTerrainHorizontalOffset(),r=this.getBaseOffsetX(),h=t-this.dragOffsetX+r+this.state.designScrollX-s,d=n-this.dragOffsetY,g=this.screenToWorldY(d),m=this.state.pendingChanges.destroyedOverlays.find(y=>y.id===this.state.selectedElement.id);if(m){const y=m.cropArea.x+m.cropArea.width/2,E=m.cropArea.y+m.cropArea.height/2,A=h-y,v=g-E;m.cropArea.x+=A,m.cropArea.y+=v,this.state.selectedElement.currentPosition={x:h,y:g},this.state.isDirty=!0}}else{const s=this.getBaseOffsetX(),c=t-this.dragOffsetX+s+this.state.designScrollX,h=Math.max(0,Math.min(Ot.MAP_WIDTH_EXTENDED,c)),d=n-this.dragOffsetY,g=this.screenToWorldY(d);this.state.selectedElement.currentPosition={x:h,y:g},this.state.pendingChanges.entityOverrides[this.state.selectedElement.id]={x:h,y:g},this.state.isDirty=!0}}startPan(t,n){this.state.isPanning=!0,this.panStartX=t,this.panStartY=n,this.scrollXAtPanStart=this.state.designScrollX,this.scrollYAtPanStart=this.state.designScrollY}updatePan(t,n){const s=(t-this.panStartX)*up,r=(n-this.panStartY)*up,c=this.getTerrainWidthForPanning(),h=this.getBaseOffsetXForPanning(),d=this.getTerrainHorizontalOffset(),g=-h+d,m=c-h-P+d;this.state.designScrollX=Math.max(g,Math.min(m,this.scrollXAtPanStart-s)),this.state.designScrollY=Math.max(0,Math.min(this.getTotalMapHeight()-Y,this.scrollYAtPanStart-r))}getTurretsForRendering(){return gt.getTurrets()}getLevelInfo(){return{campaign:this.campaign,level:this.level}}getEffectiveTerrainAdjustments(){return ga(this.campaign,this.level)}resetForLevelSwitch(){this.state.pendingChanges=mr(),this.state.selectedElement=null,this.state.isDirty=!1,this.state.designScrollX=0,this.state.designScrollY=0,this.state.isPanning=!1,this.state.isDragging=!1,this.entityPaths=[],this.cancelDestroySelection(),console.log("[DESIGN MODE] State reset for level switch")}startDestroySelection(t,n){const s=this.screenToWorld(t,n);this.state.destroySelectionStart=s,this.state.destroySelectionEnd=null,this.state.isSelectingDestroyArea=!0,console.log(`[DESIGN MODE] Started destroy selection at world (${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}updateDestroySelection(t,n){this.state.isSelectingDestroyArea&&(this.state.destroySelectionEnd=this.screenToWorld(t,n))}completeDestroySelection(){if(!this.state.destroySelectionStart||!this.state.destroySelectionEnd)return this.cancelDestroySelection(),null;const t=Math.min(this.state.destroySelectionStart.x,this.state.destroySelectionEnd.x),n=Math.min(this.state.destroySelectionStart.y,this.state.destroySelectionEnd.y),s=Math.max(this.state.destroySelectionStart.x,this.state.destroySelectionEnd.x),r=Math.max(this.state.destroySelectionStart.y,this.state.destroySelectionEnd.y),c=s-t,h=r-n;if(c<10||h<10)return console.log("[DESIGN MODE] Destroy selection too small, canceling"),this.cancelDestroySelection(),null;const d=Date.now(),g=Math.random().toString(36).substring(2,6),m=`destroyed_overlay_${this.campaign}_${this.level}_${d}_${g}`,y={id:m,cropArea:{x:t,y:n,width:c,height:h},linkedTargetId:null,imageGenerated:!1,imagePath:null,showInDesignMode:!0};return this.state.pendingChanges.destroyedOverlays.push(y),this.state.isDirty=!0,console.log(`[DESIGN MODE] Created destroy overlay: ${m} at (${t.toFixed(1)}, ${n.toFixed(1)}) size ${c.toFixed(0)}x${h.toFixed(0)}`),this.cancelDestroySelection(),y}cancelDestroySelection(){this.state.destroySelectionStart=null,this.state.destroySelectionEnd=null,this.state.isSelectingDestroyArea=!1}getDestroyedOverlays(){return this.state.pendingChanges.destroyedOverlays}getDestroyedOverlay(t){return this.state.pendingChanges.destroyedOverlays.find(n=>n.id===t)}linkOverlayToTarget(t,n){const s=this.state.pendingChanges.destroyedOverlays.find(r=>r.id===t);s&&(s.linkedTargetId=n,this.state.isDirty=!0,console.log(`[DESIGN MODE] Linked overlay ${t} to target ${n??"none"}`))}unlinkOverlayFromTarget(t){this.linkOverlayToTarget(t,null),console.log(`[DESIGN MODE] Unlinked overlay ${t} from target`)}cancelTargetSelection(){this.state.isSelectingLinkTarget=!1,this.state.linkingOverlayId=null,console.log("[DesignMode] Cancelled target selection mode")}completeTargetSelection(t){this.state.linkingOverlayId&&(this.linkOverlayToTarget(this.state.linkingOverlayId,t),console.log(`[DesignMode] Linked overlay ${this.state.linkingOverlayId} to target ${t}`)),this.state.isSelectingLinkTarget=!1,this.state.linkingOverlayId=null}toggleOverlayVisibility(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);n&&(n.showInDesignMode=!n.showInDesignMode,console.log(`[DESIGN MODE] Toggled overlay ${t} visibility: ${n.showInDesignMode}`))}markOverlayImageGenerated(t,n){const s=this.state.pendingChanges.destroyedOverlays.find(r=>r.id===t);s&&(s.imageGenerated=!0,s.imagePath=n,this.state.isDirty=!0,console.log(`[DESIGN MODE] Marked overlay ${t} as generated: ${n}`))}clearOverlayImage(t){const n=this.state.pendingChanges.destroyedOverlays.find(s=>s.id===t);n&&(n.imageGenerated=!1,n.imagePath=null,this.state.isDirty=!0,console.log(`[DESIGN MODE] Cleared overlay ${t} for regeneration`))}deleteDestroyedOverlay(t){var s;const n=this.state.pendingChanges.destroyedOverlays.findIndex(r=>r.id===t);n>=0&&(this.state.pendingChanges.destroyedOverlays.splice(n,1),this.state.isDirty=!0,((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null),console.log(`[DESIGN MODE] Deleted overlay ${t}`))}isDestroySelecting(){return this.state.isSelectingDestroyArea}getDestroySelectionBounds(){return!this.state.destroySelectionStart||!this.state.destroySelectionEnd?null:{start:this.state.destroySelectionStart,end:this.state.destroySelectionEnd}}}const V=new bE,xE="/play-wwii-sky-ace/",gp=xE;function dn(o){{const n=o.includes("title-page.mp3")||o.includes("dawn-patrol/")&&(o.includes("story.mp3")||o.includes("level/track-1.mp3")||o.includes("boss/track-1.mp3"))?`${gp}dist-assets/initial/audio`:`${gp}dist-assets/progressive/audio`,s=o.replace("/assets-audio/","");return`${n}/${s}`}}pe.DAWN_PATROL+"",pe.STEEL_VANGUARD+"",pe.HELLFIRE_HORIZON+"";const cc={[pe.DAWN_PATROL]:{campaign:pe.DAWN_PATROL,folderName:"dawn-patrol",levelCount:Wn[pe.DAWN_PATROL].levelCount,bossCount:1},[pe.STEEL_VANGUARD]:{campaign:pe.STEEL_VANGUARD,folderName:"steel-vanguard",levelCount:Wn[pe.STEEL_VANGUARD].levelCount,bossCount:1},[pe.HELLFIRE_HORIZON]:{campaign:pe.HELLFIRE_HORIZON,folderName:"hellfire-horizon",levelCount:Wn[pe.HELLFIRE_HORIZON].levelCount,bossCount:1}};function OE(o,t){const n=cc[o],s=Math.min(Math.max(1,t),n.levelCount),r=(s-1)%5+1,c=`/assets-audio/campaigns/${n.folderName}/level/track-${s}.mp3`,h=`/assets-audio/legacy/levelmusic-track${r}.mp3`;return{campaignPath:dn(c),fallbackPath:dn(h)}}function LE(o,t){const n=cc[o],s=Math.min(Math.max(1,t),n.bossCount),r=(s-1)%5+1,c=`/assets-audio/campaigns/${n.folderName}/boss/track-${s}.mp3`,h=`/assets-audio/legacy/bossmusic-track${r}.mp3`;return{campaignPath:dn(c),fallbackPath:dn(h)}}function NE(o){const n=`/assets-audio/campaigns/${cc[o].folderName}/story.mp3`;return{campaignPath:dn(n),fallbackPath:dn("/assets-audio/legacy/levelmusic-track1.mp3")}}function DE(o){const n=`/assets-audio/campaigns/${cc[o].folderName}/ending.mp3`;return{campaignPath:dn(n),fallbackPath:dn("/assets-audio/legacy/levelmusic-track5.mp3")}}function wE(){return dn("/assets-audio/campaigns/title-page.mp3")}async function PE(o){try{return(await fetch(o,{method:"HEAD"})).ok}catch{return!1}}const pp="wwii-sky-ace-settings",Bh={controlScheme:"arrows",enemySpeed:60,enemyFireRate:60,musicVolume:30,sfxVolume:90,miniMapEnabled:!0,scanlinesIntensity:50};class CE{constructor(){this.listeners=new Set,this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem(pp);if(t){const n=JSON.parse(t);return{...Bh,...n}}}catch(t){console.warn("[GameSettings] Failed to load settings from localStorage:",t)}return{...Bh}}saveSettings(){try{localStorage.setItem(pp,JSON.stringify(this.settings))}catch(t){console.warn("[GameSettings] Failed to save settings to localStorage:",t)}}getSettings(){return{...this.settings}}updateSettings(t){this.settings={...this.settings,...t},this.saveSettings(),this.notifyListeners()}resetToDefaults(){this.settings={...Bh},this.saveSettings(),this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getSettings();this.listeners.forEach(n=>n(t))}getControlKeys(){return this.settings.controlScheme==="wasd"?{LEFT:["a","A"],RIGHT:["d","D"],UP:["w","W"],DOWN:["s","S"]}:{LEFT:["ArrowLeft","a","A"],RIGHT:["ArrowRight","d","D"],UP:["ArrowUp","w","W"],DOWN:["ArrowDown","s","S"]}}getEnemySpeedMultiplier(){return this.settings.enemySpeed/100}getEnemyFireRateMultiplier(){return this.settings.enemyFireRate/100}getMusicVolume(){return this.settings.musicVolume/100}getSfxVolume(){return this.settings.sfxVolume/100}getScanlinesIntensity(){return this.settings.scanlinesIntensity/100}}const Bt=new CE;let Rs=null,Fh=null;function Qo(){return Rs||(typeof window<"u"&&window.jsmediatags?window.jsmediatags:null)}async function IE(){var o;return Qo()?!0:(Fh||(Fh=(async()=>{var t;try{const n=await Wt(()=>import("./jsmediatags.min-BbXif6c5.js").then(s=>s.j),[]);console.log("[ID3 Service] jsmediatags module loaded:",Object.keys(n)),Rs=n.default||n.jsmediatags||n,!(Rs!=null&&Rs.read)&&typeof window<"u"&&window.jsmediatags&&(Rs=window.jsmediatags),console.log("[ID3 Service] jsmediatags ready:",!!((t=Qo())!=null&&t.read))}catch(n){console.error("[ID3 Service] Failed to load jsmediatags:",n)}})()),await Fh,!!((o=Qo())!=null&&o.read))}const As=new Map;async function BE(o){if(As.has(o))return console.log("[ID3 Service] Returning cached metadata for:",o),As.get(o);if(console.log("[ID3 Service] Extracting metadata from:",o),!await IE()){console.warn("[ID3 Service] jsmediatags not available");const n={};return As.set(o,n),n}try{const n=await fetch(o);if(!n.ok){console.warn(`[ID3 Service] Failed to fetch ${o}: ${n.status}`);const r={};return As.set(o,r),r}const s=await n.blob();return console.log("[ID3 Service] Fetched blob, size:",s.size),new Promise(r=>{Qo().read(s,{onSuccess:h=>{var m;console.log("[ID3 Service] Successfully parsed tags:",{title:h.tags.title,artist:h.tags.artist,hasPicture:!!h.tags.picture});const d={title:h.tags.title,artist:h.tags.artist},g=h.tags.picture;if(g){console.log("[ID3 Service] Found picture:",{format:g.format,dataLength:(m=g.data)==null?void 0:m.length});const y=btoa(g.data.reduce((E,A)=>E+String.fromCharCode(A),""));d.artwork=`data:${g.format};base64,${y}`,console.log("[ID3 Service] Created artwork data URL, length:",d.artwork.length)}As.set(o,d),r(d)},onError:h=>{console.warn(`[ID3 Service] jsmediatags error for ${o}:`,h);const d={};As.set(o,d),r(d)}})})}catch(n){console.warn(`[ID3 Service] Exception extracting metadata from ${o}:`,n);const s={};return As.set(o,s),s}}async function FE(o){return o.artwork?new Promise(t=>{const n=new Image;n.onload=()=>t(n),n.onerror=()=>{console.warn("[ID3 Service] Failed to load artwork image"),t(null)},n.src=o.artwork}):null}const HE=1e3,Ss=1500,YE=2e3;class GE{constructor(){this.ctx=null,this.masterGain=null,this.musicGain=null,this.activeOscillators=[],this.currentMusic=null,this.currentLevel=0,this.isBossMusic=!1,this.unlockAttempted=!1,this.bombDescendingOsc=null,this.bombDescendingGain=null,this.currentCampaign=pe.STEEL_VANGUARD,this.musicExistsCache=new Map,this.currentTrackMetadata=null,this.currentArtworkImage=null,this.currentTrackPath="",this.baseSfxVolume=1,this.baseMusicVolume=1,this.muted=!1}getSfxVolume(){return(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?1:this.baseSfxVolume)*Bt.getSfxVolume()}getMusicVolume(){return this.baseMusicVolume*Bt.getMusicVolume()}updateVolumes(){this.masterGain&&this.ctx&&this.masterGain.gain.setValueAtTime(this.getSfxVolume(),this.ctx.currentTime),this.currentMusic&&(this.currentMusic.volume=Bt.getMusicVolume())}setMuted(t){this.muted=t,t&&this.stopMusic(!0)}isMutedState(){return this.muted}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=this.getSfxVolume(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.gain.value=this.getMusicVolume(),this.musicGain.connect(this.ctx.destination),console.log("[AudioService] Initialized AudioContext, state:",this.ctx.state),Bt.subscribe(()=>{this.updateVolumes()}),this.unlockAttempted||this.setupGlobalUnlock()),this.ctx.state==="suspended"&&(console.log("[AudioService] Resuming suspended AudioContext..."),this.ctx.resume().then(()=>{var t;console.log("[AudioService] AudioContext resumed, state:",(t=this.ctx)==null?void 0:t.state)}).catch(t=>{console.warn("[AudioService] Failed to resume AudioContext:",t)}))}setupGlobalUnlock(){if(this.unlockAttempted)return;this.unlockAttempted=!0;const t=()=>{console.log("[AudioService] Global unlock triggered"),this.unlockAudio(),document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0)};document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),console.log("[AudioService] Global unlock listeners registered")}unlockAudio(){if(this.init(),!this.ctx)return;console.log("[AudioService] unlockAudio called, current state:",this.ctx.state);const t=this.ctx.state==="suspended"?this.ctx.resume():Promise.resolve();try{const n=this.ctx.createBuffer(1,1,22050),s=this.ctx.createBufferSource();s.buffer=n,s.connect(this.ctx.destination),s.start(0),console.log("[AudioService] Silent buffer played for iOS unlock")}catch(n){console.warn("[AudioService] Failed to play silent buffer:",n)}try{const n=this.ctx.createOscillator(),s=this.ctx.createGain();s.gain.value=.001,n.connect(s),s.connect(this.ctx.destination),n.start(0),n.stop(this.ctx.currentTime+.001),console.log("[AudioService] Silent oscillator played for iOS unlock")}catch(n){console.warn("[AudioService] Failed to play silent oscillator:",n)}t.then(()=>{var n;console.log("[AudioService] Audio unlocked, final state:",(n=this.ctx)==null?void 0:n.state)}).catch(n=>{console.warn("[AudioService] Resume failed:",n)})}fadeOut(t,n=Ss){return new Promise(s=>{const r=t.volume,c=performance.now(),h=()=>{const d=performance.now()-c,g=Math.min(d/n,1);t.volume=r*(1-g),g<1?requestAnimationFrame(h):(t.pause(),t.currentTime=0,t.volume=r,s())};requestAnimationFrame(h)})}fadeIn(t,n,s=Ss){t.volume=0,t.play().catch(()=>{});const r=performance.now(),c=()=>{const h=performance.now()-r,d=Math.min(h/s,1);t.volume=n*d,d<1&&requestAnimationFrame(c)};requestAnimationFrame(c)}crossfadeTo(t,n,s=Ss){const r=this.currentMusic;this.currentMusic=t,this.fadeIn(t,n,s),r&&this.fadeOut(r,s)}stopMusic(t=!1,n=Ss){if(this.currentMusic)if(t){const s=this.currentMusic;this.currentMusic=null,this.fadeOut(s,n)}else this.currentMusic.pause(),this.currentMusic.currentTime=0,this.currentMusic=null;this.musicGain&&(this.musicGain.gain.cancelScheduledValues(0),this.musicGain.gain.value=0,setTimeout(()=>{this.musicGain&&this.ctx&&this.musicGain.gain.setValueAtTime(.1,this.ctx.currentTime)},100))}setCampaign(t){this.currentCampaign=t,console.log("[AudioService] Campaign set to:",t)}getCampaign(){return this.currentCampaign}getCurrentMusic(){return this.currentMusic}getCurrentArtworkImage(){return this.currentArtworkImage}getCurrentTrackMetadata(){return this.currentTrackMetadata}getCurrentTime(){var t;return((t=this.currentMusic)==null?void 0:t.currentTime)||0}getDuration(){var t;return((t=this.currentMusic)==null?void 0:t.duration)||0}isPlaying(){return this.currentMusic?!this.currentMusic.paused:!1}seekTo(t){if(this.currentMusic){const n=this.currentMusic.duration||0;this.currentMusic.currentTime=Math.max(0,Math.min(t,n))}}togglePlayPause(){this.currentMusic&&(this.currentMusic.paused?this.currentMusic.play().catch(()=>{}):this.currentMusic.pause())}restartTrack(){this.currentMusic&&(this.currentMusic.currentTime=0,this.currentMusic.paused&&this.currentMusic.play().catch(()=>{}))}async loadCurrentTrackMetadata(t){if(!(t===this.currentTrackPath&&this.currentTrackMetadata)){this.currentTrackPath=t;try{this.currentTrackMetadata=await BE(t),this.currentArtworkImage=await FE(this.currentTrackMetadata),console.log("[AudioService] Loaded track metadata:",{title:this.currentTrackMetadata.title,hasArtwork:!!this.currentArtworkImage})}catch(n){console.warn("[AudioService] Failed to load track metadata:",n),this.currentTrackMetadata=null,this.currentArtworkImage=null}}}playLevelMusic(t,n){if(this.muted)return;this.init();const s=n||this.currentCampaign;this.currentLevel=t,this.isBossMusic=!1;const r=OE(s,t);this.playMusicWithFallback(r,!0,"level")}playBossMusic(t,n){if(this.muted)return;this.init();const s=n||this.currentCampaign;this.currentLevel=t,this.isBossMusic=!0;const r=LE(s,t);this.playMusicWithFallback(r,!0,"boss")}playStoryMusic(t){if(this.muted)return;this.init();const n=t||this.currentCampaign,s=NE(n);this.playMusicWithFallback(s,!0,"story")}playEndingMusic(t){if(this.muted)return;this.init();const n=t||this.currentCampaign,s=DE(n);this.playMusicWithFallback(s,!1,"ending")}playTitleMusic(){var r;if(this.muted||(this.init(),(r=this.currentMusic)!=null&&r.src.includes("title-page.mp3")))return;const t=Bt.getMusicVolume(),n=wE();console.log("[AudioService] Playing title page music:",n);const s=new Audio(n);s.loop=!0,this.currentMusic?this.crossfadeTo(s,t,Ss):(this.currentMusic=s,this.fadeIn(s,t,Ss)),this.loadCurrentTrackMetadata(n)}isTitleMusicPlaying(){var t;return((t=this.currentMusic)==null?void 0:t.src.includes("title-page.mp3"))??!1}async playMusicWithFallback(t,n,s){let r=this.musicExistsCache.get(t.campaignPath);r===void 0&&(r=await PE(t.campaignPath),this.musicExistsCache.set(t.campaignPath,r));const c=r?t.campaignPath:t.fallbackPath;console.log(`[AudioService] Playing ${s} music: ${c}`);const h=Bt.getMusicVolume();let d;switch(s){case"boss":d=HE;break;case"ending":d=YE;break;default:d=Ss}const g=new Audio(c);g.loop=n,this.currentMusic?this.crossfadeTo(g,h,d):(this.currentMusic=g,this.fadeIn(g,h,d)),this.loadCurrentTrackMetadata(c),g.onerror=()=>{if(console.warn(`Failed to play ${s} music (${c})`),r&&c!==t.fallbackPath){console.log(`[AudioService] Trying fallback: ${t.fallbackPath}`);const m=new Audio(t.fallbackPath);m.loop=n,this.crossfadeTo(m,h,d)}}}playNote(t,n,s,r="square"){if(!this.ctx||!this.musicGain)return;const c=this.ctx.createOscillator(),h=this.ctx.createGain();c.type=r,c.frequency.setValueAtTime(t,n),h.gain.setValueAtTime(.2,n),h.gain.exponentialRampToValueAtTime(.01,n+s-.05),c.connect(h),h.connect(this.musicGain),c.start(n),c.stop(n+s)}playIntroMusic(){if(this.muted||(this.init(),this.stopMusic(),!this.ctx))return;const t=this.ctx.currentTime+.1,n=.12,s=[{f:196,d:1},{f:261.63,d:1},{f:329.63,d:1},{f:392,d:1},{f:523.25,d:4},{f:392,d:1},{f:392,d:1},{f:392,d:1},{f:329.63,d:2},{f:392,d:2},{f:523.25,d:6}];let r=0;s.forEach(c=>{this.playNote(c.f,t+r,c.d*n,"square"),r+=c.d*n})}playGameOverMusic(){if(this.muted||(this.init(),this.stopMusic(),!this.ctx))return;const t=this.ctx.currentTime+.1,n=.3,s=[{f:392,d:2},{f:369.99,d:2},{f:349.23,d:2},{f:329.63,d:4},{f:293.66,d:2},{f:196,d:8}];let r=0;s.forEach(c=>{this.playNote(c.f,t+r,c.d*n,"triangle"),r+=c.d*n})}playShoot(){if(this.muted||!this.ctx||!this.masterGain)return;if(this.ctx.state==="suspended"){this.ctx.resume();return}const t=this.ctx.createOscillator(),n=this.ctx.createGain(),s=this.ctx.createBiquadFilter();t.type="sawtooth",s.type="lowpass",s.frequency.setValueAtTime(1200,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+.05),t.frequency.setValueAtTime(280,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(80,this.ctx.currentTime+.05);const r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),c=r?.218:.168,h=r?.018:.014;n.gain.setValueAtTime(c,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(h,this.ctx.currentTime+.05),t.connect(s),s.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.05)}playEnemyExplosion(){this.muted||!this.ctx||!this.masterGain||this.createNoise(.2,.28)}playSmallExplosion(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.12,n=Math.floor(this.ctx.sampleRate*t),s=this.ctx.createBuffer(1,n,this.ctx.sampleRate),r=s.getChannelData(0);for(let g=0;g<n;g++){const m=1-g/n;r[g]=(Math.random()*2-1)*m*m}const c=this.ctx.createBufferSource();c.buffer=s;const h=this.ctx.createGain();h.gain.setValueAtTime(.15,this.ctx.currentTime),h.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t);const d=this.ctx.createBiquadFilter();d.type="lowpass",d.frequency.value=800,c.connect(d),d.connect(h),h.connect(this.masterGain),c.start(),c.stop(this.ctx.currentTime+t)}playDescending(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.5,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(180,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(80,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(400,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(150,this.ctx.currentTime+t),s.gain.setValueAtTime(.06,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.1,this.ctx.currentTime+.05),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain);const c=this.ctx.createBuffer(1,this.ctx.sampleRate*t,this.ctx.sampleRate),h=c.getChannelData(0);for(let y=0;y<h.length;y++)h[y]=(Math.random()*2-1)*.5;const d=this.ctx.createBufferSource(),g=this.ctx.createGain(),m=this.ctx.createBiquadFilter();d.buffer=c,m.type="lowpass",m.frequency.setValueAtTime(300,this.ctx.currentTime),m.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+t),g.gain.setValueAtTime(.04,this.ctx.currentTime),g.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),d.connect(m),m.connect(g),g.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t),d.start(),d.stop(this.ctx.currentTime+t)}playPlayerExplosion(){this.muted||!this.ctx||!this.masterGain||this.createNoise(.8,1.12)}playBomb(){if(this.muted||!this.ctx||!this.masterGain)return;const t=1.5,n=this.ctx.sampleRate*t,s=this.ctx.createBuffer(1,n,this.ctx.sampleRate),r=s.getChannelData(0);for(let g=0;g<n;g++)r[g]=Math.random()*2-1;const c=this.ctx.createBufferSource();c.buffer=s;const h=this.ctx.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(400,this.ctx.currentTime),h.frequency.linearRampToValueAtTime(50,this.ctx.currentTime+t);const d=this.ctx.createGain();d.gain.setValueAtTime(1.12,this.ctx.currentTime),d.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+t),c.connect(h),h.connect(d),d.connect(this.masterGain),c.start()}playBombDescending(){if(this.muted||!this.ctx||!this.masterGain)return;this.stopBombDescending();const t=1.2,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sine",n.frequency.setValueAtTime(1200,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+t),r.type="bandpass",r.frequency.setValueAtTime(1e3,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+t),r.Q.value=8,s.gain.setValueAtTime(.05,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.2,this.ctx.currentTime+.1),s.gain.setValueAtTime(.2,this.ctx.currentTime+t*.8),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t),this.bombDescendingOsc=n,this.bombDescendingGain=s,n.onended=()=>{this.bombDescendingOsc=null,this.bombDescendingGain=null}}stopBombDescending(){if(this.bombDescendingOsc){try{this.bombDescendingOsc.stop()}catch{}this.bombDescendingOsc=null}if(this.bombDescendingGain&&this.ctx){try{this.bombDescendingGain.gain.cancelScheduledValues(this.ctx.currentTime),this.bombDescendingGain.gain.setValueAtTime(0,this.ctx.currentTime)}catch{}this.bombDescendingGain=null}}playCannon(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.createOscillator(),n=this.ctx.createGain(),s=this.ctx.createBiquadFilter();t.type="sawtooth",s.type="lowpass",s.frequency.setValueAtTime(500,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.3),t.frequency.setValueAtTime(80,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(20,this.ctx.currentTime+.3),n.gain.setValueAtTime(.49,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+.3),t.connect(s),s.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.3)}playPowerUp(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.createOscillator(),n=this.ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(220,this.ctx.currentTime),t.frequency.linearRampToValueAtTime(440,this.ctx.currentTime+.15),t.frequency.linearRampToValueAtTime(660,this.ctx.currentTime+.3),n.gain.setValueAtTime(.15,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.5),t.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.5)}playCoin(){if(!this.muted){if(this.init(),!this.ctx||!this.masterGain){console.warn("[AudioService] playCoin: ctx or masterGain not ready");return}if(console.log("[AudioService] playCoin: ctx state before:",this.ctx.state),this.ctx.state==="suspended"){console.log("[AudioService] playCoin: Resuming suspended context"),this.ctx.resume().then(()=>{console.log("[AudioService] playCoin: Context resumed, now playing sound"),this.playCoinSound()}).catch(t=>{console.warn("[AudioService] playCoin: Resume failed:",t)}),this.playCoinSound();return}this.playCoinSound()}}playMenuSelect(){if(this.muted||(this.init(),!this.ctx||!this.masterGain))return;this.ctx.state==="suspended"&&this.ctx.resume();const t=.15,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sine",n.frequency.setValueAtTime(300,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(1500,this.ctx.currentTime),r.Q.value=1,s.gain.setValueAtTime(.15,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}playCoinSound(){if(!this.ctx||!this.masterGain)return;console.log("[AudioService] Playing coin sound, ctx state:",this.ctx.state);const t=this.ctx.createOscillator(),n=this.ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(900,this.ctx.currentTime),t.frequency.setValueAtTime(1200,this.ctx.currentTime+.1),n.gain.setValueAtTime(.2,this.ctx.currentTime),n.gain.setValueAtTime(.2,this.ctx.currentTime+.1),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.3),t.connect(n),n.connect(this.masterGain),t.start(),t.stop(this.ctx.currentTime+.4)}playEvade(){if(this.muted||!this.ctx||!this.masterGain)return;const t=2.5,n=this.ctx.createOscillator(),s=this.ctx.createOscillator(),r=this.ctx.createGain(),c=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(800,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(200,this.ctx.currentTime+t*.5),n.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+t),s.type="sine",s.frequency.setValueAtTime(400,this.ctx.currentTime),s.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+t*.5),s.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+t),c.type="lowpass",c.frequency.setValueAtTime(2e3,this.ctx.currentTime),c.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t*.5),c.frequency.exponentialRampToValueAtTime(1500,this.ctx.currentTime+t),c.Q.value=5,r.gain.setValueAtTime(.15,this.ctx.currentTime),r.gain.setValueAtTime(.25,this.ctx.currentTime+.1),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(c),s.connect(c),c.connect(r),r.connect(this.masterGain),n.start(),s.start(),n.stop(this.ctx.currentTime+t),s.stop(this.ctx.currentTime+t)}playDive(){if(this.muted||!this.ctx||!this.masterGain)return;const t=.75,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="sawtooth",n.frequency.setValueAtTime(600,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(150,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(2e3,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+t),r.Q.value=3,s.gain.setValueAtTime(.15,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}playClimb(){if(this.muted||!this.ctx||!this.masterGain)return;const t=1,n=this.ctx.createOscillator(),s=this.ctx.createGain(),r=this.ctx.createBiquadFilter();n.type="triangle",n.frequency.setValueAtTime(200,this.ctx.currentTime),n.frequency.exponentialRampToValueAtTime(500,this.ctx.currentTime+t),r.type="lowpass",r.frequency.setValueAtTime(500,this.ctx.currentTime),r.frequency.exponentialRampToValueAtTime(1500,this.ctx.currentTime+t),r.Q.value=2,s.gain.setValueAtTime(.1,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.2,this.ctx.currentTime+t*.5),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+t),n.connect(r),r.connect(s),s.connect(this.masterGain),n.start(),n.stop(this.ctx.currentTime+t)}createNoise(t,n=.2){if(!this.ctx||!this.masterGain)return;const s=this.ctx.sampleRate*t,r=this.ctx.createBuffer(1,s,this.ctx.sampleRate),c=r.getChannelData(0);for(let m=0;m<s;m++)c[m]=Math.random()*2-1;const h=this.ctx.createBufferSource();h.buffer=r;const d=this.ctx.createBiquadFilter();d.type="lowpass",d.frequency.value=1e3;const g=this.ctx.createGain();g.gain.setValueAtTime(n,this.ctx.currentTime),g.gain.exponentialRampToValueAtTime(.014,this.ctx.currentTime+t),h.connect(d),d.connect(g),g.connect(this.masterGain),h.start()}playHeatLevelUp(t){if(this.muted||!this.ctx||!this.masterGain)return;const n=this.ctx.currentTime,s=100+t*30,r=.1+t*.03,c=this.ctx.createOscillator(),h=this.ctx.createGain(),d=this.ctx.createBiquadFilter();if(c.type="sawtooth",c.frequency.setValueAtTime(s,n),c.frequency.linearRampToValueAtTime(s*1.8,n+r),d.type="lowpass",d.frequency.setValueAtTime(800+t*200,n),h.gain.setValueAtTime(.12,n),h.gain.exponentialRampToValueAtTime(.01,n+r),c.connect(d),d.connect(h),h.connect(this.masterGain),c.start(n),c.stop(n+r),t>=2){const g=this.ctx.createOscillator(),m=this.ctx.createGain();g.type="square",g.frequency.setValueAtTime(60+t*10,n),g.frequency.exponentialRampToValueAtTime(40,n+.05),m.gain.setValueAtTime(.1,n),m.gain.exponentialRampToValueAtTime(.01,n+.06),g.connect(m),m.connect(this.masterGain),g.start(n),g.stop(n+.06)}t>=4&&setTimeout(()=>this.playJackpot(),50)}playJackpot(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="sawtooth",n.frequency.setValueAtTime(80,t),n.frequency.linearRampToValueAtTime(150,t+.15),s.gain.setValueAtTime(.15,t),s.gain.exponentialRampToValueAtTime(.01,t+.2),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.2);const r=this.ctx.createOscillator(),c=this.ctx.createGain();r.type="square",r.frequency.setValueAtTime(400,t),r.frequency.exponentialRampToValueAtTime(1200,t+.08),c.gain.setValueAtTime(.08,t),c.gain.exponentialRampToValueAtTime(.01,t+.12),r.connect(c),c.connect(this.masterGain),r.start(t),r.stop(t+.12)}playComboUp(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="square",n.frequency.setValueAtTime(200,t),n.frequency.exponentialRampToValueAtTime(80,t+.05),s.gain.setValueAtTime(.12,t),s.gain.exponentialRampToValueAtTime(.01,t+.06),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.06)}playScoreDing(t=0){if(this.muted||!this.ctx||!this.masterGain)return;const n=this.ctx.currentTime,s=1+t*.15,r=this.ctx.createOscillator(),c=this.ctx.createGain();r.type="sawtooth",r.frequency.setValueAtTime(300*s,n),r.frequency.exponentialRampToValueAtTime(150,n+.04),c.gain.setValueAtTime(.06*s,n),c.gain.exponentialRampToValueAtTime(.01,n+.05),r.connect(c),c.connect(this.masterGain),r.start(n),r.stop(n+.05)}playCoinCollect(){if(this.muted||!this.ctx||!this.masterGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator(),s=this.ctx.createGain();n.type="triangle",n.frequency.setValueAtTime(800,t),n.frequency.exponentialRampToValueAtTime(400,t+.03),s.gain.setValueAtTime(.08,t),s.gain.exponentialRampToValueAtTime(.01,t+.04),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+.04)}}const me=new GE;function tc(o,t,n,s,r){const c=s.horizontalFreq??.03,h=s.verticalFreq??.05,d=s.horizontalAmp??1,g=s.verticalAmp??.5;return{vx:Math.sin(n*c)*t*d,vy:Math.cos(n*h)*g}}function UE(o,t,n,s,r){const c=s.horizontalFreq??.04,h=s.verticalFreq??.02,d=s.horizontalAmp??1,g=s.verticalAmp??.8;return{vx:Math.sin(n*c)*t*d,vy:Math.sin(n*h)*g}}function zE(o,t,n,s,r){const c=s.horizontalFreq??.02,h=s.horizontalAmp??1;return{vx:Math.sin(n*c)*t*h,vy:0}}function kE(o,t,n,s,r){const c=s.changeInterval??120,h=s.horizontalAmp??2,d=o.lastDirectionChange??0;return n-d>=c||o.lastVx===void 0?{vx:(Math.random()-.5)*t*h,vy:0}:{vx:o.lastVx??0,vy:0}}function VE(o,t,n,s,r){const c=s.horizontalFreq??.06,h=s.verticalFreq??.04,d=s.horizontalAmp??1,g=s.verticalAmp??1.5,m=o.phase>=2?1.5:1,y=g*m;return{vx:Math.sin(n*c)*t*d,vy:Math.cos(n*h)*y}}function WE(o,t,n,s,r){if(!r)return tc(o,t,n,s);const c=s.trackingStrength??.3,h=s.horizontalAmp??1,d=s.verticalAmp??.3,g=o.pos.x+o.size.width/2,m=o.pos.y+o.size.height/2,y=r.x-g,E=r.y-m,A=Math.sqrt(y*y+E*E);if(A<10)return tc(o,t,n,{...s,verticalAmp:.2});const v=y/A,b=E/A,O=Math.sin(n*.05)*.3;return{vx:(v*c+O)*t*h,vy:Math.max(-.5,Math.min(.5,b*c*d))}}function XE(o,t,n,s,r){const c=s.orbitSpeed??.015,h=s.horizontalAmp??1.2,d=s.verticalAmp??.4,g=n*c;return{vx:Math.cos(g)*t*h,vy:Math.sin(g)*d}}const jE={sine:tc,figure8:UE,sweep:zE,erratic:kE,aggressive:VE,chase:WE,orbit:XE};function $E(o,t,n,s,r={},c){const h=jE[o];return h?h(t,n,s,r,c):(console.warn(`Unknown movement pattern: ${o}, falling back to sine`),tc(t,n,s,r))}function qE(o,t){return{vx:o.vx*t,vy:o.vy*t}}function mp(){return{lastFireFrame:0,burstIndex:0,spiralAngle:0,currentMixedPattern:0,lastMixedSwitch:0,pauseUntil:0}}function _r(o,t,n,s,r){const c=o+n/2,h=t+s/2;return Math.atan2(r.y-h,r.x-c)}function sd(o,t,n,s,r,c,h){const d=[],g=c.fireRate??45;if(s-r.lastFireFrame<g)return d;r.lastFireFrame=s;const m=c.bulletCount??3,y=c.spreadAngle??.6,E=_r(o.x,o.y,t.width,t.height,n),A=o.x+t.width/2,v=o.y+t.height;for(let b=0;b<m;b++){const O=m===1?0:(b/(m-1)-.5)*y;d.push({x:A,y:v,angle:E+O,speed:h,type:S.BULLET_CANNON})}return d}function Jp(o,t,n,s,r,c,h){const d=[],g=c.fireRate??8;if(s-r.lastFireFrame<g)return d;r.lastFireFrame=s;const m=c.bulletCount??4,y=c.rotationSpeed??.08,E=_r(o.x,o.y,t.width,t.height,n);r.spiralAngle+=y;const A=o.x+t.width/2,v=o.y+t.height/2;for(let b=0;b<m;b++){const O=r.spiralAngle+b*Math.PI*2/m,L=E+Math.sin(O)*.5;d.push({x:A,y:v,angle:L,speed:h,type:S.BULLET_CANNON})}return d}function ZE(o,t,n,s,r,c,h){const d=[],g=c.fireRate??30;if(s-r.lastFireFrame<g)return d;r.lastFireFrame=s;const m=c.bulletCount??1,y=_r(o.x,o.y,t.width,t.height,n),E=o.x+t.width/2,A=o.y+t.height;for(let v=0;v<m;v++){const b=(Math.random()-.5)*.1;d.push({x:E,y:A,angle:y+b,speed:h*1.2,type:S.BULLET_CANNON})}return d}function KE(o,t,n,s,r,c,h){const d=[],g=c.burstCount??4,m=c.burstDelay??6,y=c.pauseDuration??60,E=c.bulletCount??4,A=c.spreadAngle??.5;if(s<r.pauseUntil||s-r.lastFireFrame<m)return d;r.lastFireFrame=s,r.burstIndex++;const v=_r(o.x,o.y,t.width,t.height,n),b=o.x+t.width/2,O=o.y+t.height;for(let L=0;L<E;L++){const N=E===1?0:(L/(E-1)-.5)*A;d.push({x:b,y:O,angle:v+N,speed:h,type:S.BULLET_CANNON})}return r.burstIndex>=g&&(r.burstIndex=0,r.pauseUntil=s+y),d}function QE(o,t,n,s,r,c,h){const d=c.alternateInterval??180;return s-r.lastMixedSwitch>=d&&(r.currentMixedPattern=(r.currentMixedPattern+1)%2,r.lastMixedSwitch=s),r.currentMixedPattern===0?sd(o,t,n,s,r,{...c,bulletCount:c.bulletCount??4,fireRate:c.fireRate??35},h):Jp(o,t,n,s,r,{...c,bulletCount:3,fireRate:c.fireRate??12},h)}function JE(o,t,n,s,r,c,h){const d=[],g=c.fireRate??60;if(s-r.lastFireFrame<g)return d;r.lastFireFrame=s;const m=c.bulletCount??2,y=c.spreadAngle??.4,E=c.missileSpeed??.6,A=_r(o.x,o.y,t.width,t.height,n);for(let v=0;v<m;v++){const b=v%2===0?-1:1,O=m===1?0:(v/(m-1)-.5)*y;d.push({x:o.x+t.width/2+b*(t.width/4),y:o.y+t.height*.8,angle:A+O,speed:h*E,type:S.BULLET_CANNON,size:{width:16,height:16}})}return d}function e_(o,t,n,s,r,c,h){return[]}const t_={spread:sd,spiral:Jp,aimed:ZE,barrage:KE,mixed:QE,missiles:JE,turrets:e_};function a_(o,t,n,s,r,c,h={},d=5){const g=t_[o];return g?g(t,n,s,r,c,h,d):(console.warn(`Unknown attack pattern: ${o}, falling back to spread`),sd(t,n,s,r,c,h,d))}function i_(o){const t=o.specialMechanics,n=[];if(t!=null&&t.hasArmorPlating&&t.armorPlateCount){const s=t.armorPlateHP??30,r=t.armorPlateCount;for(let c=0;c<r;c++){const h=c/r*Math.PI*2-Math.PI/2;n.push({id:`armor_${c}`,relPos:{x:Math.cos(h)*.6,y:Math.sin(h)*.6},size:{width:30,height:20},hp:s,maxHP:s,destroyed:!1})}}return{flareActive:!1,flareCooldown:0,flareTimer:0,flareParticles:[],smokeActive:!1,smokeCooldown:0,smokeTimer:0,smokeOpacity:0,armorPlates:n,totalArmorDestroyed:0,minionCooldown:0,totalMinionsSpawned:0,enraged:!1,enrageTriggered:!1}}function yp(o,t,n,s){const r=t.specialMechanics,c={damageMultiplier:1,deflectBullets:!1,minionsToSpawn:[],speedMultiplier:1,fireRateMultiplier:1};if(!r)return c;if(r.hasFlareSpray&&(n_(o,r,n),o.flareActive&&(c.deflectBullets=!0)),r.hasSmokeScreen&&(l_(o,r),o.smokeActive&&(c.damageMultiplier*=.5)),r.hasArmorPlating&&o.armorPlates.filter(d=>!d.destroyed).length>0&&(c.damageMultiplier*=.3),r.hasMinions){const h=r_(o,r,n);c.minionsToSpawn=h}return r.hasEnrage&&(o_(o,r,n),o.enraged&&(c.speedMultiplier=r.enrageSpeedBoost??1.5,c.fireRateMultiplier=r.enrageFireRateBoost??1.25)),c}function n_(o,t,n,s){const r=t.flareSprayInterval??180,c=t.flareDuration??60;o.flareCooldown>0&&o.flareCooldown--,!o.flareActive&&o.flareCooldown<=0&&(o.flareActive=!0,o.flareTimer=c,o.flareCooldown=r,o.flareParticles=s_(n,30)),o.flareActive&&(o.flareTimer--,o.flareParticles=o.flareParticles.filter(h=>(h.x+=h.vx,h.y+=h.vy,h.vy+=.05,h.life--,h.life>0)),o.flareTimer<=0&&(o.flareActive=!1,o.flareParticles=[]))}function s_(o,t){const n=[],s=o.pos.x+o.size.width/2,r=o.pos.y+o.size.height/2,c=["#FF6600","#FFAA00","#FF3300","#FFFF00","#FFFFFF"];for(let h=0;h<t;h++){const d=Math.random()*Math.PI*2,g=2+Math.random()*4;n.push({x:s,y:r,vx:Math.cos(d)*g,vy:Math.sin(d)*g-2,life:30+Math.random()*30,maxLife:60,size:3+Math.random()*4,color:c[Math.floor(Math.random()*c.length)]})}return n}function l_(o,t,n,s){const r=t.smokeScreenInterval??300,c=t.smokeScreenDuration??120;o.smokeCooldown>0&&o.smokeCooldown--,!o.smokeActive&&o.smokeCooldown<=0&&(o.smokeActive=!0,o.smokeTimer=c,o.smokeCooldown=r,o.smokeOpacity=0),o.smokeActive&&(o.smokeTimer--,o.smokeTimer>c-20?o.smokeOpacity=Math.min(.7,o.smokeOpacity+.035):o.smokeTimer<30&&(o.smokeOpacity=Math.max(0,o.smokeOpacity-.023)),o.smokeTimer<=0&&(o.smokeActive=!1,o.smokeOpacity=0))}function r_(o,t,n,s){const r=[],c=t.minionSpawnRate??300,h=t.minionCount??2;if(o.minionCooldown>0)return o.minionCooldown--,r;o.minionCooldown=c;const d={x:n.pos.x+n.size.width/2,y:n.pos.y+n.size.height/2};for(let g=0;g<h;g++){const m=g%2===0?-1:1,y=(Math.floor(g/2)+1)*30;r.push({x:d.x+m*(n.size.width/2+20),y:d.y+y,type:o.totalMinionsSpawned%3===0?"red":"small"}),o.totalMinionsSpawned++}return r}function o_(o,t,n){if(o.enrageTriggered)return;const s=t.enrageThreshold??.3;n.hp/n.maxHP<=s&&(o.enraged=!0,o.enrageTriggered=!0)}const Ep={1:{hp:0,fireRate:0,speed:0,spawnInterval:0,maxActive:0},2:{hp:12,fireRate:240,speed:1,spawnInterval:600,maxActive:1},3:{hp:15,fireRate:220,speed:1.05,spawnInterval:550,maxActive:1},4:{hp:18,fireRate:200,speed:1.1,spawnInterval:500,maxActive:2},5:{hp:21,fireRate:180,speed:1.15,spawnInterval:450,maxActive:2},6:{hp:24,fireRate:160,speed:1.2,spawnInterval:400,maxActive:2},7:{hp:27,fireRate:140,speed:1.25,spawnInterval:350,maxActive:2}},Hh={width:80,height:80},c_=.4,u_=60,h_=80,d_=200,f_=3,_p=2.5,Ap=3.5,g_=2,Sp=.06,Tp=.08,p_=60,vp=180,m_=80,Yh=.04,y_=20,E_=60,__=6,Rp=300;class A_{constructor(){this.minions=[],this.nextMinionId=0,this.lastSpawnFrame=0,this.level=1,this.campaign=pe.STEEL_VANGUARD,this.minionDestroyedFrame=0,this.INTRO_RESPAWN_DELAY=180,this.reset()}reset(){this.minions=[],this.nextMinionId=0,this.lastSpawnFrame=0,this.minionDestroyedFrame=0}onMinionDestroyed(t){this.minionDestroyedFrame=t}setLevel(t){this.level=t}setCampaign(t){this.campaign=t}getActiveCount(){return this.minions.filter(t=>t.state!=="destroyed").length}getMinions(){return this.minions}assessPlayerThreat(t){let n=0;return t.firepowerActive&&(n+=t.firepowerTier===za.ENHANCED?3:1.5,n+=t.firepowerStacks*.5),t.spreadActive&&(n+=t.spreadStacks*.75),n+=t.bombCount*.5,Math.min(10,n)}getMinionConfig(t){const n=Ep[Math.min(7,Math.max(1,this.level))]||Ep[7],s=this.assessPlayerThreat(t),r=Bt.getEnemySpeedMultiplier()/.6,c=Bt.getEnemyFireRateMultiplier()/.6;return{hp:Math.floor(n.hp*(1+s*.1)),fireRate:Math.floor(n.fireRate/((1+s*.05)*c)),speed:n.speed*(1+s*.02)*r,spawnInterval:Math.floor(n.spawnInterval/(1+s*.1)),maxActive:n.maxActive}}getBarrageTriggerChance(){return .002*(this.level%2===1?1.5:.7)*.8}shouldSpawnMinion(t,n,s){if(this.level<2)return!1;const r=this.getMinionConfig(s);return t.introPlayed?!(this.getActiveCount()>=r.maxActive||n-this.lastSpawnFrame<r.spawnInterval):!(this.getActiveCount()>=1||this.minionDestroyedFrame>0&&n-this.minionDestroyedFrame<this.INTRO_RESPAWN_DELAY||this.lastSpawnFrame>0&&n-this.lastSpawnFrame<r.spawnInterval)}getRandomEntrySide(){const t=["left","right","top"];return t[Math.floor(Math.random()*t.length)]}spawnMinion(t,n,s){if(!this.shouldSpawnMinion(t,s,n))return null;const r=this.getMinionConfig(n),c=this.getRandomEntrySide(),h=this.minions.filter(b=>b.state!=="destroyed"),d=h.length===0?Math.random()>.5?1:-1:h[0].lateralSide===1?-1:1;let g,m;const y=t.pos.x+t.size.width/2,E=t.pos.y+t.size.height/2;switch(c){case"left":g=-Hh.width-20,m=E+(Math.random()-.5)*100;break;case"right":g=P+20,m=E+(Math.random()-.5)*100;break;case"top":default:g=y+(Math.random()-.5)*200,m=-Hh.height-20;break}const A=`boss_minion_${this.nextMinionId++}`,v={entityId:A,entryDirection:c,orbitPhase:this.getActiveCount(),lastFireFrame:s,state:"entering",hp:r.hp,maxHP:r.hp,targetX:y,targetY:E+100,behavior:"entering",attackTimer:0,attackCooldown:vp+Math.random()*60,lateralSide:d,oscillationPhase:Math.random()*Math.PI*2,lastPlayerX:P/2,lastPlayerY:Y-100,playerVelX:0,playerVelY:0,barrageStartFrame:0,barrageLastFireFrame:0,barrageCooldownFrame:s+Rp,preBarageBehavior:"protecting"};return this.minions.push(v),this.lastSpawnFrame=s,{id:A,type:S.ENEMY_HELICOPTER,pos:{x:g,y:m},vel:{vx:0,vy:0},size:Hh,hp:r.hp,active:!0,frame:0,maxFrames:4,animationSpeed:.15,scoreValue:500+this.level*100}}calculateProtectivePosition(t,n,s,r){const c=n.pos.x+n.size.width/2,h=n.pos.y+n.size.height/2,d=c-s.x,g=h-s.y,m=Math.sqrt(d*d+g*g);if(m<1)return{x:c,y:h+100};const y=d/m,E=g/m,A=Math.min(m*c_,d_),v=c-y*A,b=h-E*A,O=-E,L=y,N=u_+Math.sin(t.oscillationPhase)*y_,x=v+O*N*t.lateralSide,I=b+L*N*t.lateralSide,G=Math.sin(r*Yh+t.oscillationPhase)*15,W=Math.cos(r*Yh*.7+t.oscillationPhase)*10;return{x:x+G,y:I+W}}calculateAttackPosition(t,n,s){n.pos.x+n.size.width/2,n.pos.y+n.size.height/2;const r=this.calculateProtectivePosition(t,n,s,0),c=s.x-r.x,h=s.y-r.y,d=Math.sqrt(c*c+h*h);if(d<1)return r;const g=Math.min(m_/d,.5);return{x:r.x+c*g,y:r.y+h*g}}updatePlayerPrediction(t,n){t.playerVelX=(n.x-t.lastPlayerX)*.5+t.playerVelX*.5,t.playerVelY=(n.y-t.lastPlayerY)*.5+t.playerVelY*.5,t.lastPlayerX=n.x,t.lastPlayerY=n.y}getPredictedPlayerPos(t,n=10){return{x:t.lastPlayerX+t.playerVelX*n,y:t.lastPlayerY+t.playerVelY*n}}updateBehavior(t,n,s,r,c,h){switch(t.oscillationPhase+=Yh,this.updatePlayerPrediction(t,r),t.behavior){case"entering":this.behaviorEntering(t,n,s,r,h);break;case"protecting":this.behaviorProtecting(t,n,s,r,c,h);break;case"attacking":this.behaviorAttacking(t,n,s,r,c,h);break;case"repositioning":this.behaviorRepositioning(t,n,s,r,h);break}}behaviorEntering(t,n,s,r,c){const h=this.calculateProtectivePosition(t,s,r,0);t.targetX=h.x,t.targetY=h.y;const d=t.targetX-n.pos.x,g=t.targetY-n.pos.y,m=Math.sqrt(d*d+g*g);if(m<30)t.behavior="protecting",t.state="active";else{const y=f_*c.speed;n.vel.vx=d/m*y,n.vel.vy=g/m*y}}behaviorProtecting(t,n,s,r,c,h){const d=this.calculateProtectivePosition(t,s,r,c);t.targetX=d.x,t.targetY=d.y;const g=t.targetX-n.pos.x,m=t.targetY-n.pos.y;n.vel.vx=g*Sp*h.speed,n.vel.vy=m*Sp*h.speed;const y=Math.sqrt(n.vel.vx**2+n.vel.vy**2);if(y>_p*h.speed){const E=_p*h.speed/y;n.vel.vx*=E,n.vel.vy*=E}t.attackCooldown--,t.attackCooldown<=0&&(t.behavior="attacking",t.attackTimer=p_)}behaviorAttacking(t,n,s,r,c,h){const d=this.calculateAttackPosition(t,s,r);t.targetX=d.x,t.targetY=d.y;const g=t.targetX-n.pos.x,m=t.targetY-n.pos.y;n.vel.vx=g*Tp*h.speed,n.vel.vy=m*Tp*h.speed;const y=Math.sqrt(n.vel.vx**2+n.vel.vy**2);if(y>Ap*h.speed){const E=Ap*h.speed/y;n.vel.vx*=E,n.vel.vy*=E}t.attackTimer--,t.attackTimer<=0&&(t.behavior="repositioning",t.attackCooldown=vp+Math.random()*60)}behaviorRepositioning(t,n,s,r,c){const h=this.calculateProtectivePosition(t,s,r,0);t.targetX=h.x,t.targetY=h.y;const d=t.targetX-n.pos.x,g=t.targetY-n.pos.y,m=Math.sqrt(d*d+g*g);if(m<40)t.behavior="protecting";else{const y=g_*c.speed;n.vel.vx=d/m*y,n.vel.vy=g/m*y}}updateMinions(t,n,s,r,c){const h=[],d=this.getMinionConfig(r);t.pos.x+t.size.width/2,t.pos.y+t.size.height/2;for(const g of this.minions){if(g.state==="destroyed")continue;const m=c.find(y=>y.id===g.entityId);if(!m||!m.active){g.state="destroyed";continue}if(g.hp=m.hp,g.hp<=0){g.state="destroyed";continue}if(g.behavior!=="barrage"&&g.behavior!=="entering"&&s>g.barrageCooldownFrame&&m.pos.y>50){const y=this.getBarrageTriggerChance();Math.random()<y&&(g.preBarageBehavior=g.behavior,g.behavior="barrage",g.barrageStartFrame=s,g.barrageLastFireFrame=0)}if(g.behavior==="barrage")if(m.vel.vx=0,m.vel.vy=0,m.bankAngle=0,s-g.barrageStartFrame>=E_)g.behavior=g.preBarageBehavior,g.barrageCooldownFrame=s+Rp;else{const E=Math.max(3,Math.floor(__/(Bt.getEnemyFireRateMultiplier()/.6)));if(s-g.barrageLastFireFrame>=E){g.barrageLastFireFrame=s;const A=m.pos.x+m.size.width/2,v=m.pos.y+m.size.height;h.push({x:A,y:v,angle:Math.PI/2,speed:8,isBarrage:!0})}}else this.updateBehavior(g,m,t,n,s,d),m.pos.x+=m.vel.vx,m.pos.y+=m.vel.vy,this.enforceMinBossDistance(m,t);if(m.pos.x=Math.max(10,Math.min(P-10-m.size.width,m.pos.x)),m.pos.y=Math.max(10,Math.min(Y-80,m.pos.y)),g.behavior!=="barrage"){const y=g.behavior==="attacking"?.6:1;if(s-g.lastFireFrame>=d.fireRate*y){g.lastFireFrame=s;const E=m.pos.x+m.size.width/2,A=m.pos.y+m.size.height/2,v=this.getPredictedPlayerPos(g,8),b=Math.atan2(v.y-A,v.x-E);h.push({x:E,y:A,angle:b,speed:3.5})}}}return this.minions=this.minions.filter(g=>g.state!=="destroyed"),h}enforceMinBossDistance(t,n){const s=t.pos.x+t.size.width/2,r=t.pos.y+t.size.height/2,c=n.pos.x+n.size.width/2,h=n.pos.y+n.size.height/2,d=s-c,g=r-h,m=Math.sqrt(d*d+g*g),y=h_+Math.max(n.size.width,n.size.height)/2;if(m<y&&m>0){const E=(y-m)/m;t.pos.x+=d*E*.15,t.pos.y+=g*E*.15}}handleMinionDamage(t,n){const s=this.minions.find(r=>r.entityId===t);return!s||s.state==="destroyed"?!1:(s.hp-=n,s.hp<=0?(s.state="destroyed",!0):!1)}clearMinions(){for(const t of this.minions)t.state="destroyed";this.minions=[]}isBossMinion(t){return this.minions.some(n=>n.entityId===t)}getMinionEntityIds(){return this.minions.map(t=>t.entityId)}}function S_(o){const t=Math.min(4,1+Math.floor(o/2)),n=15+o*5,s=[];for(let r=0;r<t;r++){const c=r/t*Math.PI*2-Math.PI/2;s.push({id:`shield_gen_${r}`,relPos:{x:Math.cos(c)*.7,y:Math.sin(c)*.7},size:{width:24,height:24},hp:n,maxHP:n,active:!0})}return{generators:s,shieldsActive:!0,damageMultiplier:.2}}function T_(o,t,n){const s=t.x+n.width/2,r=t.y+n.height/2;return o.generators.map(c=>({generator:c,worldX:s+c.relPos.x*(n.width/2)-c.size.width/2,worldY:r+c.relPos.y*(n.height/2)-c.size.height/2}))}function v_(o,t,n,s,r){const c=T_(t,n,s);o.save();for(const{generator:h,worldX:d,worldY:g}of c){if(!h.active)continue;const m=h.hp/h.maxHP,y=.5+Math.sin(r*.1)*.2,E=o.createRadialGradient(d+h.size.width/2,g+h.size.height/2,0,d+h.size.width/2,g+h.size.height/2,h.size.width/2),A=m>.5?"0, 200, 255":"255, 100, 0";E.addColorStop(0,`rgba(${A}, ${y})`),E.addColorStop(.7,`rgba(${A}, ${y*.5})`),E.addColorStop(1,"rgba(0, 0, 0, 0)"),o.fillStyle=E,o.beginPath(),o.arc(d+h.size.width/2,g+h.size.height/2,h.size.width/2,0,Math.PI*2),o.fill(),o.fillStyle=m>.5?"#00CCFF":"#FF6600",o.beginPath(),o.arc(d+h.size.width/2,g+h.size.height/2,6,0,Math.PI*2),o.fill()}if(t.shieldsActive){const h=n.x+s.width/2,d=n.y+s.height/2,g=Math.max(s.width,s.height)*.7,m=.15+Math.sin(r*.05)*.05;o.strokeStyle=`rgba(0, 200, 255, ${m})`,o.lineWidth=3,o.setLineDash([10,5]),o.beginPath(),o.arc(h,d,g,0,Math.PI*2),o.stroke(),o.setLineDash([])}o.restore()}function R_(o){return{minionDestroyedCount:0,spawnCooldownMultiplier:1,baseSpawnInterval:o}}function M_(o){return o.minionDestroyedCount++,o.spawnCooldownMultiplier=Math.max(.25,1-o.minionDestroyedCount*.15),Math.floor(o.baseSpawnInterval*o.spawnCooldownMultiplier)}const em=300,b_=.25;function x_(){return{active:!1,triggered:!1,timer:0,invulnerable:!1,damageBonus:1,attackPatternOverride:!1}}const O_={4:.07,5:.1,6:.13,7:.155};function L_(o,t,n,s,r=4){const c=[];if(o.triggered||t.hp/t.maxHP<=b_&&(o.triggered=!0,o.active=!0,o.timer=em,o.invulnerable=!0,o.attackPatternOverride=!0),o.active){o.timer--;const h=t.pos.x+t.size.width/2,d=t.pos.y+t.size.height/2,g=Math.atan2(n.y-d,n.x-h),m=O_[r]??.4,y=Math.round(6/m),E=Math.round(20/m);if(s%y===0){const A=s*.1;for(let v=0;v<4;v++){const b=A+v*Math.PI/2;c.push({x:h,y:d,angle:b,speed:3.5})}for(let v=-2;v<=2;v++)c.push({x:h,y:d,angle:g+v*.15,speed:4})}if(s%E===0)for(let A=0;A<8;A++){const v=A/8*Math.PI*2;c.push({x:h,y:d,angle:v,speed:2.5})}o.timer<=0&&(o.active=!1,o.invulnerable=!1,o.attackPatternOverride=!1,o.damageBonus=1.5)}return{damageMultiplier:o.invulnerable?0:o.damageBonus,bullets:c}}function N_(o,t,n,s,r){if(!t.active)return;o.save();const c=n.x+s.width/2,h=n.y+s.height/2,d=Math.max(s.width,s.height)*.6,g=.4+Math.sin(r*.2)*.2,m=d+Math.sin(r*.15)*20;for(let O=0;O<3;O++){const L=m+O*15,N=g*(1-O*.25),x=o.createRadialGradient(c,h,L*.3,c,h,L);x.addColorStop(0,`rgba(255, 0, 0, ${N})`),x.addColorStop(.5,`rgba(255, 100, 0, ${N*.6})`),x.addColorStop(1,"rgba(255, 0, 0, 0)"),o.fillStyle=x,o.beginPath(),o.arc(c,h,L,0,Math.PI*2),o.fill()}o.font='bold 16px "Black Ops One", monospace',o.textAlign="center",o.fillStyle=`rgba(255, 255, 0, ${.8+Math.sin(r*.3)*.2})`,o.strokeStyle="rgba(0, 0, 0, 0.8)",o.lineWidth=3,o.strokeText("!! BERSERK !!",c,h-s.height/2-20),o.fillText("!! BERSERK !!",c,h-s.height/2-20);const y=t.timer/em,E=80,A=6,v=c-E/2,b=h-s.height/2-40;o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(v-1,b-1,E+2,A+2),o.fillStyle=`rgb(255, ${Math.floor(255*y)}, 0)`,o.fillRect(v,b,E*y,A),o.restore()}function D_(o,t){const n={campaign:o};switch(o){case pe.DAWN_PATROL:t>=3&&(n.shieldState=S_(t));break;case pe.STEEL_VANGUARD:n.reinforcementState=R_(500);break;case pe.HELLFIRE_HORIZON:t>=4&&(n.berserkState=x_());break}return n}function w_(o){let t=1;return o.shieldState&&(t*=o.shieldState.damageMultiplier),o.berserkState&&o.berserkState.invulnerable?t=0:o.berserkState&&(t*=o.berserkState.damageBonus),t}class P_{constructor(t=pe.STEEL_VANGUARD){this.bosses=new Map,this.activeBoss=null,this.bossIntroTimer=0,this.nextBossId=0,this.campaign=pe.STEEL_VANGUARD,this.currentLevel=1,this.minionManager=new A_,this.campaignMechanicsState=null,this.campaign=t,this.difficultyMultipliers=yr(t,1)}setCampaign(t){this.campaign=t,this.difficultyMultipliers=yr(t,1)}setDifficulty(t){switch(t){case mt.BEGINNER:this.setCampaign(pe.DAWN_PATROL);break;case mt.NORMAL:this.setCampaign(pe.STEEL_VANGUARD);break;case mt.VETERAN:this.setCampaign(pe.HELLFIRE_HORIZON);break}}createBoss(t){this.currentLevel=t,this.minionManager.reset(),this.minionManager.setLevel(t),this.minionManager.setCampaign(this.campaign),this.campaignMechanicsState=D_(this.campaign,t);const n=Ly(this.campaign,t);if(!n){const r=Ny(this.campaign,t);return r?this.createLegacyBoss(r,t):null}this.difficultyMultipliers=yr(this.campaign,t);const s=this.createBossFromVariant(n,t);return this.bosses.set(t,s),s}createBossFromVariant(t,n){const s=`boss_${this.nextBossId++}`,r=this.difficultyMultipliers,h=ml(this.campaign).levelCount,g=1+(n-1)/h*.3;let m=3.059;this.campaign===pe.DAWN_PATROL?m=2.574:this.campaign===pe.HELLFIRE_HORIZON&&(m=2.955);const y=90+n*15,E=Math.floor(y*r.enemyHP*m*t.hpMultiplier*g),A={width:t.size.width,height:t.size.height},v={x:P/2-A.width/2,y:-A.height-20},b=Bt.getEnemySpeedMultiplier()/.6,O=Bt.getEnemyFireRateMultiplier()/.6,L=t.phases.map(j=>({hp:Math.floor(E*j.hpThreshold),attackPattern:j.attackPattern.type,fireRate:Math.floor(60*j.fireRateMultiplier/O),speed:2*j.speedMultiplier*b})),N=Math.floor(90/(r.fireRate*O)),x=t.turretConfig.positions||[],I=5,G=x.map((j,q)=>({id:`t${q+1}`,relPos:j,angle:0,cooldown:N+q*30,fireRate:N,hp:Math.floor(I*t.turretConfig.hpMultiplier*m),hitFlash:0})),W=mp(),Q=i_(t);return{id:s,type:S.BOSS,bossType:t.baseBossType,pos:v,vel:{vx:0,vy:0},size:A,hp:E,maxHP:E,active:!0,frame:0,phase:0,phases:L,destructibleParts:[],invulnerable:!1,introPlayed:!1,turrets:G,scoreValue:E*10,variantId:t.variantId,variantName:t.displayName,variantSprite:t.spriteKey,lastDirectionChange:0,lastVx:0,orbitAngle:0,attackState:W,mechanicsState:Q}}createLegacyBoss(t,n){const s=`boss_${this.nextBossId++}`,r=this.difficultyMultipliers;let c,h,d,g,m=[];const y=Math.floor(90/r.fireRate);let E=1.9;this.campaign===pe.DAWN_PATROL?E=1.95:this.campaign===pe.HELLFIRE_HORIZON&&(E=1.97);const A=v=>Math.floor(v*E);switch(t){case Ia.ACE_SQUADRON:c={width:200,height:200},h={x:P/2-100,y:-250},d=Math.floor((90+n*15)*r.enemyHP*E),g=[{hp:d,attackPattern:"dive",fireRate:30,speed:3},{hp:d*.6,attackPattern:"spiral",fireRate:20,speed:4},{hp:d*.3,attackPattern:"berserk",fireRate:25,speed:5}];break;case Ia.FLYING_FORTRESS:c={width:250,height:250},h={x:P/2-125,y:-280},d=Math.floor((100+n*18)*r.enemyHP*E),g=[{hp:d,attackPattern:"formation",fireRate:40,speed:1},{hp:d*.5,attackPattern:"split",fireRate:25,speed:2}],m=[{id:"t1",relPos:{x:60,y:60},angle:0,cooldown:y,fireRate:y,hp:A(15),hitFlash:0},{id:"t2",relPos:{x:190,y:60},angle:0,cooldown:y+30,fireRate:y,hp:A(15),hitFlash:0},{id:"t3",relPos:{x:60,y:190},angle:0,cooldown:y+60,fireRate:y,hp:A(15),hitFlash:0},{id:"t4",relPos:{x:190,y:190},angle:0,cooldown:y+90,fireRate:y,hp:A(15),hitFlash:0}];break;case Ia.SUPER_BATTLESHIP:c={width:220,height:300},h={x:P/2-110,y:-320},d=Math.floor((110+n*20)*r.enemyHP*E),g=[{hp:d,attackPattern:"broadside",fireRate:50,speed:.5},{hp:d*.7,attackPattern:"barrage",fireRate:35,speed:1},{hp:d*.4,attackPattern:"desperation",fireRate:25,speed:1.5}],m=[{id:"t1",relPos:{x:55,y:80},angle:0,cooldown:y,fireRate:y,hp:A(20),hitFlash:0},{id:"t2",relPos:{x:165,y:80},angle:0,cooldown:y+30,fireRate:y,hp:A(20),hitFlash:0},{id:"t3",relPos:{x:55,y:160},angle:0,cooldown:y+60,fireRate:y,hp:A(20),hitFlash:0},{id:"t4",relPos:{x:165,y:160},angle:0,cooldown:y+90,fireRate:y,hp:A(20),hitFlash:0},{id:"t5",relPos:{x:110,y:240},angle:0,cooldown:y+120,fireRate:y,hp:A(20),hitFlash:0}];break;case Ia.EXPERIMENTAL_AIRSHIP:c={width:250,height:220},h={x:P/2-125,y:-240},d=Math.floor((120+n*22)*r.enemyHP*E),g=[{hp:d,attackPattern:"laser",fireRate:45,speed:2},{hp:d*.6,attackPattern:"missiles",fireRate:30,speed:2.5},{hp:d*.3,attackPattern:"overload",fireRate:25,speed:3}],m=[{id:"t1",relPos:{x:60,y:110},angle:0,cooldown:y,fireRate:y,hp:A(18),hitFlash:0},{id:"t2",relPos:{x:125,y:55},angle:0,cooldown:y+30,fireRate:y,hp:A(18),hitFlash:0},{id:"t3",relPos:{x:190,y:110},angle:0,cooldown:y+60,fireRate:y,hp:A(18),hitFlash:0}];break;case Ia.ULTIMATE_WEAPON:default:c={width:280,height:280},h={x:P/2-140,y:-300},d=Math.floor((150+n*30)*r.enemyHP*E),g=[{hp:d,attackPattern:"core_shield",fireRate:60,speed:1},{hp:d*.8,attackPattern:"core_exposed",fireRate:40,speed:1.5},{hp:d*.6,attackPattern:"desperation",fireRate:35,speed:2},{hp:d*.4,attackPattern:"berserk",fireRate:25,speed:2.5},{hp:d*.2,attackPattern:"final_phase",fireRate:30,speed:3}],m=[{id:"t1",relPos:{x:70,y:70},angle:0,cooldown:y,fireRate:y,hp:A(25),hitFlash:0},{id:"t2",relPos:{x:210,y:70},angle:0,cooldown:y+30,fireRate:y,hp:A(25),hitFlash:0},{id:"t3",relPos:{x:140,y:120},angle:0,cooldown:y+60,fireRate:y,hp:A(30),hitFlash:0},{id:"t4",relPos:{x:70,y:210},angle:0,cooldown:y+90,fireRate:y,hp:A(25),hitFlash:0},{id:"t5",relPos:{x:210,y:210},angle:0,cooldown:y+120,fireRate:y,hp:A(25),hitFlash:0}];break}return{id:s,type:S.BOSS,bossType:t,pos:h,vel:{vx:0,vy:0},size:c,hp:d,maxHP:d,active:!0,frame:0,phase:0,phases:g,destructibleParts:[],invulnerable:!1,introPlayed:!1,turrets:m,scoreValue:d*10}}updateBoss(t,n,s){const r=[];if(!t.introPlayed)t.vel.vy=2,t.pos.y>=100&&(t.vel.vy=0,t.introPlayed=!0);else{const c=this.getCurrentPhase(t);if(!c)return r;this.updatePhase(t)&&(t.phaseJustChanged=!0);const d=t.variantId?Ko[t.variantId]:null;let g=null;d&&t.mechanicsState&&(g=yp(t.mechanicsState,d,t)),d?r.push(...this.executeVariantAttack(t,d,c,n,s,(g==null?void 0:g.fireRateMultiplier)||1)):r.push(...this.executeLegacyAttackPattern(t,c,n,s)),d?this.updateVariantMovement(t,d,c,s,n,(g==null?void 0:g.speedMultiplier)||1):this.updateLegacyMovement(t,c,s)}return t.pos.x+=t.vel.vx,t.pos.y+=t.vel.vy,t.pos.x=Math.max(0,Math.min(P-t.size.width,t.pos.x)),t.pos.y=Math.max(-100,Math.min(300,t.pos.y)),t.turrets&&t.turrets.forEach(c=>{const h=t.pos.x+c.relPos.x,d=t.pos.y+c.relPos.y,g=n.x-h,m=n.y-d,y=Math.atan2(m,g);c.angle=y+Math.PI/2,c.cooldown--,c.cooldown<=0&&c.hp>0&&(c.cooldown=c.fireRate,r.push(this.createBossBullet(h,d,y)))}),r}executeVariantAttack(t,n,s,r,c,h){const d=[],g=this.difficultyMultipliers,m=Math.min(t.phase,n.phases.length-1),y=n.phases[m],E=y==null?void 0:y.attackPattern;if(!E||E.type==="turrets")return d;t.attackState||(t.attackState=mp());const A=Math.floor(s.fireRate/(g.fireRate*h)),v=2.5*g.bulletSpeed,b=E.params,O=a_(E.type,t.pos,t.size,r,c,t.attackState,{bulletCount:Math.max(2,Math.round((b.bulletCount||3)*g.bulletCount)),spreadAngle:b.spreadAngle||.3,fireRate:A,burstCount:b.burstCount,burstDelay:b.burstDelay,pauseDuration:b.spiralSpeed,rotationSpeed:b.spiralSpeed},v);for(const L of O)d.push({id:`boss_bullet_${Date.now()}_${Math.random()}`,type:L.type,pos:{x:L.x,y:L.y},vel:{vx:Math.cos(L.angle)*L.speed,vy:Math.sin(L.angle)*L.speed},size:L.size||{width:12,height:12},hp:1,active:!0,frame:0,scoreValue:0});return d}updateVariantMovement(t,n,s,r,c,h){const d=Math.min(t.phase,n.phases.length-1),g=n.phases[d],m=g==null?void 0:g.movementPattern;if(!m){this.updateLegacyMovement(t,s,r);return}const y={pos:t.pos,size:t.size,phase:t.phase,lastDirectionChange:t.lastDirectionChange,lastVx:t.lastVx,orbitAngle:t.orbitAngle},E=m.params||{};let A=$E(m.type,y,s.speed,r,E,c);if(h!==1&&(A=qE(A,h)),t.vel.vx=A.vx,t.vel.vy=A.vy,m.type==="erratic"){const v=E.changeInterval??120;r-(t.lastDirectionChange||0)>=v&&(t.lastDirectionChange=r,t.lastVx=A.vx)}}executeLegacyAttackPattern(t,n,s,r){const c=[],h=this.difficultyMultipliers,d=Math.floor(n.fireRate/h.fireRate),g=t.pos.x+t.size.width/2,m=t.pos.y+t.size.height/2,y=Math.atan2(s.y-m,s.x-g);switch(n.attackPattern){case"dive":case"spiral":case"berserk":r%d===0&&c.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,y));break;case"formation":case"split":break;case"broadside":if(r%Math.floor(d/2)===0){const E=Math.max(2,Math.round(3*h.bulletCount));for(let A=0;A<E;A++){const v=y+(A-(E-1)/2)*.3;c.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,v))}}break;case"barrage":case"desperation":if(r%d===0){const E=Math.max(2,Math.round(4*h.bulletCount));for(let A=0;A<E;A++){const v=y+(A-(E-1)/2)*.25;c.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height,v))}}break;case"laser":case"missiles":case"overload":break;case"core_shield":case"core_exposed":case"final_phase":if(r%d===0){const E=Math.max(3,Math.round(5*h.bulletCount));for(let A=0;A<E;A++){const v=r*.05+A*Math.PI*2/E,b=y+Math.sin(v)*.5;c.push(this.createBossBullet(t.pos.x+t.size.width/2,t.pos.y+t.size.height/2,b))}}break}return c}updateLegacyMovement(t,n,s){switch(t.bossType){case Ia.ACE_SQUADRON:t.vel.vx=Math.sin(s*.03)*n.speed,t.vel.vy=Math.cos(s*.05)*.5;break;case Ia.FLYING_FORTRESS:t.vel.vx=Math.sin(s*.02)*n.speed,t.vel.vy=0;break;case Ia.SUPER_BATTLESHIP:s%120===0&&(t.vel.vx=(Math.random()-.5)*n.speed*2),t.vel.vy=0;break;case Ia.EXPERIMENTAL_AIRSHIP:t.vel.vx=Math.sin(s*.04)*n.speed,t.vel.vy=Math.sin(s*.02)*.8;break;case Ia.ULTIMATE_WEAPON:t.phase>=3?(t.vel.vx=Math.sin(s*.06)*n.speed,t.vel.vy=Math.cos(s*.04)*1.5):(t.vel.vx=Math.sin(s*.03)*n.speed,t.vel.vy=0);break}}getCurrentPhase(t){for(let n=0;n<t.phases.length;n++)if(t.hp>=t.phases[n].hp||n===t.phases.length-1)return t.phases[n];return null}updatePhase(t){let n=0;for(let s=t.phases.length-1;s>=0;s--)if(t.hp<t.phases[s].hp){n=s;break}return t.phase!==n?(t.phase=n,t.invulnerable=!1,!0):!1}checkPhaseTransition(t){for(let n=0;n<t.phases.length;n++)if(t.hp<t.phases[n].hp&&t.phase!==n)return!0;return!1}createBossBullet(t,n,s){const r=2.5*this.difficultyMultipliers.bulletSpeed;return{id:`boss_bullet_${Date.now()}_${Math.random()}`,type:S.BULLET_CANNON,pos:{x:t,y:n},vel:{vx:Math.cos(s)*r,vy:Math.sin(s)*r},size:{width:12,height:12},hp:1,active:!0,frame:0,scoreValue:0}}isBossDefeated(t){return t.hp<=0}getActiveBoss(){return this.activeBoss}setActiveBoss(t){this.activeBoss=t}reset(){this.bosses.clear(),this.activeBoss=null,this.bossIntroTimer=0}getMinionSpawns(t,n){var c;if(!t.variantId||!t.mechanicsState)return[];const s=Ko[t.variantId];return!s||!((c=s.specialMechanics)!=null&&c.hasMinions)?[]:yp(t.mechanicsState,s,t).minionsToSpawn}getDamageMultiplier(t){return!t.variantId||!t.mechanicsState||!Ko[t.variantId]?1:t.mechanicsState.smokeActive?.5:t.mechanicsState.armorPlates.filter(r=>!r.destroyed).length>0?.3:1}shouldDeflectBullets(t){return t.mechanicsState?t.mechanicsState.flareActive:!1}getMinionManager(){return this.minionManager}spawnHelicopterMinion(t,n,s){return this.minionManager.spawnMinion(t,n,s)}updateHelicopterMinions(t,n,s,r,c){return this.minionManager.updateMinions(t,n,s,r,c)}onHelicopterMinionDestroyed(t,n){var s;this.minionManager.onMinionDestroyed(n),(s=this.campaignMechanicsState)!=null&&s.reinforcementState&&M_(this.campaignMechanicsState.reinforcementState)}isBossHelicopterMinion(t){return this.minionManager.isBossMinion(t)}clearHelicopterMinions(){this.minionManager.clearMinions()}getHelicopterMinionEntityIds(){return this.minionManager.getMinionEntityIds()}getCampaignMechanicsState(){return this.campaignMechanicsState}getCampaignDamageMultiplier(){return this.campaignMechanicsState?w_(this.campaignMechanicsState):1}updateBerserkMode(t,n,s){var c;return(c=this.campaignMechanicsState)!=null&&c.berserkState?L_(this.campaignMechanicsState.berserkState,t,n,s,this.currentLevel).bullets.map((h,d)=>({id:`berserk_bullet_${s}_${d}`,type:S.BULLET_CANNON,pos:{x:h.x,y:h.y},vel:{vx:Math.cos(h.angle)*h.speed,vy:Math.sin(h.angle)*h.speed},size:{width:10,height:10},hp:1,active:!0,frame:0,scoreValue:0})):[]}renderCampaignEffects(t,n,s){this.campaignMechanicsState&&(this.campaignMechanicsState.shieldState&&v_(t,this.campaignMechanicsState.shieldState,n.pos,n.size,s),this.campaignMechanicsState.berserkState&&N_(t,this.campaignMechanicsState.berserkState,n.pos,n.size,s))}isBossInBerserk(){var t,n;return((n=(t=this.campaignMechanicsState)==null?void 0:t.berserkState)==null?void 0:n.invulnerable)??!1}getCurrentLevel(){return this.currentLevel}}class C_{constructor(){this.particles=[],this.maxParticles=500,this.particleMultiplier=1,this.particlesEnabled=!0}setPerformanceSettings(t,n,s){this.particlesEnabled=t,this.particleMultiplier=n,this.maxParticles=s}shouldEmit(){return!(!this.particlesEnabled||this.particleMultiplier<=0||this.particleMultiplier<1&&Math.random()>this.particleMultiplier)}getMultiplier(){return this.particleMultiplier}emitBulletTracer(t,n,s,r,c="#999999"){if(this.shouldEmit())for(let h=0;h<2;h++)this.particles.push({x:t+(Math.random()-.5)*3,y:n+(Math.random()-.5)*3,vx:s*.3+(Math.random()-.5)*2,vy:r*.3+(Math.random()-.5)*2,life:15,maxLife:15,size:3+Math.random()*2,color:c,type:"BULLET_TRACER",rotation:0,rotationSpeed:0,alpha:.5,gravity:0,drag:.95})}emitMuzzleFlash(t,n,s=0,r="#FF4422"){if(!this.shouldEmit())return;const h=(this.particleMultiplier>=.7?8:4)+Math.floor(Math.random()*4);for(let d=0;d<h;d++){const g=s+(Math.random()-.5)*Math.PI*.5,m=3+Math.random()*5,y=["#FF4422","#FF5533","#FF3311","#DD3311","#EE4422"],E=y[Math.floor(Math.random()*y.length)];this.particles.push({x:t,y:n,vx:Math.cos(g)*m,vy:Math.sin(g)*m,life:8,maxLife:8,size:4+Math.random()*6,color:E,type:"MUZZLE_FLASH",rotation:Math.random()*Math.PI*2,rotationSpeed:0,alpha:.7,gravity:0,drag:.9})}}emitEngineExhaust(t,n,s,r){this.shouldEmit()&&this.particles.push({x:t,y:n,vx:s*.1+(Math.random()-.5)*1,vy:r*.1+(Math.random()-.5)*1,life:40,maxLife:40,size:4+Math.random()*4,color:Math.random()>.5?"#888888":"#AAAAAA",type:"ENGINE_EXHAUST",rotation:0,rotationSpeed:0,alpha:.4,gravity:0,drag:.98})}emitWaterSplash(t,n){if(!this.shouldEmit())return;const r=(this.particleMultiplier>=.7?12:6)+Math.floor(Math.random()*8);for(let c=0;c<r;c++){const h=Math.random()*Math.PI*2,d=2+Math.random()*4;this.particles.push({x:t,y:n,vx:Math.cos(h)*d,vy:Math.sin(h)*d-2,life:20,maxLife:20,size:2+Math.random()*4,color:"#4A90E2",type:"WATER_SPLASH",rotation:0,rotationSpeed:0,alpha:.6,gravity:.3,drag:.96})}}emitShrapnel(t,n,s=15){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let c=0;c<r;c++){const h=Math.random()*Math.PI*2,d=3+Math.random()*7;this.particles.push({x:t,y:n,vx:Math.cos(h)*d,vy:Math.sin(h)*d,life:30+Math.random()*20,maxLife:50,size:3+Math.random()*5,color:Math.random()>.5?"#666666":"#888888",type:"SHRAPNEL",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,alpha:.7,gravity:.2,drag:.98})}}emitSparks(t,n,s=10){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let c=0;c<r;c++){const h=Math.random()*Math.PI*2,d=4+Math.random()*6,g=["#DD3311","#BB4422","#999999","#777777"],m=g[Math.floor(Math.random()*g.length)];this.particles.push({x:t,y:n,vx:Math.cos(h)*d,vy:Math.sin(h)*d,life:12,maxLife:12,size:2+Math.random()*2,color:m,type:"SPARKS",rotation:0,rotationSpeed:0,alpha:.6,gravity:.1,drag:.95})}}emitFire(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(3*s*this.particleMultiplier);for(let c=0;c<r;c++){const h=-Math.PI/2+(Math.random()-.5)*.5,d=1+Math.random()*2,g=["#FF4500","#DD3311","#CC2211","#888888"],m=g[Math.floor(Math.random()*g.length)];this.particles.push({x:t+(Math.random()-.5)*10,y:n,vx:Math.cos(h)*d,vy:Math.sin(h)*d,life:20+Math.random()*15,maxLife:35,size:6+Math.random()*8,color:m,type:"FIRE",rotation:0,rotationSpeed:0,alpha:.5,gravity:-.1,drag:.97})}}emitGroundEmbers(t,n,s=3){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let c=0;c<r;c++){const h=["#FF6600","#FF4400","#FFAA00","#FF8800","#FFCC00"],d=h[Math.floor(Math.random()*h.length)];this.particles.push({x:t+(Math.random()-.5)*40,y:n+(Math.random()-.5)*20,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.3,life:40+Math.random()*40,maxLife:80,size:2+Math.random()*3,color:d,type:"SPARKS",rotation:0,rotationSpeed:0,alpha:.9,gravity:.02,drag:.99})}}emitWhiteSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(2*s*this.particleMultiplier);for(let c=0;c<r;c++)this.particles.push({x:t+(Math.random()-.5)*20,y:n,vx:-.3-Math.random()*.5,vy:-1.5-Math.random()*1.5,life:80+Math.random()*40,maxLife:120,size:10+Math.random()*15,color:Math.random()>.3?"#CCCCCC":"#AAAAAA",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.03,alpha:.5,gravity:-.03,drag:.99})}emitSmokePlume(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(2.2*s*this.particleMultiplier);for(let c=0;c<r;c++)this.particles.push({x:t+(Math.random()-.5)*15,y:n,vx:(Math.random()-.5)*1,vy:-1-Math.random()*2,life:66+Math.random()*44,maxLife:110,size:8.8+Math.random()*13.2,color:Math.random()>.5?"#555555":"#666666",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.45,gravity:-.05,drag:.99})}emitCrashSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.floor(1.5*s*this.particleMultiplier);for(let c=0;c<r;c++)this.particles.push({x:t+(Math.random()-.5)*5,y:n,vx:(Math.random()-.5)*.5,vy:-.5-Math.random()*1,life:40+Math.random()*30,maxLife:70,size:3+Math.random()*4,color:Math.random()>.5?"#555555":"#666666",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.5,gravity:-.03,drag:.98})}emitDamageSmoke(t,n,s){if(!this.shouldEmit())return;const r=s;if(r<.1)return;const c=(.1+r*.3)*this.particleMultiplier;if(Math.random()>c)return;const h=r>.7?2:1;for(let d=0;d<h;d++)this.particles.push({x:t+(Math.random()-.5)*12,y:n+20,vx:(Math.random()-.5)*.8,vy:.8+Math.random()*1.2,life:40+Math.random()*30,maxLife:70,size:4+Math.random()*6*r,color:r>.7?"#3a3a3a":"#5a5a5a",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.03,alpha:.3+r*.25,gravity:-.02,drag:.97})}emitExplosionDebris(t,n,s=20){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let c=0;c<r;c++){const h=Math.random()*Math.PI*2,d=5+Math.random()*10,g=["#DD3311","#CC2211","#333333","#555555"],m=g[Math.floor(Math.random()*g.length)];this.particles.push({x:t,y:n,vx:Math.cos(h)*d,vy:Math.sin(h)*d,life:40+Math.random()*30,maxLife:70,size:4+Math.random()*8,color:m,type:"EXPLOSION_DEBRIS",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.4,alpha:.7,gravity:.3,drag:.97})}}emitSpriteDebris(t,n,s,r=12){if(!this.shouldEmit())return;const c=Math.ceil(r*this.particleMultiplier);for(let h=0;h<c;h++){const d=Math.random(),g=d<.5?s.primary:d<.8?s.secondary:s.accent,m=Math.random()*Math.PI*2,y=4+Math.random()*8;this.particles.push({x:t,y:n,vx:Math.cos(m)*y,vy:Math.sin(m)*y+3,life:25+Math.random()*25,maxLife:50,size:3+Math.random()*5,color:g,type:"SPRITE_DEBRIS",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,alpha:.8,gravity:.2,drag:.97})}}emitEnemyDamageSmoke(t,n,s=1){if(!this.shouldEmit())return;const r=Math.ceil(s*this.particleMultiplier);for(let c=0;c<r;c++)this.particles.push({x:t+(Math.random()-.5)*10,y:n+(Math.random()-.5)*10,vx:(Math.random()-.5)*2,vy:-.5-Math.random()*1.5,life:25+Math.random()*20,maxLife:45,size:5+Math.random()*6,color:Math.random()>.3?"#555555":"#444444",type:"SMOKE_PLUME",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.05,alpha:.4,gravity:-.03,drag:.98})}update(){const t=[];for(const n of this.particles)n.vy+=n.gravity,n.vx*=n.drag,n.vy*=n.drag,n.x+=n.vx,n.y+=n.vy,n.rotation+=n.rotationSpeed,n.life--,n.alpha=n.life/n.maxLife,(n.type==="SMOKE_PLUME"||n.type==="ENGINE_EXHAUST")&&(n.size*=1.03),n.life>0&&t.push(n);if(this.particles=t,this.particles.length>this.maxParticles){const n=this.particles.length-this.maxParticles;this.particles.splice(0,n)}}render(t,n=!1){n&&(t.save(),t.globalCompositeOperation="lighter");for(const s of this.particles)t.globalAlpha=s.alpha,t.fillStyle=s.color,s.type==="BULLET_TRACER"||s.type==="MUZZLE_FLASH"||s.type==="SPARKS"||s.type==="FIRE"?(t.globalAlpha=s.alpha*.3,t.beginPath(),t.arc(s.x,s.y,s.size*1.5,0,Math.PI*2),t.fill(),t.globalAlpha=s.alpha,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill()):s.type==="SHRAPNEL"||s.type==="EXPLOSION_DEBRIS"||s.type==="SPRITE_DEBRIS"?s.rotation!==0?(t.save(),t.translate(s.x,s.y),t.rotate(s.rotation),t.fillRect(-s.size/2,-s.size/2,s.size,s.size),t.restore()):t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size):(t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill());n&&t.restore(),t.globalAlpha=1}getCount(){return this.particles.length}clear(){this.particles=[]}}const ve=new C_;var I_={};const Gh=typeof process<"u"?I_.NEXT_PUBLIC_ATMOSPHERE_EFFECTS!=="false":!0,Mp={[pe.DAWN_PATROL]:{type:"CLOUD",maxParticles:25,spawnRate:.025,scaleRange:[.5,1.5],alphaRange:[.15,.35],velocityYRange:[1,2],velocityXRange:[-.3,.3],rotates:!1,rotationSpeedRange:[0,0],secondaryType:"FOG",secondaryChance:.55,secondaryScaleRange:[1.5,3.5],secondaryAlphaRange:[.35,.55]},[pe.STEEL_VANGUARD]:{type:"FOG",maxParticles:8,spawnRate:.01,scaleRange:[1.5,3],alphaRange:[.18,.35],velocityYRange:[1.5,3],velocityXRange:[-.5,.5],rotates:!1,rotationSpeedRange:[0,0]},[pe.HELLFIRE_HORIZON]:{type:"SANDSTORM",maxParticles:25,spawnRate:.04,scaleRange:[.3,.7],alphaRange:[.2,.4],velocityYRange:[2,3.5],velocityXRange:[1,2.5],rotates:!0,rotationSpeedRange:[-.1,.1]}};class B_{constructor(){this.particles=[],this.enabled=Gh,this.intensity=1,this.campaign=pe.DAWN_PATROL,this.level=1,this.frameCount=0,this.performanceMultiplier=1,this.windGustActive=!1,this.windGustStrength=0,this.windGustTimer=0,this.nextGustTime=180,this.cloudSprite=null,this.fogSprite=null,this.sandSprite=null,this.config=Mp[pe.DAWN_PATROL]}setSprites(t,n,s){this.cloudSprite=t,this.fogSprite=n,this.sandSprite=s}getCurrentSprite(){switch(this.config.type){case"CLOUD":return this.cloudSprite;case"FOG":return this.fogSprite;case"SANDSTORM":return this.sandSprite;default:return this.cloudSprite}}setCampaign(t,n){this.campaign=t,this.level=n,this.config=Mp[t];const s=nd(t),r=.3,c=.7;this.intensity=r+c*((n-1)/Math.max(1,s-1)),this.particles=[]}setPerformanceMultiplier(t){this.performanceMultiplier=Math.max(0,Math.min(1,t))}setEnabled(t){this.enabled=t&&Gh,this.enabled||(this.particles=[])}clear(){this.particles=[]}random(t,n){return t+Math.random()*(n-t)}spawnParticle(){const t=this.config,n=t.secondaryType&&t.secondaryChance&&Math.random()<t.secondaryChance,s=n?t.secondaryType:t.type,r=this.random(-100,P+100);let c=-this.random(50,200);t.type==="SANDSTORM"&&Math.random()<.3&&(c=this.random(0,Y));const h=n&&t.secondaryScaleRange?t.secondaryScaleRange:t.scaleRange,d=n&&t.secondaryAlphaRange?t.secondaryAlphaRange:t.alphaRange,m=this.random(h[0],h[1])*(.8+this.intensity*.2),E=this.random(d[0],d[1])*this.intensity;let A=this.random(t.velocityYRange[0],t.velocityYRange[1])*(.8+this.intensity*.4),v=this.random(t.velocityXRange[0],t.velocityXRange[1]);if(s==="FOG"&&(A=this.random(3,5)*(.8+this.intensity*.4),v=this.random(-.5,.5)),t.type==="SANDSTORM"){const L=Math.sin(this.frameCount/60)*.5;v+=L}const b=t.rotates?Math.random()*Math.PI*2:0,O=t.rotates?this.random(t.rotationSpeedRange[0],t.rotationSpeedRange[1]):0;this.particles.push({x:r,y:c,vx:v,vy:A,scale:m,alpha:E,rotation:b,rotationSpeed:O,effectType:s})}update(t,n=1){if(!this.enabled)return;this.frameCount=t;const s=this.config;if(s.type==="FOG"||s.type==="SANDSTORM"||s.secondaryType==="FOG"){const E=s.type==="FOG"?"FOG":s.type==="SANDSTORM"?"SANDSTORM":"FOG";this.updateWindGusts(n,E)}let c=1;this.windGustActive&&(s.type==="FOG"?c=.05:s.type==="SANDSTORM"&&(c=.3));const h=s.spawnRate*this.intensity*this.performanceMultiplier*c,d=Math.floor(s.maxParticles*this.performanceMultiplier);this.particles.length<d&&Math.random()<h&&this.spawnParticle();const g=this.getCurrentSprite(),m=(g==null?void 0:g.width)||128,y=(g==null?void 0:g.height)||96;for(let E=this.particles.length-1;E>=0;E--){const A=this.particles[E];A.x+=A.vx*n,A.y+=A.vy*n,s.rotates&&(A.rotation+=A.rotationSpeed*n),A.effectType==="FOG"&&(A.scale*=1.001,this.windGustActive&&(A.x+=this.windGustStrength*n,A.alpha*=.96)),s.type==="SANDSTORM"&&this.windGustActive&&(A.x+=this.windGustStrength*.5*n,A.alpha*=.998);const v=m*A.scale,b=y*A.scale;(A.y>Y+b||A.x<-v-100||A.x>P+v+100||A.alpha<.02)&&this.particles.splice(E,1)}}updateWindGusts(t,n){this.windGustTimer+=t;const s=n==="FOG"?180:120,r=n==="FOG"?60:240,c=n==="FOG"?180:480;this.windGustActive?this.windGustTimer>s&&(this.windGustActive=!1,this.windGustStrength=0,this.windGustTimer=0,this.nextGustTime=r+Math.random()*(c-r)):this.windGustTimer>this.nextGustTime&&(this.windGustActive=!0,n==="FOG"?this.windGustStrength=3+Math.random()*4:this.windGustStrength=2+Math.random()*2,Math.random()<.5&&(this.windGustStrength*=-1),this.windGustTimer=0)}getSpriteForType(t){switch(t){case"CLOUD":return this.cloudSprite;case"FOG":return this.fogSprite;case"SANDSTORM":return this.sandSprite;default:return this.cloudSprite}}render(t){if(!this.enabled||this.particles.length===0)return;const n=this.config;t.save();for(const s of this.particles){const r=this.getSpriteForType(s.effectType);if(!r)continue;const c=r.width*s.scale,h=r.height*s.scale;t.globalAlpha=s.alpha,n.rotates&&s.effectType==="SANDSTORM"?(t.save(),t.translate(s.x,s.y),t.rotate(s.rotation),t.drawImage(r,-c/2,-h/2,c,h),t.restore()):t.drawImage(r,s.x-c/2,s.y-h/2,c,h)}t.globalAlpha=1,t.restore()}getParticleCount(){return this.particles.length}isEnabled(){return this.enabled&&Gh}hasSprites(){return this.cloudSprite!==null||this.fogSprite!==null||this.sandSprite!==null}}const Vn=new B_;class tm{constructor(){this.screenShake={active:!1,intensity:0,duration:0,elapsed:0},this.damageVignette={active:!1,intensity:0,duration:0,elapsed:0},this.whiteFlash={active:!1,intensity:0,duration:0,elapsed:0},this.chromaticAberration={active:!1,intensity:0,duration:0,elapsed:0},this.heatDistortion={active:!1,intensity:0,duration:0,elapsed:0},this.precisionVignette={active:!1,intensity:0,duration:0,elapsed:0}}triggerScreenShake(t=10,n=15){this.screenShake={active:!0,intensity:Math.max(this.screenShake.intensity,t),duration:n,elapsed:0}}triggerDamageVignette(t=.5,n=30){this.damageVignette={active:!0,intensity:t,duration:n,elapsed:0}}triggerWhiteFlash(t=1,n=10){this.whiteFlash={active:!0,intensity:t,duration:n,elapsed:0},setTimeout(()=>{this.whiteFlash.active&&this.whiteFlash.elapsed>=n*2&&(console.error("[FREEZE DEBUG] White flash stuck! Force clearing."),this.whiteFlash.active=!1,this.whiteFlash.intensity=0)},n*2*16.67)}triggerChromaticAberration(t=5,n=15){this.chromaticAberration={active:!0,intensity:t,duration:n,elapsed:0}}triggerHeatDistortion(t=3,n=20){this.heatDistortion={active:!0,intensity:t,duration:n,elapsed:0}}triggerPrecisionVignette(t,n){this.precisionVignette.active=!0,this.precisionVignette.intensity=Math.max(0,Math.min(1,t)),this.precisionVignette.duration=n,this.precisionVignette.elapsed=0}update(){this.screenShake.active&&(this.screenShake.elapsed++,this.screenShake.intensity*=.9,(this.screenShake.elapsed>=this.screenShake.duration||this.screenShake.intensity<.5)&&(this.screenShake.active=!1,this.screenShake.intensity=0)),this.damageVignette.active&&(this.damageVignette.elapsed++,this.damageVignette.elapsed>=this.damageVignette.duration&&(this.damageVignette.active=!1,this.damageVignette.intensity=0)),this.whiteFlash.active&&(this.whiteFlash.elapsed++,this.whiteFlash.intensity=1-this.whiteFlash.elapsed/this.whiteFlash.duration,this.whiteFlash.elapsed>=this.whiteFlash.duration&&(this.whiteFlash.active=!1,this.whiteFlash.intensity=0)),this.chromaticAberration.active&&(this.chromaticAberration.elapsed++,this.chromaticAberration.elapsed>=this.chromaticAberration.duration&&(this.chromaticAberration.active=!1,this.chromaticAberration.intensity=0)),this.heatDistortion.active&&(this.heatDistortion.elapsed++,this.heatDistortion.elapsed>=this.heatDistortion.duration&&(this.heatDistortion.active=!1,this.heatDistortion.intensity=0)),this.precisionVignette.active&&this.precisionVignette.elapsed<this.precisionVignette.duration&&(this.precisionVignette.elapsed++,this.precisionVignette.elapsed>=this.precisionVignette.duration&&(this.precisionVignette.active=!1))}applyScreenShake(t){if(this.screenShake.active&&this.screenShake.intensity>0){const n=(Math.random()-.5)*this.screenShake.intensity,s=(Math.random()-.5)*this.screenShake.intensity;t.translate(n,s)}}renderDamageVignette(t,n,s,r=!0){if(!this.damageVignette.active||!r)return;t.save();const c=t.createRadialGradient(n/2,s/2,0,n/2,s/2,Math.max(n,s)*.8);c.addColorStop(0,"rgba(255, 0, 0, 0)"),c.addColorStop(.7,"rgba(255, 0, 0, 0)"),c.addColorStop(1,`rgba(255, 0, 0, ${this.damageVignette.intensity})`),t.fillStyle=c,t.fillRect(0,0,n,s),t.restore()}renderWhiteFlash(t,n,s){!this.whiteFlash.active||this.whiteFlash.intensity<=0||(t.save(),t.fillStyle=`rgba(255, 255, 255, ${this.whiteFlash.intensity})`,t.fillRect(0,0,n,s),t.restore())}renderPrecisionVignette(t,n,s,r=!0){if(!this.precisionVignette.active||this.precisionVignette.intensity<=0||!r)return;const c=this.precisionVignette.intensity;t.save();const h=t.createRadialGradient(n/2,s/2,s*.2,n/2,s/2,s*.7);h.addColorStop(0,"rgba(0, 100, 255, 0)"),h.addColorStop(1,`rgba(0, 100, 255, ${c*.3})`),t.fillStyle=h,t.fillRect(0,0,n,s),t.strokeStyle=`rgba(0, 150, 255, ${c*.5})`,t.lineWidth=4,t.strokeRect(2,2,n-4,s-4),t.restore()}renderChromaticAberration(t,n){if(!this.chromaticAberration.active||this.chromaticAberration.intensity<=0)return;const s=this.chromaticAberration.intensity,r=n.getImageData(0,0,t.width,t.height);r.data;const c=document.createElement("canvas");c.width=t.width,c.height=t.height;const h=c.getContext("2d");h&&(h.putImageData(r,0,0),n.save(),n.globalCompositeOperation="lighten",n.globalAlpha=.5,n.drawImage(c,-s,0),n.drawImage(c,s,0),n.restore())}renderScanlines(t,n,s,r,c=!0){if(!c||r<=0)return;const h=r*.15;t.fillStyle=`rgba(0, 0, 0, ${h})`;for(let d=0;d<s;d+=3)t.fillRect(0,d,n,1)}getScreenShake(){return this.screenShake.active?{x:(Math.random()-.5)*this.screenShake.intensity,y:(Math.random()-.5)*this.screenShake.intensity}:{x:0,y:0}}hasActiveEffects(){return this.screenShake.active||this.damageVignette.active||this.whiteFlash.active||this.chromaticAberration.active||this.heatDistortion.active||this.precisionVignette.active}reset(){this.screenShake={active:!1,intensity:0,duration:0,elapsed:0},this.damageVignette={active:!1,intensity:0,duration:0,elapsed:0},this.whiteFlash={active:!1,intensity:0,duration:0,elapsed:0},this.chromaticAberration={active:!1,intensity:0,duration:0,elapsed:0},this.heatDistortion={active:!1,intensity:0,duration:0,elapsed:0},this.precisionVignette={active:!1,intensity:0,duration:0,elapsed:0}}}const F_="/play-wwii-sky-ace/",El=F_,bp=!0;let ii=null,Vo=null;const H_=()=>{try{const o=document.createElement("canvas");return o.width=1,o.height=1,o.toDataURL("image/webp").startsWith("data:image/webp")}catch{return!1}},Y_=H_();async function G_(){return ii||Vo||(Vo=(async()=>{try{const o=await fetch(`${El}dist-assets/manifest.json`);return o.ok?(ii=await o.json(),console.log("[ASSETS] Loaded compressed assets manifest:",ii==null?void 0:ii.version),ii):(console.warn("[ASSETS] Manifest not found, falling back to dynamic loading"),null)}catch(o){return console.warn("[ASSETS] Failed to load manifest:",o),null}})(),Vo)}function am(o){return ii&&[...ii.bundles.initial.graphics,...ii.bundles.progressive.tier2,...ii.bundles.progressive.tier3,...ii.bundles.progressive.terrain].find(n=>n.name===o)||null}function U_(o){{if(ii){const t=am(o);if(t)return`${El}dist-assets/${t.path}`}return`${El}dist-assets/initial/graphics/${o}.webp`}}function uc(o){{if(ii){const t=am(`${o}_thumb`);if(t)return`${El}dist-assets/${t.path}`}return`${El}dist-assets/initial/graphics/${o}_thumb.webp`}}const z_="v2",im=`game-assets-${z_}`,k_=50,V_=500;let Jh=0;const W_=["player","enemySmall1","enemySmall2","enemySmall3","enemyRed","cloud","explosion","powerupFirepower","powerupFirepowerEnhanced","powerupBomb","powerupInvincibility","helicopter1","helicopter2","bombDropped","bombTier1","bombTier2","bombTier3","bombTier4"],ni=new Map,X_={1:["ocean1","island1","enemySmall1","enemySmall2"],2:["ocean2","island2","enemyBig1","helicopter1","helicopter2"],3:["ocean3","island3","battleship1","battleship2"],4:["ocean4","bossAceSquadron","bossFlyingFortress"],5:["ocean5","bossSuperBattleship","bossExperimentalAirship","bossUltimateWeapon"]};let xp=!1,ac=new Set;function ic(o){return`${im}-${o}`}function j_(o){try{const t=localStorage.getItem(ic(o));return t&&console.log(`[CACHE]  Hit: ${o}`),t}catch(t){return console.warn(`[CACHE] Failed to read ${o}:`,t),null}}function $_(o,t){try{const n=t.length*.75/1024;return n>V_?(console.log(`[CACHE]  Skip ${o}: ${n.toFixed(0)}KB (too large)`),!1):(Jh+n>k_*1024&&(console.warn("[CACHE]  Cache full, clearing old entries..."),ed()),localStorage.setItem(ic(o),t),Jh+=n,console.log(`[CACHE]  Saved: ${o} (${n.toFixed(0)}KB)`),!0)}catch(n){if(console.warn(`[CACHE] Failed to save ${o}:`,n),n instanceof DOMException&&n.name==="QuotaExceededError"){ed();try{return localStorage.setItem(ic(o),t),!0}catch{return!1}}return!1}}function ed(){try{const o=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith("game-assets-")&&!n.startsWith(im)&&o.push(n)}o.forEach(t=>localStorage.removeItem(t)),console.log(`[CACHE] Cleared ${o.length} old cache entries`),Jh=0}catch(o){console.warn("[CACHE] Failed to clear old cache:",o)}}ed();const Uh=3,Op=1e3;async function Be(o,t=!0,n=!1,s=0){const r=j_(o);if(r)return q_(o,r);const c=U_(o),h=c.includes("/dist-assets/");return console.log(`[ASSET] Loading: ${o} from ${c}${s>0?` (retry ${s}/${Uh})`:""}${h?" (WebP)":""}`),new Promise((d,g)=>{const m=new Image;if(m.crossOrigin="anonymous",m.onload=()=>{console.log(`[ASSET]  Loaded: ${o}`);const y=document.createElement("canvas");y.width=m.width,y.height=m.height;const E=y.getContext("2d");if(!E){console.error(`Failed to get 2D context for ${o}`),d(y);return}if(E.drawImage(m,0,0),n){const A=E.getImageData(0,0,y.width,y.height),v=A.data;for(let b=0;b<v.length;b+=4){const O=v[b],L=v[b+1],N=v[b+2],x=.299*O+.587*L+.114*N;v[b]=(O*.6+x*.4)*.8,v[b+1]=(L*.6+x*.4)*.8,v[b+2]=(N*.6+x*.4)*.8}E.putImageData(A,0,0),console.log(` ${o}: Applied desaturation overlay`)}if(t)try{const A=E.getImageData(0,0,y.width,y.height),v=A.data,b=v[0],O=v[1],L=v[2];let N=0;const x=60;for(let I=0;I<v.length;I+=4){const G=v[I],W=v[I+1],Q=v[I+2],j=Math.abs(G-b),q=Math.abs(W-O),Ee=Math.abs(Q-L);j<x&&q<x&&Ee<x&&(v[I+3]=0,N++)}E.putImageData(A,0,0),console.log(` ${o}: Removed ${N.toLocaleString()} background pixels (sampled bg: rgb(${b}, ${O}, ${L}))`)}catch(A){console.error(`Failed to apply chroma key to ${o}:`,A)}else console.log(` ${o}: Keeping opaque (no chroma key)`);if(W_.includes(o)||o==="titleScreen")try{const A=y.toDataURL("image/png");$_(o,A)}catch(A){console.warn(`[CACHE] Failed to cache ${o}:`,A)}d(y)},m.onerror=async y=>{if(console.error(`[ASSET]  Failed to load ${o}:`,y),console.error(`[ASSET] URL was: ${m.src}`),s<Uh){console.log(`[ASSET]  Retrying ${o} in ${Op}ms...`),await new Promise(E=>setTimeout(E,Op*(s+1)));try{const E=await Be(o,t,n,s+1);d(E)}catch(E){g(E)}}else g(new Error(`Failed to load ${o} after ${Uh} retries`))},h)m.src=c;else{const y=Date.now();m.src=`${c}?t=${y}`}})}async function q_(o,t){return new Promise((n,s)=>{const r=new Image;r.onload=()=>{const c=document.createElement("canvas");c.width=r.width,c.height=r.height;const h=c.getContext("2d");if(!h){s(new Error(`Failed to get 2D context for cached ${o}`));return}h.drawImage(r,0,0),n(c)},r.onerror=()=>{console.warn(`[CACHE] Corrupted cache for ${o}, removing...`),localStorage.removeItem(ic(o)),s(new Error(`Cached ${o} corrupted`))},r.src=t})}const Wo=(o,t,n,s,r)=>{const h=document.createElement("canvas");h.width=s+6,h.height=r+6;const d=h.getContext("2d");if(d){const g=h.width/2;h.height/2,d.shadowColor=n,d.shadowBlur=4;const m=d.createLinearGradient(g,3,g,3+r);m.addColorStop(0,o),m.addColorStop(.3,t),m.addColorStop(1,n),d.fillStyle=m,d.beginPath(),d.roundRect(3,3,s,r,s/2),d.fill(),d.shadowBlur=0;const y=d.createLinearGradient(g,3,g,3+r*.4);y.addColorStop(0,"#FFFFFF"),y.addColorStop(1,o),d.fillStyle=y,d.beginPath(),d.roundRect(4,3,s-2,r*.4,(s-2)/2),d.fill()}return h},Z_=()=>{const o=`
      <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#888;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ccc;stop-opacity:1" />
          </linearGradient>
        </defs>
        <g>
          <rect x="11" y="2" width="3" height="14" fill="url(#grad1)"/>
          <rect x="18" y="2" width="3" height="14" fill="url(#grad1)"/>
          <circle cx="16" cy="16" r="8" fill="url(#grad1)"/>
          <circle cx="16" cy="16" r="5" fill="#666"/>
        </g>
      </svg>`,t=new Image;return t.src="data:image/svg+xml;base64,"+btoa(o),t},hc=(o=64,t=64)=>{const n=document.createElement("canvas");n.width=o,n.height=t;const s=n.getContext("2d");return s&&(s.fillStyle="#333",s.fillRect(0,0,o,t)),n};let st={},K_=!1;async function Q_(){if(!xp){console.log("[TIER 2] Loading deferred assets in background...");try{const o=await Promise.allSettled([Be("ocean2",!1,!0),Be("ocean3",!1,!0),Be("ocean4",!1,!0),Be("ocean5",!1,!0),Be("island1",!0,!1),Be("island2",!0,!1),Be("island3",!0,!1),Be("enemySmall3",!0,!1),Be("enemyBig1",!0,!1),Be("enemyBig2",!0,!1),Be("enemyBig3",!0,!1),Be("helicopter2",!0,!1),Be("battleship1",!0,!1),Be("battleship2",!0,!1),Be("battleship3",!0,!1),Be("tank1",!0,!1),Be("tank2",!0,!1),Be("tank3",!0,!1),Be("largeTank1",!0,!1),Be("largeTank2",!0,!1),Be("largeTank3",!0,!1),Be("turretBaseAA",!0,!1),Be("turretCannonAA",!0,!1),Be("turretBaseFortress",!0,!1),Be("turretCannonFortress",!0,!1),Be("turretBaseNaval",!0,!1),Be("turretCannonNaval",!0,!1)]),t=hc(),n=(Te,at,U)=>Te.status==="fulfilled"?Te.value:(console.warn(`[TIER 2] Failed to load ${U}, using placeholder`),t),[s,r,c,h,d,g,m,y,E,A,v,b,O,L,N,x,I,G,W,Q,j,q,Ee,ye,fe,re,ce]=[n(o[0],0,"ocean2"),n(o[1],1,"ocean3"),n(o[2],2,"ocean4"),n(o[3],3,"ocean5"),n(o[4],4,"island1"),n(o[5],5,"island2"),n(o[6],6,"island3"),n(o[7],7,"enemySmall3"),n(o[8],8,"enemyBig1"),n(o[9],9,"enemyBig2"),n(o[10],10,"enemyBig3"),n(o[11],11,"helicopter2"),n(o[12],12,"battleship1"),n(o[13],13,"battleship2"),n(o[14],14,"battleship3"),n(o[15],15,"tank1"),n(o[16],16,"tank2"),n(o[17],17,"tank3"),n(o[18],18,"largeTank1"),n(o[19],19,"largeTank2"),n(o[20],20,"largeTank3"),n(o[21],21,"turretBaseAA"),n(o[22],22,"turretCannonAA"),n(o[23],23,"turretBaseFortress"),n(o[24],24,"turretCannonFortress"),n(o[25],25,"turretBaseNaval"),n(o[26],26,"turretCannonNaval")];st.ocean&&(st.ocean[1]=s,st.ocean[2]=r,st.ocean[3]=c,st.ocean[4]=h),st.island&&(st.island[0]=d,st.island[1]=g,st.island[2]=m),st.enemySmall&&(st.enemySmall[2]=y),st.enemyBig&&(st.enemyBig[0]=E,st.enemyBig[1]=A,st.enemyBig[2]=v),st.enemyHelicopter&&(st.enemyHelicopter[1]=b),st.battleship&&(st.battleship[0]=O,st.battleship[1]=L,st.battleship[2]=N),st.tank&&(st.tank[0]=x,st.tank[1]=I,st.tank[2]=G),st.largeTank&&(st.largeTank[0]=W,st.largeTank[1]=Q,st.largeTank[2]=j),st.turretBaseAA=q,st.turretCannonAA=Ee,st.turretBaseFortress=ye,st.turretCannonFortress=fe,st.turretBaseNaval=re,st.turretCannonNaval=ce,xp=!0,console.log("[TIER 2]  Deferred assets loaded")}catch(o){console.error("[TIER 2]  Failed to load deferred assets:",o)}}}const td={[pe.DAWN_PATROL]:["dawnPatrolStory1","dawnPatrolStory2","dawnPatrolStory3","dawnPatrolStory4","dawnPatrolStory5"],[pe.STEEL_VANGUARD]:["steelVanguardStory1","steelVanguardStory2","steelVanguardStory3","steelVanguardStory4","steelVanguardStory5"],[pe.HELLFIRE_HORIZON]:["hellfireStory1","hellfireStory2","hellfireStory3","hellfireStory4","hellfireStory5"]},ad={[pe.DAWN_PATROL]:["dawnPatrolVictory1","dawnPatrolVictory2"],[pe.STEEL_VANGUARD]:["steelVanguardVictory1","steelVanguardVictory2"],[pe.HELLFIRE_HORIZON]:["hellfireVictory1","hellfireVictory2"]},zh=new Map;async function Lp(o){const t=zh.get(o);if(t&&t.length===5&&!t.some(g=>g.width===64)&&td[o].every(y=>sc(y)))return console.log(`[LAZY] Using cached story panels for ${o}`),t;const n=td[o];console.log(`[LAZY] Loading ${o} story panels with progressive loading...`);const s=hc(640,480);console.log(`[LAZY] Phase 1: Loading ${o} story panel thumbnails...`);const c=(await Promise.allSettled(n.map(async g=>{try{const m=uc(g),y=await dc(m),E=fc(y,640,480);return ni.set(g,{thumbnail:E,full:null,loading:!0}),E}catch{return console.warn(`[LAZY] Could not load thumbnail for ${g}, trying full asset...`),null}}))).map((g,m)=>g.status==="fulfilled"&&g.value?g.value:s);zh.set(o,c),console.log(`[LAZY]  ${o} story panel thumbnails ready`),console.log(`[LAZY] Phase 2: Loading full ${o} story panels...`);const d=(await Promise.allSettled(n.map(g=>Be(g,!1,!1)))).map((g,m)=>{const y=n[m];if(g.status==="fulfilled"){const A=ni.get(y);return A?(A.full=g.value,A.loading=!1):ni.set(y,{thumbnail:null,full:g.value,loading:!1}),g.value}console.warn(`[LAZY] Failed to load ${y}, using thumbnail or placeholder`);const E=ni.get(y);return(E==null?void 0:E.thumbnail)||s});return zh.set(o,d),console.log(`[LAZY]  Full ${o} story panels loaded`),d}function Np(o){return td[o]}function J_(o){return ad[o]}const kh=new Map;async function e2(o){const t=kh.get(o);if(t&&t.length===2&&!t.some(g=>g.width===64)&&ad[o].every(y=>sc(y)))return console.log(`[LAZY] Using cached victory panels for ${o}`),t;const n=ad[o];console.log(`[LAZY] Loading ${o} victory panels with progressive loading...`);const s=hc(640,480);console.log(`[LAZY] Phase 1: Loading ${o} victory panel thumbnails...`);const c=(await Promise.allSettled(n.map(async g=>{try{const m=uc(g),y=await dc(m),E=fc(y,640,480);return ni.set(g,{thumbnail:E,full:null,loading:!0}),E}catch{return console.warn(`[LAZY] Could not load thumbnail for ${g}, trying full asset...`),null}}))).map(g=>g.status==="fulfilled"&&g.value?g.value:s);kh.set(o,c),console.log(`[LAZY]  ${o} victory panel thumbnails ready`),console.log(`[LAZY] Phase 2: Loading full ${o} victory panels...`);const d=(await Promise.allSettled(n.map(g=>Be(g,!1,!1)))).map((g,m)=>{const y=n[m];if(g.status==="fulfilled"){const A=ni.get(y);return A?(A.full=g.value,A.loading=!1):ni.set(y,{thumbnail:null,full:g.value,loading:!1}),g.value}console.warn(`[LAZY] Failed to load ${y}, using thumbnail or placeholder`);const E=ni.get(y);return(E==null?void 0:E.thumbnail)||s});return kh.set(o,d),console.log(`[LAZY]  Full ${o} victory panels loaded`),d}const nm={1:"bossAceSquadron",2:"bossFlyingFortress",3:"bossSuperBattleship",4:"bossExperimentalAirship",5:"bossUltimateWeapon"};async function nc(o){const t=nm[o];if(!(!t||ac.has(t))){console.log(`[LAZY] Loading boss for level ${o}: ${t}`);try{const n=await Be(t,!0,!1);st[t]=n,ac.add(t),console.log(`[LAZY]  ${t} loaded`)}catch(n){console.error(`[LAZY]  Failed to load ${t}:`,n)}}}async function t2(){console.log("[LAZY] Loading all boss sprites in background...");const o=Object.entries(nm).map(async([t,n])=>{if(!ac.has(n))try{const s=await Be(n,!0,!1);st[n]=s,ac.add(n),console.log(`[LAZY]  ${n} loaded`)}catch(s){console.error(`[LAZY]  Failed to load ${n}:`,s)}});await Promise.allSettled(o),console.log("[LAZY]  All boss sprites loaded")}async function a2(o){const t=o+1;if(!(t>5||!X_[t])){console.log(`[PRELOAD] Preloading assets for level ${t}...`);try{console.log(`[PRELOAD] Preloading terrain for level ${t}...`),await ba.generateForLevelAsync(t),console.log(`[PRELOAD] Terrain for level ${t} preloaded successfully`)}catch(s){console.error(`[PRELOAD] Failed to preload terrain for level ${t}:`,s)}await nc(t)}}async function dc(o){return new Promise((t,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const c=r.getContext("2d");c&&c.drawImage(s,0,0),t(r)},s.onerror=()=>n(new Error(`Failed to load thumbnail from ${o}`)),s.src=o})}function fc(o,t,n){const s=document.createElement("canvas");s.width=t,s.height=n;const r=s.getContext("2d");return r&&(r.imageSmoothingEnabled=!1,r.drawImage(o,0,0,t,n)),s}async function i2(o=!1,t,n,s){console.log(""),console.log(" Loading Assets (Tiered Loading)..."),console.log("API_BASE:","(relative path)"),console.log("USE_STATIC_ASSETS:",bp),console.log("WEBP_SUPPORTED:",Y_),console.log("STATIC_BASE_URL:",El),console.log("");const r=Date.now(),c=h=>{s&&s(h)};try{c(5),bp&&(console.log("[MANIFEST] Loading static assets manifest..."),await G_()),console.log("[TIER 0] Loading title screen with progressive loading...");let h=null;try{const ce=uc("titleScreen"),Te=await dc(ce);h=fc(Te,640,960),console.log(`[TIER 0]  Thumbnail ready (${Date.now()-r}ms) - showing pixelated preview`),t&&t(h),st.titleScreen=h,ni.set("titleScreen",{thumbnail:h,full:null,loading:!0})}catch{console.warn("[TIER 0] Could not load thumbnail, waiting for full image...")}c(15);const d=await Be("titleScreen",!1,!1);console.log(`[TIER 0]  Full title screen loaded (${Date.now()-r}ms)`),c(25),st.titleScreen=d,ni.set("titleScreen",{thumbnail:h,full:d,loading:!1}),!h&&t&&t(d),console.log("[TIER 1] Loading essential assets...");const g=Date.now();c(30);const[m,y,E,A,v,b]=await Promise.all([Be("player",!0,!1),Be("ocean1",!1,!0),Be("explosion",!0,!1),Be("cloud",!0,!1),Be("fogPatch",!0,!1),Be("sandParticle",!0,!1)]);c(45);const[O,L,N,x]=await Promise.all([Be("enemySmall1",!0,!1),Be("enemySmall2",!0,!1),Be("enemyRed",!0,!1),Be("helicopter1",!0,!1)]);c(60);const[I,G,W,Q]=await Promise.all([Be("powerupFirepower",!0,!1),Be("powerupFirepowerEnhanced",!0,!1),Be("powerupBomb",!0,!1),Be("powerupInvincibility",!0,!1)]);c(75);const[j,q,Ee,ye,fe]=await Promise.all([Be("bombDropped",!0,!1),Be("bombTier1",!0,!1),Be("bombTier2",!0,!1),Be("bombTier3",!0,!1),Be("bombTier4",!0,!1)]);c(90),console.log(`[TIER 1]  Essential assets loaded (${Date.now()-g}ms)`);const re=hc();return Object.assign(st,{titleScreen:d,ocean:[y,re,re,re,re],island:[re,re,re],cloud:A,fogPatch:v,sandParticle:b,explosion:E,player:m,enemySmall:[O,L,re],enemyRed:N,enemyBig:[re,re,re],battleship:[re,re,re],tank:[re,re,re],largeTank:[re,re,re],enemyHelicopter:[x,re],powerupFirepower:I,powerupFirepowerEnhanced:G,powerupBomb:W,powerupInvincibility:Q,bombDropped:j,bombTier1:q,bombTier2:Ee,bombTier3:ye,bombTier4:fe,bulletPlayer:Wo("#FFFF00","#FF8800","#FF4400",22,14),bulletEnemy:Wo("#FF6666","#CC0000","#880000",22,12),bulletTurret:Wo("#FFAA00","#FF6600","#CC3300",4,10),bulletCannon:Wo("#FFFF00","#FF4400","#CC0000",10,10),turret:Z_(),storyPanels:[re,re,re,re,re],explosionSmall:[E],explosionMedium:[E],explosionLarge:[E],explosionMassive:[E],bossAceSquadron:re,bossFlyingFortress:re,bossSuperBattleship:re,bossExperimentalAirship:re,bossUltimateWeapon:re}),K_=!0,Q_().catch(ce=>console.error("[TIER 2] Background load error:",ce)),await nc(1).catch(ce=>console.error("[LAZY] Boss 1 load error:",ce)),t2().catch(ce=>console.error("[LAZY] All bosses load error:",ce)),c(100),console.log(""),console.log(` Essential assets ready! (${Date.now()-r}ms)`),console.log(" Deferred assets loading in background..."),console.log(""),st}catch(h){throw console.error(" Failed to load assets:",h),h}}function Dp(o){const t=ni.get(o);return t?t.full||t.thumbnail:null}function sc(o){const t=ni.get(o);return(t==null?void 0:t.full)!==null&&(t==null?void 0:t.full)!==void 0}async function n2(o){console.log(`[PROGRESSIVE] Preloading ${o.length} thumbnails...`);const t=o.map(async n=>{if(!ni.has(n))try{const s=uc(n),r=await dc(s),c=fc(r,512,512);ni.set(n,{thumbnail:c,full:null,loading:!1})}catch{}});await Promise.allSettled(t),console.log("[PROGRESSIVE]  Thumbnails preloaded")}function Xo(){return xi?V:null}const hn=ki.chunkSize,Ui=hn*ki.tileSize;function wp(o,t,n){return`${o}:${t}:${n}`}class s2{constructor(){this.chunks=new Map,this.tilesets=new Map,this.tileCache=new Map,this.currentTilemap=null,this.dirtyChunks=new Set,this.currentCampaign="DAWN_PATROL",this.currentLevel=1}setLevelContext(t,n){this.currentCampaign=t,this.currentLevel=n}getEffectiveAdjustments(){const t=Xo();return t&&t.isEnabled()?t.getEffectiveTerrainAdjustments():ga(this.currentCampaign,this.currentLevel)}getEffectiveTerrainWidthForRendering(t){const n=ba.getDetectedTerrainWidth(this.currentCampaign,this.currentLevel);return n!==null?n:this.getEffectiveAdjustments().mapWidthExtended}isDesignModeActive(){const t=Xo();return t?t.isEnabled():!1}loadTilemap(t){this.currentTilemap=t,this.chunks.clear(),this.dirtyChunks.clear(),console.log(`[TilemapRenderer] Loaded tilemap: ${t.width}x${t.height} tiles`)}registerTileset(t,n){this.tilesets.set(t,n),this.tileCache.clear(),this.chunks.clear(),console.log(`[TilemapRenderer] Registered tileset: ${t}`)}getTile(t,n,s=ki.tileSize){const r=`${n}:${t}`;if(this.tileCache.has(r))return this.tileCache.get(r);const c=this.tilesets.get(n);if(!c)return console.warn(`[TilemapRenderer] Tileset not found: ${n}`),null;const h=Math.floor(c.width/s),d=t%h*s,g=Math.floor(t/h)*s,m=document.createElement("canvas");m.width=s,m.height=s;const y=m.getContext("2d");return y&&(y.imageSmoothingEnabled=!1,y.drawImage(c,d,g,s,s,0,0,s,s)),this.tileCache.set(r,m),m}getChunk(t,n,s,r){var E,A;if(!this.currentTilemap)return null;const c=wp(n,s,r);if(!this.dirtyChunks.has(c)&&this.chunks.has(c))return this.chunks.get(c);const h=document.createElement("canvas");h.width=Ui,h.height=Ui;const d=h.getContext("2d");if(!d)return null;d.imageSmoothingEnabled=!1;const g=this.currentTilemap.tileSize,m=s*hn,y=r*hn;for(let v=0;v<hn;v++)for(let b=0;b<hn;b++){const O=m+b,L=y+v;if(L>=t.tiles.length||O>=(((E=t.tiles[0])==null?void 0:E.length)||0))continue;const N=(A=t.tiles[L])==null?void 0:A[O];if(!N)continue;const x=this.getTile(N.id,this.currentTilemap.tilesetId,g);if(!x)continue;const I=b*g,G=v*g;N.rotation||N.flipX||N.flipY?(d.save(),d.translate(I+g/2,G+g/2),N.rotation&&d.rotate(N.rotation*Math.PI/180),N.flipX&&d.scale(-1,1),N.flipY&&d.scale(1,-1),d.drawImage(x,-g/2,-g/2),d.restore()):d.drawImage(x,I,G)}return this.chunks.set(c,h),this.dirtyChunks.delete(c),h}markTileDirty(t,n){const s=Math.floor(t/hn),r=Math.floor(n/hn);if(this.currentTilemap)for(let c=0;c<this.currentTilemap.layers.length;c++)this.dirtyChunks.add(wp(c,s,r))}renderLayer(t,n,s,r=P/2,c=P,h=Y,d=!1){if(!this.currentTilemap)return;const g=this.currentTilemap.layers[n];if(!g||g.visible===!1)return;const m=s*g.parallaxFactor,y=this.currentTilemap.tileSize;let E=0,A=0;if(d||this.isDesignModeActive()){const fe=Xo();fe&&(E=fe.getDesignScrollX(),A=fe.getTerrainHorizontalOffset())}else{const fe=c/2,re=(r-fe)/fe,ce=Xn(this.currentCampaign,this.currentLevel),Te=this.getEffectiveTerrainWidthForRendering(!1);let at=Ot.MAX_PARALLAX_OFFSET;ce&&(at=yl(Te,ce.leftX,ce.rightX,c)),E=Math.floor(re*at);const U=Xo();U&&(A=U.getTerrainHorizontalOffset())}const v=this.currentTilemap.height*y,b=Math.ceil(this.currentTilemap.width/hn),O=Math.ceil(this.currentTilemap.height/hn),N=v-m,x=N-h,I=Math.floor(x/Ui),G=Math.ceil(N/Ui),W=this.getEffectiveTerrainWidthForRendering(d),Q=Math.floor((W-c)/2),j=Q+E-A,q=j+c,Ee=Math.max(0,Math.floor(j/Ui)-1),ye=Math.min(b,Math.ceil(q/Ui)+1);for(let fe=I;fe<=G;fe++){let re=fe%O;re<0&&(re+=O);for(let ce=Ee;ce<=ye;ce++){if(ce<0||ce>=b)continue;const Te=this.getChunk(g,n,ce,re);if(!Te)continue;const at=fe*Ui,U=h-(N-at),se=ce*Ui-Q-E+A;t.drawImage(Te,se,U,Ui+1,Ui+1)}}}render(t,n,s=P/2,r,c=!1){if(!this.currentTilemap)return;const h=r||[zi.BACKGROUND,zi.TERRAIN,zi.DECORATION];for(const d of h)this.renderLayer(t,d,n,s,P,Y,c)}renderBackground(t,n,s=P/2,r=!1){this.renderLayer(t,zi.BACKGROUND,n,s,P,Y,r)}renderTerrain(t,n,s=P/2,r=!1){this.renderLayer(t,zi.TERRAIN,n,s,P,Y,r)}renderDecoration(t,n,s=P/2,r=!1){this.renderLayer(t,zi.DECORATION,n,s,P,Y,r)}getTileAt(t,n,s){var d,g;if(!this.currentTilemap)return null;const r=this.currentTilemap.layers[s];if(!r)return null;const c=Math.floor(t/this.currentTilemap.tileSize),h=Math.floor(n/this.currentTilemap.tileSize);return h<0||h>=r.tiles.length||c<0||c>=(((d=r.tiles[0])==null?void 0:d.length)||0)?null:((g=r.tiles[h])==null?void 0:g[c])||null}hasCollision(t,n){return this.getTileAt(t,n,zi.COLLISION)!==null}setTileAt(t,n,s,r){var h;if(!this.currentTilemap)return;const c=this.currentTilemap.layers[s];c&&(n<0||n>=c.tiles.length||t<0||t>=(((h=c.tiles[0])==null?void 0:h.length)||0)||(c.tiles[n][t]=r,this.markTileDirty(t,n)))}clearCache(){this.chunks.clear(),this.dirtyChunks.clear(),this.tileCache.clear(),console.log("[TilemapRenderer] Cache cleared")}clearAll(){this.chunks.clear(),this.dirtyChunks.clear(),this.tileCache.clear(),this.tilesets.clear(),console.log("[TilemapRenderer] All caches including tilesets cleared")}getDebugInfo(){return{chunks:this.chunks.size,tiles:this.tileCache.size,tilesets:this.tilesets.size}}}const ka=new s2,l2={[vs.SPAWN_TANK]:{entityType:S.SUPPLY_CONVOY,hp:50,scoreValue:100},[vs.SPAWN_TRUCK]:{entityType:S.SUPPLY_CONVOY,hp:30,scoreValue:50},[vs.SPAWN_AA_VEHICLE]:{entityType:S.AA_EMPLACEMENT,hp:40,fireRate:60,scoreValue:150},[vs.TURRET_MG]:{entityType:S.AA_EMPLACEMENT,hp:50,fireRate:30,scoreValue:100},[vs.TURRET_AA]:{entityType:S.AA_EMPLACEMENT,hp:75,fireRate:45,scoreValue:150},[vs.TURRET_CANNON]:{entityType:S.FORTRESS,hp:100,fireRate:90,scoreValue:200}};class r2{constructor(){this.spawnedTiles=new Set,this.spawnedEntities=[],this.triggeredSpawns=new Set,this.activeStructures=new Map,this.levelData=null,this.tilemap=null,this.entityIdCounter=0}loadLevel(t){this.levelData=t,this.tilemap=t.tilemap,this.reset();for(const n of t.structures){const s=np[n.structureId];if(s){const r=`${n.tileX}:${n.tileY}`;this.activeStructures.set(r,{structureId:n.structureId,tileX:n.tileX,tileY:n.tileY,hp:n.hp||s.hp||100})}}console.log(`[TilemapEntityManager] Loaded level ${t.id} with ${t.structures.length} structures`)}reset(){this.spawnedTiles.clear(),this.spawnedEntities=[],this.triggeredSpawns.clear(),this.activeStructures.clear(),this.entityIdCounter=0}generateEntityId(){return`tile_entity_${++this.entityIdCounter}`}getTileKey(t,n){return`${t}:${n}`}processVisibleTiles(t,n,s){var E,A;if(!this.tilemap)return;const r=this.tilemap.tileSize,c=((E=this.tilemap.layers[zi.ENTITY])==null?void 0:E.parallaxFactor)||.6,h=t*c,d=h+Y+r*2,g=Math.max(0,Math.floor(h/r)-1),m=Math.min(this.tilemap.height-1,Math.ceil(d/r)+1),y=this.tilemap.layers[zi.ENTITY];if(y)for(let v=g;v<=m;v++)for(let b=0;b<this.tilemap.width;b++){const O=this.getTileKey(b,v);if(this.spawnedTiles.has(O))continue;const L=(A=y.tiles[v])==null?void 0:A[b];if(!L)continue;const N=l2[L.id];if(!N)continue;this.spawnedTiles.add(O);const x=b*r+r/2,I=v*r,G=this.createGroundEntity(N.entityType,x,I/c,N.hp,N.fireRate,N.scoreValue);this.spawnedEntities.push({tileX:b,tileY:v,entityId:G.id}),s(G)}}processSpawnTriggers(t,n){if(this.levelData)for(const s of this.levelData.spawnTriggers)this.triggeredSpawns.has(s.id)||s.triggerType==="scroll_position"&&s.triggerY!==void 0&&t>=s.triggerY&&(this.triggeredSpawns.add(s.id),this.executeTrigger(s,n))}executeTrigger(t,n){var r,c;console.log(`[TilemapEntityManager] Executing trigger: ${t.id}`);const s=((r=this.tilemap)==null?void 0:r.tileSize)||ki.tileSize;for(let h=0;h<t.count;h++){const d=t.spawnX*(((c=this.tilemap)==null?void 0:c.width)||10)*s,g=(t.spawnY||0)-50;let m=0;t.formation&&(m=(h-Math.floor(t.count/2))*t.formation.spacing);const y={id:this.generateEntityId(),type:t.entityType,pos:{x:d+m,y:g},vel:{vx:0,vy:3},size:this.getEntitySize(t.entityType),hp:this.getEntityHP(t.entityType),active:!0,frame:0,altitude:t.altitude,scoreValue:this.getEntityScore(t.entityType)};t.formation&&t.delay?setTimeout(()=>n(y),h*t.formation.delay*16):n(y)}}createGroundEntity(t,n,s,r,c,h){const d=this.getEntitySize(t);return{id:this.generateEntityId(),type:t,pos:{x:n-d.width/2,y:s},vel:{vx:0,vy:0},size:d,hp:r||this.getEntityHP(t),active:!0,frame:0,altitude:Zt.LOW_ALTITUDE,scoreValue:h||this.getEntityScore(t)}}getEntitySize(t){switch(t){case S.SUPPLY_CONVOY:return{width:48,height:32};case S.AA_EMPLACEMENT:return{width:40,height:40};case S.FORTRESS:return{width:96,height:96};case S.ENEMY_SMALL:return{width:48,height:48};case S.ENEMY_RED:return{width:48,height:48};case S.ENEMY_BIG:return{width:64,height:64};case S.ENEMY_HELICOPTER:return{width:56,height:56};default:return{width:48,height:48}}}getEntityHP(t){switch(t){case S.SUPPLY_CONVOY:return 30;case S.AA_EMPLACEMENT:return 50;case S.FORTRESS:return 200;case S.ENEMY_SMALL:return 10;case S.ENEMY_RED:return 15;case S.ENEMY_BIG:return 40;case S.ENEMY_HELICOPTER:return 25;default:return 20}}getEntityScore(t){switch(t){case S.SUPPLY_CONVOY:return 100;case S.AA_EMPLACEMENT:return 150;case S.FORTRESS:return 500;case S.ENEMY_SMALL:return 50;case S.ENEMY_RED:return 75;case S.ENEMY_BIG:return 150;case S.ENEMY_HELICOPTER:return 100;default:return 50}}getCurrentAltitudeZone(t){if(!this.levelData)return null;const n=t*.6;for(const s of this.levelData.altitudeZones)if(n>=s.startY&&n<=s.endY)return s;return null}handleTileDestruction(t,n,s){var d;if(!this.tilemap)return null;const r=this.tilemap.layers[s];if(!r)return null;const c=(d=r.tiles[n])==null?void 0:d[t];if(!c)return null;const h=eE.find(g=>g.tileId===c.id);return!h||h.type!=="destroyable"?null:(r.tiles[n][t]=null,{scoreValue:h.scoreValue||10,dropsPowerup:h.dropsPowerup||!1})}damageStructure(t,n,s){for(const[r,c]of this.activeStructures){const h=np[c.structureId];if(h&&t>=c.tileX&&t<c.tileX+h.widthTiles&&n>=c.tileY&&n<c.tileY+h.heightTiles)return c.hp-=s,c.hp<=0?(this.activeStructures.delete(r),{destroyed:!0,scoreValue:h.scoreValue||200,dropsPowerup:h.dropsPowerup||!1}):{destroyed:!1,scoreValue:0,dropsPowerup:!1}}return null}cullOffscreenEntities(t,n){const s=t-Y;return n.filter(r=>r.id.startsWith("tile_entity_")?!(r.pos.y<s-200):!0)}getDebugInfo(){return{spawnedTiles:this.spawnedTiles.size,activeStructures:this.activeStructures.size,triggeredSpawns:this.triggeredSpawns.size}}}const lc=new r2,bs=new Map,xs=new Map;function ld(o,t){return`${o}_${t}`}let Jo=!1,Ms=null;async function o2(o,t){const n=o??pe.STEEL_VANGUARD,s=t??1;if(Jo&&Ms===n){console.log(`[TILEMAP] Terrain already loaded for campaign: ${n}`);return}Ms!==null&&Ms!==n&&(console.log(`[TILEMAP] Switching campaigns: ${Ms} -> ${n}`),xs.clear(),bs.clear(),ka.clearAll(),ba.clearCache(),Jo=!1),console.log(`[TILEMAP] Initializing tilemap system for campaign: ${n}, level: ${s}...`);const r=ld(n,s),c=await ba.generateForCampaignAsync(n,s);xs.set(r,c),ka.registerTileset(`terrain_level_${s}`,c.tileset),Jo=!0,Ms=n,console.log(`[TILEMAP] Tilemap system initialized for campaign: ${n}, level: ${s}`)}function sm(o,t){var E;const{tileGrid:n}=t,s=n.length,r=((E=n[0])==null?void 0:E.length)||ki.mapWidthTiles,c={tiles:n.map(A=>A.map(v=>({id:v}))),parallaxFactor:1,visible:!0},h={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!0},d={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!1},g={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!0},m={tiles:Array(s).fill(null).map(()=>Array(r).fill(null)),parallaxFactor:1,visible:!1},y={width:r,height:s,tileSize:ki.tileSize,tilesetId:`terrain_level_${o}`,layers:[c,h,d,g,m]};return{level:o,tilemap:y,spawnTriggers:[],structures:[]}}async function Vh(o,t){ka.clearCache();const n=t??Ms??pe.STEEL_VANGUARD;ka.setLevelContext(n,o),gt.setLevelContext(n,o),ea.setLevelContext(n,o);const s=ld(n,o);console.log(`[TILEMAP] Loading terrain for ${n} level ${o}...`);let r=xs.get(s);if(r||(r=await ba.generateForCampaignAsync(n,o),xs.set(s,r)),ka.registerTileset(`terrain_level_${o}`,r.tileset),bs.has(s)){const h=bs.get(s);return ka.loadTilemap(h.tilemap),lc.loadLevel(h),console.log(`[TILEMAP] Loaded cached tilemap for ${n} level ${o}`),h}const c=sm(o,r);return bs.set(s,c),ka.loadTilemap(c.tilemap),lc.loadLevel(c),console.log(`[TILEMAP] Level ${o} tilemap ready: ${c.tilemap.width}x${c.tilemap.height} tiles`),c}function Pp(o,t){console.log(`[TILEMAP] loadLevelTilemap called: level=${o}, campaign=${t}`),ka.clearCache();const n=t??Ms??pe.STEEL_VANGUARD,s=ld(n,o);console.log(`[TILEMAP] targetCampaign=${n}, cacheKey=${s}`),ka.setLevelContext(n,o),gt.setLevelContext(n,o),ea.setLevelContext(n,o);let r=xs.get(s);if(!r){const h=ba.getCampaignCached(n,o);h&&(r=h,xs.set(s,r))}if(r&&ka.registerTileset(`terrain_level_${o}`,r.tileset),bs.has(s)){const h=bs.get(s);return ka.loadTilemap(h.tilemap),lc.loadLevel(h),console.log(`[TILEMAP] Loaded cached tilemap for ${n} level ${o}`),h}if(!r)return console.log(`[TILEMAP] Terrain not cached for ${n} level ${o}, starting async load...`),ba.generateForCampaignAsync(n,o).then(d=>{xs.set(s,d),ka.registerTileset(`terrain_level_${o}`,d.tileset),console.log(`[TILEMAP] Terrain for ${n} level ${o} now cached`)}),{level:o,tilemap:{width:ki.mapWidthTiles,height:ki.mapHeightTiles,tileSize:ki.tileSize,tilesetId:`terrain_level_${o}`,layers:[]},spawnTriggers:[],structures:[]};const c=sm(o,r);return bs.set(s,c),ka.loadTilemap(c.tilemap),lc.loadLevel(c),console.log(`[TILEMAP] Level ${o} tilemap ready: ${c.tilemap.width}x${c.tilemap.height} tiles`),c}function Cp(o,t,n=P/2,s=!1){ka.renderBackground(o,t,n,s)}function Ip(o,t,n=P/2,s=!1){ka.renderTerrain(o,t,n,s)}function Wh(){return Jo}const c2="/play-wwii-sky-ace/",u2=c2,lm=`${u2}dist-assets`,h2=!0;console.log(`[DestroyedOverlayRenderer] ASSET_BASE_PATH=${lm}, PROD=${h2}`);function Bp(o){return`${lm}/${o.replace(".png",".webp")}`}const fl=new Map,un=new Set;class d2{constructor(){this.campaign="",this.level=0,this.totalMapHeight=0,this.overlays=[],this.revealedOverlays=new Map,this.baseOffsetX=0}setLevelContext(t,n,s){this.campaign=t,this.level=n,this.totalMapHeight=s;const r=ga(t,n);this.baseOffsetX=Math.floor((r.mapWidthExtended-P)/2),this.overlays=Kp(t,n),this.revealedOverlays.clear(),this.preloadOverlayImages(),console.log(`[DestroyedOverlayRenderer] Loaded ${this.overlays.length} overlays for ${t} level ${n}`)}getDynamicParallaxOffsetForPlayer(t){const n=Xn(this.campaign,this.level);if(n){const s=ba.getDetectedTerrainWidth(this.campaign,this.level),r=ga(this.campaign,this.level),c=s??r.mapWidthExtended,h=yl(c,n.leftX,n.rightX,P),d=P/2,g=(t-d)/d;return Math.floor(g*h)}return oc(t,P)}preloadOverlayImages(){for(const t of this.overlays)if(!fl.has(t.id)&&!un.has(t.id)){un.add(t.id);const n=new Image;n.onload=()=>{fl.set(t.id,n),un.delete(t.id),console.log(`[DestroyedOverlayRenderer] Preloaded overlay: ${t.id}`)},n.onerror=r=>{un.delete(t.id),console.error(`[DestroyedOverlayRenderer] Failed to preload overlay: ${n.src}`,r)};const s=Bp(t.imagePath);console.log(`[DestroyedOverlayRenderer] Preloading from: ${s}`),n.src=s}}async preloadAllImages(){if(this.overlays.length===0)return;console.log(`[DestroyedOverlayRenderer] Preloading ${this.overlays.length} overlay images...`);const t=this.overlays.map(n=>new Promise(s=>{if(fl.has(n.id)){s();return}if(un.has(n.id)){const h=setInterval(()=>{(fl.has(n.id)||!un.has(n.id))&&(clearInterval(h),s())},50);return}un.add(n.id);const r=new Image;r.onload=()=>{fl.set(n.id,r),un.delete(n.id),console.log(`[DestroyedOverlayRenderer] Loaded overlay: ${n.id}`),s()},r.onerror=h=>{un.delete(n.id),console.error(`[DestroyedOverlayRenderer] Failed to load overlay: ${r.src}`,h),s()};const c=Bp(n.imagePath);console.log(`[DestroyedOverlayRenderer] Loading image: ${c}`),r.src=c}));await Promise.all(t),console.log(`[DestroyedOverlayRenderer] All ${this.overlays.length} overlay images preloaded`)}checkAndRevealForDestroyedTargets(t){for(const n of t){const s=lp(this.campaign,this.level,n);s&&!this.revealedOverlays.has(s.id)&&this.revealOverlay(s)}}revealOverlay(t){const n=fl.get(t.id);n?(this.revealedOverlays.set(t.id,{overlay:t,image:n,revealTime:performance.now(),fadeInProgress:0}),console.log(`[DestroyedOverlayRenderer] Revealed overlay: ${t.id} (linked to ${t.linkedTargetId})`)):console.warn(`[DestroyedOverlayRenderer] Cannot reveal overlay ${t.id}: image not loaded`)}revealOverlayForTarget(t){const n=lp(this.campaign,this.level,t);n&&this.revealOverlay(n)}update(t){for(const s of this.revealedOverlays.values())if(s.fadeInProgress<1){const r=performance.now()-s.revealTime;s.fadeInProgress=Math.min(1,r/500)}}render(t,n,s){if(this.revealedOverlays.size===0)return;const r=this.totalMapHeight-n;t.save();for(const c of this.revealedOverlays.values()){const{overlay:h,image:d,fadeInProgress:g}=c,{cropArea:m}=h,y=this.getDynamicParallaxOffsetForPlayer(s),E=m.x-this.baseOffsetX-y,A=Y-(r-m.y),v=Y-(r-(m.y+m.height)),b=Math.min(A,v),O=Math.max(A,v),L=O-b;b>Y+50||O<-50||E>P+50||E+m.width<-50||(t.globalAlpha=g,t.drawImage(d,E,b,m.width,L))}t.restore()}reset(){this.revealedOverlays.clear()}isOverlayRevealed(t){return this.revealedOverlays.has(t)}getRevealedCount(){return this.revealedOverlays.size}getTotalOverlays(){return this.overlays.length}}const Er=new d2,Fp=Object.assign({}),Xh=Object.assign({"../data/generated/maps/campaigns/dawn-patrol-1_combined_metadata.json":()=>Wt(()=>import("./dawn-patrol-1_combined_metadata-uFdTddyA.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-2_combined_metadata.json":()=>Wt(()=>import("./dawn-patrol-2_combined_metadata-qhkigtIS.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-3_combined_metadata.json":()=>Wt(()=>import("./dawn-patrol-3_combined_metadata-DKAThoaN.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-4_combined_metadata.json":()=>Wt(()=>import("./dawn-patrol-4_combined_metadata-BFXl99t6.js"),[]),"../data/generated/maps/campaigns/dawn-patrol-5_combined_metadata.json":()=>Wt(()=>import("./dawn-patrol-5_combined_metadata-CAmGGX5N.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-1_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-1_combined_metadata-CKGhBMD_.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-2_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-2_combined_metadata-CW-zkVym.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-3_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-3_combined_metadata-OLnkna3i.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-4_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-4_combined_metadata-DIZaaKOV.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-5_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-5_combined_metadata-R-AoW6iY.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-6_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-6_combined_metadata-Cwvrsig9.js"),[]),"../data/generated/maps/campaigns/hellfire-horizon-7_combined_metadata.json":()=>Wt(()=>import("./hellfire-horizon-7_combined_metadata-CKdUWefK.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-1_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-1_combined_metadata-CwCKkbOh.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-2_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-2_combined_metadata-B4830iwU.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-3_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-3_combined_metadata-BFb0beKi.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-4_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-4_combined_metadata-BHOCbtsV.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-5_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-5_combined_metadata-DiPkbG6M.js"),[]),"../data/generated/maps/campaigns/steel-vanguard-6_combined_metadata.json":()=>Wt(()=>import("./steel-vanguard-6_combined_metadata-BQ-_5Hdl.js"),[])}),Hp=Object.assign({"../data/generated/maps/level1_combined_metadata.json":()=>Wt(()=>import("./level1_combined_metadata-DEg4OSmK.js"),[]),"../data/generated/maps/level2_combined_metadata.json":()=>Wt(()=>import("./level2_combined_metadata-ByJ4iVlt.js"),[]),"../data/generated/maps/level3_combined_metadata.json":()=>Wt(()=>import("./level3_combined_metadata-CYIMHv7w.js"),[]),"../data/generated/maps/level4_combined_metadata.json":()=>Wt(()=>import("./level4_combined_metadata-DukPmzVA.js"),[]),"../data/generated/maps/level5_combined_metadata.json":()=>Wt(()=>import("./level5_combined_metadata-BUA17aNz.js"),[])});class f2{constructor(){this.state=te.ATTRACT,this.campaign=pe.STEEL_VANGUARD,this.difficulty=mt.NORMAL,this.entities=[],this.score=0,this.finalScore=0,this.highScore=1e4,this.lives=3,this.frameCount=0,this.waveTimer=0,this.credits=0,this.totalCreditsRemaining=10,this.pausedFromState=te.PLAYING,this.pauseSelection=0,this.screenShake=0,this.camera={x:0,y:0,zoom:1,targetZoom:1,rotation:0,targetRotation:0,smoothing:.2},this.timeScale=1,this.targetTimeScale=1,this.freezeFrames=0,this.logicFrame=0,this.level=1,this.levelProgress=0,this.intermissionTimer=0,this.intermissionScrollY=0,this.intermissionFadeAlpha=0,this.intermissionPhase="stats",this.intermissionLoading=!1,this.intermissionIsFinalLevel=!1,this.intermissionCachedProgress=null,this.INTERMISSION_DURATION=300,this.INTERMISSION_FADE_DURATION=30,this.INTERMISSION_SCROLL_SPEED=1.5,this.bossEngine=new P_,this.activeBoss=null,this.bossIntroTimer=0,this.bossIntroStartFrame=0,this.bossDefeating=!1,this.crashingBoss=null,this.bossCrashTimer=0,this.bossCrashRotation=0,this.nextStateAfterDebrief=te.GAME_OVER,this.postProcessing=new tm,this.combo=0,this.comboTimer=0,this.COMBO_TIMEOUT=180,this.LEVEL_DURATION=1800,this.heatPoints=0,this.heatLevel=jt.COLD,this.heatDecayTimer=0,this.lastHeatLevel=jt.COLD,this.lastScoreMilestone=0,this.lastComboMilestone=0,this.floatingScores=[],this.lingeringFireZones=[],this.helicopterBarrageState=new Map,this.BARRAGE_DURATION=60,this.BARRAGE_FIRE_INTERVAL=6,this.BARRAGE_COOLDOWN=300,this.pendingScores=[],this.pendingScoreTimer=0,this.SCORE_BUNDLE_WINDOW=12,this.playerEvading=!1,this.evadeTimer=0,this.firepowerBullets=0,this.firepowerStacks=0,this.activeFirepowerTier=za.STANDARD,this.spreadBullets=0,this.spreadStacks=0,this.spreadDropsCompleted=[],this.bombQueue=[],this.bombCooldown=0,this.bombActiveFrame=-100,this.playerInvincible=0,this.playerHealth=100,this.maxPlayerHealth=100,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.invincibilityCount=0,this.gameOverTimer=0,this.powerupLegendTimer=0,this.nextLevelPreloaded=!1,this.autoZoomEnabled=!0,this.actionDensity=0,this.currentZoomState=Ja.CALM,this.zoomOverride=wa.NONE,this.zoomOverrideTimer=0,this.nearDeathActive=!1,this.bulletHellActive=!1,this.previousDensity=0,this.debugMode=!1,this.playerAltitude=2,this.targetAltitude=2,this.altitudeTransitionTimer=0,this.diveBombChargeTimer=0,this.isTransitioningAltitude=!1,this.autoClimbTimer=0,this.currentLevelMap=null,this.spawnedEntityIds=new Set,this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.tilemapEnabled=!0,this.tilemapScrollY=0,this.waterZones=[],this.roadZones=[],this.landZones=[],this.mapElements=[],this.entityPaths=[],this.pathSpawnTimers=new Map,this.reset()}get MAX_LEVEL(){return nd(this.campaign)}get bombCount(){return this.bombQueue.length}getPlayerFirepowerState(){return{firepowerActive:this.firepowerBullets>0,firepowerTier:this.activeFirepowerTier,firepowerStacks:this.firepowerStacks,spreadActive:this.spreadBullets>0,spreadStacks:this.spreadStacks,bombCount:this.bombQueue.length}}get firepowerCount(){return this.standardFirepowerCount+this.enhancedFirepowerCount}setCampaign(t){switch(this.campaign=t,this.bossEngine.setCampaign(t),me.setCampaign(t),t){case pe.DAWN_PATROL:this.difficulty=mt.BEGINNER;break;case pe.STEEL_VANGUARD:this.difficulty=mt.NORMAL;break;case pe.HELLFIRE_HORIZON:this.difficulty=mt.VETERAN;break}}setDifficulty(t){switch(t){case mt.BEGINNER:this.setCampaign(pe.DAWN_PATROL);break;case mt.NORMAL:this.setCampaign(pe.STEEL_VANGUARD);break;case mt.VETERAN:this.setCampaign(pe.HELLFIRE_HORIZON);break}}getDifficultyMultiplier(){const t=yr(this.campaign,this.level),n=Bt.getEnemySpeedMultiplier()/.8,s=Bt.getEnemyFireRateMultiplier()/.8;return{...t,speed:t.speed*n,fireRate:t.fireRate*s}}getCampaignTurretHPMult(){return this.campaign===pe.DAWN_PATROL?1.3:this.campaign===pe.HELLFIRE_HORIZON?1.7:1.5}getDynamicPowerupBoost(){if(this.levelProgress/this.LEVEL_DURATION*100<60)return 0;let n=0;this.firepowerBullets===0&&this.firepowerStacks===0&&(n+=.15),this.bombQueue.length<=1&&(n+=.1);const s={[pe.DAWN_PATROL]:1.2,[pe.STEEL_VANGUARD]:1,[pe.HELLFIRE_HORIZON]:.7};return n*=s[this.campaign]||1,n}getEnemyMaxHP(t){const n=this.getDifficultyMultiplier();switch(t){case S.ENEMY_SMALL:case S.ENEMY_RED:return this.campaign===pe.HELLFIRE_HORIZON?6:this.campaign===pe.STEEL_VANGUARD?4:3;case S.ENEMY_HELICOPTER:return Math.floor(12*n.enemyHP);case S.ENEMY_BIG:return Math.floor(35*n.enemyHP);case S.ENEMY_BATTLESHIP:return Math.floor(170*n.enemyHP);case S.ENEMY_TANK:return Math.floor(50*n.enemyHP);case S.ENEMY_LARGE_TANK:return Math.floor(95*n.enemyHP);default:return 10}}reset(){this.entities=[],this.score=0,this.finalScore=0,this.lives=3+this.credits,this.bombQueue=[ya.STANDARD,ya.STANDARD,ya.STANDARD],this.bombCooldown=0,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.invincibilityCount=0,this.frameCount=0,this.waveTimer=0,this.firepowerBullets=0,this.firepowerStacks=0,this.activeFirepowerTier=za.STANDARD,this.spreadBullets=0,this.spreadStacks=0,this.spreadDropsCompleted=[],this.bombActiveFrame=-100,this.screenShake=0;const t=parseInt("0",10);switch(t>0&&t<=this.MAX_LEVEL?(this.level=t,console.log(`[GameEngine] CHEAT: Skipping to level ${t}`)):this.level=1,this.levelProgress=0,this.tilemapScrollY=0,Vn.setCampaign(this.campaign,this.level),this.waterZones=[],this.landZones=[],this.mapElements=[],gt.reset(),ea.reset(),this.playerAltitude=Zt.HIGH_ALTITUDE,this.targetAltitude=Zt.HIGH_ALTITUDE,this.altitudeTransitionTimer=0,this.diveBombChargeTimer=0,this.isTransitioningAltitude=!1,this.autoClimbTimer=0,this.difficulty){case mt.BEGINNER:this.maxPlayerHealth=300;break;case mt.NORMAL:this.maxPlayerHealth=200;break;case mt.VETERAN:this.maxPlayerHealth=100;break}this.playerHealth=this.maxPlayerHealth,this.spawnPlayer()}insertCoin(){this.totalCreditsRemaining>0&&(this.credits++,this.totalCreditsRemaining--,me.playCoin())}startGame(){this.credits>0&&(this.state=te.STORY,this.gameOverTimer=0,this.reset(),this.credits=0,me.init())}pause(){(this.state===te.PLAYING||this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE)&&(this.pausedFromState=this.state,this.state=te.PAUSED,this.pauseSelection=0)}resume(){this.state===te.PAUSED&&(this.state=this.pausedFromState)}quitToTitle(){if(this.state===te.PAUSED){const t=Math.max(0,this.lives-3);this.totalCreditsRemaining+=t,this.state=te.ATTRACT,Vn.clear()}}isDesignModeAvailable(){return xi}isDesignModeEnabled(){return V.isEnabled()}toggleDesignMode(){if(!xi)return console.warn("[DESIGN MODE] Not available - VITE_DESIGN_TIME not set"),this.state;V.setLevelContext(this.campaign,this.level),V.setEntityPaths(this.entityPaths);const t=V.toggleDesignMode(this.state,this.tilemapScrollY);return this.state=t,t}getDesignModeManager(){return V}async switchDesignModeLevel(t){if(!xi||this.state!==te.DESIGN_MODE)return console.warn("[DESIGN MODE] Cannot switch level - not in design mode"),!1;if(V.resetForLevelSwitch(),this.level=t,V.setLevelContext(this.campaign,t),gt.setLevelContext(this.campaign,t),ea.setLevelContext(this.campaign,t),V.loadCompiledOverrides(),this.tilemapScrollY=0,this.tilemapEnabled)try{await Vh(t,this.campaign),console.log(`[DESIGN MODE] Loaded tilemap for ${this.campaign} level ${t}`)}catch(n){return console.warn(`[DESIGN MODE] Failed to load tilemap for ${this.campaign} level ${t}:`,n),!1}return await this.loadLevelMap(t),V.setEntityPaths(this.entityPaths),console.log(`[DESIGN MODE] Switched to ${this.campaign} level ${t}`),!0}getPathHorizontalOffset(t){if(xi&&V.isEnabled()){const n=V.getPendingChanges();if(n.pathOverrides[t])return n.pathOverrides[t].horizontalOffset}return cE(this.campaign,this.level,t)}getEffectiveScrollY(){return this.state===te.DESIGN_MODE?V.getDesignScrollY():this.state===te.LEVEL_COMPLETE?this.intermissionPhase==="fadeIn"?this.tilemapScrollY:this.intermissionScrollY:this.tilemapScrollY}clearEntitiesForIntermission(){this.entities=this.entities.filter(t=>t.type===S.PLAYER),ve.clear(),this.activeBoss=null}startIntermission(t=!1){if(this.state=te.LEVEL_COMPLETE,this.intermissionTimer=this.INTERMISSION_DURATION,this.intermissionScrollY=this.tilemapScrollY,this.intermissionFadeAlpha=0,this.intermissionPhase="stats",this.intermissionLoading=!1,this.intermissionIsFinalLevel=t,this.intermissionCachedProgress=ea.getLevelProgress(),this.clearEntitiesForIntermission(),this.bossDefeating=!1,t&&(this.finalScore=this.score),!t&&this.level<this.MAX_LEVEL){const n=this.level+1;console.log(`[INTERMISSION] Preloading level ${n} assets...`);const s=`../data/generated/level${n}.json`,r=Fp[s];r&&r().then(()=>{console.log(`[INTERMISSION] Level ${n} JSON preloaded`)}).catch(g=>{console.warn("[INTERMISSION] Level JSON preload failed:",g)});const h=`../data/generated/maps/campaigns/${this.campaign.toLowerCase().replace(/_/g,"-")}-${n}_combined_metadata.json`,d=Xh[h];d&&d().then(()=>{console.log(`[INTERMISSION] Level ${n} metadata preloaded`)}).catch(g=>{console.warn("[INTERMISSION] Metadata preload failed:",g)}),Vh(n,this.campaign).then(()=>{console.log(`[INTERMISSION] Level ${n} tilemap preloaded`)}).catch(g=>{console.warn("[INTERMISSION] Tilemap preload failed:",g)}),nc(n).catch(g=>{console.warn("[INTERMISSION] Boss asset preload failed:",g)})}}async updateIntermission(){if(this.state===te.LEVEL_COMPLETE){if(this.intermissionScrollY+=this.INTERMISSION_SCROLL_SPEED,this.intermissionPhase==="stats")this.intermissionTimer--,this.intermissionTimer<=0&&(this.intermissionPhase="fadeOut",this.intermissionFadeAlpha=0);else if(this.intermissionPhase==="fadeOut")this.intermissionFadeAlpha+=1/this.INTERMISSION_FADE_DURATION,this.intermissionFadeAlpha>=1&&!this.intermissionLoading&&(this.intermissionFadeAlpha=1,this.intermissionLoading=!0,this.intermissionIsFinalLevel?(this.postProcessing.reset(),this.intermissionLoading=!1,console.log("[INTERMISSION] Final level complete - transitioning to VICTORY"),this.state=te.VICTORY):(this.level++,this.levelProgress=0,this.tilemapScrollY=0,this.nextLevelPreloaded=!1,this.spreadDropsCompleted=[],Vn.setCampaign(this.campaign,this.level),await this.loadLevelMap(this.level),this.tilemapEnabled&&(ba.hasCampaignCached(this.campaign,this.level)?Pp(this.level,this.campaign):await Vh(this.level,this.campaign)),nc(this.level).catch(t=>console.error("[LAZY] Failed to load boss for level",this.level,t)),me.playLevelMusic(this.level,this.campaign),this.postProcessing.reset(),this.intermissionLoading=!1,this.intermissionPhase="fadeIn"));else if(this.intermissionPhase==="fadeIn"&&(this.intermissionFadeAlpha-=1/this.INTERMISSION_FADE_DURATION,this.intermissionFadeAlpha<=0)){this.intermissionFadeAlpha=0,this.state=te.PLAYING,this.playerInvincible=54;for(let t=0;t<2&&this.bombQueue.length<At.MAX_BOMBS;t++)this.bombQueue.push(ya.STANDARD)}}}async startMission(){await this.loadLevelMap(this.level),this.state=te.PLAYING,this.powerupLegendTimer=180,this.playerInvincible=54;for(let t=0;t<2&&this.bombQueue.length<At.MAX_BOMBS;t++)this.bombQueue.push(ya.STANDARD);if(console.log(`[TILEMAP] tilemapEnabled=${this.tilemapEnabled}, campaign=${this.campaign}, level=${this.level}`),this.tilemapEnabled)try{console.log("[TILEMAP] About to call loadLevelTilemap..."),Pp(this.level,this.campaign),this.tilemapScrollY=0,console.log(`[TILEMAP] Loaded tilemap for ${this.campaign} level ${this.level}`)}catch(t){console.warn(`[TILEMAP] Failed to load tilemap for ${this.campaign} level ${this.level}:`,t)}else console.log("[TILEMAP] Tilemap is DISABLED, skipping terrain load");me.playLevelMusic(this.level,this.campaign)}async loadLevelMap(t){var n,s,r;try{const c=`../data/generated/level${t}.json`,h=Fp[c];if(h){const d=await h();this.currentLevelMap=d.default||d,this.spawnedEntityIds.clear(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.playerAltitude=Zt.HIGH_ALTITUDE,this.targetAltitude=Zt.HIGH_ALTITUDE,this.isTransitioningAltitude=!1,console.log(`[LEVEL MAP] Loaded level ${t}: ${(n=this.currentLevelMap)==null?void 0:n.name}`),console.log(`[LEVEL MAP] Spawns: ${(s=this.currentLevelMap)==null?void 0:s.spawns.length}, Altitude zones: ${(r=this.currentLevelMap)==null?void 0:r.altitudeZones.length}`)}else console.log(`[LEVEL MAP] No level${t}.json found, using procedural spawning`),this.currentLevelMap=null,this.spawnedEntityIds.clear(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1,this.playerAltitude=Zt.HIGH_ALTITUDE,this.targetAltitude=Zt.HIGH_ALTITUDE,this.isTransitioningAltitude=!1}catch(c){console.warn(`[LEVEL MAP] Failed to load level ${t}, using procedural spawning:`,c),this.currentLevelMap=null}await this.loadTerrainMetadata(t)}async loadTerrainMetadata(t){const n=Ot.TOTAL_MAP_HEIGHT,r=`../data/generated/maps/campaigns/${this.campaign.toLowerCase().replace(/_/g,"-")}-${t}_combined_metadata.json`,c=`../data/generated/maps/level${t}_combined_metadata.json`;Xh[r]?await this.loadMetadataFromPath(r,!0,t,n):Hp[c]?await this.loadMetadataFromPath(c,!1,t,n):(this.waterZones=[],this.landZones=[],this.mapElements=[],gt.reset(),console.log(`[TERRAIN] ${this.campaign} Level ${t}: No metadata found, using unrestricted spawning`))}async loadMetadataFromPath(t,n,s,r){gt.setLevelContext(this.campaign,s),ea.setLevelContext(this.campaign,s),Er.setLevelContext(this.campaign,s,r),Er.preloadAllImages().catch(y=>{console.warn("[TERRAIN] Failed to preload destroyed overlays:",y)});let c=[],h=[],d=[],g=[];try{const y=n?Xh[t]:Hp[t];if(!y)throw new Error(`No loader found for path: ${t}`);const E=await y(),A=E.default||E;let v=[];if(A&&A.slices)for(const O of A.slices)O.entities&&(v=v.concat(O.entities));if(v.length>0){c=v.filter(L=>L.type==="turret").map(L=>({id:L.id,x:L.x,worldY:L.worldY})),console.log(`[TERRAIN] Level ${s}: Loaded ${c.length} turrets from JSON metadata`);const O=v.filter(L=>L.type==="target").map(L=>({id:L.id,type:"target",shape:"circle",label:L.id,x:L.x,y:r-L.worldY,radius:L.radius||20,normalizedX:L.x/640,normalizedY:(r-L.worldY)/r,targetType:L.targetType,scoreValue:L.points||100}));ea.loadFromMetadata(O,r,s),O.length>0&&console.log(`[TERRAIN] Level ${s}: Loaded ${O.length} mission targets from JSON metadata`)}else console.warn(`[TERRAIN] Level ${s}: No entities in metadata, turrets will be empty`),ea.loadFromMetadata([],r,s);ea.loadAddedTargets(),A&&A.terrainZones&&(h=A.terrainZones.water||[],d=A.terrainZones.road||[],g=A.terrainZones.land||[],console.log(`[TERRAIN] Level ${s}: Loaded ${h.length} water, ${d.length} road, ${g.length} land zones from metadata`)),A&&A.entityPaths&&A.entityPaths.length>0?(this.entityPaths=A.entityPaths.map(O=>({id:O.id,entityType:this.parseEntityType(O.entityType),waypoints:O.waypoints||[],totalLength:O.totalLength||0,speedMultiplier:O.speedMultiplier??1,spawnDelay:O.spawnDelay??0,spawnInterval:O.spawnInterval??600,maxEntities:O.maxEntities??1,loop:O.loop??!1,direction:O.direction||"random",activeEntities:0,nextSpawnFrame:O.spawnDelay??0})),this.pathSpawnTimers.clear(),this.entityPaths.forEach(O=>{this.pathSpawnTimers.set(O.id,O.spawnDelay)}),console.log(`[TERRAIN] Level ${s}: Loaded ${this.entityPaths.length} entity paths from metadata`),this.entityPaths.forEach(O=>{const L=O.waypoints.map(I=>I.x),N=Math.min(...L),x=Math.max(...L);console.log(`[TERRAIN] Path ${O.id}: ${O.waypoints.length} waypoints, X range: ${N.toFixed(1)} to ${x.toFixed(1)} (${(x-N).toFixed(1)}px)`)})):(this.entityPaths=[],this.pathSpawnTimers.clear());const b=uE(this.campaign,this.level);if(b.length>0){for(const O of b){const L=hE(this.campaign,this.level,O.pathId),N=this.parseEntityType((L==null?void 0:L.entityType)||O.entityType),x=(L==null?void 0:L.speed)??O.speed,I=(L==null?void 0:L.direction)??O.direction,G=(L==null?void 0:L.spawnPoint)??O.spawnPoint,W={id:O.pathId,entityType:N,waypoints:O.waypoints,totalLength:this.calculatePathLength(O.waypoints),speedMultiplier:x,spawnDelay:O.spawnDelay??0,spawnInterval:O.spawnInterval??600,maxEntities:O.maxEntities??1,loop:O.loop??!1,direction:I,spawnPoint:G,activeEntities:0,nextSpawnFrame:O.spawnDelay??0};this.entityPaths.push(W),this.pathSpawnTimers.set(W.id,W.spawnDelay)}console.log(`[TERRAIN] Level ${s}: Loaded ${b.length} added paths from design overrides`)}}catch(y){console.warn(`[TERRAIN] Level ${s}: Failed to load metadata JSON, using fallback zones:`,y)}h.length>0?this.waterZones=h.map(y=>({id:y.id,type:"water",shape:"rect",label:y.label||y.id,x:y.x,y:y.y,width:y.width,height:y.height,normalizedX:y.x/P,normalizedY:y.y/r,isSpawnZone:!0,allowedSpawns:[S.ENEMY_BATTLESHIP]})):(this.waterZones=[],console.log(`[TERRAIN] Level ${s}: No water zones - battleships disabled`)),g.length>0?this.landZones=g.map(y=>({id:y.id,type:"land",shape:"rect",label:y.label||y.id,x:y.x,y:y.y,width:y.width,height:y.height,normalizedX:y.x/P,normalizedY:y.y/r})):this.landZones=[{id:"land_left",type:"land",shape:"rect",label:"land_left",x:90,y:r/2,width:180,height:r,normalizedX:.14,normalizedY:.5}],d.length>0?(this.roadZones=d.map(y=>({id:y.id,type:"road",shape:"rect",label:y.label||y.id,x:y.x,y:y.y,width:y.width,height:y.height,normalizedX:y.x/P,normalizedY:y.y/r,isSpawnZone:!0,allowedSpawns:[S.ENEMY_TANK,S.ENEMY_LARGE_TANK]})),console.log(`[TERRAIN] Level ${s}: ${this.roadZones.length} road zones enabled for tank spawning`)):this.roadZones=[];const m=c.map(y=>({id:y.id,type:"turret",shape:"circle",label:y.id,x:y.x,y:r-y.worldY,radius:8,normalizedX:y.x/640,normalizedY:(r-y.worldY)/r,entityType:S.AA_EMPLACEMENT,hp:15,fireRate:360,scoreValue:200}));this.mapElements=[...this.waterZones,...this.roadZones,...this.landZones,...m],gt.reset(),gt.setLevelContext(this.campaign,s),gt.setTotalMapHeight(r),gt.loadFromMetadata(m,0,r,r),gt.loadAddedTurrets(),console.log(`[TERRAIN] Level ${s}: Loaded ${this.waterZones.length} water, ${this.roadZones.length} road, ${this.landZones.length} land zones, ${m.length} turrets (mapHeight=${r})`)}setCameraZoom(t,n=30){this.camera.targetZoom=Math.max(.5,Math.min(2,t)),this.camera.smoothing=n>0?.15:1}setCameraOffset(t,n){this.camera.x=t,this.camera.y=n}resetCamera(){this.camera.targetZoom=1,this.camera.targetRotation=0,this.camera.x=0,this.camera.y=0}initiateAltitudeTransition(t){var s,r;if(this.playerAltitude===t||this.isTransitioningAltitude)return;this.targetAltitude=t,this.isTransitioningAltitude=!0;const n=t<this.playerAltitude;this.altitudeTransitionTimer=n?ei.DIVE_TRANSITION_FRAMES:ei.CLIMB_TRANSITION_FRAMES,this.zoomOverride=n?wa.DIVE_BOMB:wa.CLIMB_UP,n?(s=me.playDive)==null||s.call(me):(r=me.playClimb)==null||r.call(me),console.log(`[ALTITUDE] Transitioning from ${this.playerAltitude} to ${t}`)}startDiveBomb(t){const n=t??Math.max(0,this.playerAltitude-1);this.initiateAltitudeTransition(n)}climbUp(){this.initiateAltitudeTransition(Zt.HIGH_ALTITUDE)}updateAltitudeTransition(){if(!this.isTransitioningAltitude||this.altitudeTransitionTimer<=0)return;this.altitudeTransitionTimer--;const t=this.targetAltitude<this.playerAltitude,n=t?ei.DIVE_TRANSITION_FRAMES:ei.CLIMB_TRANSITION_FRAMES,s=1-this.altitudeTransitionTimer/n,r=s<.5?2*s*s:1-Math.pow(-2*s+2,2)/2,c=m=>{switch(m){case Zt.SEA_LEVEL:return ei.SEA_LEVEL;case Zt.LOW_ALTITUDE:return ei.LOW_ALTITUDE;case Zt.HIGH_ALTITUDE:return ei.HIGH_ALTITUDE;default:return 1}},h=c(this.playerAltitude),d=c(this.targetAltitude),g=h+(d-h)*r;if(this.camera.targetZoom=g,t?(this.camera.targetRotation=ei.DIVE_ROTATION_MAX*(1-s),this.targetTimeScale=ei.DIVE_TIME_SCALE,this.screenShake=Math.max(this.screenShake,ei.DIVE_SHAKE_INTENSITY*(1-s))):this.targetTimeScale=ei.CLIMB_TIME_SCALE,this.altitudeTransitionTimer<=0){this.playerAltitude=this.targetAltitude,this.isTransitioningAltitude=!1,this.camera.targetRotation=0,this.targetTimeScale=1,this.zoomOverride=wa.NONE,this.autoClimbTimer=0;const m=this.entities.find(y=>y.type===S.PLAYER);m&&(m.altitude=this.playerAltitude),console.log(`[ALTITUDE] Transition complete. Now at altitude ${this.playerAltitude}`)}}canCollideWithAltitude(t,n){return t===n}getDefaultAltitude(t){switch(t){case S.ENEMY_BATTLESHIP:case S.AIRCRAFT_CARRIER:case S.DESTROYER:case S.SUPPLY_SHIP:case S.SUBMARINE:case S.PT_BOAT:case S.WAKE:return Zt.SEA_LEVEL;case S.VILLAGE:case S.FORTRESS:case S.AA_EMPLACEMENT:case S.RADAR_STATION:case S.FUEL_DEPOT:case S.AIRFIELD:case S.SUPPLY_CONVOY:return Zt.LOW_ALTITUDE;case S.PLAYER:case S.ENEMY_SMALL:case S.ENEMY_RED:case S.ENEMY_BIG:case S.ENEMY_HELICOPTER:case S.BOSS:case S.SUPPORT_FIGHTER:case S.BULLET_PLAYER:case S.BULLET_ENEMY:case S.POWERUP:default:return Zt.HIGH_ALTITUDE}}getAltitudeScoreMultiplier(t){return this.playerAltitude===t?1:t===Zt.SEA_LEVEL&&this.playerAltitude<=Zt.LOW_ALTITUDE?ei.SEA_ATTACK_MULTIPLIER:t===Zt.LOW_ALTITUDE&&this.playerAltitude===Zt.LOW_ALTITUDE?ei.GROUND_ATTACK_MULTIPLIER:1}calculateActionDensity(){if(!this.autoZoomEnabled)return 0;const t=this.entities.find(y=>y.type===S.PLAYER);if(!t)return 0;const n=this.entities.filter(y=>{if(!y.type.toString().startsWith("ENEMY"))return!1;const E=y.pos.x-t.pos.x,A=y.pos.y-t.pos.y;return Math.sqrt(E*E+A*A)<ot.ENEMY_RADIUS}).length,s=Math.min(1,n/ot.MAX_ENEMIES_NORMALIZE),r=this.entities.filter(y=>{if(y.type!==S.BULLET_CANNON&&y.type!==S.BULLET_ENEMY&&y.type!==S.BULLET_TURRET)return!1;const E=y.pos.x-t.pos.x,A=y.pos.y-t.pos.y;return Math.sqrt(E*E+A*A)<ot.BULLET_RADIUS}).length,c=Math.min(1,r/ot.MAX_BULLETS_NORMALIZE);let h=0;this.activeBoss&&this.activeBoss.vulnerable&&(h=1);const d=1-this.playerHealth/this.maxPlayerHealth,g=Math.min(1,this.combo/20),m=s*ot.ENEMY_WEIGHT+c*ot.BULLET_WEIGHT+h*ot.BOSS_WEIGHT+d*ot.HEALTH_WEIGHT+g*ot.COMBO_WEIGHT;return this.debugMode&&this.logicFrame%60===0&&console.log(`[DYNAMIC ZOOM] Density: ${(m*100).toFixed(1)}% | Enemies: ${n} | Bullets: ${r} | Health: ${this.playerHealth}/${this.maxPlayerHealth} | Combo: ${this.combo}`),Math.max(0,Math.min(1,m))}determineZoomState(t){const n=ot.HYSTERESIS;return t<this.previousDensity?t<ot.CALM_THRESHOLD-n?Ja.CALM:t<ot.MODERATE_THRESHOLD-n?Ja.MODERATE:t<ot.INTENSE_THRESHOLD-n?Ja.INTENSE:Ja.EXTREME:t<ot.CALM_THRESHOLD?Ja.CALM:t<ot.MODERATE_THRESHOLD?Ja.MODERATE:t<ot.INTENSE_THRESHOLD?Ja.INTENSE:Ja.EXTREME}checkZoomOverrides(){if(!this.entities.find(r=>r.type===S.PLAYER))return;if(this.activeBoss&&this.activeBoss.vulnerable&&this.zoomOverride!==wa.BOSS_VULNERABLE){this.zoomOverride=wa.BOSS_VULNERABLE,this.zoomOverrideTimer=ot.BOSS_VULNERABLE_DURATION,console.log("[DYNAMIC ZOOM] Boss vulnerable! Precision mode activated.");return}const n=this.playerHealth/this.maxPlayerHealth;if(n<ot.NEAR_DEATH_THRESHOLD&&!this.nearDeathActive?(this.nearDeathActive=!0,this.zoomOverride=wa.NEAR_DEATH,this.zoomOverrideTimer=-1,console.log("[DYNAMIC ZOOM] Near death! Last stand mode activated.")):n>ot.NEAR_DEATH_RELEASE&&this.nearDeathActive&&(this.nearDeathActive=!1,this.zoomOverride=wa.NONE,this.zoomOverrideTimer=0,console.log("[DYNAMIC ZOOM] Health recovered. Exiting last stand mode.")),this.nearDeathActive)return;const s=this.entities.filter(r=>r.type===S.BULLET_CANNON||r.type===S.BULLET_ENEMY||r.type===S.BULLET_TURRET).length;s>ot.BULLET_HELL_THRESHOLD&&!this.bulletHellActive?(this.bulletHellActive=!0,this.zoomOverride=wa.BULLET_HELL,this.zoomOverrideTimer=-1,console.log(`[DYNAMIC ZOOM] Bullet hell detected! ${s} bullets on screen.`)):s<ot.BULLET_HELL_RELEASE&&this.bulletHellActive&&(this.bulletHellActive=!1,this.zoomOverride=wa.NONE,this.zoomOverrideTimer=0,console.log("[DYNAMIC ZOOM] Bullet density decreased. Exiting bullet hell mode."))}updateZoomVisualEffects(t){if(t>=1.1){const n=(t-1)/.3;this.postProcessing.triggerPrecisionVignette(n*.3,1)}}updateDynamicZoom(){if(!this.autoZoomEnabled)return;this.actionDensity=this.calculateActionDensity(),this.checkZoomOverrides();let t=ot.NORMAL,n=1,s=ot.SMOOTH_DURATION;if(this.zoomOverride!==wa.NONE)switch(this.zoomOverride){case wa.BOSS_VULNERABLE:t=ot.BOSS_VULNERABLE_ZOOM,n=ot.BOSS_VULNERABLE_TIMESCALE,s=ot.FAST_TRANSITION;break;case wa.NEAR_DEATH:t=ot.NEAR_DEATH_ZOOM,n=ot.NEAR_DEATH_TIMESCALE;break;case wa.BULLET_HELL:t=ot.BULLET_HELL_ZOOM,n=ot.BULLET_HELL_TIMESCALE;break}else{const r=this.currentZoomState;switch(this.currentZoomState=this.determineZoomState(this.actionDensity),this.debugMode&&r!==this.currentZoomState&&console.log(`[DYNAMIC ZOOM] State changed: ${r} -> ${this.currentZoomState} (Density: ${(this.actionDensity*100).toFixed(1)}%)`),this.currentZoomState){case Ja.CALM:t=ot.CALM_ZOOM,n=ot.CALM_TIMESCALE;break;case Ja.MODERATE:t=ot.MODERATE_ZOOM,n=ot.MODERATE_TIMESCALE;break;case Ja.INTENSE:t=ot.INTENSE_ZOOM,n=ot.INTENSE_TIMESCALE;break;case Ja.EXTREME:t=ot.EXTREME_ZOOM,n=ot.EXTREME_TIMESCALE;break}}this.setCameraZoom(t,s),this.setTimeScale(n,0),this.updateZoomVisualEffects(t),this.previousDensity=this.actionDensity,this.zoomOverrideTimer>0&&(this.zoomOverrideTimer--,this.zoomOverrideTimer<=0&&(this.zoomOverride=wa.NONE))}setTimeScale(t,n=0){this.targetTimeScale=Math.max(.1,Math.min(2,t)),n===0&&(this.timeScale=this.targetTimeScale)}freezeFrame(t){this.freezeFrames=t}spawnPlayer(){this.playerHealth=this.maxPlayerHealth,this.entities.push({id:"player",type:S.PLAYER,pos:{x:P/2-Kg/2,y:Y-100},vel:{vx:0,vy:0},size:{width:Kg,height:Hy},hp:1,active:!0,frame:0,hitFlash:0,bankAngle:0})}handleInput(t){if(this.state!==te.PLAYING&&this.state!==te.BOSS_INTRO&&this.state!==te.BOSS_BATTLE)return;const n=this.entities.find(L=>L.type===S.PLAYER);if(!n||!n.active||n.isLooping)return;let s=0,r=0;t.left&&(s=-fr),t.right&&(s=fr),t.up&&(r=-fr),t.down&&(r=fr),n.vel.vx=n.vel.vx*.8+s*.2,n.vel.vy=n.vel.vy*.8+r*.2;const c=n.vel.vx/fr*.3;n.bankAngle=(n.bankAngle||0)*.8+c*.2;const h=n.pos.x+n.vel.vx,d=n.pos.y+n.vel.vy,g=Y*.05,m=Y*.07,y=P*.02,E=Xn(this.campaign,this.level),A=g,v=Y-m-n.size.height;let b=y,O=P-y-n.size.width;if(E){const L=ba.getDetectedTerrainWidth(this.campaign,this.level),N=ga(this.campaign,this.level),x=L??N.mapWidthExtended;yl(x,E.leftX,E.rightX,P);const I=10;b=I,O=P-I-n.size.width;const G=E.rightX-E.leftX;if(G<P){const W=(P-G)/2;b=Math.max(I,W),O=Math.min(P-I-n.size.width,P-W-n.size.width)}(b>=O||O-b<50)&&(b=y,O=P-y-n.size.width)}h<b?(n.pos.x=b,n.vel.vx=0):h>O?(n.pos.x=O,n.vel.vx=0):n.pos.x=h,d<A?(n.pos.y=A,n.vel.vy=0):d>v?(n.pos.y=v,n.vel.vy=0):n.pos.y=d,t.fire&&!this.playerEvading&&this.logicFrame%8===0&&this.fireBullet(n),t.evade&&this.lives>0&&!this.playerEvading&&this.performEvade(n),t.bomb&&this.bombQueue.length>0&&!this.playerEvading&&this.bombCooldown<=0&&this.triggerBomb(n)}triggerBomb(t){if(this.bombQueue.length===0||this.bombCooldown>0)return;const n=this.bombQueue.pop();if(!n)return;this.bombActiveFrame=this.frameCount,this.bombCooldown=At.COOLDOWN,me.playBomb(),me.playBombDescending();const s=t.pos.x+t.size.width/2,r=this.getDynamicTerrainParallaxOffset(s),c=s-16+r;this.entities.push({id:`bomb_${Date.now()}`,type:S.BOMB_DROPPED,pos:{x:c,y:t.pos.y+10},vel:{vx:0,vy:At.INITIAL_VELOCITY},size:{width:32,height:48},hp:1,active:!0,frame:0,bombTier:n,dropFrame:0,scale:At.INITIAL_SCALE,shadowScale:0})}detonateBomb(t){me.stopBombDescending();const n=t.bombTier||ya.STANDARD,s=At.TIERS[n];this.entities.forEach(N=>{if(!this.isEnemy(N))return;const x=N.pos.x+N.size.width/2-(t.pos.x+t.size.width/2),I=N.pos.y+N.size.height/2-(t.pos.y+t.size.height/2),G=Math.sqrt(x*x+I*I);if(G>s.radius)return;const W=Math.pow(1-G/s.radius,2),Q=Math.floor(s.damage*W);N.hp-=Q,N.hp<=0?(N.active=!1,this.decrementPathActiveEntities(N),this.spawnExplosion(N.pos,N.size),N.scoreValue&&(this.score+=N.scoreValue)):N.hitFlash=5,N.turrets&&(N.turrets.forEach(j=>{Math.sqrt(Math.pow(N.pos.x+j.relPos.x-t.pos.x,2)+Math.pow(N.pos.y+j.relPos.y-t.pos.y,2))<s.radius&&(j.hp-=Math.floor(Q*.5),j.hp<=0&&this.spawnExplosion({x:N.pos.x+j.relPos.x-16,y:N.pos.y+j.relPos.y-16},{width:32,height:32}))}),N.turrets=N.turrets.filter(j=>j.hp>0))}),this.entities.forEach(N=>{if(N.type===S.BULLET_ENEMY||N.type===S.BULLET_CANNON||N.type===S.BULLET_TURRET){const x=N.pos.x-t.pos.x,I=N.pos.y-t.pos.y;Math.sqrt(x*x+I*I)<s.radius&&(N.active=!1)}});const r=this.entities.find(N=>N.type===S.PLAYER),c=r?r.pos.x+r.size.width/2:P/2,h=this.getDynamicTerrainParallaxOffset(c),g=t.pos.x+t.size.width/2-h,m=t.pos.y+t.size.height/2,y=gt.applyBombDamage(g,m,s.radius,s.damage,this.tilemapScrollY,c);for(const N of y.destroyed){const x=gt.getTurretScreenPosition(N,this.tilemapScrollY);x&&(this.spawnExplosion({x:x.x-24,y:x.y-24},{width:48,height:48}),ve.emitExplosionDebris(x.x,x.y,10),this.score+=200,this.spawnFloatingScore(x.x,x.y,200,"turret"),this.spawnTurretDebris(x.x,x.y))}const E=ea.applyBombDamage(g,m,s.radius,this.tilemapScrollY,c);for(const N of E.destroyed){const x=ea.getTargetScreenPosition(N,this.tilemapScrollY,c);x&&(this.spawnExplosion({x:x.x-32,y:x.y-32},{width:64,height:64}),ve.emitExplosionDebris(x.x,x.y,15))}if(this.score+=E.pointsAwarded,E.destroyed.length>0&&Er.checkAndRevealForDestroyedTargets(E.destroyed),this.activeBoss){const N=this.entities.find(x=>x.type===S.BOSS);if(N&&N.active){const x=N.pos.x+N.size.width/2,I=N.pos.y+N.size.height/2,G=g-x,W=m-I,Q=Math.sqrt(G*G+W*W),j=Math.max(N.size.width,N.size.height)/2;if(Q<=s.radius+j){const Ee=this.campaign===pe.STEEL_VANGUARD||this.campaign===pe.HELLFIRE_HORIZON||this.campaign===pe.DAWN_PATROL&&this.level>=2?.2:1,ye=Math.floor(s.damage*Ee);this.activeBoss.hp-=ye,N.hp=this.activeBoss.hp,ve.emitExplosionDebris(x,I,10),console.log(`[BOSS] Bomb hit! Damage: ${ye} (${Ee*100}%), HP remaining: ${this.activeBoss.hp}`)}}}this.entities.push({id:`blast_wave_${Date.now()}`,type:S.BLAST_WAVE,pos:{x:t.pos.x+t.size.width/2,y:t.pos.y+t.size.height/2},vel:{vx:0,vy:0},size:{width:0,height:0},hp:1,active:!0,frame:0,maxFrames:30,blastRadius:s.radius}),this.spawnExplosion(t.pos,{width:96,height:96}),s.clusters>0&&this.spawnClusterExplosions(t.pos,n,s.clusters),this.screenShake=At.SCREEN_SHAKE_BASE+n*At.SCREEN_SHAKE_PER_TIER,ve.emitExplosionDebris(t.pos.x+t.size.width/2,t.pos.y+t.size.height/2,15+n*5);const A=ga(this.campaign,this.level),v=Math.floor((A.mapWidthExtended-P)/2),b=gt.getTotalMapHeight(),O=g+v+h,L=b-this.tilemapScrollY-Y+m;this.addLingeringFireZone(O,L)}isEnemy(t){return t.type===S.ENEMY_SMALL||t.type===S.ENEMY_RED||t.type===S.ENEMY_BIG||t.type===S.ENEMY_HELICOPTER||t.type===S.ENEMY_BATTLESHIP||t.type===S.AA_EMPLACEMENT||t.type===S.FORTRESS||t.type===S.AIRCRAFT_CARRIER||t.type===S.DESTROYER}addLingeringFireZone(t,n){this.lingeringFireZones.length>=8&&this.lingeringFireZones.shift(),this.lingeringFireZones.push({worldX:t,worldY:n,startFrame:this.frameCount})}updateLingeringFireZones(){if(this.lingeringFireZones.length===0)return;const t=this.entities.find(g=>g.type===S.PLAYER),n=t?t.pos.x+t.size.width/2:P/2,s=ga(this.campaign,this.level),r=Math.floor((s.mapWidthExtended-P)/2),c=this.getDynamicTerrainParallaxOffset(n),h=gt.getTotalMapHeight(),d=60;for(let g=this.lingeringFireZones.length-1;g>=0;g--){const m=this.lingeringFireZones[g],y=m.worldX-r-c,E=Y-(h-this.tilemapScrollY-m.worldY);if(E>Y+50){this.lingeringFireZones.splice(g,1);continue}if(E<-100){this.lingeringFireZones.splice(g,1);continue}if(E<0||E>Y||y<-50||y>P+50)continue;if(this.frameCount-m.startFrame<d){if(Math.random()<.08){const v=-Math.PI/2+(Math.random()-.5)*.5;ve.emitMuzzleFlash(y+(Math.random()-.5)*30,E,v)}Math.random()<.08&&ve.emitGroundEmbers(y+(Math.random()-.5)*30,E,2),Math.random()<.12&&ve.emitWhiteSmoke(y+(Math.random()-.5)*25,E,.5),Math.random()<.04&&ve.emitSparks(y+(Math.random()-.5)*50,E,2)}else Math.random()<.15&&ve.emitWhiteSmoke(y+(Math.random()-.5)*25,E,.6)}}getBombTierForLevel(){return this.level>=At.TIER_THRESHOLDS.MEGA?ya.MEGA:this.level>=At.TIER_THRESHOLDS.CLUSTER?ya.CLUSTER:this.level>=At.TIER_THRESHOLDS.HEAVY?ya.HEAVY:ya.STANDARD}getFirepowerTierForLevel(){if(this.level<pi.TIER_THRESHOLDS.ENHANCED)return za.STANDARD;const t=pi.ENHANCED_CHANCE[this.difficulty]||0;return Math.random()<t?za.ENHANCED:za.STANDARD}spawnClusterExplosions(t,n,s){const r=At.CLUSTER_SPREAD_BASE+n*At.CLUSTER_SPREAD_PER_TIER;for(let c=0;c<s;c++){const h=c/s*Math.PI*2+Math.random()*.3,d=r*(.5+Math.random()*.5),g=c*At.CLUSTER_DELAY_FRAMES+Math.floor(Math.random()*3),m=t.x+Math.cos(h)*d,y=t.y+Math.sin(h)*d;this.entities.push({id:`cluster_${Date.now()}_${c}`,type:S.EXPLOSION,pos:{x:m,y},vel:{vx:0,vy:0},size:{width:48,height:48},hp:1,active:!0,frame:-g,maxFrames:20}),this.applyBlastDamage(m,y,At.CLUSTER_RADIUS,At.TIERS[n].damage*At.CLUSTER_DAMAGE_RATIO)}}applyBlastDamage(t,n,s,r){this.entities.forEach(c=>{if(!this.isEnemy(c))return;const h=c.pos.x+c.size.width/2-t,d=c.pos.y+c.size.height/2-n,g=Math.sqrt(h*h+d*d);if(g>s)return;const m=1-g/s;c.hp-=Math.floor(r*m),c.hp<=0&&(c.active=!1,this.decrementPathActiveEntities(c),this.spawnExplosion(c.pos,c.size))})}performEvade(t){t.isEvading=!0,t.evasiveScale=1,this.playerEvading=!0,this.evadeTimer=150,this.playerInvincible=150,me.playEvade()}activateFirepower(){this.enhancedFirepowerCount>0?(this.enhancedFirepowerCount--,this.firepowerBullets=pi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=za.ENHANCED):this.standardFirepowerCount>0&&(this.standardFirepowerCount--,this.firepowerBullets=pi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=za.STANDARD)}generateBulletOffsets(t,n=15){const s=[],r=Math.floor(t/2);for(let c=0;c<r;c++){const h=(c+1)*n;s.push(-h,h)}return s}fireBullet(t){me.playShoot();const n=this.firepowerBullets>0;if(this.spreadBullets>0){const r=this.spreadStacks-1,h=[...[-Math.PI/2,-Math.PI/4,0,0,Math.PI/4,Math.PI/2]];for(let m=0;m<r;m++){const y=(m+1)*(Math.PI/16);m%2===0?h.push(y):h.push(-y)}const d=t.pos.x+t.size.width/2,g=t.pos.y;h.forEach((m,y)=>{const E=m-Math.PI/2,A=Math.cos(E)*Bo,v=Math.sin(E)*Bo;let b=0;m===0&&(b=y===2?-8:8),this.entities.push({id:Math.random().toString(),type:S.BULLET_PLAYER,pos:{x:d-2+b,y:g},vel:{vx:A,vy:v},size:{width:4,height:16},hp:1,active:!0,frame:0}),(y===2||y===3)&&ve.emitMuzzleFlash(d+b,g,E)}),this.spreadBullets--,this.spreadBullets===0&&(this.spreadStacks=0)}else{let r,c=1;if(n){const h=pi.TIERS[this.activeFirepowerTier],d=h.offsets.length,g=this.firepowerStacks-1,m=d+g;c=h.damageMultiplier,r=this.generateBulletOffsets(m)}else r=[-10,10];r.forEach((h,d)=>{const g=t.pos.x+t.size.width/2+h-2,m=t.pos.y;this.entities.push({id:Math.random().toString(),type:S.BULLET_PLAYER,pos:{x:g,y:m},vel:{vx:0,vy:-Bo},size:{width:4,height:16},hp:c,active:!0,frame:0}),d<2&&ve.emitMuzzleFlash(g+2,m,-Math.PI/2),(d===0||d===r.length-1)&&ve.emitBulletTracer(g+2,m-10,0,-Bo)}),n&&(this.firepowerBullets--,this.firepowerBullets===0&&(this.firepowerStacks=0,this.activateFirepower()))}}update(){if(this.postProcessing.update(),Vn.update(this.frameCount,this.timeScale),ea.update(1),this.updateAltitudeTransition(),this.screenShake>0&&(this.screenShake*=.9,this.screenShake<.5&&(this.screenShake=0)),this.combo>0&&(this.comboTimer--,this.comboTimer<=0&&(this.combo=0)),this.updateHeatDecay(),this.updateFloatingScores(),this.updateLingeringFireZones(),this.state===te.GAME_OVER&&(this.gameOverTimer++,this.gameOverTimer>300&&(this.state=te.ATTRACT,this.gameOverTimer=0)),this.state===te.LEVEL_COMPLETE){this.updateIntermission();return}if(this.state===te.BOSS_INTRO){if(this.bossIntroTimer++,this.bossIntroTimer===1&&this.activeBoss){this.freezeFrame(8),this.postProcessing.triggerWhiteFlash(.8,15),this.setCameraZoom(1.3,40);const s=this.activeBoss.pos.x+this.activeBoss.size.width/2,r=this.activeBoss.pos.y+this.activeBoss.size.height/2;for(let c=0;c<12;c++){const h=Math.PI*2/12*c,d=Math.max(this.activeBoss.size.width,this.activeBoss.size.height)/2;ve.emitShrapnel(s+Math.cos(h)*d,r+Math.sin(h)*d,8)}}if(this.bossIntroTimer>8&&this.bossIntroTimer<80&&this.activeBoss&&this.bossIntroTimer%5===0){const s=this.activeBoss.pos.x+this.activeBoss.size.width/2,r=this.activeBoss.pos.y+this.activeBoss.size.height/2;ve.emitFire(s+(Math.random()-.5)*50,r+(Math.random()-.5)*50,2)}this.bossIntroTimer===80&&this.setCameraZoom(1,30),this.bossIntroTimer>120&&(this.state=te.BOSS_BATTLE,this.bossIntroTimer=0,this.resetCamera())}if(this.state===te.BOSS_BATTLE&&this.activeBoss){const s=this.entities.find(r=>r.type===S.PLAYER);if(s){const r=this.getPlayerFirepowerState(),c=this.bossEngine.updateBoss(this.activeBoss,s.pos,this.logicFrame);c.length>20&&console.warn(`[FREEZE DEBUG] Boss generated ${c.length} bullets! Frame: ${this.logicFrame}, TimeScale: ${this.timeScale.toFixed(2)}`),c.length>50?(console.error(`[FREEZE DEBUG] Boss bullet explosion! Limiting ${c.length} to 50.`),this.entities.push(...c.slice(0,50))):this.entities.push(...c);const h=this.bossEngine.spawnHelicopterMinion(this.activeBoss,r,this.logicFrame);h&&this.entities.push(h);const d=this.bossEngine.updateHelicopterMinions(this.activeBoss,s.pos,this.logicFrame,r,this.entities);for(const m of d)this.entities.push({id:`minion_bullet_${this.logicFrame}_${Math.random()}`,type:S.BULLET_ENEMY,pos:{x:m.x,y:m.y},vel:{vx:Math.cos(m.angle)*m.speed,vy:Math.sin(m.angle)*m.speed},size:{width:8,height:8},hp:1,active:!0,frame:0,scoreValue:0}),m.isBarrage&&ve.emitMuzzleFlash(m.x,m.y,Math.PI/2);const g=this.bossEngine.updateBerserkMode(this.activeBoss,s.pos,this.logicFrame);if(this.entities.push(...g),this.activeBoss.phaseJustChanged){console.log(`[FREEZE DEBUG] Boss phase transition! Phase: ${this.activeBoss.phase}, HP: ${this.activeBoss.hp}, Frame: ${this.logicFrame}`),this.activeBoss.phaseJustChanged=!1,this.freezeFrame(5),console.log("[FREEZE DEBUG] Freeze frame triggered for 5 frames"),this.postProcessing.triggerChromaticAberration(8,20),this.screenShake=12;const m=this.activeBoss.pos.x+this.activeBoss.size.width/2,y=this.activeBoss.pos.y+this.activeBoss.size.height/2;ve.emitExplosionDebris(m,y,20),ve.emitShrapnel(m,y,15);for(let E=0;E<8;E++){const A=Math.PI*2/8*E;ve.emitFire(m+Math.cos(A)*40,y+Math.sin(A)*40,3)}}}if(this.bossEngine.isBossDefeated(this.activeBoss)&&!this.bossDefeating){this.bossDefeating=!0,this.score+=this.activeBoss.scoreValue||5e4;const r=this.bossEngine.getHelicopterMinionEntityIds();for(const g of r){const m=this.entities.find(y=>y.id===g);m&&m.active&&(m.active=!1,this.spawnExplosion(m.pos,m.size))}this.bossEngine.clearHelicopterMinions(),console.log("[FREEZE DEBUG] Boss defeat triggered at frame",this.logicFrame),this.setTimeScale(.6,0),this.setCameraZoom(.9,30);const c=this.activeBoss.pos.x+this.activeBoss.size.width/2,h=this.activeBoss.pos.y+this.activeBoss.size.height/2;for(let g=0;g<4;g++){const m=(Math.random()-.5)*this.activeBoss.size.width*.6,y=(Math.random()-.5)*this.activeBoss.size.height*.6;this.spawnExplosion({x:c+m-32,y:h+y-32},{width:64,height:64})}ve.emitExplosionDebris(c,h,15),ve.emitFire(c,h,5),ve.emitShrapnel(c,h,10),this.postProcessing.triggerWhiteFlash(.6,8),this.screenShake=20;const d=Math.random()>.5?1:-1;this.crashingBoss={...this.activeBoss},this.crashingBoss.vel={vx:d*(.5+Math.random()*.3),vy:2+Math.random()*.5},this.crashingBoss.scale=1,this.bossCrashTimer=60,this.bossCrashRotation=d*.1,this.activeBoss.active=!1,this.activeBoss=null,this.entities.forEach(g=>{g.type===S.BOSS&&(g.active=!1),g.pathFollow&&(g.type===S.ENEMY_TANK||g.type===S.ENEMY_LARGE_TANK||g.type===S.ENEMY_BATTLESHIP||g.type===S.AIRCRAFT_CARRIER||g.type===S.DESTROYER)&&(g.active=!1)}),this.entityPaths.forEach(g=>{g.activeEntities=0}),console.log("[BOSS] Started crash sequence, cleared ground units")}}if(this.crashingBoss&&this.bossCrashTimer>0){const r=1-this.bossCrashTimer/60;this.crashingBoss.vel.vy+=.08,this.crashingBoss.pos.y+=this.crashingBoss.vel.vy,this.crashingBoss.pos.x+=this.crashingBoss.vel.vx,this.crashingBoss.scale=1-r*.6,this.bossCrashRotation+=.025;const c=this.crashingBoss.pos.x+this.crashingBoss.size.width/2,h=this.crashingBoss.pos.y+this.crashingBoss.size.height/2;if(this.logicFrame%2===0&&(ve.emitCrashSmoke(c+(Math.random()-.5)*40,h,2),ve.emitSmokePlume(c+(Math.random()-.5)*60,h,1)),this.logicFrame%3===0&&ve.emitFire(c+(Math.random()-.5)*80,h+(Math.random()-.5)*30,1),this.bossCrashTimer%10===0){const d=(Math.random()-.5)*this.crashingBoss.size.width*.6,g=(Math.random()-.5)*this.crashingBoss.size.height*.4;this.spawnExplosion({x:c+d-24,y:h+g-24},{width:48,height:48}),ve.emitExplosionDebris(c+d,h+g,6)}this.bossCrashTimer--,(this.bossCrashTimer<=0||this.crashingBoss.pos.y>Y+50)&&(this.crashingBoss.pos.y<Y+100?this.triggerBossCrashExplosion():(this.crashingBoss=null,this.bossCrashTimer=0,this.finishBossDefeat()))}if(this.powerupLegendTimer>0&&this.powerupLegendTimer--,this.state!==te.PLAYING&&this.state!==te.GAME_OVER&&this.state!==te.LEVEL_COMPLETE&&this.state!==te.BOSS_INTRO&&this.state!==te.BOSS_BATTLE)return;if(this.camera.zoom+=(this.camera.targetZoom-this.camera.zoom)*this.camera.smoothing,this.camera.rotation+=(this.camera.targetRotation-this.camera.rotation)*this.camera.smoothing,this.updateDynamicZoom(),this.timeScale!==this.targetTimeScale&&(this.timeScale+=(this.targetTimeScale-this.timeScale)*.1,Math.abs(this.timeScale-this.targetTimeScale)<.01&&(this.timeScale=this.targetTimeScale)),this.postProcessing.update(),this.freezeFrames>0){this.freezeFrames--,this.freezeFrames===0&&console.log("[FREEZE DEBUG] Freeze frame ended, resuming game logic");return}if(this.state===te.PAUSED||this.state===te.DESIGN_MODE)return;const t=this.timeScale;if(this.frameCount+=t,this.logicFrame++,this.playerInvincible>0&&(this.playerInvincible-=t),this.state===te.PLAYING){this.waveTimer++,this.levelProgress++,this.tilemapEnabled&&(this.tilemapScrollY=this.levelProgress*fa);const s=this.entities.find(d=>d.type===S.PLAYER);if(s){gt.update(this.tilemapScrollY,s.pos,t);const d=this.getDifficultyMultiplier(),g=gt.getFiringTurrets(this.tilemapScrollY,this.logicFrame,d.fireRate);for(const y of g)y.burstPending=Gn.BURST_COUNT,y.burstNextFrame=this.logicFrame;const m=gt.getActiveTurrets();for(const y of m){if(y.burstPending<=0||this.logicFrame<y.burstNextFrame)continue;const E=gt.getTurretScreenPosition(y.metadata.id,this.tilemapScrollY,s.pos.x);if(!E)continue;const v=(Gn.BURST_COUNT-y.burstPending===0?-1:1)*Gn.PARALLEL_OFFSET/2,b=y.angle+Math.PI/2,O=Math.cos(b)*v,L=Math.sin(b)*v,N=Gn.BASE_SPEED*d.bulletSpeed,x=Math.cos(y.angle)*N,I=Math.sin(y.angle)*N;this.entities.push({id:Math.random().toString(),type:S.BULLET_TURRET,pos:{x:E.x+O,y:E.y+L},vel:{vx:x,vy:I},size:{width:Gn.WIDTH,height:Gn.HEIGHT},hp:1,active:!0,frame:0}),y.burstPending--,y.burstNextFrame=this.logicFrame+Gn.BURST_DELAY}}const r=this.LEVEL_DURATION*.8;this.levelProgress>=r&&!this.nextLevelPreloaded&&this.level<this.MAX_LEVEL&&(console.log(`[PRELOAD] Level ${this.level} at 80%, preloading level ${this.level+1} assets...`),this.nextLevelPreloaded=!0,a2(this.level).catch(d=>console.error("[PRELOAD] Failed to preload next level:",d)));const c=this.levelProgress/this.LEVEL_DURATION*100;let h=[];this.campaign===pe.DAWN_PATROL?h=[40]:this.campaign===pe.STEEL_VANGUARD?h=[40,80]:this.campaign===pe.HELLFIRE_HORIZON&&(h=[50,85]);for(const d of h)c>=d&&!this.spreadDropsCompleted.includes(d)&&(this.spawnSupportFighter(),this.spreadDropsCompleted.push(d));if(this.levelProgress>=this.LEVEL_DURATION&&this.level<=this.MAX_LEVEL){const d=this.bossEngine.createBoss(this.level);d&&(this.activeBoss=d,this.entities.push(d),this.state=te.BOSS_INTRO,this.bossIntroTimer=0,this.bossIntroStartFrame=this.frameCount,this.bossDefeating=!1,this.entities.forEach(g=>{if(g.pathFollow&&(g.type===S.ENEMY_TANK||g.type===S.ENEMY_LARGE_TANK)){g.active=!1;const m=this.entityPaths.find(y=>y.id===g.pathFollow.pathId);m&&(m.activeEntities=Math.max(0,m.activeEntities-1))}}),me.playBossMusic(this.level,this.campaign));return}}if(this.state===te.GAME_OVER)return;if(this.bombCooldown>0&&this.bombCooldown--,this.playerEvading){this.evadeTimer--;const s=this.entities.find(r=>r.type===S.PLAYER);if(s&&s.isEvading){const c=(150-this.evadeTimer)/150;c<.5?s.evasiveScale=1-c*2*.3:s.evasiveScale=.7+(c-.5)*2*.3}this.evadeTimer<=0&&(s&&(s.isEvading=!1,s.evasiveScale=1),this.playerEvading=!1)}this.entities.forEach(s=>{if(s.animationSpeed&&(s.frame+=s.animationSpeed,s.maxFrames&&s.frame>=s.maxFrames&&(s.frame=0)),s.type===S.POWERUP&&(s.rotation=(s.rotation||0)+.02),s.type===S.BOSS&&this.activeBoss){const r=Math.sin(this.frameCount/30)*.02;s.scale=1+r}}),this.spawnWaves(),this.spawnPathBasedEntities();const n=this.entities.find(s=>s.type===S.PLAYER);if(this.entities.forEach(s=>{var g,m,y;if(s.type===S.ENEMY_SMALL||s.type===S.ENEMY_RED||s.type===S.ENEMY_BIG||s.type===S.POWERUP){const E=fa;s.vel.vy<E&&(s.vel.vy=E)}if(s.type!==S.PLAYER&&!s.pathFollow&&(s.pos.x+=s.vel.vx,s.pos.y+=s.vel.vy),s.hitFlash&&s.hitFlash>0&&s.hitFlash--,s.type===S.BOMB_DROPPED){if(s.dropFrame=(s.dropFrame||0)+1,s.dropFrame<=At.INITIAL_FORWARD_FRAMES)s.vel.vy=At.INITIAL_VELOCITY,s.scale=At.INITIAL_SCALE;else{s.vel.vy=0,s.vel.vx=0;const E=(s.dropFrame-At.INITIAL_FORWARD_FRAMES)/(At.DROP_DURATION-At.INITIAL_FORWARD_FRAMES),A=At.INITIAL_SCALE*(1-At.SHRINK_FACTOR);s.scale=At.INITIAL_SCALE-E*(At.INITIAL_SCALE-A),s.shadowScale=E}s.dropFrame>=At.DROP_DURATION&&(this.detonateBomb(s),s.active=!1)}if(s.type===S.SUPPORT_FIGHTER&&this.updateSupportFighter(s),s.formationState&&s.formationState.waypoints.length>0){const E=s.formationState,A=E.waypoints[E.currentWaypointIndex];if(A){const v=this.getDifficultyMultiplier(),b=Fo*Zg(this.campaign,this.level)*v.speed,O=ap(s.pos,A,b);s.vel.vx+=(O.vx-s.vel.vx)*.15,s.vel.vy+=(O.vy-s.vel.vy)*.15;const L=ip(s.vel);s.rotation===void 0?s.rotation=L:s.rotation=Ky(s.rotation,L,.12),Qy(s.pos,A,25)&&(E.currentWaypointIndex++,E.waypointProgress=0)}}if(s.type===S.ENEMY_SMALL||s.type===S.ENEMY_RED){const E=s.vel.vx/Fo*.4;if(s.bankAngle=E,this.difficulty===mt.VETERAN&&this.level>=3&&n){const A=n.pos.y-s.pos.y,v=s.type===S.ENEMY_RED,b=fa,O=v?fa+1.5:fa+2.5;let N=(b+O)/2;A>200?N=O:A<100&&A>0&&(N=b),s.vel.vy+=(N-s.vel.vy)*.05,s.vel.vy=Math.max(b,Math.min(O,s.vel.vy))}}if(s.type===S.ENEMY_HELICOPTER){if(this.getDifficultyMultiplier(),!this.bossEngine.isBossHelicopterMinion(s.id)){const L=this.helicopterBarrageState.get(s.id);if(L!=null&&L.active){if(s.vel.vx=0,s.vel.vy=0,s.bankAngle=0,this.logicFrame-L.startFrame>=this.BARRAGE_DURATION)L.active=!1;else{const x=Math.max(3,Math.floor(this.BARRAGE_FIRE_INTERVAL/(Bt.getEnemyFireRateMultiplier()/.6)));this.logicFrame-L.lastFireFrame>=x&&(this.helicopterBarrageFire(s),L.lastFireFrame=this.logicFrame)}return}if((!L||this.logicFrame-L.startFrame>this.BARRAGE_COOLDOWN)&&s.pos.y>50){const N=this.getBarrageTriggerChance(this.level,!1);Math.random()<N&&this.helicopterBarrageState.set(s.id,{active:!0,startFrame:this.logicFrame,lastFireFrame:0})}}const A=this.getDifficultyMultiplier(),v=A.speed;if(s.pos.y<100)s.vel.vy=2*v;else{s.vel.vy=.5*v;const L=Math.sin(this.frameCount/30)*3*v;let N=0;if(this.difficulty===mt.NORMAL?N=.3:this.difficulty===mt.VETERAN&&(N=.5),n&&N>0){const x=n.pos.x-(s.pos.x+s.size.width/2),I=Math.sign(x)*Math.min(Math.abs(x)*.01,N);s.vel.vx=L*.6+I*.4}else s.vel.vx=L;this.difficulty===mt.VETERAN&&(s.vel.vy+=Math.sin(this.frameCount/60)*.3)}const b=s.vel.vx/3*.3;s.bankAngle=b;const O=Math.max(30,Math.floor(150/A.fireRate));this.logicFrame%O===0&&Math.random()>.3&&this.enemyShoot(s)}if(s.type===S.ENEMY_BIG){const E=this.getDifficultyMultiplier(),A=.015,v=1+(E.speed-1)*.5;if(s.vel.vx=Math.sin(this.frameCount*A)*v,this.difficulty===mt.VETERAN&&n){const O=n.pos.x-(s.pos.x+s.size.width/2);s.vel.vx+=Math.sign(O)*.15}const b=s.vel.vx/2*.2;s.bankAngle=b}if(s.pathFollow&&this.updatePathFollowingEntity(s),s.type===S.ENEMY_BATTLESHIP&&!s.pathFollow){const E=s.pos.y+s.size.height/2,A=this.getWaterBoundsAtScreenY(E);if(A){const v=A.minX,b=A.maxX-s.size.width,N=Math.sin((this.frameCount+(s.id?parseInt(s.id.substring(0,8),16):0))*.008)*.3;s.vel.vx=N,s.pos.x<v&&(s.pos.x=v,s.vel.vx=Math.abs(s.vel.vx)),s.pos.x>b&&(s.pos.x=b,s.vel.vx=-Math.abs(s.vel.vx))}else s.pos.y>0&&(s.active=!1,console.log(`[TERRAIN] Battleship deactivated - no water zone at Y=${E.toFixed(0)}`))}if((s.type===S.ENEMY_TANK||s.type===S.ENEMY_LARGE_TANK)&&!s.pathFollow){const E=s.pos.y+s.size.height/2,A=this.tilemapScrollY+E,v=this.getRoadBoundsAtWorldY(A);if(v){const b=v.minX,O=v.maxX-s.size.width;s.pos.x<b&&(s.pos.x=b,s.vel.vx=Math.abs(s.vel.vx)),s.pos.x>O&&(s.pos.x=O,s.vel.vx=-Math.abs(s.vel.vx))}}if(s.type===S.PARTICLE){s.vel.vx*=.95,s.vel.vy*=.95,s.hp--,(g=s.id)!=null&&g.startsWith("turret_debris")?(s.rotation!==void 0&&s.scoreValue&&(s.rotation+=s.scoreValue),s.vel.vy+=.1,s.size.width*=.99,s.size.height*=.99):(s.size.width*=.95,s.size.height*=.95),s.hp<=0&&(s.active=!1);return}if(s.type===S.SMOKE){s.pos.y+=fa,s.hp--,s.size.width+=.5,s.size.height+=.5,s.hp<=0&&(s.active=!1);return}if(s.type===S.WAKE){s.pos.y+=fa,s.hp--,s.size.width+=1,s.size.height+=.5,s.hp<=0&&(s.active=!1);return}if(s.type===S.CRASHING_AIRCRAFT){s.crashTimer=(s.crashTimer||38)-1,s.vel.vy+=.05;const A=1-s.crashTimer/38;s.scale=1-A*.5;const v=s.pos.x+s.size.width/2,b=s.pos.y+s.size.height/2;this.logicFrame%2===0&&ve.emitCrashSmoke(v,b,1),this.logicFrame%5===0&&ve.emitFire(v,b,.3),s.crashTimer<=0&&(s.active=!1,s.pos.y<Y+50&&s.pos.x>-100&&s.pos.x<P+100&&(this.triggerFullExplosion(s),me.playEnemyExplosion(),this.screenShake=5));return}if(s.type===S.PLAYER&&this.logicFrame%8===0&&ve.emitEngineExhaust(s.pos.x+s.size.width/2,s.pos.y+s.size.height,0,2),s.type===S.PLAYER){const E=1-this.playerHealth/this.maxPlayerHealth;E>.05&&(this.debugMode&&this.logicFrame%60===0&&console.log(`[DAMAGE SMOKE] Player damage: ${(E*100).toFixed(1)}% | Health: ${this.playerHealth}/${this.maxPlayerHealth}`),ve.emitDamageSmoke(s.pos.x+s.size.width/2,s.pos.y+s.size.height,E))}if(s.type===S.BOSS&&this.logicFrame%6===0&&ve.emitEngineExhaust(s.pos.x+s.size.width/2,s.pos.y+s.size.height,0,3),(s.type===S.ENEMY_BIG||s.type===S.ENEMY_BATTLESHIP)&&s.hp<20&&this.logicFrame%20===0&&this.spawnSmoke(s.pos.x+s.size.width/2,s.pos.y+s.size.height/2),s.type===S.BOSS&&this.activeBoss&&s.hp<this.activeBoss.maxHP/2&&this.logicFrame%10===0){const E=s.pos.x+s.size.width/2,A=s.pos.y+s.size.height/2;ve.emitSmokePlume(E,A,3),ve.emitFire(E,A,2)}if(s.type===S.ENEMY_BATTLESHIP&&this.logicFrame%15===0&&this.spawnWake(s.pos.x+s.size.width/2,s.pos.y-5),s.turrets){s.turrets.forEach(A=>{A.hitFlash&&A.hitFlash>0&&A.hitFlash--});const E=s.pos.y>-s.size.height&&s.pos.y<Y&&s.pos.x>-s.size.width&&s.pos.x<P;if(n&&n.active&&!n.isLooping&&E){const A=this.getDifficultyMultiplier();s.turrets.forEach(v=>{const b=s.pos.x+v.relPos.x,O=s.pos.y+v.relPos.y,L=n.pos.x+n.size.width/2-b,N=n.pos.y+n.size.height/2-O;v.angle=Math.atan2(N,L)+Math.PI/2,v.cooldown>0?v.cooldown--:Math.abs(L)<400&&Math.abs(N)<600&&(this.fireTurret(b,O,Math.atan2(N,L)),v.cooldown=Math.max(30,Math.floor(6e3/(v.fireRate*A.fireRate))))})}}s.type===S.ENEMY_BIG&&this.logicFrame%120===0&&Math.random()>.5&&this.enemyShoot(s);const c=((m=s.pathFollow)==null?void 0:m.hasBeenOnScreen)===!1?!1:s.pos.y<-500;(s.pathFollow&&s.pathFollow.hasBeenOnScreen!==!0?!1:s.pos.y>Y+300||c||s.pos.x<-200||s.pos.x>P+200)&&s.type!==S.PLAYER&&(s.type===S.ENEMY_BATTLESHIP&&console.log(`[DEACTIVATE] Battleship removed: pos.y=${s.pos.y.toFixed(0)}, pos.x=${s.pos.x.toFixed(0)}, hasBeenOnScreen=${(y=s.pathFollow)==null?void 0:y.hasBeenOnScreen}`),s.active=!1)}),this.checkCollisions(),this.entities=this.entities.filter(s=>s.active),this.entities.length>200){console.error(`[FREEZE DEBUG] CRITICAL: Entity count ${this.entities.length}! Emergency cleanup!`);const s=[],r=[],c=[];for(const g of this.entities)g.type===S.PLAYER||g.type===S.BOSS||g.type===S.ENEMY_SMALL||g.type===S.ENEMY_RED||g.type===S.ENEMY_BIG||g.type===S.ENEMY_BATTLESHIP||g.type===S.ENEMY_HELICOPTER||g.type===S.POWERUP?s.push(g):g.type===S.BULLET_PLAYER||g.type===S.BULLET_ENEMY||g.type===S.BULLET_CANNON||g.type===S.BULLET_TURRET?r.push(g):c.push(g);const h=r.length>80?r.slice(-80):r,d=c.length>40?c.slice(-40):c;this.entities=[...s,...h,...d],console.error(`[FREEZE DEBUG] Emergency cleanup complete. Entities: ${this.entities.length} (${s.length} critical, ${h.length} bullets, ${d.length} effects)`)}this.entities.find(s=>s.type===S.PLAYER)||(this.lives>0?(this.lives--,this.spawnPlayer(),this.firepowerBullets=0,this.firepowerStacks=0,this.standardFirepowerCount=0,this.enhancedFirepowerCount=0,this.spreadBullets=0,this.spreadStacks=0,this.bombQueue=[ya.STANDARD,ya.STANDARD,ya.STANDARD]):(this.state=te.GAME_OVER,this.score>this.highScore&&(this.highScore=this.score),me.stopMusic()))}fireTurret(t,n,s){me.playCannon();const c=3.75*this.getDifficultyMultiplier().bulletSpeed;this.entities.push({id:Math.random().toString(),type:S.BULLET_CANNON,pos:{x:t-8,y:n-8},vel:{vx:Math.cos(s)*c,vy:Math.sin(s)*c},size:{width:16,height:16},hp:1,active:!0,frame:0}),Math.random()>.5&&ve.emitMuzzleFlash(t,n,s)}enemyShoot(t){const n=this.entities.find(g=>g.type===S.PLAYER);if(!n)return;const s=this.getDifficultyMultiplier(),r=n.pos.x-t.pos.x,c=n.pos.y-t.pos.y,h=Math.sqrt(r*r+c*c),d=Math.atan2(c,r);this.entities.push({id:Math.random().toString(),type:S.BULLET_ENEMY,pos:{x:t.pos.x+t.size.width/2,y:t.pos.y+t.size.height},vel:{vx:r/h*7.5*s.speed,vy:c/h*7.5*s.speed},size:{width:8,height:8},hp:1,active:!0,frame:0}),Math.random()>.7&&ve.emitMuzzleFlash(t.pos.x+t.size.width/2,t.pos.y+t.size.height,d)}getBarrageTriggerChance(t,n){const r=t%2===1?1.5:.7,c=n?.8:1;return .002*r*c}helicopterBarrageFire(t){const n=t.pos.x+t.size.width/2,s=t.pos.y+t.size.height;this.entities.push({id:`heli-barrage-${this.logicFrame}-${Math.random()}`,type:S.BULLET_ENEMY,pos:{x:n,y:s},vel:{vx:0,vy:8},size:{width:6,height:12},hp:1,active:!0,frame:0}),ve.emitMuzzleFlash(n,s,Math.PI/2)}checkOverlap(t,n){return this.entities.some(s=>!n.includes(s.type)||!s.active?!1:t.x<s.pos.x+s.size.width&&t.x+t.width>s.pos.x&&t.y<s.pos.y+s.size.height&&t.y+t.height>s.pos.y)}isValidNavalSpawnPosition(t,n){if(this.waterZones.length===0)return!0;const s=this.waterZones.some(c=>{if(c.shape==="ellipse"&&c.rx&&c.ry){const h=(t-c.x)/c.rx,d=(n-c.y)/c.ry;return h*h+d*d<=1}if(c.shape==="rect"&&c.width&&c.height){const h=c.width/2,d=c.height/2;return t>=c.x-h&&t<=c.x+h&&n>=c.y-d&&n<=c.y+d}return!1}),r=this.landZones.some(c=>{if(c.shape==="ellipse"&&c.rx&&c.ry){const h=(t-c.x)/c.rx,d=(n-c.y)/c.ry;return h*h+d*d<=1}if(c.shape==="rect"&&c.width&&c.height){const h=c.width/2,d=c.height/2;return t>=c.x-h&&t<=c.x+h&&n>=c.y-d&&n<=c.y+d}return!1});return s&&!r}getWaterSpawnX(){if(this.waterZones.length===0)return-1;const t=this.waterZones[Math.floor(Math.random()*this.waterZones.length)];if(t.shape==="rect"&&t.width){const n=t.x-t.width/2,s=t.x+t.width/2-140;return Math.max(0,Math.min(P-140,n+Math.random()*(s-n)))}if(t.shape==="ellipse"&&t.rx){const n=t.x-t.rx,s=t.x+t.rx-140;return Math.max(0,Math.min(P-140,n+Math.random()*(s-n)))}return Math.random()*(P-140)}getRoadSpawnX(){if(this.roadZones.length===0)return-1;const t=this.roadZones[Math.floor(Math.random()*this.roadZones.length)];if(t.shape==="rect"&&t.width){const s=t.x-t.width/2,r=t.x+t.width/2-80;return Math.max(0,Math.min(P-80,s+Math.random()*(r-s)))}return-1}getRoadBoundsAtWorldY(t){for(const n of this.roadZones){if(n.shape!=="rect"||!n.width||!n.height)continue;const s=n.y-n.height/2,r=n.y+n.height/2,c=Ot.TOTAL_MAP_HEIGHT,h=c-r,d=c-s;if(t>=h&&t<=d){const g=n.width/2;return{minX:n.x-g,maxX:n.x+g}}}return null}parseEntityType(t){return{battleship:S.ENEMY_BATTLESHIP,tank:S.ENEMY_TANK,"large-tank":S.ENEMY_LARGE_TANK,ENEMY_BATTLESHIP:S.ENEMY_BATTLESHIP,ENEMY_TANK:S.ENEMY_TANK,ENEMY_LARGE_TANK:S.ENEMY_LARGE_TANK}[t]||S.ENEMY_TANK}calculatePathLength(t){if(t.length<2)return 0;let n=0;for(let s=1;s<t.length;s++){const r=t[s].x-t[s-1].x,c=t[s].y-t[s-1].y;n+=Math.sqrt(r*r+c*c)}return n}spawnPathBasedEntities(){if(this.logicFrame%60===0&&console.log(`[PATH-SPAWN-DEBUG] logicFrame=${this.logicFrame}, frameCount=${this.frameCount}, state=${this.state}, entityPaths.length=${this.entityPaths.length}`),this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE){this.frameCount<=3&&console.log("[PATH-SPAWN] Early return due to boss state");return}const t=yr(this.campaign,this.level);this.frameCount===1&&(console.log(`[PATH-SPAWN] Frame 1: entityPaths.length=${this.entityPaths.length}, tilemapScrollY=${this.tilemapScrollY}`),this.entityPaths.forEach(n=>console.log(`[PATH-SPAWN] Path ${n.id}: direction=${n.direction}, maxEntities=${n.maxEntities}, spawnPoint=${n.spawnPoint}, entityType=${n.entityType}`)));for(const n of this.entityPaths){if(this.logicFrame<=120&&this.logicFrame%60===0&&console.log(`[PATH-SPAWN] Checking path: id=${n.id}, entityType=${n.entityType}, activeEntities=${n.activeEntities}, maxEntities=${n.maxEntities}`),n.waypoints.length===0)continue;const s=this.pathSpawnTimers.get(n.id)||0;if(this.frameCount<s){this.logicFrame<=120&&console.log(`[PATH-SPAWN] Path ${n.id}: skipping - frameCount=${this.frameCount} < timer=${s}`);continue}if(n.activeEntities>=n.maxEntities){this.logicFrame<=120&&console.log(`[PATH-SPAWN] Path ${n.id}: skipping - activeEntities=${n.activeEntities} >= maxEntities=${n.maxEntities}`);continue}const r=n.waypoints[0].y,h=n.waypoints[n.waypoints.length-1].y<r,d=ba.getDetectedTerrainWidth(this.campaign,this.level),g=ga(this.campaign,this.level),y=((d??g.mapWidthExtended)-P)/2,E=-150,A=-50,v=n.entityType===S.ENEMY_TANK||n.entityType===S.ENEMY_LARGE_TANK;let b;v||n.direction==="down"?b=E+Math.random()*(A-E):n.direction==="up"?b=Y+50+Math.random()*100:b=-200+Math.random()*(Y+400);const O=Ot.TOTAL_MAP_HEIGHT,L=b-Y+O-this.tilemapScrollY;let N=0,x=1/0;for(let ce=0;ce<n.waypoints.length;ce++){const Te=Math.abs(n.waypoints[ce].y-L);Te<x&&(x=Te,N=ce)}const I=300,G=n.id.startsWith("path_");this.logicFrame<=120&&this.logicFrame%60===0&&console.log(`[PATH-SPAWN] Path ${n.id}: isAddedPath=${G}`);let W,Q=null;if(G){let ce;if(n.spawnPoint==="top")ce=0;else if(n.spawnPoint==="bottom")ce=n.waypoints.length-1;else{const at=n.waypoints.map(_e=>_e.y),U=Math.min(...at),se=Math.max(...at);n.direction==="up"?ce=n.waypoints.findIndex(_e=>_e.y===se):ce=n.waypoints.findIndex(_e=>_e.y===U)}const Te=n.waypoints[ce];W=ce/(n.waypoints.length-1),Q=Te,this.frameCount<=5&&console.log(`[PATH-SPAWN] Added path ${n.id}: immediate spawn at waypoint ${ce}, progress=${W}, spawnPoint=${n.spawnPoint}`)}else{if(x>I)continue;W=N/(n.waypoints.length-1)}const j=Q||n.waypoints[N];let q;if(G){const ce=(g.mapWidthExtended-P)/2;q=j.x-ce}else{const ce=this.getPathHorizontalOffset(n.id);q=j.x-y+ce}const Ee=Y-O+this.tilemapScrollY+j.y,ye=150,fe=this.entities.filter(ce=>{var Te;return((Te=ce.pathFollow)==null?void 0:Te.pathId)===n.id&&ce.active});let re=!1;for(const ce of fe){const Te=ce.pos.y+ce.size.height/2;if(Math.abs(Ee-Te)<ye){re=!0;break}}if(!re){const ce={id:0,x:0,y:0,type:n.entityType},Te=this.getEntityPropsForType(n.entityType,ce,t),at=Te.size,U=Te.hp;let se;G&&n.spawnPoint?n.spawnPoint==="top"?se=1:se=-1:n.direction==="up"?se=h?1:-1:n.direction==="down"?se=h?-1:1:W<.1?se=1:W>.9?se=-1:se=Math.random()<.5?1:-1;const _e=n.waypoints.map(xa=>xa.y),Qe=Math.min(..._e),et=Math.max(..._e),C=Math.max(et-Qe,100),le=1/(C/fa),ue=1+n.speedMultiplier;let Le=1;n.entityType===S.ENEMY_BATTLESHIP?Le=bh:n.entityType===S.ENEMY_TANK?Le=xh:n.entityType===S.ENEMY_LARGE_TANK&&(Le=Oh);const K=le*ue*Le,xe=n.entityType===S.ENEMY_TANK||n.entityType===S.ENEMY_LARGE_TANK,de=xe?ue*Le:void 0;console.log(`[PATH] Spawning ${n.entityType}: progress=${(W*100).toFixed(0)}%, pathYSpan=${C.toFixed(0)}, pathSpeed=${K.toFixed(6)}${xe?`, ySpeed=${de==null?void 0:de.toFixed(3)}`:""}`),console.log(`[PATH] Spawn position: screenX=${q.toFixed(0)}, screenY=${Ee.toFixed(0)}, waypointY=${j.y.toFixed(0)}, tilemapScrollY=${this.tilemapScrollY.toFixed(0)}`);const Ue={id:`path_${n.id}_${this.frameCount}`,type:n.entityType,pos:{x:q-at.width/2,y:Ee-at.height/2},vel:{vx:0,vy:0},size:at,hp:U,active:!0,altitude:this.getDefaultAltitude(n.entityType),pathFollow:{pathId:n.id,pathProgress:W,pathSpeed:K,pathDirection:se,lastWaypointIndex:N,anchorSvgY:xe?j.y:void 0,worldY:xe?j.y:void 0,ySpeedMultiplier:de},frame:0,animationSpeed:Te.animationSpeed,maxFrames:Te.maxFrames,turrets:Te.turrets};this.entities.push(Ue),n.activeEntities++,this.pathSpawnTimers.set(n.id,this.frameCount+n.spawnInterval);const ta=n.direction==="down"?"moving down":n.direction==="up"?"moving up":"random";console.log(`[PATH] Spawned ${n.entityType} on path ${n.id} (${ta})`)}}}updatePathFollowingEntity(t){if(!t.pathFollow)return;t.type===S.ENEMY_BATTLESHIP&&this.logicFrame%60===0&&console.log(`[BATTLESHIP-POS] pos.y=${t.pos.y.toFixed(0)}, active=${t.active}, hasBeenOnScreen=${t.pathFollow.hasBeenOnScreen}, progress=${(t.pathFollow.pathProgress*100).toFixed(1)}%`);const n=this.entityPaths.find(q=>q.id===t.pathFollow.pathId);if(!n||n.waypoints.length<2){t.active=!1;return}const s=t.type===S.ENEMY_TANK||t.type===S.ENEMY_LARGE_TANK,r=n.waypoints.length,c=t.pathFollow.pathSpeed;c>0&&(t.pathFollow.pathProgress+=c*t.pathFollow.pathDirection,t.pathFollow.pathProgress>=1?(t.pathFollow.pathProgress=1,n.direction==="random"&&(t.pathFollow.pathDirection=-1)):t.pathFollow.pathProgress<=0&&(t.pathFollow.pathProgress=0,n.direction==="random"&&(t.pathFollow.pathDirection=1)));let h,d;if(s&&t.pathFollow.worldY!==void 0){let q=0,Ee=1/0;for(let re=0;re<r;re++){const ce=Math.abs(n.waypoints[re].y-t.pathFollow.worldY);ce<Ee&&(Ee=ce,q=re)}h=Math.max(0,Math.min(q,r-2));const ye=n.waypoints[h].y,fe=n.waypoints[Math.min(h+1,r-1)].y;Math.abs(fe-ye)>.01?(d=(t.pathFollow.worldY-ye)/(fe-ye),d=Math.max(0,Math.min(1,d))):d=0}else{const q=t.pathFollow.pathProgress*(r-1),Ee=Math.floor(q);d=q-Ee,h=Math.min(Ee,r-2)}const g=n.waypoints[h],m=n.waypoints[Math.min(h+1,r-1)],y=g.x+(m.x-g.x)*d,E=g.y+(m.y-g.y)*d,A=ba.getDetectedTerrainWidth(this.campaign,this.level),v=ga(this.campaign,this.level),O=((A??v.mapWidthExtended)-P)/2,L=n.id.startsWith("path_");let N;if(L){const q=(v.mapWidthExtended-P)/2;N=y-q}else{const q=this.getPathHorizontalOffset(n.id);N=y-O+q}const x=Ot.TOTAL_MAP_HEIGHT;let I;s&&t.pathFollow.worldY!==void 0&&t.pathFollow.ySpeedMultiplier!==void 0?(t.pathFollow.worldY+=fa*t.pathFollow.ySpeedMultiplier,I=Y-x+this.tilemapScrollY+t.pathFollow.worldY):I=Y-x+this.tilemapScrollY+E,t.pos.x=N-t.size.width/2,t.pos.y=I-t.size.height/2,L&&t.type===S.ENEMY_BATTLESHIP&&this.frameCount%30===0&&console.log(`[PATH-MOVE] Battleship on ${n.id}: pos.y=${t.pos.y.toFixed(0)}, progress=${(t.pathFollow.pathProgress*100).toFixed(1)}%, svgY=${E.toFixed(0)}, dir=${t.pathFollow.pathDirection}`);const G=g.tangentX+(m.tangentX-g.tangentX)*d,W=g.tangentY+(m.tangentY-g.tangentY)*d;if(s){const q=t.size.width,Ee=this.entities.filter(ye=>{var fe;return ye.active&&ye.id!==t.id&&(ye.type===S.ENEMY_TANK||ye.type===S.ENEMY_LARGE_TANK)&&((fe=ye.pathFollow)==null?void 0:fe.pathId)===t.pathFollow.pathId});for(const ye of Ee){if(!ye.pathFollow)continue;const fe=ye.pos.x-t.pos.x,re=ye.pos.y-t.pos.y;if(Math.sqrt(fe*fe+re*re)<q){const Te=ye.pathFollow.pathProgress-t.pathFollow.pathProgress;if(Te>0&&t.pathFollow.pathDirection===1||Te<0&&t.pathFollow.pathDirection===-1){t.pathFollow.pathDirection=t.pathFollow.pathDirection===1?-1:1,t.pathFollow.lastReversalFrame=this.frameCount,t.pathFollow.lastReversalProgress=t.pathFollow.pathProgress,console.log(`[TANK] Collision avoidance: ${t.id} reversed direction`);break}}}}const Q=t.pathFollow.pathDirection;if(Math.abs(G)>.01||Math.abs(W)>.01){let q=Math.atan2(W*Q,G*Q)+Math.PI/2;s&&(q=-q+Math.PI),t.rotation=q}if(t.pathFollow.lastWaypointIndex=h,!t.pathFollow.hasBeenOnScreen&&t.pos.y>=0&&t.pos.y<=Y&&(t.pathFollow.hasBeenOnScreen=!0),t.type===S.ENEMY_BATTLESHIP||t.type===S.AIRCRAFT_CARRIER||t.type===S.DESTROYER){const q=t.pathFollow.hasBeenOnScreen&&t.pos.y<-300;(t.pos.y>Y+150||q)&&(t.active=!1,n.activeEntities=Math.max(0,n.activeEntities-1))}else{const q=t.pathFollow.hasBeenOnScreen&&t.pos.y<-300;(t.pos.y>Y+300||q)&&(t.active=!1,n.activeEntities=Math.max(0,n.activeEntities-1))}}decrementPathActiveEntities(t){if(t.pathFollow){const n=this.entityPaths.find(s=>s.id===t.pathFollow.pathId);n&&(n.activeEntities=Math.max(0,n.activeEntities-1))}}getWaterBoundsAtScreenY(t){const n=this.tilemapScrollY+t;return this.getWaterBoundsAtWorldY(n)}getWaterBoundsAtWorldY(t){for(const n of this.waterZones){if(n.shape!=="rect"||!n.width||!n.height)continue;const s=n.y-n.height/2,r=n.y+n.height/2,c=Ot.TOTAL_MAP_HEIGHT,h=c-r,d=c-s;if(t>=h&&t<=d){const g=n.width/2;return{minX:n.x-g,maxX:n.x+g}}}return null}spawnWaves(){this.state===te.BOSS_INTRO||this.state===te.BOSS_BATTLE||(this.currentLevelMap?(this.spawnFromLevelMap(),this.updateAltitudeZones()):this.spawnProceduralWaves())}spawnFromLevelMap(){if(!this.currentLevelMap)return;const t=this.getDifficultyMultiplier(),n=fa;for(let s=0;s<this.currentLevelMap.spawns.length;s++){const r=this.currentLevelMap.spawns[s];this.spawnedEntityIds.has(s)||this.levelProgress>=r.frameOffset&&(this.spawnedEntityIds.add(s),this.spawnEntityFromMap(r,t,n,s))}}spawnEntityFromMap(t,n,s,r){const c=t.x*(P-100)+50,h=t.yOffset||0,d=this.getEntityTypeFromString(t.type);if(d===null){console.warn(`[LEVEL MAP] Unknown entity type: ${t.type}`);return}const g=this.getEntityPropsForType(d,t,n),m=this.getVelocityForPattern(t.movementPattern,n,d),y={id:`map_${this.level}_${r}_${Math.random().toString(36).substr(2,9)}`,type:d,pos:{x:c,y:-g.size.height+h},vel:m,size:g.size,hp:g.hp,active:!0,frame:0,scoreValue:g.score,hitFlash:0,spriteVariant:t.variant||0,altitude:t.altitude,turrets:g.turrets,animationSpeed:g.animationSpeed,maxFrames:g.maxFrames};if(this.entities.push(y),t.formation)for(let E=1;E<t.formation.count;E++)setTimeout(()=>{const A={...y,id:`map_${this.level}_${r}_f${E}_${Math.random().toString(36).substr(2,9)}`,pos:{x:c+E*t.formation.spacing,y:-g.size.height+h-E*30}};this.entities.push(A)},E*(t.formation.delay||10)*16)}getEntityTypeFromString(t){return{ENEMY_SMALL:S.ENEMY_SMALL,ENEMY_RED:S.ENEMY_RED,ENEMY_BIG:S.ENEMY_BIG,ENEMY_HELICOPTER:S.ENEMY_HELICOPTER,ENEMY_BATTLESHIP:S.ENEMY_BATTLESHIP,VILLAGE:S.VILLAGE,FORTRESS:S.FORTRESS,AA_EMPLACEMENT:S.AA_EMPLACEMENT,RADAR_STATION:S.RADAR_STATION,FUEL_DEPOT:S.FUEL_DEPOT,AIRFIELD:S.AIRFIELD,SUPPLY_CONVOY:S.SUPPLY_CONVOY,ENEMY_TANK:S.ENEMY_TANK,ENEMY_LARGE_TANK:S.ENEMY_LARGE_TANK,AIRCRAFT_CARRIER:S.AIRCRAFT_CARRIER,DESTROYER:S.DESTROYER,SUPPLY_SHIP:S.SUPPLY_SHIP,SUBMARINE:S.SUBMARINE,PT_BOAT:S.PT_BOAT}[t]||null}getEntityPropsForType(t,n,s){const r=s.enemyHP;switch(t){case S.ENEMY_SMALL:case S.ENEMY_RED:let c=3;return this.campaign===pe.STEEL_VANGUARD?c=4:this.campaign===pe.HELLFIRE_HORIZON&&(c=6),{size:{width:66,height:66},hp:c,score:t===S.ENEMY_RED?150:100};case S.ENEMY_BIG:return{size:{width:177,height:138},hp:Math.floor(35*r),score:2e3,turrets:this.createBomberTurrets()};case S.ENEMY_HELICOPTER:return{size:{width:89,height:89},hp:Math.floor(27*r),score:500,animationSpeed:.2,maxFrames:2};case S.ENEMY_BATTLESHIP:return{size:{width:140,height:300},hp:Math.floor(170*r),score:5e3,turrets:this.createBattleshipTurrets({width:140,height:300})};case S.AIRCRAFT_CARRIER:return{size:{width:ua.AIRCRAFT_CARRIER.width,height:ua.AIRCRAFT_CARRIER.height},hp:Math.floor(ua.AIRCRAFT_CARRIER.hp*r),score:ua.AIRCRAFT_CARRIER.score,turrets:this.createCarrierTurrets()};case S.DESTROYER:return{size:{width:ua.DESTROYER.width,height:ua.DESTROYER.height},hp:Math.floor(ua.DESTROYER.hp*r),score:ua.DESTROYER.score,turrets:this.createDestroyerTurrets()};case S.SUPPLY_SHIP:return{size:{width:ua.SUPPLY_SHIP.width,height:ua.SUPPLY_SHIP.height},hp:Math.floor(ua.SUPPLY_SHIP.hp*r),score:ua.SUPPLY_SHIP.score};case S.SUBMARINE:return{size:{width:ua.SUBMARINE.width,height:ua.SUBMARINE.height},hp:Math.floor(ua.SUBMARINE.hp*r),score:ua.SUBMARINE.score};case S.PT_BOAT:return{size:{width:ua.PT_BOAT.width,height:ua.PT_BOAT.height},hp:Math.floor(ua.PT_BOAT.hp*r),score:ua.PT_BOAT.score};case S.VILLAGE:return{size:{width:Rt.VILLAGE.width,height:Rt.VILLAGE.height},hp:Math.floor(Rt.VILLAGE.hp*r),score:Rt.VILLAGE.score};case S.FORTRESS:return{size:{width:Rt.FORTRESS.width,height:Rt.FORTRESS.height},hp:Math.floor(Rt.FORTRESS.hp*r),score:Rt.FORTRESS.score,turrets:this.createFortressTurrets()};case S.AA_EMPLACEMENT:return{size:{width:Rt.AA_EMPLACEMENT.width,height:Rt.AA_EMPLACEMENT.height},hp:Math.floor(Rt.AA_EMPLACEMENT.hp*r),score:Rt.AA_EMPLACEMENT.score,turrets:[{id:Math.random().toString(),relPos:{x:32,y:32},angle:0,cooldown:Rt.AA_EMPLACEMENT.turretFireRate,fireRate:Rt.AA_EMPLACEMENT.turretFireRate,hp:3,hitFlash:0}]};case S.RADAR_STATION:return{size:{width:Rt.RADAR_STATION.width,height:Rt.RADAR_STATION.height},hp:Math.floor(Rt.RADAR_STATION.hp*r),score:Rt.RADAR_STATION.score};case S.FUEL_DEPOT:return{size:{width:Rt.FUEL_DEPOT.width,height:Rt.FUEL_DEPOT.height},hp:Math.floor(Rt.FUEL_DEPOT.hp*r),score:Rt.FUEL_DEPOT.score};case S.AIRFIELD:return{size:{width:Rt.AIRFIELD.width,height:Rt.AIRFIELD.height},hp:Math.floor(Rt.AIRFIELD.hp*r),score:Rt.AIRFIELD.score,turrets:this.createAirfieldTurrets()};case S.SUPPLY_CONVOY:return{size:{width:Rt.SUPPLY_CONVOY.width,height:Rt.SUPPLY_CONVOY.height},hp:Math.floor(Rt.SUPPLY_CONVOY.hp*r),score:Rt.SUPPLY_CONVOY.score};case S.ENEMY_TANK:return{size:{width:80,height:60},hp:Math.floor(50*r),score:1500,turrets:this.createTankTurrets({width:80,height:60})};case S.ENEMY_LARGE_TANK:return{size:{width:120,height:80},hp:Math.floor(95*r),score:3500,turrets:this.createLargeTankTurrets({width:120,height:80})};default:return{size:{width:64,height:64},hp:10,score:100}}}getVelocityForPattern(t,n,s){let r;s===S.ENEMY_BATTLESHIP||s===S.AIRCRAFT_CARRIER||s===S.DESTROYER?r=bh:s===S.ENEMY_TANK?r=xh:s===S.ENEMY_LARGE_TANK?r=Oh:s===S.ENEMY_BIG?r=fa:s===S.ENEMY_RED?r=fa+.5:s===S.ENEMY_SMALL?r=fa+1.5:r=Math.max(fa,Fo);let c;switch(t){case"straight":c={vx:0,vy:r*n.speed};break;case"sine":c={vx:1.5*n.speed,vy:r*n.speed};break;case"tracking":c={vx:0,vy:r*.8*n.speed};break;case"stationary":c={vx:0,vy:fa};break;default:c={vx:0,vy:r*n.speed}}return c}createBattleshipTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"t1",relPos:{x:t.width/2,y:t.height*.3},angle:0,cooldown:300,fireRate:30,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0},{id:"t2",relPos:{x:t.width/2,y:t.height*.7},angle:Math.PI,cooldown:350,fireRate:30,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0}]}createCarrierTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(5*t);return[{id:"c1",relPos:{x:40,y:80},angle:-Math.PI/2,cooldown:40,fireRate:75,hp:n,hitFlash:0},{id:"c2",relPos:{x:140,y:80},angle:Math.PI/2,cooldown:50,fireRate:75,hp:n,hitFlash:0},{id:"c3",relPos:{x:40,y:320},angle:-Math.PI/2,cooldown:60,fireRate:75,hp:n,hitFlash:0},{id:"c4",relPos:{x:140,y:320},angle:Math.PI/2,cooldown:70,fireRate:75,hp:n,hitFlash:0}]}createDestroyerTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(4*t);return[{id:"d1",relPos:{x:50,y:50},angle:0,cooldown:50,fireRate:60,hp:n,hitFlash:0},{id:"d2",relPos:{x:50,y:125},angle:0,cooldown:60,fireRate:60,hp:n,hitFlash:0},{id:"d3",relPos:{x:50,y:200},angle:Math.PI,cooldown:70,fireRate:60,hp:n,hitFlash:0}]}createFortressTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(6*t);return[{id:"f1",relPos:{x:40,y:40},angle:-Math.PI/4,cooldown:75,fireRate:40,hp:n,hitFlash:0},{id:"f2",relPos:{x:160,y:40},angle:Math.PI/4,cooldown:85,fireRate:40,hp:n,hitFlash:0},{id:"f3",relPos:{x:40,y:160},angle:-3*Math.PI/4,cooldown:95,fireRate:40,hp:n,hitFlash:0},{id:"f4",relPos:{x:160,y:160},angle:3*Math.PI/4,cooldown:105,fireRate:40,hp:n,hitFlash:0}]}createAirfieldTurrets(){const t=this.getCampaignTurretHPMult(),n=Math.floor(4*t);return[{id:"a1",relPos:{x:50,y:75},angle:0,cooldown:60,fireRate:50,hp:n,hitFlash:0},{id:"a2",relPos:{x:250,y:75},angle:0,cooldown:80,fireRate:50,hp:n,hitFlash:0}]}createTankTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"tank_main",relPos:{x:t.width/2,y:t.height*.4},angle:0,cooldown:60,fireRate:50,hp:Math.floor((2+Math.floor(this.level/2))*n),hitFlash:0}]}createLargeTankTurrets(t){const n=this.getCampaignTurretHPMult();return[{id:"ltank_main",relPos:{x:t.width/2,y:t.height*.35},angle:0,cooldown:75,fireRate:40,hp:Math.floor((3+Math.floor(this.level/2))*n),hitFlash:0},{id:"ltank_mg",relPos:{x:t.width/2,y:t.height*.65},angle:Math.PI,cooldown:40,fireRate:75,hp:Math.floor((2+Math.floor(this.level/3))*n),hitFlash:0}]}createBomberTurrets(){const t=this.getCampaignTurretHPMult();return[{id:"bomber_rear",relPos:{x:88,y:115},angle:Math.PI,cooldown:75+Math.floor(Math.random()*30),fireRate:40,hp:Math.floor(5*t),hitFlash:0}]}updateAltitudeZones(){if(!this.currentLevelMap)return;let t=null;for(const n of this.currentLevelMap.altitudeZones)if(this.levelProgress>=n.startFrame&&this.levelProgress<=n.endFrame){t=n;break}t&&!this.currentAltitudeZone?(this.currentAltitudeZone=t,this.altitudeZoneNotified=!1,console.log(`[ALTITUDE ZONE] Entering: ${t.description} (suggested altitude: ${t.suggestedAltitude})`),this.playerAltitude===Zt.HIGH_ALTITUDE&&!this.isTransitioningAltitude&&(console.log(`[ALTITUDE ZONE] Auto-diving to altitude ${t.suggestedAltitude}`),this.startDiveBomb(t.suggestedAltitude))):!t&&this.currentAltitudeZone&&(console.log("[ALTITUDE ZONE] Exiting zone, climbing back to high altitude"),this.playerAltitude!==Zt.HIGH_ALTITUDE&&!this.isTransitioningAltitude&&this.climbUp(),this.currentAltitudeZone=null,this.altitudeZoneNotified=!1)}spawnProceduralWaves(){const t=this.getDifficultyMultiplier();this.logicFrame%Math.floor(400/t.spawn)===0&&this.entities.push({id:Math.random().toString(),type:S.ENEMY_HELICOPTER,pos:{x:Math.random()*(P-83),y:-90},vel:{vx:0,vy:2},size:{width:89,height:89},hp:Math.floor(27*t.enemyHP),active:!0,frame:0,scoreValue:500,hitFlash:0,animationSpeed:.2,maxFrames:2}),this.logicFrame%170===0&&this.spawnEnemyFormation(),this.logicFrame%Math.floor(600/t.spawn)===0&&this.entities.push({id:Math.random().toString(),type:S.ENEMY_BIG,pos:{x:P/2-82,y:-145},vel:{vx:0,vy:fa*t.speed},size:{width:177,height:138},hp:Math.floor(35*t.enemyHP),active:!0,frame:0,scoreValue:2e3,hitFlash:0,spriteVariant:Math.floor(Math.random()*3),turrets:this.createBomberTurrets()});const n=this.entityPaths.some(c=>c.entityType===S.ENEMY_BATTLESHIP);if(this.waterZones.length>0&&n&&this.logicFrame===501&&console.log("[SPAWN] Zone-based battleship spawning DISABLED - entity paths exist for battleships"),this.waterZones.length>0&&!n&&this.logicFrame>500&&this.logicFrame%Math.floor(1200/t.spawn)===0){const c={width:140,height:300};let h=10;for(;h>0;){const d=this.getWaterSpawnX(),g={x:d,y:-350},m=!this.checkOverlap({...g,...c},[S.ENEMY_BATTLESHIP]),y=this.getWaterBoundsAtWorldY(this.tilemapScrollY+g.y),E=y&&d>=y.minX&&d+c.width<=y.maxX;if(m&&E){const A=this.createBattleshipTurrets(c);this.entities.push({id:Math.random().toString(),type:S.ENEMY_BATTLESHIP,pos:g,vel:{vx:0,vy:bh*t.speed},size:c,hp:Math.floor(170*t.enemyHP),active:!0,frame:0,scoreValue:5e3,turrets:A,hitFlash:0,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Battleship spawned in water zone at X=${g.x.toFixed(0)}`);break}h--}h===0&&console.log("[TERRAIN] Battleship spawn skipped - overlapping with existing battleship")}const s=this.entityPaths.some(c=>c.entityType===S.ENEMY_TANK);if(this.roadZones.length>0&&!s&&this.logicFrame>500&&this.logicFrame%Math.floor(800/t.spawn)===0){const c=this.getRoadSpawnX();if(c>=0){const h={width:80,height:60},d={x:c,y:-80},g=!this.checkOverlap({...d,...h},[S.ENEMY_TANK,S.ENEMY_LARGE_TANK]),m=this.getRoadBoundsAtWorldY(this.tilemapScrollY+d.y),y=m&&c>=m.minX&&c+h.width<=m.maxX;if(g&&y){const E=this.createTankTurrets(h);this.entities.push({id:Math.random().toString(),type:S.ENEMY_TANK,pos:d,vel:{vx:0,vy:xh*t.speed},size:h,hp:Math.floor(50*t.enemyHP),active:!0,frame:0,scoreValue:1500,turrets:E,hitFlash:0,altitude:Zt.LOW_ALTITUDE,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Tank spawned in road zone at X=${d.x.toFixed(0)}`)}}}const r=this.entityPaths.some(c=>c.entityType===S.ENEMY_LARGE_TANK);if(this.roadZones.length>0&&!r&&this.logicFrame>1e3&&this.logicFrame%Math.floor(1500/t.spawn)===0){const c=this.getRoadSpawnX();if(c>=0){const h={width:120,height:80},d={x:c,y:-100},g=!this.checkOverlap({...d,...h},[S.ENEMY_TANK,S.ENEMY_LARGE_TANK]),m=this.getRoadBoundsAtWorldY(this.tilemapScrollY+d.y),y=m&&c>=m.minX&&c+h.width<=m.maxX;if(g&&y){const E=this.createLargeTankTurrets(h);this.entities.push({id:Math.random().toString(),type:S.ENEMY_LARGE_TANK,pos:d,vel:{vx:0,vy:Oh*t.speed},size:h,hp:Math.floor(95*t.enemyHP),active:!0,frame:0,scoreValue:3500,turrets:E,hitFlash:0,altitude:Zt.LOW_ALTITUDE,spriteVariant:Math.floor(Math.random()*3)}),console.log(`[TERRAIN] Large Tank spawned in road zone at X=${d.x.toFixed(0)}`)}}}}checkCollisions(){const t=this.entities.find(h=>h.type===S.PLAYER),n=[],s=[],r=[],c=[];this.entities.length>250&&console.warn(`[FREEZE DEBUG] checkCollisions() with ${this.entities.length} entities`);for(const h of this.entities)if(h.active)switch(h.type){case S.BULLET_PLAYER:n.push(h);break;case S.ENEMY_SMALL:case S.ENEMY_RED:case S.ENEMY_BIG:case S.ENEMY_HELICOPTER:case S.BOSS:s.push(h),r.push(h);break;case S.ENEMY_BATTLESHIP:case S.ENEMY_TANK:case S.ENEMY_LARGE_TANK:s.push(h);break;case S.BULLET_ENEMY:case S.BULLET_CANNON:case S.BULLET_TURRET:r.push(h);break;case S.POWERUP:c.push(h);break}(n.length>100||r.length>100)&&console.warn(`[FREEZE DEBUG] Collision workload: ${n.length} player bullets  ${s.length} enemies + ${r.length} threats`);for(const h of n){if(!h.active)continue;if(h.active){const g=(t==null?void 0:t.pos.x)??P/2,m=gt.checkBulletCollision(h.pos.x+h.size.width/2,h.pos.y+h.size.height/2,Math.max(h.size.width,h.size.height)/2,this.tilemapScrollY,g);if(m){h.active=!1;const y=gt.getTurret(m),E=gt.getTurretScreenPosition(m,this.tilemapScrollY,g),A=gt.damageTurret(m,1);if(y&&E&&(this.spawnDebris(E.x,E.y,lt.GREY,3),ve.emitSparks(E.x,E.y,8),A)){const v=y.metadata.scoreValue||200;this.score+=v,me.playEnemyExplosion(),this.spawnExplosion({x:E.x-20,y:E.y-20},{width:40,height:40}),ve.emitExplosionDebris(E.x,E.y,10),this.spawnFloatingScore(E.x,E.y,v,"turret"),this.spawnTurretDebris(E.x,E.y),console.log(`[TERRAIN] Turret ${m} destroyed!`)}}}if(h.active&&this.activeBoss&&this.activeBoss.turrets&&this.activeBoss.turrets.length>0){for(const g of this.activeBoss.turrets){if(g.hp<=0)continue;const m=this.activeBoss.pos.x+g.relPos.x-20,y=this.activeBoss.pos.y+g.relPos.y-20;if(h.pos.x<m+40&&h.pos.x+h.size.width>m&&h.pos.y<y+40&&h.pos.y+h.size.height>y){h.active=!1,g.hp--,this.spawnDebris(m+20,y+20,lt.GREY,3),ve.emitSparks(m+20,y+20,10),g.hp<=0&&(this.score+=200,me.playEnemyExplosion(),this.spawnExplosion({x:m,y},{width:40,height:40}),this.activeBoss.hp-=3,ve.emitExplosionDebris(m+20,y+20,15),ve.emitFire(m+20,y+20,2),this.spawnFloatingScore(m+20,y+20,200,"turret"),this.spawnTurretDebris(m+20,y+20),console.log(`[BOSS] Turret destroyed! Boss HP: ${this.activeBoss.hp}, Turrets remaining: ${this.activeBoss.turrets.filter(b=>b.hp>0).length}`));break}}this.activeBoss.turrets=this.activeBoss.turrets.filter(g=>g.hp>0)}if(!h.active)continue;const d=this.getDynamicTerrainParallaxOffset((t==null?void 0:t.pos.x)??P/2);for(const g of s)if(g.active&&this.isCollidingWithParallax(h,g,d)){h.active=!1;const m=h.hp||1;g.hp-=m,g.type!==S.BOSS&&(g.hitFlash=2),g.type===S.BOSS&&console.log(`[FREEZE DEBUG] Boss hit! HP: ${g.hp}, Frame: ${this.logicFrame}`),this.spawnDebris(h.pos.x,h.pos.y,lt.YELLOW,1);const y=g.type===S.BOSS?8:5;ve.emitSparks(h.pos.x+2,h.pos.y+2,y);const E=g.pos.x+g.size.width/2+(Math.random()-.5)*g.size.width*.6,A=g.pos.y+g.size.height/2+(Math.random()-.5)*g.size.height*.6;if(ve.emitSparks(E,A,g.type===S.BOSS?6:3),g.hp<=0)this.destroyEnemy(g);else{const v=this.getEnemyMaxHP(g.type),b=1-g.hp/v;if(b>.3&&Math.random()<.3){const O=g.pos.x+g.size.width/2,L=g.pos.y+g.size.height/2;ve.emitEnemyDamageSmoke(O,L,1+b)}}break}h.active&&h.pos.y<-20&&(h.active=!1)}if(t&&!t.isEvading&&t.active&&this.playerInvincible<=0){const h=this.getDynamicTerrainParallaxOffset(t.pos.x);for(const d of r){if(!d.active||d.hp<=0)continue;if(d.type===S.BULLET_ENEMY||d.type===S.BULLET_CANNON||d.type===S.BULLET_TURRET?this.isColliding(t,d):this.isCollidingWithParallax(t,d,h)){let y=0;d.type===S.BULLET_ENEMY?y=20:d.type===S.BULLET_CANNON?y=50:d.type===S.BULLET_TURRET?y=Gn.DAMAGE:d.type===S.ENEMY_SMALL||d.type===S.ENEMY_RED||d.type===S.ENEMY_HELICOPTER?y=40:d.type===S.ENEMY_BIG?y=60:d.type===S.BOSS&&(y=100),this.destroyPlayer(t,y),(d.type===S.BULLET_ENEMY||d.type===S.BULLET_CANNON||d.type===S.BULLET_TURRET)&&(d.active=!1);break}}}if(t&&t.active){const h=this.getDynamicTerrainParallaxOffset(t.pos.x);for(const d of c)if(this.isCollidingWithParallax(t,d,h)){d.active=!1,this.score+=500,me.playPowerUp();const g=d.pos.x+d.size.width/2,m=d.pos.y+d.size.height/2;if(this.freezeFrame(3),this.setCameraZoom(1.15,15),setTimeout(()=>{this.setCameraZoom(1,15)},250),d.powerupType===ma.FIREPOWER)ve.emitFire(g,m,10),ve.emitShrapnel(g,m,8);else if(d.powerupType===ma.BOMB)ve.emitMuzzleFlash(g,m,0),ve.emitExplosionDebris(g,m,12);else if(d.powerupType===ma.INVINCIBILITY){for(let y=0;y<16;y++){const E=Math.PI*2/16*y;ve.emitBulletTracer(g,m,Math.cos(E)*3,Math.sin(E)*3)}ve.emitSparks(g,m,15)}if(d.powerupType===ma.FIREPOWER){const y=d.firepowerTier||za.STANDARD;this.firepowerBullets===0?(this.firepowerBullets=pi.BULLETS_PER_POWERUP,this.firepowerStacks=1,this.activeFirepowerTier=y):y===this.activeFirepowerTier?(this.firepowerBullets+=pi.BULLETS_PER_POWERUP,this.firepowerStacks=Math.min(this.firepowerStacks+1,pi.MAX_STACKS)):y===za.ENHANCED?this.enhancedFirepowerCount=Math.min(this.enhancedFirepowerCount+1,9):this.standardFirepowerCount=Math.min(this.standardFirepowerCount+1,9)}else if(d.powerupType===ma.BOMB){if(this.bombQueue.length<At.MAX_BOMBS){const y=d.bombTier||this.getBombTierForLevel();this.bombQueue.push(y)}}else d.powerupType===ma.INVINCIBILITY?this.playerInvincible=210:d.powerupType===ma.SPREAD&&(this.spreadBullets===0?(this.spreadBullets=pi.BULLETS_PER_POWERUP,this.spreadStacks=1):(this.spreadBullets+=pi.BULLETS_PER_POWERUP,this.spreadStacks=Math.min(this.spreadStacks+1,pi.MAX_STACKS)))}}}getHitbox(t){let n=.7,s=.7;t.type===S.BOSS?(n=.8,s=.8):t.type===S.ENEMY_BATTLESHIP?(n=.4,s=.9):t.type===S.ENEMY_BIG?(n=.8,s=.6):t.type===S.PLAYER&&(n=.4,s=.7),(t.type===S.BULLET_PLAYER||t.type===S.BULLET_ENEMY||t.type===S.BULLET_CANNON||t.type===S.BULLET_TURRET)&&(n=1,s=1);const r=t.size.width*n,c=t.size.height*s,h=t.pos.x+(t.size.width-r)/2,d=t.pos.y+(t.size.height-c)/2;return{x:h,y:d,width:r,height:c}}isColliding(t,n){const s=this.getHitbox(t),r=this.getHitbox(n);return s.x<r.x+r.width&&s.x+s.width>r.x&&s.y<r.y+r.height&&s.y+s.height>r.y}isCollidingWithParallax(t,n,s){const r=this.getHitbox(t),c=this.getHitbox(n),h=c.x-s;return r.x<h+c.width&&r.x+r.width>h&&r.y<c.y+c.height&&r.y+r.height>c.y}spawnDebris(t,n,s,r){const c=this.entities.filter(h=>h.type===S.PARTICLE).length;if(c>150&&(r=Math.floor(r/2)),!(c>300))for(let h=0;h<r;h++)this.entities.push({id:Math.random().toString(),type:S.PARTICLE,pos:{x:t,y:n},vel:{vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10},size:{width:6,height:6},hp:30+Math.random()*20,active:!0,frame:0,color:s})}spawnTurretDebris(t,n){this.entities.push({id:`turret_debris_base_${Math.random()}`,type:S.PARTICLE,pos:{x:t-5,y:n},vel:{vx:-4-Math.random()*3,vy:3+Math.random()*3},size:{width:18,height:14},hp:70,active:!0,frame:0,color:"#8b7355",rotation:0,scoreValue:.18+Math.random()*.12}),this.entities.push({id:`turret_debris_cannon_${Math.random()}`,type:S.PARTICLE,pos:{x:t+5,y:n-5},vel:{vx:4+Math.random()*3,vy:-4-Math.random()*3},size:{width:22,height:8},hp:70,active:!0,frame:0,color:"#5c5c5c",rotation:Math.PI/4,scoreValue:-.22-Math.random()*.12});for(let s=0;s<6;s++){const r=Math.PI*2*s/6+Math.random()*.5,c=5+Math.random()*4;this.entities.push({id:`turret_debris_shrapnel_${Math.random()}`,type:S.PARTICLE,pos:{x:t,y:n},vel:{vx:Math.cos(r)*c,vy:Math.sin(r)*c},size:{width:6,height:6},hp:50+Math.random()*25,active:!0,frame:0,color:"#a0a0a0"})}}spawnSmoke(t,n){this.entities.push({id:Math.random().toString(),type:S.SMOKE,pos:{x:t,y:n},vel:{vx:(Math.random()-.5)*1,vy:0},size:{width:10,height:10},hp:60,active:!0,frame:0})}spawnWake(t,n){this.entities.push({id:Math.random().toString(),type:S.WAKE,pos:{x:t,y:n},vel:{vx:0,vy:0},size:{width:20,height:5},hp:120,active:!0,frame:0})}destroyEnemy(t){this.decrementPathActiveEntities(t),t.type===S.ENEMY_HELICOPTER&&this.bossEngine.isBossHelicopterMinion(t.id)&&this.bossEngine.onHelicopterMinionDestroyed(t.id,this.logicFrame);const n=t.type===S.ENEMY_SMALL||t.type===S.ENEMY_RED||t.type===S.ENEMY_BIG||t.type===S.ENEMY_HELICOPTER||t.type===S.BOSS;this.combo++,this.comboTimer=this.COMBO_TIMEOUT;const s=Math.min(this.combo,8);this.addHeat();const r=(t.scoreValue||100)*s,c=this.getHeatMultiplier(),h=this.awardScoreWithHeat(r),d=t.pos.x+t.size.width/2,g=t.pos.y,m=t.type===S.ENEMY_BIG?"bomber":"fighter";if(this.spawnFloatingScore(d,g,h,m,c>1?c:void 0),this.checkComboMilestones(),this.screenShake=5,me.playEnemyExplosion(),t.type===S.ENEMY_RED){const y=Math.random()*100,E=10;let A;y<E?A=ma.INVINCIBILITY:y<50+E/2?A=ma.FIREPOWER:A=ma.BOMB;const v=A===ma.BOMB?this.getBombTierForLevel():void 0,b=A===ma.FIREPOWER?this.getFirepowerTierForLevel():void 0;this.entities.push({id:Math.random().toString(),type:S.POWERUP,pos:{...t.pos},vel:{vx:0,vy:fa+.5},size:{width:32,height:32},hp:1,active:!0,frame:0,powerupType:A,bombTier:v,firepowerTier:b})}if(n){const E=Math.random()>.5?1:-1;this.entities.push({id:Math.random().toString(),type:S.CRASHING_AIRCRAFT,pos:{...t.pos},vel:{vx:E*(.8+Math.random()*.4),vy:2.5+Math.random()*1},size:{...t.size},hp:0,active:!0,frame:t.frame,rotation:t.rotation||0,crashTimer:38,crashRotationSpeed:0,originalType:t.type,bossType:t.bossType,crashDiveAngle:E,colorPalette:t.colorPalette,spriteVariant:t.spriteVariant,maxFrames:t.maxFrames,animationSpeed:t.animationSpeed,scale:1}),t.active=!1,me.playSmallExplosion(),me.playDescending();const A=t.pos.x+t.size.width/2,v=t.pos.y+t.size.height/2;ve.emitSmokePlume(A,v,1),ve.emitSparks(A,v,8),ve.emitFire(A,v,.5)}else t.active=!1,this.triggerFullExplosion(t)}triggerFullExplosion(t){const n=t.pos.x+t.size.width/2,s=t.pos.y+t.size.height/2,r=t.originalType||t.type;this.spawnExplosion(t.pos,t.size),this.spawnDebris(n,s,lt.ORANGE,5),this.spawnDebris(n,s,lt.RED,4),this.spawnDebris(n,s,lt.GREY,3),ve.emitExplosionDebris(n,s,15),(r===S.ENEMY_BIG||r===S.ENEMY_BATTLESHIP||r===S.BOSS)&&ve.emitFire(n,s,5),ve.emitShrapnel(n,s,12);const c=t.colorPalette||this.getDefaultColorPalette(r),h=r===S.ENEMY_BIG||r===S.ENEMY_BATTLESHIP||r===S.BOSS?18:10;ve.emitSpriteDebris(n,s,c,h)}triggerBossCrashExplosion(){if(!this.crashingBoss)return;const t=this.crashingBoss.pos.x+this.crashingBoss.size.width/2,n=this.crashingBoss.pos.y+this.crashingBoss.size.height/2;console.log("[BOSS] Crash explosion triggered at",t,n);for(let r=0;r<6;r++){const c=(Math.random()-.5)*this.crashingBoss.size.width,h=(Math.random()-.5)*this.crashingBoss.size.height*.5;this.spawnExplosion({x:t+c-40,y:n+h-40},{width:80,height:80}),ve.emitExplosionDebris(t+c,n+h,20),ve.emitFire(t+c,n+h,6)}for(let r=0;r<5;r++){const c=(Math.random()-.5)*this.crashingBoss.size.width;ve.emitSmokePlume(t+c,n,5)}ve.emitShrapnel(t,n,40);const s=this.crashingBoss.colorPalette||this.getDefaultColorPalette(S.BOSS);ve.emitSpriteDebris(t,n,s,25),this.spawnDebris(t,n,lt.ORANGE,8),this.spawnDebris(t,n,lt.RED,6),this.spawnDebris(t,n,lt.GREY,5),this.screenShake=45,this.postProcessing.triggerWhiteFlash(.7,12),me.playEnemyExplosion(),this.crashingBoss=null,this.bossCrashTimer=0,setTimeout(async()=>{try{console.log("[FREEZE DEBUG] Boss crash cleanup"),this.setTimeScale(1,0),this.resetCamera(),this.playerInvincible=180;const r=this.level>=this.MAX_LEVEL;this.startIntermission(r)}catch(r){console.error("[FREEZE DEBUG] Error in boss crash cleanup:",r),this.bossDefeating=!1,this.setTimeScale(1,0),this.state=te.PLAYING}},1e3)}finishBossDefeat(){setTimeout(async()=>{try{console.log("[FREEZE DEBUG] Boss defeat cleanup (off-screen)"),this.setTimeScale(1,0),this.resetCamera(),this.playerInvincible=180;const t=this.level>=this.MAX_LEVEL;this.startIntermission(t)}catch(t){console.error("[FREEZE DEBUG] Error in boss defeat cleanup:",t),this.bossDefeating=!1,this.setTimeScale(1,0),this.state=te.PLAYING}},500)}getDefaultColorPalette(t){switch(t){case S.ENEMY_SMALL:case S.ENEMY_RED:return{primary:"#4a6b4a",secondary:"#6b6b6b",accent:"#8b7355"};case S.ENEMY_HELICOPTER:return{primary:"#556b2f",secondary:"#708090",accent:"#2f4f4f"};case S.ENEMY_BIG:return{primary:"#484848",secondary:"#3c5a3c",accent:"#5a5a5a"};case S.ENEMY_BATTLESHIP:return{primary:"#708090",secondary:"#4a4a4a",accent:"#5f6f7f"};case S.ENEMY_TANK:case S.ENEMY_LARGE_TANK:return{primary:"#6b5a3a",secondary:"#4a5a4a",accent:"#3a3a3a"};default:return{primary:"#888888",secondary:"#666666",accent:"#444444"}}}destroyPlayer(t,n=100){if(this.playerHealth-=n,this.playerHealth<=0){this.playerHealth=0,t.active=!1;const s=t.pos.x+t.size.width/2,r=t.pos.y+t.size.height/2;this.setTimeScale(.5,0),setTimeout(()=>this.setTimeScale(1,0),800),this.setCameraZoom(.7,40),this.camera.targetRotation=-.1,this.screenShake=25,this.postProcessing.triggerWhiteFlash(.7,12),this.postProcessing.triggerDamageVignette(.8,40),me.playPlayerExplosion(),this.spawnExplosion(t.pos,t.size),ve.emitExplosionDebris(s,r,25),ve.emitFire(s,r,12),ve.emitShrapnel(s,r,20),ve.emitSmokePlume(s,r,8),this.spawnDebris(s,r,lt.WHITE,15),this.spawnDebris(s,r,lt.RED,12),this.spawnDebris(s,r,lt.ORANGE,10),this.resetCamera()}else this.screenShake=Math.min(8,Math.floor(n/10)),this.postProcessing.triggerDamageVignette(.4,20),this.playerInvincible<=0&&(this.playerInvincible=60),me.playEnemyExplosion()}spawnExplosion(t,n){this.entities.push({id:Math.random().toString(),type:S.EXPLOSION,pos:{x:t.x,y:t.y},vel:{vx:0,vy:2},size:{width:n.width,height:n.width},hp:1,active:!0,frame:0,maxFrames:20})}spawnEnemyFormation(){const t=this.getDifficultyMultiplier(),n=Zy(this.campaign),s=qy(this.campaign),r=80,c=r+Math.random()*(P-r*2),h=Uy(n.type,s,c,-60),d=Zg(this.campaign,this.level),g=Wy(n.movementPattern,c,d);let m;for(let y=0;y<h.length;y++){const E=h[y],A=Math.random().toString();y===0&&(m=A);const v=y===0?{x:0,y:0}:{x:E.x-h[0].x,y:E.y-h[0].y},b=g.map(q=>({x:q.x+v.x,y:q.y+v.y,speed:q.speed})),O=Jy(b,y===0?void 0:m,v),L=this.campaign===pe.HELLFIRE_HORIZON?.24:this.campaign===pe.STEEL_VANGUARD?.25:.15,N=this.getDynamicPowerupBoost(),x=Math.min(.5,L+N),I=y>0&&Math.random()<x,G=I?S.ENEMY_RED:S.ENEMY_SMALL,W=I?7:5,Q=I?300:100,j=ap(E,b[0],Fo*d*t.speed);this.entities.push({id:A,type:G,pos:{...E},vel:{...j},size:{width:66,height:66},hp:Math.floor(W*t.enemyHP),active:!0,frame:0,scoreValue:Q,hitFlash:0,bankAngle:0,rotation:ip(j),formationState:O})}}spawnSupportFighter(){console.log("[SUPPORT]  Spawning support fighter with SPREAD powerup!"),this.entities.push({id:"support-fighter",type:S.SUPPORT_FIGHTER,pos:{x:-80,y:Y*.4},vel:{vx:8,vy:0},size:{width:66,height:66},hp:100,active:!0,frame:0,hitFlash:0}),me.playPowerUp()}updateSupportFighter(t){const n=P/2;t.hp===100&&t.pos.x>=n-40&&(t.hp=50,console.log("[SUPPORT]  Dropping SPREAD powerup at center!"),this.entities.push({id:Math.random().toString(),type:S.POWERUP,pos:{x:t.pos.x+t.size.width/2-20,y:t.pos.y+t.size.height},vel:{vx:0,vy:fa+.5},size:{width:40,height:40},hp:1,active:!0,frame:0,powerupType:ma.SPREAD,isSpecial:!0}),ve.emitSparks(t.pos.x+t.size.width/2,t.pos.y+t.size.height,10),me.playPowerUp()),t.pos.x>P+100&&(t.active=!1)}getDynamicTerrainParallaxOffset(t){const n=Xn(this.campaign,this.level);if(n){const s=ba.getDetectedTerrainWidth(this.campaign,this.level),r=ga(this.campaign,this.level),c=s??r.mapWidthExtended,h=yl(c,n.leftX,n.rightX,P),d=P/2,g=(t-d)/d;return Math.floor(g*h)}return oc(t,P)}calculateHeatLevel(){const t=Es.THRESHOLDS;return this.heatPoints>=t.BLAZING?jt.BLAZING:this.heatPoints>=t.ON_FIRE?jt.ON_FIRE:this.heatPoints>=t.HOT?jt.HOT:this.heatPoints>=t.WARM?jt.WARM:jt.COLD}getHeatMultiplier(){return Es.MULTIPLIERS[this.heatLevel]}addHeat(t=Es.HEAT_PER_KILL,n=!1){const s=this.combo*Es.HEAT_PER_COMBO_POINT,r=n?Es.HEAT_PER_TARGET:0;this.heatPoints+=t+s+r,this.heatDecayTimer=0;const c=this.calculateHeatLevel();c!==this.heatLevel&&(this.onHeatLevelChange(this.heatLevel,c),this.heatLevel=c)}onHeatLevelChange(t,n){const s=[jt.COLD,jt.WARM,jt.HOT,jt.ON_FIRE,jt.BLAZING],r=s.indexOf(t),c=s.indexOf(n);c>r&&(me.playHeatLevelUp(c),n===jt.BLAZING?(this.postProcessing.triggerWhiteFlash(.6,15),this.screenShake=8):n===jt.ON_FIRE?(this.postProcessing.triggerWhiteFlash(.4,10),this.screenShake=5):n===jt.HOT&&this.postProcessing.triggerWhiteFlash(.2,8))}updateHeatDecay(){if(!(this.heatPoints<=0)&&(this.heatDecayTimer++,this.heatDecayTimer>Es.DECAY_DELAY)){this.heatPoints-=Es.DECAY_PER_FRAME,this.heatPoints<0&&(this.heatPoints=0);const t=this.calculateHeatLevel();t!==this.heatLevel&&(this.heatLevel=t)}}awardScoreWithHeat(t){const n=this.getHeatMultiplier(),s=Math.floor(t*n);return this.score+=s,this.checkScoreMilestones(),s}checkScoreMilestones(){for(const t of Yy)this.score>=t.score&&this.lastScoreMilestone<t.score&&(this.lastScoreMilestone=t.score,this.score+=t.bonus,me.playJackpot(),this.postProcessing.triggerWhiteFlash(.8,20),this.screenShake=15,this.addHeat(5),console.log(`[MILESTONE] ${t.label} - Bonus: +${t.bonus}`))}checkComboMilestones(){for(const t of Gy)this.combo>=t.combo&&this.lastComboMilestone<t.combo&&(this.lastComboMilestone=t.combo,this.awardScoreWithHeat(t.bonus),t.combo>=10?(me.playJackpot(),this.postProcessing.triggerWhiteFlash(.6,15),this.screenShake=10):t.combo>=5?(me.playComboUp(),this.postProcessing.triggerWhiteFlash(.3,10),this.screenShake=5):me.playComboUp(),console.log(`[COMBO] ${t.label} - Bonus: +${t.bonus}`));this.combo===0&&(this.lastComboMilestone=0)}resetHeatSystem(){this.heatPoints=0,this.heatLevel=jt.COLD,this.heatDecayTimer=0,this.lastHeatLevel=jt.COLD,this.lastScoreMilestone=0,this.lastComboMilestone=0,this.floatingScores=[],this.lingeringFireZones=[],this.pendingScores=[],this.pendingScoreTimer=0}spawnFloatingScore(t,n,s,r="fighter",c){this.pendingScores.push({x:t,y:n,points:Math.floor(s),entityType:r,heatLevel:this.heatLevel}),this.pendingScoreTimer=this.SCORE_BUNDLE_WINDOW}processPendingScores(){if(this.pendingScores.length===0)return;const t=this.pendingScores.reduce((g,m)=>g+m.points,0),n=this.pendingScores.reduce((g,m)=>g+m.x,0)/this.pendingScores.length,s=this.pendingScores.reduce((g,m)=>g+m.y,0)/this.pendingScores.length,r=this.pendingScores.length,c=[jt.BLAZING,jt.ON_FIRE,jt.HOT,jt.WARM,jt.COLD],h=this.pendingScores.reduce((g,m)=>{const y=c.indexOf(g);return c.indexOf(m.heatLevel)<y?m.heatLevel:g},jt.COLD);let d="fighter";this.pendingScores.some(g=>g.entityType==="bomber")?d="bomber":this.pendingScores.some(g=>g.entityType==="turret")?d="turret":this.pendingScores.some(g=>g.entityType==="target")&&(d="target"),this.floatingScores.push({x:n,y:s,points:t,frame:0,maxFrames:90,heatLevel:h,multiplier:r>1?r:void 0,entityType:d}),this.pendingScores=[]}updateFloatingScores(){this.pendingScoreTimer>0&&(this.pendingScoreTimer--,this.pendingScoreTimer===0&&this.pendingScores.length>0&&this.processPendingScores());for(let t=this.floatingScores.length-1;t>=0;t--){const n=this.floatingScores[t];n.frame++,n.frame>=n.maxFrames&&this.floatingScores.splice(t,1)}}}let Ts=new Map;const g2=20;class p2{constructor(){this.frameTimeHistory=[],this.HISTORY_SIZE=60,this.lastFrameTime=0,this.currentFPS=60,this.targetFPS=60,this.qualityLevel="HIGH",this.isMobile=!1,this.isLowEndDevice=!1,this.consecutiveLowFrames=0,this.consecutiveHighFrames=0,this.lastQualityChange=0,this.QUALITY_CHANGE_COOLDOWN=120,this.detectDevice(),this.cachedSettings=this.getSettingsForLevel(this.qualityLevel)}detectDevice(){this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);const t=navigator.hardwareConcurrency||2,n=navigator.deviceMemory||4;this.isLowEndDevice=t<=4||n<=2,this.isMobile?this.isLowEndDevice?this.qualityLevel="LOW":this.qualityLevel="MEDIUM":this.qualityLevel="HIGH",this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log("[PerformanceManager] Device detected:",{isMobile:this.isMobile,isLowEnd:this.isLowEndDevice,cores:t,memory:n,initialQuality:this.qualityLevel})}startFrame(){this.lastFrameTime=performance.now()}endFrame(){const t=performance.now()-this.lastFrameTime;if(this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length>=10){const n=this.frameTimeHistory.reduce((s,r)=>s+r,0)/this.frameTimeHistory.length;this.currentFPS=Math.round(1e3/n)}this.adjustQuality()}adjustQuality(){if(this.frameTimeHistory.length<this.QUALITY_CHANGE_COOLDOWN)return;this.currentFPS<45?(this.consecutiveLowFrames++,this.consecutiveHighFrames=0,this.consecutiveLowFrames>30&&(this.decreaseQuality(),this.consecutiveLowFrames=0)):this.currentFPS>=58?(this.consecutiveHighFrames++,this.consecutiveLowFrames=0,this.consecutiveHighFrames>180&&(this.increaseQuality(),this.consecutiveHighFrames=0)):(this.consecutiveLowFrames=0,this.consecutiveHighFrames=0)}decreaseQuality(){const t=["ULTRA","HIGH","MEDIUM","LOW"],n=t.indexOf(this.qualityLevel);n<t.length-1&&(this.qualityLevel=t[n+1],this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log(`[PerformanceManager] Quality decreased to ${this.qualityLevel} (FPS: ${this.currentFPS})`))}increaseQuality(){if(this.isMobile&&this.isLowEndDevice)return;const t=["ULTRA","HIGH","MEDIUM","LOW"],n=t.indexOf(this.qualityLevel),s=this.isMobile?"HIGH":"ULTRA",r=t.indexOf(s);n>r&&(this.qualityLevel=t[n-1],this.cachedSettings=this.getSettingsForLevel(this.qualityLevel),console.log(`[PerformanceManager] Quality increased to ${this.qualityLevel} (FPS: ${this.currentFPS})`))}getSettingsForLevel(t){switch(t){case"ULTRA":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:1,maxParticles:500,enablePostProcessing:!0,enableClouds:!0,enableScreenShake:!0,enableCameraZoom:!0,shadowQuality:"full",explosionDetail:"full",maxEntities:200};case"HIGH":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:.7,maxParticles:300,enablePostProcessing:!0,enableClouds:!0,enableScreenShake:!0,enableCameraZoom:!0,shadowQuality:"full",explosionDetail:"full",maxEntities:150};case"MEDIUM":return{qualityLevel:t,enableShadows:!0,enableParticles:!0,particleMultiplier:.4,maxParticles:150,enablePostProcessing:!1,enableClouds:!1,enableScreenShake:!0,enableCameraZoom:!1,shadowQuality:"full",explosionDetail:"simple",maxEntities:100};case"LOW":return{qualityLevel:t,enableShadows:!1,enableParticles:!1,particleMultiplier:0,maxParticles:0,enablePostProcessing:!1,enableClouds:!1,enableScreenShake:!1,enableCameraZoom:!1,shadowQuality:"none",explosionDetail:"simple",maxEntities:75}}}getSettings(){return this.cachedSettings}getFPS(){return this.currentFPS}getQualityLevel(){return this.qualityLevel}setQualityLevel(t){this.qualityLevel=t,this.cachedSettings=this.getSettingsForLevel(t),console.log(`[PerformanceManager] Quality set to ${t}`)}getIsMobile(){return this.isMobile}getShadowCanvas(t,n){const s=`${t}x${n}`;if(!Ts.has(s)){if(Ts.size>=g2){const c=Ts.keys().next().value;c&&Ts.delete(c)}const r=document.createElement("canvas");r.width=t,r.height=n,Ts.set(s,r)}return Ts.get(s)}clearShadowCache(){Ts.clear()}}const jo=new p2,Yp=(o,t,n)=>{if(o===0)return null;const s="w-7 h-7 sm:w-8 sm:h-8";return o===1?M.jsx("div",{className:"flex items-center",children:M.jsx("img",{src:t,alt:n,className:s,style:{imageRendering:"pixelated"}})}):M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("img",{src:t,alt:n,className:s,style:{imageRendering:"pixelated"}}),M.jsxs("span",{className:"text-white font-bold text-sm sm:text-base drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]",children:["x",o]})]})},m2=({score:o,highScore:t,lives:n,bombs:s,level:r,combo:c,activeBoss:h,playerHealth:d,maxPlayerHealth:g,firepowerCount:m,bombCount:y,invincibilityCount:E,firepowerSprite:A,firepowerEnhancedSprite:v,bombSprite:b,invincibilitySprite:O,firepowerBullets:L,firepowerStacks:N,activeFirepowerTier:x,spreadBullets:I,spreadStacks:G,enemyFighterSprite:W,playerInvincible:Q,gameEngine:j,canvasBounds:q})=>{const[Ee,ye]=Z.useState(o),fe=Z.useRef(o);Z.useEffect(()=>{if(o!==fe.current){const le=Math.ceil((o-Ee)/10);if(Math.abs(o-Ee)>0){const ue=setTimeout(()=>{ye(Le=>{const K=Le+le;return le>0?Math.min(K,o):Math.max(K,o)})},16);return()=>clearTimeout(ue)}fe.current=o}},[o,Ee]);const[re,ce]=Z.useState(d),[Te,at]=Z.useState(d);Z.useEffect(()=>{ce(d);const le=setTimeout(()=>{at(d)},300);return()=>clearTimeout(le)},[d]),h&&h.hp/h.maxHP*100;const U=re/g*100,se=Te/g*100,_e=I>0||L>0,Qe=I>0;let et=0,C=A;if(Qe){const le=pi.BULLETS_PER_POWERUP*G;et=I/le*100,C=A}else if(L>0){const le=pi.BULLETS_PER_POWERUP*N;et=L/le*100,C=x===za.ENHANCED?v:A}const ee=Math.ceil(et/100*10);return M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"absolute pointer-events-none z-50 flex items-center gap-2",style:{left:q?q.offsetLeft+8:8,bottom:q?q.offsetTop+8:8},children:[M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:L>0||m>0?Yp(N+m,L>0&&x===za.ENHANCED?v:A,"Firepower"):M.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"NO FIRE"})}),M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:y>0?Yp(y,b,"Bomb"):M.jsx("span",{className:"text-gray-500 text-[10px] sm:text-xs",children:"NO BOMBS"})}),Q>0&&M.jsxs("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2 flex items-center gap-2",children:[M.jsx("img",{src:O,alt:"Shield",className:"w-7 h-7 sm:w-8 sm:h-8 animate-pulse",style:{imageRendering:"pixelated"}}),M.jsx("div",{className:"flex gap-0.5",children:Array.from({length:7}).map((le,ue)=>{const Le=30*(7-ue);return M.jsx("div",{className:`w-2 sm:w-2.5 h-5 sm:h-6 rounded transition-colors ${Q>=Le?"bg-gradient-to-t from-purple-600 to-purple-400":Q>=Le-30?"bg-gradient-to-t from-purple-600 to-purple-400 animate-pulse":"bg-gray-700/50"}`},ue)})})]})]}),M.jsx("div",{className:"absolute pointer-events-none z-50",style:{right:q?q.offsetLeft+8:8,bottom:q?q.offsetTop+8:8},children:M.jsxs("div",{className:"flex items-center gap-4 sm:gap-5 bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:[_e&&M.jsxs("div",{className:"flex items-center gap-2.5",children:[M.jsx("img",{src:C,alt:"Ammo",className:"w-8 h-8 sm:w-9 sm:h-9",style:{imageRendering:"pixelated"}}),M.jsx("div",{className:"flex gap-0.5",children:Array.from({length:10}).map((le,ue)=>M.jsx("div",{className:`w-2.5 sm:w-3 h-5 sm:h-6 rounded transition-colors ${ue<ee?et>30?"bg-gradient-to-t from-orange-600 to-orange-400":"bg-gradient-to-t from-red-700 to-red-500 animate-pulse":"bg-gray-700/50"}`},ue))})]}),_e&&M.jsx("div",{className:"w-px h-6 bg-gray-600"}),M.jsxs("div",{className:"flex items-center gap-1.5",children:[M.jsx("img",{src:W,alt:"Lives",className:"w-7 h-7 sm:w-8 sm:h-8",style:{imageRendering:"pixelated"}}),M.jsxs("span",{className:"text-green-400 font-bold text-sm sm:text-base",children:["x",n]})]})]})}),M.jsx("div",{className:"absolute pointer-events-none z-50",style:{right:q?q.offsetLeft+8:8,top:q?q.offsetTop+8:8},children:M.jsxs("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:[M.jsx("div",{className:"text-right mb-1 whitespace-nowrap",children:M.jsx("span",{className:"text-cyan-400 font-bold text-xs sm:text-sm tracking-wider drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:"HULL INTEGRITY"})}),M.jsxs("div",{className:"relative w-48 sm:w-64 h-5 sm:h-6 bg-gray-900/80 border border-cyan-600 rounded-lg overflow-hidden",children:[M.jsx("div",{className:"absolute inset-0 bg-red-900/50 transition-all duration-300",style:{width:`${se}%`}}),M.jsx("div",{className:`absolute inset-0 transition-all duration-100 ${U>66?"bg-gradient-to-r from-green-500 to-cyan-400":U>33?"bg-gradient-to-r from-yellow-500 to-orange-400":"bg-gradient-to-r from-red-600 to-red-400 animate-pulse"}`,style:{width:`${U}%`},children:M.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent"})}),M.jsx("div",{className:"absolute inset-0 flex",children:Array.from({length:10}).map((le,ue)=>M.jsx("div",{className:"flex-1 border-r border-black/30"},ue))}),M.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:M.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]",children:[Math.ceil(U),"%"]})})]})]})}),c>1&&M.jsx("div",{className:"absolute top-20 sm:top-32 pointer-events-none",style:{left:q?c%2===0?q.offsetLeft+16:q.offsetLeft+q.renderWidth-80:c%2===0?16:void 0,right:!q&&c%2!==0?16:void 0},children:M.jsxs("div",{className:"text-center animate-bounce",children:[M.jsx("div",{className:"absolute inset-0 blur-xl bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 opacity-60 animate-pulse"}),M.jsxs("div",{className:"relative text-3xl sm:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 drop-shadow-[0_4px_8px_rgba(0,0,0,0.9)] animate-pulse",children:["x",c]}),M.jsx("div",{className:"relative text-xs sm:text-sm font-bold text-yellow-300 tracking-wider sm:tracking-widest drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:"COMBO!"})]})})]})};function y2(o){if(o.length<ai.CIRCLE_MIN_POINTS||o[o.length-1].time-o[0].time>ai.CIRCLE_MAX_DURATION)return!1;const n=o.reduce((g,m)=>g+m.x,0)/o.length,s=o.reduce((g,m)=>g+m.y,0)/o.length,r=o.map(g=>Math.hypot(g.x-n,g.y-s)),c=r.reduce((g,m)=>g+m,0)/r.length;if(c<ai.CIRCLE_MIN_RADIUS||c>ai.CIRCLE_MAX_RADIUS)return!1;let h=0;for(let g=1;g<o.length;g++){const m=Math.atan2(o[g-1].y-s,o[g-1].x-n);let E=Math.atan2(o[g].y-s,o[g].x-n)-m;for(;E>Math.PI;)E-=2*Math.PI;for(;E<-Math.PI;)E+=2*Math.PI;h+=E}const d=ai.CIRCLE_MIN_ANGLE*Math.PI/180;return Math.abs(h)>d}const E2=({onMove:o,onFire:t,onEvade:n,onBomb:s,onFirstTouch:r})=>{const c=Z.useRef(null),h=Z.useRef(!1),d=Z.useRef(null),g=Z.useRef(null),m=Z.useRef(null),y=Z.useRef(0),E=Z.useRef(null),A=Z.useRef([]),v=Z.useRef(0),b=Z.useRef(!1);return Z.useEffect(()=>{const O=c.current;if(!O)return;const L=I=>{I.preventDefault(),!h.current&&r&&(h.current=!0,r()),Array.from(I.changedTouches).forEach(G=>{const W=G.clientX,Q=G.clientY;if(d.current===null){d.current=G.identifier,g.current={x:W,y:Q};return}if(m.current===null){const j=Date.now();if(j-y.current<ai.DOUBLE_TAP_WINDOW&&E.current!==null&&Math.hypot(W-E.current.x,Q-E.current.y)<ai.DOUBLE_TAP_DISTANCE){s(),"vibrate"in navigator&&navigator.vibrate(200),y.current=0,E.current=null;return}m.current=G.identifier,t(!0),"vibrate"in navigator&&navigator.vibrate(10),A.current=[{x:W,y:Q,time:j}],v.current=j,b.current=!1}})},N=I=>{I.preventDefault(),Array.from(I.touches).forEach(G=>{if(G.identifier===d.current&&g.current){const W=G.clientX-g.current.x,Q=G.clientY-g.current.y;let j=W/ai.JOYSTICK_MAX_DISTANCE,q=Q/ai.JOYSTICK_MAX_DISTANCE;j=Math.max(-1,Math.min(1,j)),q=Math.max(-1,Math.min(1,q)),Math.hypot(j,q)<ai.JOYSTICK_DEAD_ZONE&&(j=0,q=0),o(j,q)}if(G.identifier===m.current&&!b.current){const W=Date.now();if(W-v.current>=ai.CIRCLE_SAMPLE_INTERVAL){v.current=W,A.current.push({x:G.clientX,y:G.clientY,time:W});const Q=W-ai.CIRCLE_MAX_DURATION;A.current=A.current.filter(j=>j.time>=Q),y2(A.current)&&(n(),"vibrate"in navigator&&navigator.vibrate([30,30,30]),A.current=[],b.current=!0)}}})},x=I=>{Array.from(I.changedTouches).forEach(G=>{G.identifier===d.current&&(d.current=null,g.current=null,o(0,0)),G.identifier===m.current&&(m.current=null,t(!1),y.current=Date.now(),E.current={x:G.clientX,y:G.clientY},A.current=[],b.current=!1)})};return O.addEventListener("touchstart",L,{passive:!1}),O.addEventListener("touchmove",N,{passive:!1}),O.addEventListener("touchend",x,{passive:!1}),O.addEventListener("touchcancel",x,{passive:!1}),()=>{O.removeEventListener("touchstart",L),O.removeEventListener("touchmove",N),O.removeEventListener("touchend",x),O.removeEventListener("touchcancel",x)}},[o,t,n,s,r]),M.jsx("div",{ref:c,className:"absolute inset-0 z-40 touch-none",style:{pointerEvents:"auto"}})},$o=["INITIALIZING MEMORY...","LOADING ROM DATA...","CHECKING GRAPHICS...","SOUND CHIP TEST...","CALIBRATING INPUTS...","LOADING SPRITES...","DECODING ASSETS...","SYSTEM READY..."],gi=8,_2=5,A2=({progress:o,width:t,height:n})=>{const s=Z.useRef(null),r=Z.useRef(0),c=Z.useRef([]),h=Z.useRef([]),[d,g]=Z.useState($o[0]);return Z.useEffect(()=>{const m=Math.min(Math.floor(o/100*$o.length),$o.length-1);g($o[m])},[o]),Z.useEffect(()=>{const m=s.current;if(!m)return;const y=m.getContext("2d");if(!y)return;const E=Math.ceil(t/gi),A=Math.ceil(n/gi),v=()=>{const N=[];for(let x=0;x<A;x++){N[x]=[];for(let I=0;I<E;I++)N[x][I]=Math.random()}return N},b=()=>{const N=[];for(let x=0;x<8;x++){let I="";for(let G=0;G<24;G++)I+=Math.random()>.5?"1":"0";N.push(I)}return N};c.current=v(),h.current=b();let O;const L=()=>{var Le,K,xe;r.current++;const N=r.current;y.fillStyle="#000000",y.fillRect(0,0,t,n);const x=30,I=25,G=50,W=x,Q=I,j=t-x*2,q=n-I-G;if(N%_2===0)for(let de=0;de<A;de++)for(let Ue=0;Ue<E;Ue++)c.current[de][Ue]=Math.random();if(N%8===0)for(let de=0;de<h.current.length;de++)h.current[de]=h.current[de].substring(1)+(Math.random()>.5?"1":"0");const Ee=.25+Math.sin(N*.05)*.05;for(let de=0;de<A;de++)for(let Ue=0;Ue<E;Ue++){const ta=Ue*gi,xa=de*gi;if(ta>=W-gi&&ta<=W+j&&xa>=Q-gi&&xa<=Q+q)continue;const jn=c.current[de][Ue];if(jn<Ee){const si=Math.floor(jn*200+55);y.fillStyle=`rgb(${si}, ${si}, ${si})`,y.fillRect(ta,xa,gi-1,gi-1)}}y.fillStyle="#000000",y.fillRect(W,Q,j,q),y.strokeStyle="#333",y.lineWidth=1,y.strokeRect(W,Q,j,q),y.strokeStyle="#222",y.strokeRect(W+2,Q+2,j-4,q-4);const ye=2+Math.floor(Math.sin(N*.02)+1);for(let de=0;de<ye;de++){const Ue=(N*.5+de*120)%n;if(Ue<Q||Ue>Q+q){const ta=2+N%3,xa=80+Math.floor(Math.sin(N*.1)*40+40);y.fillStyle=`rgba(${xa}, ${xa}, ${xa}, 0.25)`,y.fillRect(0,Ue,t,ta)}}const fe=N*1.5%(n+40)-20;y.fillStyle="rgba(255, 255, 255, 0.03)",y.fillRect(0,fe,t,20),y.fillStyle="rgba(255, 255, 255, 0.06)",y.fillRect(0,fe+8,t,4),y.fillStyle="rgba(0, 0, 0, 0.08)";for(let de=0;de<n;de+=3)y.fillRect(0,de,t,1);y.save();const re=W+15,ce=W+j-15;let Te=Q+30;y.font="bold 14px monospace",y.textAlign="center";const at=.9+Math.sin(N*.05)*.1;y.fillStyle=`rgba(255, 255, 255, ${at})`,y.fillText("WORLD WAR II SKY ACE - SYSTEM BOOT",t/2,Te),Te+=25,y.fillStyle="#333",y.fillRect(re,Te,ce-re,1),Te+=20,y.font="10px monospace",y.fillStyle="#AAA",y.textAlign="left",y.fillText("ROM CHECK:    OK",re,Te),y.fillText("RAM CHECK:    OK",re,Te+18),y.fillText(`VRAM:         ${String(Math.floor(o*64)).padStart(4," ")}K / 6400K`,re,Te+36),y.textAlign="right",y.fillStyle="#888",y.fillText(`FRAME: ${String(N).padStart(6,"0")}`,ce,Te),y.fillText("VER:   1.942.0",ce,Te+18),Te+=55,y.fillStyle="#222",y.fillRect(re,Te,ce-re,1),Te+=18,y.font="9px monospace",y.fillStyle="#555",y.textAlign="left";for(let de=0;de<4;de++)y.fillText(h.current[de]||"",re,Te+de*16);y.textAlign="right";for(let de=4;de<8;de++)y.fillText(h.current[de]||"",ce,Te+(de-4)*16);Te+=70,y.font="8px monospace",y.fillStyle="#666",y.textAlign="left";for(let de=0;de<4;de++){const Ue=32768+(Math.floor(N/3)*16+de*256)&65535,ta=Math.floor((((Le=c.current[de])==null?void 0:Le[0])||.5)*256);y.fillText(`0x${Ue.toString(16).toUpperCase().padStart(4,"0")}:  ${ta.toString(16).toUpperCase().padStart(2,"0")}`,re,Te+de*14)}y.textAlign="right";for(let de=0;de<4;de++){const Ue=49152+(Math.floor(N/3)*8+de*128)&65535,ta=Math.floor((((K=c.current[de])==null?void 0:K[1])||.5)*256);y.fillText(`${ta.toString(16).toUpperCase().padStart(2,"0")}  :0x${Ue.toString(16).toUpperCase().padStart(4,"0")}`,ce,Te+de*14)}const U=Q+q-70;y.fillStyle="#333",y.fillRect(re,U,ce-re,1),y.font="bold 11px monospace",y.fillStyle="#FFF",y.textAlign="center";const se=Math.floor(N/20)%2===0;y.fillText("> "+d+(se?"_":" "),t/2,U+22);const _e=U+35,Qe=16,et=j-30,C=W+15,ee=Math.floor(et/gi),le=Math.floor(o/100*ee);y.fillStyle="#111",y.fillRect(C,_e,et,Qe),y.strokeStyle="#333",y.strokeRect(C,_e,et,Qe);for(let de=0;de<le;de++){const Ue=180+Math.floor((((xe=c.current[0])==null?void 0:xe[de%E])||.5)*75);y.fillStyle=`rgb(${Ue}, ${Ue}, ${Ue})`,y.fillRect(C+2+de*gi,_e+2,gi-2,Qe-4)}le<ee&&N%6<3&&(y.fillStyle="#AAA",y.fillRect(C+2+le*gi,_e+2,gi-2,Qe-4)),y.font="bold 10px monospace",y.fillStyle="#FFF",y.textAlign="center",y.fillText(`[ ${String(Math.floor(o)).padStart(3," ")}% ]`,t/2,_e+Qe+15),y.restore(),Math.random()<.01&&(y.fillStyle="rgba(255, 255, 255, 0.015)",y.fillRect(0,0,t,n));const ue=y.createRadialGradient(t/2,n/2,n*.3,t/2,n/2,n*.8);ue.addColorStop(0,"rgba(0, 0, 0, 0)"),ue.addColorStop(1,"rgba(0, 0, 0, 0.4)"),y.fillStyle=ue,y.fillRect(0,0,t,n),O=requestAnimationFrame(L)};return L(),()=>{cancelAnimationFrame(O)}},[t,n,o]),M.jsx("canvas",{ref:s,width:t,height:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",imageRendering:"pixelated"}})},S2=()=>{const[o,t]=Z.useState({isTouchDevice:!1,isMobile:!1,isLowPerformance:!1,screenWidth:typeof window<"u"?window.innerWidth:0,screenHeight:typeof window<"u"?window.innerHeight:0});return Z.useEffect(()=>{const n=()=>{const s="ontouchstart"in window||navigator.maxTouchPoints>0,r=window.innerWidth<768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),h=(navigator.hardwareConcurrency||2)<4||r;t({isTouchDevice:s,isMobile:r,isLowPerformance:h,screenWidth:window.innerWidth,screenHeight:window.innerHeight})};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),o};class T2{constructor(){this.joystickX=0,this.joystickY=0,this.firePressed=!1,this.evadeTriggered=!1,this.bombTriggered=!1}setJoystickPosition(t,n){this.joystickX=t,this.joystickY=n}setFirePressed(t){this.firePressed=t}triggerEvade(){this.evadeTriggered=!0}triggerBomb(){this.bombTriggered=!0}getInputState(){const t=this.joystickX<-.2,n=this.joystickX>ai.JOYSTICK_DEAD_ZONE,s=this.joystickY<-.2,r=this.joystickY>ai.JOYSTICK_DEAD_ZONE,c=this.bombTriggered;this.bombTriggered=!1;const h=this.evadeTriggered;return this.evadeTriggered=!1,{left:t,right:n,up:s,down:r,fire:this.firePressed,evade:h,bomb:c}}mergeWithKeyboardInput(t,n){return{left:t.left||n.left,right:t.right||n.right,up:t.up||n.up,down:t.down||n.down,fire:t.fire||n.fire,evade:t.evade||n.evade,bomb:t.bomb||n.bomb}}reset(){this.joystickX=0,this.joystickY=0,this.firePressed=!1,this.evadeTriggered=!1,this.bombTriggered=!1}}const gl=new T2,v2=({gameState:o,onSave:t,onLoad:n})=>{const[s,r]=Z.useState(V.getState().selectedElement),[c,h]=Z.useState(V.getState().pendingChanges),[d,g]=Z.useState(V.hasUnsavedChanges()),[m,y]=Z.useState(V.getDesignScrollY()),[E,A]=Z.useState("30"),[v,b]=Z.useState("1.5"),[O,L]=Z.useState("5000"),[N,x]=Z.useState("0.0035"),[I,G]=Z.useState("down"),[W,Q]=Z.useState("tank"),[j,q]=Z.useState("top"),[Ee,ye]=Z.useState("0");Z.useEffect(()=>{if(o!==te.DESIGN_MODE)return;const K=setInterval(()=>{const xe=V.getState();r(xe.selectedElement),h(xe.pendingChanges),g(xe.isDirty),y(xe.designScrollY)},100);return()=>clearInterval(K)},[o]),Z.useEffect(()=>{if(s){if(s.type==="turret"||s.type==="target"){const K=V.getEntityMetadata(s.id);s.type==="turret"?(A(String((K==null?void 0:K.hp)??30)),b(String((K==null?void 0:K.fireRate)??1.5))):L(String((K==null?void 0:K.points)??5e3))}else if(s.type==="path"){const K=V.getPathMetadata(s.id),xe=V.getPathOffset(s.id);ye(String(xe)),x(String((K==null?void 0:K.speed)??.0035)),G((K==null?void 0:K.direction)??"down"),Q((K==null?void 0:K.entityType)??"tank"),q((K==null?void 0:K.spawnPoint)??"top")}}},[s==null?void 0:s.id,s==null?void 0:s.type]);const fe=Z.useCallback((K,xe)=>{const de=parseInt(xe,10);isNaN(de)||!s||(K==="x"?V.nudgeSelected(de-s.currentPosition.x,0):V.nudgeSelected(0,de-s.currentPosition.y),r(V.getState().selectedElement))},[s]);Z.useCallback(K=>{const xe=parseInt(K,10);if(isNaN(xe)||!s||s.type!=="path")return;V.updatePathOffset(s.id,xe);const de=V.getState();r(de.selectedElement),h(de.pendingChanges)},[s]);const re=Z.useCallback(()=>{if(!s||s.type!=="turret")return;const K=parseInt(E,10);isNaN(K)||(V.updateEntityMetadata(s.id,{hp:Math.max(1,K)}),h(V.getState().pendingChanges),g(!0))},[s,E]),ce=Z.useCallback(()=>{if(!s||s.type!=="turret")return;const K=parseFloat(v);isNaN(K)||(V.updateEntityMetadata(s.id,{fireRate:Math.max(.1,K)}),h(V.getState().pendingChanges),g(!0))},[s,v]),Te=Z.useCallback(()=>{if(!s||s.type!=="target")return;const K=parseInt(O,10);isNaN(K)||(V.updateEntityMetadata(s.id,{points:Math.max(100,K)}),h(V.getState().pendingChanges),g(!0))},[s,O]),at=Z.useCallback(()=>{if(!s||s.type!=="path")return;const K=parseInt(Ee,10);isNaN(K)||(V.updatePathOffset(s.id,K),h(V.getState().pendingChanges),g(!0))},[s,Ee]),U=Z.useCallback(()=>{if(!s||s.type!=="path")return;const K=parseFloat(N);isNaN(K)||(V.updatePathMetadata(s.id,{speed:Math.max(.001,K)}),h(V.getState().pendingChanges),g(!0))},[s,N]),se=Z.useCallback(K=>{!s||s.type!=="path"||(G(K),V.updatePathMetadata(s.id,{direction:K}),h(V.getState().pendingChanges),g(!0))},[s]),_e=Z.useCallback(K=>{!s||s.type!=="path"||(Q(K),V.updatePathMetadata(s.id,{entityType:K}),h(V.getState().pendingChanges),g(!0))},[s]),Qe=Z.useCallback(K=>{!s||s.type!=="path"||(q(K),V.updatePathMetadata(s.id,{spawnPoint:K}),h(V.getState().pendingChanges),g(!0))},[s]),et=Z.useCallback(async()=>{if(t)t();else{const K=V.getPendingChanges(),xe=V.getLevelInfo(),de={campaign:xe.campaign,level:xe.level,timestamp:new Date().toISOString(),...K},Ue=JSON.stringify(de,null,2);console.log("[DESIGN MODE] Saving changes:",Ue);try{await navigator.clipboard.writeText(Ue),alert(`Design changes copied to clipboard!

Paste into the API or JSON file.`),V.markSaved(),g(!1)}catch(ta){console.error("Failed to copy to clipboard:",ta),alert("Save failed. Check console for JSON output.")}}},[t]),C=Z.useCallback(()=>{if(n)n();else{const K=prompt("Paste design overrides JSON:");if(K)try{const xe=JSON.parse(K);V.loadOverrides(xe),h(V.getState().pendingChanges),g(!1),alert("Design overrides loaded!")}catch(xe){console.error("Failed to parse JSON:",xe),alert("Invalid JSON format.")}}},[n]),ee=Z.useCallback(()=>{confirm("Reset all design changes to defaults?")&&(V.resetToDefaults(),h(V.getState().pendingChanges),r(null),g(!0))},[]);if(!xi||o!==te.DESIGN_MODE)return null;const le=V.getLevelInfo(),ue=Ot.TOTAL_MAP_HEIGHT,Le=Math.round(m/(ue-Y)*100);return M.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:100},children:[M.jsxs("div",{className:"absolute top-0 left-0 right-0 h-12 bg-black/80 border-b-2 border-cyan-500 flex items-center px-4 pointer-events-auto",style:{backdropFilter:"blur(4px)"},children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("span",{className:"text-green-400 font-bold text-lg",children:"DESIGN MODE"}),M.jsx("span",{className:"text-white/50",children:"|"}),M.jsxs("span",{className:"text-white",children:[le.campaign," Level ",le.level]})]}),M.jsx("div",{className:"flex-1 text-center",children:M.jsxs("span",{className:"text-cyan-400 font-mono",children:["Scroll: ",Le,"% (",Math.round(m)," / ",ue-Y,")"]})}),M.jsxs("div",{className:"flex items-center gap-2",children:[d&&M.jsx("span",{className:"text-orange-400 text-sm mr-2",children:"* Unsaved"}),M.jsx("button",{onClick:C,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded border border-gray-500",children:"Load"}),M.jsx("button",{onClick:et,className:"px-3 py-1 bg-cyan-700 hover:bg-cyan-600 text-white text-sm rounded border border-cyan-500",children:"Save (S)"}),M.jsx("button",{onClick:ee,className:"px-3 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Reset"})]})]}),s&&M.jsxs("div",{className:"absolute top-14 right-2 w-56 bg-black/90 border-2 border-cyan-500 rounded p-3 pointer-events-auto",style:{backdropFilter:"blur(4px)"},children:[M.jsx("h3",{className:"text-cyan-400 font-bold mb-2 text-sm",children:s.type==="path"?"Selected Path":"Selected Element"}),M.jsxs("div",{className:"space-y-2 text-sm",children:[M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-gray-400",children:"ID:"}),M.jsx("span",{className:"text-white font-mono text-xs truncate max-w-32",children:s.id})]}),M.jsxs("div",{className:"flex justify-between",children:[M.jsx("span",{className:"text-gray-400",children:"Type:"}),M.jsx("span",{className:"text-white",children:s.type.toUpperCase()})]}),s.type==="path"?M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2 space-y-2",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"H-Offset:"}),M.jsx("input",{type:"number",value:Ee,onChange:K=>ye(K.target.value),onBlur:at,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"}),M.jsx("span",{className:"text-gray-500 text-xs",children:"px"})]}),parseInt(Ee,10)!==0&&M.jsxs("div",{className:"text-orange-400 text-xs",children:["Offset: ",parseInt(Ee,10)>0?"+":"",Ee,"px"]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-cyan-400 text-xs font-bold mb-2",children:"Path Properties"}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Speed:"}),M.jsx("input",{type:"number",step:"0.001",value:N,onChange:K=>x(K.target.value),onBlur:U,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Direction:"}),M.jsxs("select",{value:I,onChange:K=>se(K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"up",children:"Up"}),M.jsx("option",{value:"down",children:"Down"}),M.jsx("option",{value:"random",children:"Random"})]})]}),M.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Entity:"}),M.jsxs("select",{value:W,onChange:K=>_e(K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"tank",children:"Tank"}),M.jsx("option",{value:"battleship",children:"Battleship"})]})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-20",children:"Spawn:"}),M.jsxs("select",{value:j,onChange:K=>Qe(K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm",children:[M.jsx("option",{value:"top",children:"Top (first vertex)"}),M.jsx("option",{value:"bottom",children:"Bottom (last vertex)"})]})]})]})]}):s.type==="turret"?M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:K=>fe("x",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:K=>fe("y",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-green-400 text-xs font-bold mb-2",children:"Turret Properties"}),M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"HP:"}),M.jsx("input",{type:"number",value:E,onChange:K=>A(K.target.value),onBlur:re,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"Fire Rate:"}),M.jsx("input",{type:"number",step:"0.1",value:v,onChange:K=>b(K.target.value),onBlur:ce,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]}):s.type==="target"?M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:K=>fe("x",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:K=>fe("y",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsx("div",{className:"text-pink-400 text-xs font-bold mb-2",children:"Target Properties"}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-16",children:"Points:"}),M.jsx("input",{type:"number",step:"100",value:O,onChange:K=>L(K.target.value),onBlur:Te,className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]}):M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[M.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"X:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.x),onChange:K=>fe("x",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("label",{className:"text-gray-400 w-8",children:"Y:"}),M.jsx("input",{type:"number",value:Math.round(s.currentPosition.y),onChange:K=>fe("y",K.target.value),className:"flex-1 bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 text-sm font-mono"})]})]}),(s.currentPosition.x!==s.originalPosition.x||s.currentPosition.y!==s.originalPosition.y)&&M.jsxs("div",{className:"text-orange-400 text-xs",children:["Delta: (",Math.round(s.currentPosition.x-s.originalPosition.x),",",Math.round(s.currentPosition.y-s.originalPosition.y),")"]}),M.jsx("button",{onClick:()=>V.deleteSelected(),className:"w-full mt-2 px-2 py-1 bg-red-800 hover:bg-red-700 text-white text-sm rounded border border-red-500",children:"Delete Element"})]})]})]}),M.jsxs("div",{className:"absolute top-14 left-2 bg-black/70 border border-gray-600 rounded p-2 text-xs pointer-events-none",style:{backdropFilter:"blur(2px)"},children:[M.jsx("div",{className:"text-gray-400 mb-1 font-bold",children:"Shortcuts"}),M.jsxs("div",{className:"text-gray-500 space-y-0.5",children:[M.jsx("div",{children:"D / ESC: Exit"}),M.jsx("div",{children:"Arrows: Nudge (1px)"}),M.jsx("div",{children:"+Shift: Nudge (10px)"}),M.jsx("div",{children:"Del: Delete"}),M.jsx("div",{children:"PgUp/Dn: Scroll"}),M.jsx("div",{children:"Home/End: Jump"}),M.jsx("div",{children:"Drag: Move"}),M.jsx("div",{children:"Ctrl+Drag: Pan"}),M.jsx("div",{className:"border-t border-gray-600 pt-1 mt-1",children:"N: Add Entity Mode"}),M.jsx("div",{children:"Enter: Finish Path"})]})]})]})},R2=({isOpen:o,onClose:t})=>{const[n,s]=Z.useState(Bt.getSettings());Z.useEffect(()=>Bt.subscribe(y=>{s(y)}),[]);const r=m=>{me.playMenuSelect(),Bt.updateSettings({controlScheme:m})},c=(m,y)=>{Bt.updateSettings({[m]:y})},h=(m,y)=>{me.playMenuSelect(),Bt.updateSettings({[m]:y})},d=()=>{me.playMenuSelect(),Bt.resetToDefaults()},g=()=>{me.playMenuSelect(),t()};return o?M.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{fontFamily:'"Black Ops One"'},children:[M.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:g}),M.jsxs("div",{className:"relative flex flex-col rounded-lg shadow-2xl",style:{width:"90%",maxWidth:"400px",maxHeight:"85vh",background:"linear-gradient(to bottom, #3B4A1C, #2B3A12)",border:"4px solid #5A6D33",boxShadow:"0 0 30px rgba(90, 109, 51, 0.3), inset 0 0 20px rgba(0,0,0,0.5)"},children:[M.jsxs("div",{className:"flex items-center justify-between px-4 py-3",style:{borderBottom:"2px solid #5A6D33",background:"linear-gradient(to right, rgba(59, 74, 28, 0.7), rgba(43, 58, 18, 0.7))"},children:[M.jsx("h2",{className:"text-xs sm:text-sm tracking-wider",style:{color:"#c9a961",textShadow:"0 0 10px rgba(201, 169, 97, 0.8)"},children:"GAME SETTINGS"}),M.jsx("button",{onClick:g,className:"text-red-500 hover:text-red-400 text-lg leading-none transition-colors",style:{textShadow:"0 0 5px rgba(239, 68, 68, 0.8)"},children:"X"})]}),M.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-6",children:[M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"CONTROLS"}),M.jsxs("div",{className:"flex gap-2",children:[M.jsx("button",{onClick:()=>r("arrows"),className:`flex-1 py-2 px-2 text-[11px] sm:text-[12px] rounded border-2 transition-all ${n.controlScheme==="arrows"?"text-white shadow-lg":"text-zinc-400 hover:border-zinc-500"}`,style:n.controlScheme==="arrows"?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 15px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:"ARROW KEYS"}),M.jsx("button",{onClick:()=>r("wasd"),className:`flex-1 py-2 px-2 text-[11px] sm:text-[12px] rounded border-2 transition-all ${n.controlScheme==="wasd"?"text-white shadow-lg":"text-zinc-400 hover:border-zinc-500"}`,style:n.controlScheme==="wasd"?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 15px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:"WASD KEYS"})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"DIFFICULTY"}),M.jsxs("div",{className:"mb-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"ENEMY SPEED"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.enemySpeed,"%"]})]}),M.jsxs("div",{className:"relative",children:[M.jsx("input",{type:"range",min:"20",max:"100",value:n.enemySpeed,onChange:m=>c("enemySpeed",parseInt(m.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${(n.enemySpeed-20)/80*100}%, #2B3A12 ${(n.enemySpeed-20)/80*100}%, #2B3A12 100%)`}}),M.jsx("style",{children:`
                  input[type="range"]::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    width: 16px;
                    height: 16px;
                    background: linear-gradient(135deg, #5A6D33 0%, #4A5D23 100%);
                    border: 2px solid #6B5B3D;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 0 8px rgba(90, 109, 51, 0.6);
                  }
                  input[type="range"]::-moz-range-thumb {
                    width: 16px;
                    height: 16px;
                    background: linear-gradient(135deg, #5A6D33 0%, #4A5D23 100%);
                    border: 2px solid #6B5B3D;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 0 8px rgba(90, 109, 51, 0.6);
                  }
                `})]}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"EASY"}),M.jsx("span",{children:"HARD"})]})]}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"ENEMY FIRE RATE"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.enemyFireRate,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"20",max:"100",value:n.enemyFireRate,onChange:m=>c("enemyFireRate",parseInt(m.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${(n.enemyFireRate-20)/80*100}%, #2B3A12 ${(n.enemyFireRate-20)/80*100}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"SLOW"}),M.jsx("span",{children:"FAST"})]})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"SOUND"}),M.jsxs("div",{className:"mb-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"MUSIC VOLUME"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.musicVolume,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.musicVolume,onChange:m=>c("musicVolume",parseInt(m.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.musicVolume}%, #2B3A12 ${n.musicVolume}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"SOUND EFFECTS"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.sfxVolume,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.sfxVolume,onChange:m=>c("sfxVolume",parseInt(m.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.sfxVolume}%, #2B3A12 ${n.sfxVolume}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]})]}),M.jsxs("section",{children:[M.jsx("h3",{className:"text-[10px] sm:text-xs mb-3 tracking-wide pb-1",style:{color:"#c9a961",borderBottom:"1px solid #4A5D23"},children:"DISPLAY"}),M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"RADAR MINI-MAP"}),M.jsx("button",{onClick:()=>h("miniMapEnabled",!n.miniMapEnabled),className:"relative w-12 h-6 rounded-full transition-all duration-300 border-2",style:n.miniMapEnabled?{background:"#4A5D23",borderColor:"#5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)"}:{background:"#2B3A12",borderColor:"#3B4A1C"},children:M.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all duration-300 ${n.miniMapEnabled?"left-6 bg-white":"left-0.5 bg-zinc-400"}`})})]}),M.jsx("p",{className:"text-[9px] mt-2",style:{color:"#9AAF7A"},children:"Shows terrain preview with target locations during gameplay"}),M.jsxs("div",{className:"mt-4",children:[M.jsxs("div",{className:"flex justify-between items-center mb-2",children:[M.jsx("label",{className:"text-zinc-200 text-[11px] sm:text-[12px]",children:"CRT SCANLINES"}),M.jsxs("span",{className:"text-[11px] sm:text-[12px] font-mono",style:{color:"#c9a961"},children:[n.scanlinesIntensity,"%"]})]}),M.jsx("div",{className:"relative",children:M.jsx("input",{type:"range",min:"0",max:"100",value:n.scanlinesIntensity,onChange:m=>c("scanlinesIntensity",parseInt(m.target.value)),className:"w-full h-3 appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(to right, #5A6D33 0%, #5A6D33 ${n.scanlinesIntensity}%, #2B3A12 ${n.scanlinesIntensity}%, #2B3A12 100%)`}})}),M.jsxs("div",{className:"flex justify-between text-[9px] mt-1",style:{color:"#9AAF7A"},children:[M.jsx("span",{children:"OFF"}),M.jsx("span",{children:"MAX"})]})]})]})]}),M.jsxs("div",{className:"flex gap-2 px-4 py-3",style:{borderTop:"2px solid #4A5D23",background:"rgba(43, 58, 18, 0.5)"},children:[M.jsx("button",{onClick:d,className:"flex-1 py-2 text-[11px] sm:text-[12px] text-zinc-300 rounded transition-colors",style:{background:"#2B3A12",border:"1px solid #3B4A1C"},children:"RESET DEFAULTS"}),M.jsx("button",{onClick:g,className:"flex-1 py-2 text-[11px] sm:text-[12px] text-white rounded transition-colors font-bold",style:{background:"#4A5D23",border:"1px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.3)"},children:"DONE"})]})]})]}):null},Ua=60,Ca=512,M2="#ff0000",b2="#ffaa00",Gp="#5A6D33",jh="#00ff00",x2=3,Up=4,O2=300,qo=16,zp=8,L2=60,N2="#2d3748",D2="#1a202c",w2="rgba(90, 109, 51, 0.3)",$h=Ot.MAP_WIDTH_EXTENDED;Ot.TOTAL_MAP_HEIGHT;class P2{constructor(){this.detectedTerrainWidths=new Map,this.terrainDrawInfoCache=new Map,this.terrainPreviewCache=new Map,this.currentCacheKey=null}getCacheKey(t,n){return`${t}_${n}`}async generateTerrainPreview(t,n){const s=this.getCacheKey(t,n);if(this.terrainPreviewCache.has(s))return this.currentCacheKey=s,this.terrainPreviewCache.get(s);console.log(`[MiniMapRenderer] Generating terrain preview for ${t} level ${n}`);const r=await ba.generateForCampaignAsync(t,n),c=r.fullTerrainCanvas,h=r.detectedWidthGamePixels||$h,d=c.height;this.detectedTerrainWidths.set(s,h);const g=Xn(t,n),m=(g==null?void 0:g.leftX)??0,y=(g==null?void 0:g.rightX)??h,A=ga(t,n).mapWidthExtended,v=document.createElement("canvas");v.width=Ua,v.height=Ca;const b=v.getContext("2d");b.fillStyle="#1a202c",b.fillRect(0,0,Ua,Ca),b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high";const O=h/d,L=Ca,N=Ca*O,x=(Ua-N)/2,I=0;return b.drawImage(c,0,0,c.width,c.height,x,I,N,L),this.terrainDrawInfoCache.set(s,{width:N,height:L,terrainWidth:h,terrainHeight:d,offsetX:x,offsetY:I,terrainBoundaryLeft:m,terrainBoundaryRight:y,mapWidthExtended:A}),this.applyRadarEffect(b),this.terrainPreviewCache.set(s,v),this.currentCacheKey=s,console.log(`[MiniMapRenderer] Terrain preview generated: ${Ua}x${Ca} (terrain ${h}x${d}, draw ${N.toFixed(1)}x${L.toFixed(1)} at ${x.toFixed(1)},${I.toFixed(1)})`),v}applyRadarEffect(t){t.globalCompositeOperation="multiply",t.fillStyle="rgba(100, 255, 150, 0.15)",t.fillRect(0,0,Ua,Ca),t.globalCompositeOperation="source-over",t.fillStyle="rgba(0, 0, 0, 0.03)";for(let n=0;n<Ca;n+=2)t.fillRect(0,n,Ua,1)}render(t,n,s,r,c){const h=this.terrainPreviewCache.get(this.currentCacheKey||"");if(!h){t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,Ua,Ca);return}t.drawImage(h,0,0),this.renderTargets(t,c),this.renderViewport(t,n),this.renderPlayer(t,n,s,r,c)}renderTargets(t,n){const s=ea.getAllTargetsForMiniMap(),r=ea.getTotalMapHeight();if(s.length>0&&Math.floor(n/2e3)%5===0&&(console.log(`[MiniMap] Rendering ${s.length} targets, totalMapHeight=${r}`),s.forEach(x=>console.log(`  Target ${x.id}: x=${x.x.toFixed(0)}, y=${x.y.toFixed(0)}, type=${x.targetType}, destroyed=${x.destroyed}`))),r===0||s.length===0)return;const c=this.terrainDrawInfoCache.get(this.currentCacheKey||""),h=(c==null?void 0:c.terrainWidth)||this.detectedTerrainWidths.get(this.currentCacheKey||"")||$h,d=(c==null?void 0:c.width)||Ua,g=(c==null?void 0:c.height)||Ca,m=(c==null?void 0:c.offsetX)||0,y=(c==null?void 0:c.offsetY)||0,E=(c==null?void 0:c.terrainBoundaryLeft)??0,v=((c==null?void 0:c.terrainBoundaryRight)??h)-E,b=(c==null?void 0:c.mapWidthExtended)??v,O=400,L=n%O/O,N=.5+Math.sin(L*Math.PI*2)*.5;for(const x of s){if(x.destroyed)continue;const I=E+x.x/b*v,G=m+I/h*d,W=y+x.y/r*g,Q=x.targetType==="game-target",j=Q?M2:b2;t.save(),Q?(t.strokeStyle=j,t.lineWidth=2,t.globalAlpha=N,t.shadowColor=j,t.shadowBlur=8,t.beginPath(),t.arc(G,W,5,0,Math.PI*2),t.stroke(),t.globalAlpha=1,t.strokeStyle=j,t.lineWidth=2,t.shadowBlur=4,t.beginPath(),t.moveTo(G-3,W),t.lineTo(G+3,W),t.stroke(),t.beginPath(),t.moveTo(G,W-3),t.lineTo(G,W+3),t.stroke()):(t.fillStyle=j,t.globalAlpha=N,t.shadowColor=j,t.shadowBlur=6,t.beginPath(),t.arc(G,W,x2,0,Math.PI*2),t.fill()),t.restore()}}renderViewport(t,n){const s=ea.getTotalMapHeight();if(s===0)return;const r=this.terrainDrawInfoCache.get(this.currentCacheKey||""),c=(r==null?void 0:r.width)||Ua,h=(r==null?void 0:r.height)||Ca,d=(r==null?void 0:r.offsetX)||0,g=(r==null?void 0:r.offsetY)||0,y=s-n-Y,E=g+y/s*h,A=Y/s*h;t.save(),t.strokeStyle=Gp,t.lineWidth=1,t.globalAlpha=.8,t.shadowColor=Gp,t.shadowBlur=3,t.strokeRect(d+1,E,c-2,A),t.restore()}renderPlayer(t,n,s,r,c){const h=ea.getTotalMapHeight();if(h===0)return;const d=this.terrainDrawInfoCache.get(this.currentCacheKey||"");d!=null&&d.terrainWidth||this.detectedTerrainWidths.get(this.currentCacheKey||"");const g=(d==null?void 0:d.width)||Ua,m=(d==null?void 0:d.height)||Ca,y=(d==null?void 0:d.offsetX)||0,E=(d==null?void 0:d.offsetY)||0,v=h-n-(Y-r),b=E+v/h*m,L=s/600;let N=y+L*g;const x=Up+3;N=Math.max(y+x,Math.min(y+g-x,N));const I=300,G=c%I/I,W=.5+Math.sin(G*Math.PI*2)*.5;t.save();const Q=Up+2;t.strokeStyle=jh,t.lineWidth=1.5,t.globalAlpha=W,t.shadowColor=jh,t.shadowBlur=6,t.beginPath(),t.arc(N,b,Q,0,Math.PI*2),t.stroke(),t.globalAlpha=1,t.fillStyle=jh,t.shadowBlur=3,t.beginPath(),t.arc(N,b,2,0,Math.PI*2),t.fill(),t.restore()}clearCache(){this.terrainPreviewCache.clear(),this.detectedTerrainWidths.clear(),this.terrainDrawInfoCache.clear(),this.currentCacheKey=null}isPreviewReady(t,n){return this.terrainPreviewCache.has(this.getCacheKey(t,n))}}const kp=new P2;function C2({campaign:o,level:t,scrollY:n,playerX:s,playerY:r,visible:c,containerWidth:h,canvasBounds:d}){const g=Z.useRef(null),[m,y]=Z.useState(!1),E=Z.useRef(0),A=Z.useRef(""),v=Ua+12,b=Ca+28,O=h-(d.offsetLeft+d.renderWidth),L=d.offsetLeft,N=v+qo*2,x=O>=N,I=L>=N,G=x||I,W=typeof window<"u"&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.matchMedia("(max-width: 768px)").matches),Q=typeof window<"u"?window.innerWidth:h,j=v/Q>.07,q=W&&j,Ee=q?s<P/2:!0;Z.useEffect(()=>{const re=`${o}_${t}`;re!==A.current&&(A.current=re,y(!1),kp.generateTerrainPreview(o,t).then(()=>{y(!0)}).catch(ce=>{console.error("[MiniMap] Failed to generate terrain preview:",ce)}))},[o,t]);const ye=Z.useCallback(()=>{const re=g.current;if(!re||!m||!c)return;const ce=re.getContext("2d");ce&&(ce.clearRect(0,0,Ua,Ca),kp.render(ce,n,s,r,performance.now()),E.current=requestAnimationFrame(ye))},[n,s,r,m,c]);if(Z.useEffect(()=>(c&&m&&(E.current=requestAnimationFrame(ye)),()=>{E.current&&cancelAnimationFrame(E.current)}),[c,m,ye]),!c)return null;const fe={position:"absolute",width:v,height:b,background:`linear-gradient(180deg, ${N2} 0%, ${D2} 100%)`,borderRadius:4,border:"2px solid #5A6D33",boxShadow:`0 0 10px ${w2}, inset 0 0 5px rgba(0, 0, 0, 0.5)`,padding:4,transition:G||!q?"none":`left ${O2}ms ease-out`,zIndex:30,pointerEvents:"none"};if(G){const re=d.offsetTop+d.renderHeight;fe.bottom=`calc(100% - ${re}px + ${qo}px)`,x?(fe.left=d.offsetLeft+d.renderWidth+qo,fe.right="auto"):(fe.left=d.offsetLeft-v-qo,fe.right="auto")}else fe.bottom=L2,Ee?(fe.left=d.offsetLeft+d.renderWidth-v-zp,fe.right="auto"):(fe.left=d.offsetLeft+zp,fe.right="auto");return M.jsxs("div",{style:fe,children:[M.jsx("div",{style:{fontFamily:'"Black Ops One", monospace',fontSize:9,color:"#5A6D33",textAlign:"center",marginBottom:2,textShadow:"0 0 4px #5A6D33",letterSpacing:1},children:"RADAR"}),M.jsxs("div",{style:{position:"relative",width:Ua,height:Ca,borderRadius:2,overflow:"hidden"},children:[M.jsx("div",{style:{position:"absolute",top:0,left:0,width:8,height:8,borderTop:"2px solid #5A6D33",borderLeft:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",top:0,right:0,width:8,height:8,borderTop:"2px solid #5A6D33",borderRight:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:8,height:8,borderBottom:"2px solid #5A6D33",borderLeft:"2px solid #5A6D33"}}),M.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:8,height:8,borderBottom:"2px solid #5A6D33",borderRight:"2px solid #5A6D33"}}),M.jsx("canvas",{ref:g,width:Ua,height:Ca,style:{display:"block",width:Ua,height:Ca,background:"#0a1a0a"}}),M.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.1) 0px, rgba(0, 0, 0, 0.1) 1px, transparent 1px, transparent 2px)",pointerEvents:"none"}}),!m&&M.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#5A6D33",fontSize:10,fontFamily:'"Black Ops One", monospace'},children:"..."})]})]})}const rd="";async function rm(o,t){try{const n=await fetch(`${rd}/api/design/${encodeURIComponent(o.toLowerCase())}/${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return await n.json()}catch(n){return console.error("[DESIGN API] Load failed:",n),{success:!1,error:n instanceof Error?n.message:"Failed to load design overrides"}}}async function om(o,t,n){try{const s=await fetch(`${rd}/api/design/${encodeURIComponent(o.toLowerCase())}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return await s.json()}catch(s){return console.error("[DESIGN API] Save failed:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save design overrides"}}}async function I2(o,t,n,s,r=!1){try{const c=await fetch(`${rd}/api/design/generate-destroyed-overlay`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({overlayId:o,imageData:t,width:n,height:s,regenerate:r})});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);return await c.json()}catch(c){return console.error("[DESIGN API] Generate destroyed overlay failed:",c),{success:!1,error:c instanceof Error?c.message:"Failed to generate destroyed overlay"}}}const B2=Object.freeze(Object.defineProperty({__proto__:null,generateDestroyedOverlay:I2,loadDesignOverrides:rm,saveDesignOverrides:om},Symbol.toStringTag,{value:"Module"})),rc=60,ec=new Map,Zo=new Map;function F2(o,t,n,s,r){const c=(t+s)*2+20,h=c/2;let d="";const g=Math.PI*2/o;for(let m=0;m<o;m++){const y=r+m*g,E=Math.cos(y),A=Math.sin(y),v=h+E*s,b=h+A*s,O=h+E*(s+t),L=h+A*(s+t);d+=`
      <line x1="${v+1}" y1="${b+1}" x2="${O+1}" y2="${L+1}"
            stroke="#1a1a1a" stroke-width="${n+2}"
            stroke-linecap="round" opacity="0.5"/>
    `,d+=`
      <line x1="${v}" y1="${b}" x2="${O}" y2="${L}"
            stroke="#333333" stroke-width="${n}"
            stroke-linecap="round"/>
    `,d+=`
      <line x1="${v}" y1="${b}" x2="${O}" y2="${L}"
            stroke="#555555" stroke-width="${n*.4}"
            stroke-linecap="round"/>
    `}return`
    <svg width="${c}" height="${c}" viewBox="0 0 ${c} ${c}" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="hubGrad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#888888"/>
          <stop offset="70%" stop-color="#555555"/>
          <stop offset="100%" stop-color="#333333"/>
        </radialGradient>
        <radialGradient id="hubCenter" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#444444"/>
          <stop offset="100%" stop-color="#111111"/>
        </radialGradient>
      </defs>
      <!-- Motion blur effect - slight transparency on blades -->
      <g opacity="0.9">
        ${d}
      </g>
      <!-- Hub (center) -->
      <circle cx="${h}" cy="${h}" r="${s}"
              fill="url(#hubGrad)" stroke="#222222" stroke-width="2"/>
      <!-- Hub center bolt -->
      <circle cx="${h}" cy="${h}" r="${s*.35}"
              fill="url(#hubCenter)"/>
    </svg>
  `}function H2(o,t,n){return new Promise((s,r)=>{const c=document.createElement("canvas");c.width=t,c.height=n;const h=c.getContext("2d");if(!h){r(new Error("Could not get 2D context"));return}const d=new Image,g=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),m=URL.createObjectURL(g);d.onload=()=>{h.drawImage(d,0,0,t,n),URL.revokeObjectURL(m),s(c)},d.onerror=()=>{URL.revokeObjectURL(m),r(new Error("Failed to load SVG image"))},d.src=m})}async function Y2(o){if(ec.has(o))return ec.get(o);if(Zo.has(o))return Zo.get(o);const t=Wp[o];if(!t)return console.warn(`No rotor config found for boss type: ${o}`),[];const n=(async()=>{const s=[],r=(t.bladeLength+t.hubRadius)*2+20;for(let c=0;c<rc;c++){const h=c/rc*Math.PI*2,d=F2(t.bladeCount,t.bladeLength,t.bladeWidth,t.hubRadius,h);try{const g=await H2(d,r,r);s.push(g)}catch(g){console.error(`Failed to render rotor frame ${c} for ${o}:`,g);const m=document.createElement("canvas");m.width=r,m.height=r,s.push(m)}}return ec.set(o,s),Zo.delete(o),s})();return Zo.set(o,n),n}function G2(o){Y2(o).catch(t=>{console.error(`Failed to initialize rotors for ${o}:`,t)})}function U2(o,t,n,s,r,c,h,d=1){const g=ec.get(t);if(!g||g.length===0){G2(t);return}const m=Wp[t];if(!m)return;const y=m.baseRotationSpeed*d,E=h*y*(180/Math.PI)/6,A=n+r/2,v=s+c/2,b=g[0].width;m.positions.forEach((O,L)=>{let x=Math.floor(E*(L===0||L===2?1:-1))%rc;x<0&&(x+=rc);const I=g[x];if(!I)return;const G=A+O.x*(r/2)-b/2,W=v+O.y*(c/2)-b/2;o.drawImage(I,G,W)})}const z2={pacific:{name:"Pacific Jungle",colors:["#4A5D23","#3B4A1C","#2B3A12","#5A6D33","#6B5B3D"],weights:[.3,.25,.2,.15,.1]},european:{name:"European Theater",colors:["#4B5320","#3D4518","#5C6428","#6E7B4A","#454B32"],weights:[.35,.25,.2,.1,.1]},desert:{name:"Desert Sand",colors:["#C4A35A","#8B7355","#A68B5B","#D4B896","#6B5D4A"],weights:[.3,.25,.2,.15,.1]},splinter:{name:"Splinter Pattern",colors:["#5C6B4A","#3D4A32","#8B7355","#4A5D3A","#2B3520"],weights:[.25,.25,.2,.2,.1]},british:{name:"British DPM",colors:["#5A5D23","#3B3A1C","#6B5B3D","#4A4D33","#2B2A12"],weights:[.3,.25,.2,.15,.1]},steel:{name:"Industrial Steel",colors:["#4A4A4A","#5A5A5A","#3A3A3A","#6A6A6A","#333333"],weights:[.3,.25,.2,.15,.1]}};function k2(o){return()=>(o=o*1103515245+12345&2147483647,o/2147483647)}function V2(o,t,n=50,s){const r=[],c=new Set;for(;r.length<t;){const d=Math.floor(s()*o.length);c.has(d)||(c.add(d),r.push({...o[d]}))}let h=r.map((d,g)=>({centroid:d,points:[],colorIndex:g%5}));for(let d=0;d<n;d++){h.forEach(m=>m.points=[]),o.forEach(m=>{let y=1/0,E=0;h.forEach((A,v)=>{const b=Math.hypot(m.x-A.centroid.x,m.y-A.centroid.y);b<y&&(y=b,E=v)}),h[E].points.push(m)});let g=!0;if(h.forEach(m=>{if(m.points.length===0)return;const y=m.points.reduce((A,v)=>A+v.x,0)/m.points.length,E=m.points.reduce((A,v)=>A+v.y,0)/m.points.length;(Math.abs(y-m.centroid.x)>.1||Math.abs(E-m.centroid.y)>.1)&&(g=!1),m.centroid={x:y,y:E}}),g)break}return h}function W2(o){if(o.length<3)return o;let t=o[0];o.forEach(r=>{(r.y<t.y||r.y===t.y&&r.x<t.x)&&(t=r)});const n=o.slice().sort((r,c)=>{const h=Math.atan2(r.y-t.y,r.x-t.x),d=Math.atan2(c.y-t.y,c.x-t.x);return h-d}),s=[];return n.forEach(r=>{for(;s.length>=2;){const c=s[s.length-2],h=s[s.length-1];if((h.x-c.x)*(r.y-c.y)-(h.y-c.y)*(r.x-c.x)<=0)s.pop();else break}s.push(r)}),s}function X2(o,t,n,s,r,c){const h=k2(c.seed),d=z2[c.palette],g=d.colors,m=c.opacity??1,y=c.numClusters,E=c.pointDensity;o.save(),o.globalAlpha=m,o.fillStyle=g[0],o.fillRect(t,n,s,r);const A=Math.floor(s*r*E),v=[];for(let O=0;O<A;O++)v.push({x:t+h()*s,y:n+h()*r});const b=V2(v,y,50,h);b.forEach(O=>{let L=0;const N=h();for(let x=0;x<d.weights.length;x++)if(L+=d.weights[x],N<L){O.colorIndex=x;break}}),o.globalAlpha=m*.9,b.forEach(O=>{if(O.points.length<3)return;const L=W2(O.points);if(L.length<3)return;o.fillStyle=g[O.colorIndex],o.beginPath();const N=O.centroid,x=L.map(I=>({x:N.x+(I.x-N.x)*1.15,y:N.y+(I.y-N.y)*1.15}));o.moveTo(x[0].x,x[0].y);for(let I=0;I<x.length;I++){const G=x[(I-1+x.length)%x.length],W=x[I],Q=x[(I+1)%x.length],j=x[(I+2)%x.length],q=W.x+(Q.x-G.x)/6,Ee=W.y+(Q.y-G.y)/6,ye=Q.x-(j.x-W.x)/6,fe=Q.y-(j.y-W.y)/6;o.bezierCurveTo(q,Ee,ye,fe,Q.x,Q.y)}o.closePath(),o.fill()}),o.restore()}const D=new f2;mt.BEGINNER,mt.NORMAL,mt.VETERAN;const zn=Dy;function cm(o){return ml(o).storyText}function um(o){return ml(o).endingText}cm(pe.STEEL_VANGUARD);const pl=um(pe.STEEL_VANGUARD),pr=(o,t)=>{var r,c;const n=o.spriteVariant||0;switch(o.type===S.CRASHING_AIRCRAFT&&o.originalType?o.originalType:o.type){case S.PLAYER:return t.player;case S.ENEMY_RED:return t.enemyRed;case S.ENEMY_BIG:return t.enemyBig[n%3];case S.ENEMY_BATTLESHIP:return t.battleship[n%3];case S.ENEMY_TANK:return((r=t.tank)==null?void 0:r[n%3])||t.enemySmall[0];case S.ENEMY_LARGE_TANK:return((c=t.largeTank)==null?void 0:c[n%3])||t.enemyBig[0];case S.BULLET_PLAYER:return t.bulletPlayer;case S.BULLET_ENEMY:return t.bulletEnemy;case S.BULLET_TURRET:return t.bulletTurret;case S.POWERUP:if(o.powerupType===ma.BOMB)switch(o.bombTier||ya.STANDARD){case ya.HEAVY:return t.bombTier2;case ya.CLUSTER:return t.bombTier3;case ya.MEGA:return t.bombTier4;default:return t.bombTier1}return o.powerupType===ma.FIREPOWER?(o.firepowerTier||za.STANDARD)===za.ENHANCED?t.powerupFirepowerEnhanced:t.powerupFirepower:o.powerupType===ma.INVINCIBILITY?t.powerupInvincibility:t.powerupFirepower;case S.EXPLOSION:return t.explosion;case S.BOMB_DROPPED:return t.bombDropped;case S.ENEMY_SMALL:return t.enemySmall[n%3];case S.ENEMY_HELICOPTER:const h=Math.floor(o.frame||0);return t.enemyHelicopter[h%2];case S.BOSS:if(o.variantSprite&&t[o.variantSprite])return t[o.variantSprite];switch(o.bossType){case Ia.ACE_SQUADRON:return t.bossAceSquadron;case Ia.FLYING_FORTRESS:return t.bossFlyingFortress;case Ia.SUPER_BATTLESHIP:return t.bossSuperBattleship;case Ia.EXPERIMENTAL_AIRSHIP:return t.bossExperimentalAirship;case Ia.ULTIMATE_WEAPON:return t.bossUltimateWeapon;default:return t.enemyBig[0]}case S.SUPPORT_FIGHTER:return t.player;default:return t.enemySmall[0]}},j2=()=>{const o=Z.useRef(null),t=Z.useRef(null);Z.useRef(1);const[n,s]=Z.useState(te.ATTRACT),[r,c]=Z.useState(0),[h,d]=Z.useState(1e4),[g,m]=Z.useState(3),[y,E]=Z.useState(0),[A,v]=Z.useState(10),[b,O]=Z.useState(0),[L,N]=Z.useState(1),[x,I]=Z.useState(pe.STEEL_VANGUARD),[G,W]=Z.useState(mt.NORMAL),[Q,j]=Z.useState(0),[q,Ee]=Z.useState(0),[ye,fe]=Z.useState(0),[re,ce]=Z.useState([]),[Te,at]=Z.useState([]),[U,se]=Z.useState(!1),[_e,Qe]=Z.useState(!1),et=S2(),[C,ee]=Z.useState(!0),[le,ue]=Z.useState(null),[Le,K]=Z.useState(0),[xe,de]=Z.useState(!1),[Ue,ta]=Z.useState(0),[xa,Os]=Z.useState(100),[jn,si]=Z.useState(100),[$n,qn]=Z.useState({show:!1,targetLevel:0}),[gc,Zn]=Z.useState(!1),[_l,fn]=Z.useState(!1),[Ar,Al]=Z.useState(!1),[Ls,Ea]=Z.useState(me.isMutedState()),[pc,Sr]=Z.useState(0),[Sl,Ns]=Z.useState({x:P/2,y:Y-100}),[mc,Tr]=Z.useState(Bt.getSettings().miniMapEnabled),[Ds,yc]=Z.useState({offsetLeft:0,offsetTop:0,renderWidth:0,renderHeight:0}),_a=Z.useRef(null),Ba=Z.useRef(null),Va=Z.useRef([]),Fa=Z.useRef(0);Z.useRef(new tm);const Tl=Z.useRef(0),vl=Z.useRef(!1),Rl=Z.useRef(0),Wa=Z.useRef({}),gn=Z.useRef(!1),pn=Z.useRef(!1),Oi=Z.useRef(!1),mn=Z.useRef(0),Kn=300,vr=Z.useRef(te.ATTRACT),Wi=Z.useMemo(()=>_a.current?{firepower:_a.current.powerupFirepower.toDataURL(),firepowerEnhanced:_a.current.powerupFirepowerEnhanced.toDataURL(),bomb:_a.current.powerupBomb.toDataURL(),invincibility:_a.current.powerupInvincibility.toDataURL(),enemyFighter:_a.current.enemySmall[0].toDataURL()}:null,[_a.current]),Qn=Z.useCallback(F=>{if(!o.current)return null;const p=o.current.getBoundingClientRect(),Ae=P/Y,ct=p.width/p.height;let Xe,Ct,yt,Lt;ct>Ae?(Ct=p.height,Xe=p.height*Ae,yt=(p.width-Xe)/2,Lt=0):(Xe=p.width,Ct=p.width/Ae,yt=0,Lt=(p.height-Ct)/2);const $t=F.clientX-p.left-yt,Ft=F.clientY-p.top-Lt,It=$t/Xe*P,Ht=Ft/Ct*Y;return{x:It,y:Ht}},[]),Ci=Z.useCallback(()=>{if(!o.current||!t.current)return;o.current;const F=t.current.getBoundingClientRect(),p=P/Y,Ae=F.width/F.height;let ct,Xe,Ct,yt;Ae>p?(Xe=F.height,ct=F.height*p,Ct=(F.width-ct)/2,yt=0):(ct=F.width,Xe=F.width/p,Ct=0,yt=(F.height-Xe)/2),yc({offsetLeft:Ct,offsetTop:yt,renderWidth:ct,renderHeight:Xe})},[]);Z.useEffect(()=>(Ci(),window.addEventListener("resize",Ci),()=>window.removeEventListener("resize",Ci)),[Ci]),Z.useEffect(()=>{if(C)return;const p=vr.current!==n;n===te.ATTRACT?me.playIntroMusic():n===te.STORY?me.playStoryMusic(D.campaign):n===te.VICTORY&&p?(me.playEndingMusic(D.campaign),Ee(0),Qe(!1),e2(D.campaign).then(Ae=>{console.log(`[LAZY] ${D.campaign} victory panels loaded`),at(Ae),Qe(!0)}).catch(Ae=>console.error("[LAZY] Failed to load campaign victory panels:",Ae))):n===te.ENDING||n===te.GAME_OVER&&me.playGameOverMusic(),vr.current=n},[n,C]);const Ec=async F=>{ee(!0),ue(null),K(0);try{console.log("[LOAD] Starting asset load...");const p=await i2(F,Ae=>{console.log("[LOAD] Title screen available! Displaying immediately..."),Ba.current=Ae},void 0,Ae=>{K(Ae)});console.log("[LOAD] Assets loaded successfully!"),_a.current=p,Vn.setSprites(p.cloud,p.fogPatch,p.sandParticle),ee(!1)}catch(p){console.error("[LOAD] Failed to load assets:",p),ue(p instanceof Error?p.message:"Failed to load game assets"),ee(!1)}};Z.useEffect(()=>{const F={current:!0},p=setTimeout(()=>{F.current&&(console.error("[LOAD] Asset loading timeout after 30 seconds"),ue("Loading timeout - Please check your connection and refresh"))},3e4);return Ec(!1).finally(()=>{F.current=!1}),()=>{clearTimeout(p),F.current=!1}},[]),Z.useEffect(()=>{window.gameAPI={insertCoin:()=>{console.log("API: Inserting Coin"),D.insertCoin(),E(D.credits),v(D.totalCreditsRemaining),me.init()},startGame:()=>{console.log("API: Starting Game"),D.credits>0?(D.startGame(),E(D.credits),v(D.totalCreditsRemaining),j(0),me.init()):console.warn("API: Cannot start game. No credits.")},getState:()=>({state:D.state,credits:D.credits,level:D.level}),setControls:F=>{console.log("API: Controls set (not fully implemented)",F)}}},[]);const Rr=Z.useCallback(async()=>{const F=V.getLevelInfo(),p=V.getPendingChanges();console.log("[DESIGN] Saving overrides to server...");const Ae=await om(F.campaign,F.level,p);Ae.success?(V.markSaved(),console.log("[DESIGN] Saved successfully:",Ae.filepath),alert(`Design changes saved to ${Ae.filepath||"server"}`)):(console.error("[DESIGN] Save failed:",Ae.error),alert(`Save failed: ${Ae.error}`))},[]),Mr=Z.useCallback(async()=>{const F=V.getLevelInfo();console.log("[DESIGN] Loading overrides from server...");const p=await rm(F.campaign,F.level);p.success&&p.data?(V.loadOverrides(p.data),console.log("[DESIGN] Loaded successfully"),alert("Design overrides loaded from server")):p.success&&!p.data?alert("No saved overrides found for this level"):(console.error("[DESIGN] Load failed:",p.error),alert(`Load failed: ${p.error}`))},[]),ws=Z.useCallback(F=>{var p,Ae,ct;if((Ra.EVADE.includes(F.key)||Ra.FIRE.includes(F.key)||Ra.BOMB.includes(F.key))&&F.preventDefault(),Wa.current[F.key]=!0,F.key==="Escape"){if(D.state===te.DESIGN_MODE){V.hasUnsavedChanges()?Zn(!0):(D.toggleDesignMode(),s(D.state));return}D.state!==te.PAUSED&&D.pause();return}if(D.state===te.DESIGN_MODE){const Xe=document.activeElement;if(Xe instanceof HTMLInputElement||Xe instanceof HTMLTextAreaElement||Xe instanceof HTMLSelectElement)return;const yt=F.shiftKey?10:1,Lt=5,$t=5;if(F.ctrlKey||F.metaKey){if(F.shiftKey&&!F.altKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustSingleBoundary("left",-$t);return;case"ArrowRight":F.preventDefault(),V.adjustSingleBoundary("left",$t);return}else if(F.altKey&&!F.shiftKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustSingleBoundary("right",-$t);return;case"ArrowRight":F.preventDefault(),V.adjustSingleBoundary("right",$t);return}else if(!F.shiftKey&&!F.altKey)switch(F.key){case"ArrowLeft":F.preventDefault(),V.adjustBoundaryWidth(-Lt);return;case"ArrowRight":F.preventDefault(),V.adjustBoundaryWidth(Lt);return}}const Ft=V.getState().selectedElement!==null;switch(F.key){case"ArrowUp":F.preventDefault(),Ft&&V.nudgeSelected(0,yt);break;case"ArrowDown":F.preventDefault(),Ft&&V.nudgeSelected(0,-yt);break;case"ArrowLeft":F.preventDefault(),Ft?V.nudgeSelected(-yt,0):V.adjustTerrainHorizontalOffset(-yt);break;case"ArrowRight":F.preventDefault(),Ft?V.nudgeSelected(yt,0):V.adjustTerrainHorizontalOffset(yt);break;case"Delete":case"Backspace":F.preventDefault();const Ht=V.getState().selectedElement;(Ht==null?void 0:Ht.type)==="added-path"&&Ht.selectedVertexIndex!==void 0?V.deleteSelectedVertex():V.deleteSelected();break;case"Home":F.preventDefault(),V.jumpToTop();break;case"End":F.preventDefault(),V.jumpToBottom();break;case"PageUp":F.preventDefault(),V.pageScroll(1);break;case"PageDown":F.preventDefault(),V.pageScroll(-1);break;case"s":case"S":F.preventDefault();const qe=V.getPendingChanges(),We=V.getLevelInfo(),li={campaign:We.campaign,level:We.level,timestamp:new Date().toISOString(),...qe};navigator.clipboard.writeText(JSON.stringify(li,null,2)).then(()=>{console.log("[DESIGN MODE] Changes copied to clipboard"),V.markSaved()}).catch(je=>console.error("[DESIGN MODE] Failed to copy:",je));break;case"n":case"N":F.preventDefault();const Xa=V.getPlacementMode(),Yt=["none","turret","game-target","path"],sa=Yt.indexOf(Xa),Oa=Yt[(sa+1)%Yt.length];V.setPlacementMode(Oa),console.log(`[DESIGN MODE] Placement mode: ${Oa}`);break;case"Escape":F.preventDefault(),V.getState().isDrawingPath?(V.cancelPathDrawing(),console.log("[DESIGN MODE] Path drawing cancelled")):V.getPlacementMode()!=="none"?(V.setPlacementMode("none"),console.log("[DESIGN MODE] Placement mode cancelled")):V.clearSelection();break;case"Enter":F.preventDefault(),V.getState().isDrawingPath&&(V.finishPathDrawing(),console.log("[DESIGN MODE] Path drawing finished"));break;case"[":case"]":F.preventDefault();const vt=V.getState().selectedElement;if(vt){const je=F.shiftKey?F.key==="["?-1:1:F.key==="["?-10:10;if(vt.type==="turret"){const Fe=((p=V.getEntityMetadata(vt.id))==null?void 0:p.hp)??30,He=Math.max(1,Fe+je);V.updateEntityMetadata(vt.id,{hp:He}),console.log(`[DESIGN MODE] Turret HP: ${He}`)}else if(vt.type==="target"){const Fe=F.shiftKey?F.key==="["?-100:100:F.key==="["?-1e3:1e3,He=((Ae=V.getEntityMetadata(vt.id))==null?void 0:Ae.points)??5e3,Me=Math.max(100,He+Fe);V.updateEntityMetadata(vt.id,{points:Me}),console.log(`[DESIGN MODE] Target Points: ${Me}`)}}break;case",":case".":F.preventDefault();const De=V.getState().selectedElement;if(De&&De.type==="turret"){const je=F.shiftKey?F.key===","?-.5:.5:F.key===","?-.1:.1,Fe=((ct=V.getEntityMetadata(De.id))==null?void 0:ct.fireRate)??1.5,He=Math.max(.1,Math.round((Fe+je)*10)/10);V.updateEntityMetadata(De.id,{fireRate:He}),console.log(`[DESIGN MODE] Turret Fire Rate: ${He}`)}break}const It=parseInt(F.key);if(!isNaN(It)&&It>=1&&It<=9){F.preventDefault();const Ht=V.getLevelInfo(),qe=nd(Ht.campaign);It<=qe&&It!==Ht.level&&(V.hasUnsavedChanges()?qn({show:!0,targetLevel:It}):D.switchDesignModeLevel(It))}return}if(D.state===te.PAUSED){if(F.key==="ArrowUp")D.pauseSelection=Math.max(0,D.pauseSelection-1);else if(F.key==="ArrowDown")D.pauseSelection=Math.min(3,D.pauseSelection+1);else if(F.key==="Enter"||F.key===" ")if(D.pauseSelection===0)D.resume();else if(D.pauseSelection===1)Al(!0),fn(!0);else if(D.pauseSelection===2){const Xe=!me.isMutedState();me.setMuted(Xe),Ea(Xe),Xe||me.playLevelMusic(D.level,D.campaign)}else D.quitToTitle(),v(D.totalCreditsRemaining);return}if(Ra.COIN.includes(F.key)&&(me.unlockAudio(),D.insertCoin(),E(D.credits),v(D.totalCreditsRemaining)),Ra.START.includes(F.key)&&!C&&D.state===te.ATTRACT){me.unlockAudio(),D.startGame(),E(D.credits),v(D.totalCreditsRemaining),j(0);const Xe=Np(x);n2(Xe).catch(Ct=>console.warn("[PROGRESSIVE] Could not preload campaign story thumbnails:",Ct)),se(!1),Lp(x).then(Ct=>{console.log(`[LAZY] ${x} story panels loaded for story mode`),ce(Ct),se(!0)}).catch(Ct=>console.error("[LAZY] Failed to load campaign story panels:",Ct))}if(D.state===te.ATTRACT&&(me.playTitleMusic(),Ra.UP.includes(F.key)&&I(Xe=>{const yt=(zn.indexOf(Xe)-1+zn.length)%zn.length,Lt=zn[yt];D.setCampaign(Lt);const $t={[pe.DAWN_PATROL]:mt.BEGINNER,[pe.STEEL_VANGUARD]:mt.NORMAL,[pe.HELLFIRE_HORIZON]:mt.VETERAN};return W($t[Lt]),me.playMenuSelect(),Lt}),Ra.DOWN.includes(F.key)&&I(Xe=>{const yt=(zn.indexOf(Xe)+1)%zn.length,Lt=zn[yt];D.setCampaign(Lt);const $t={[pe.DAWN_PATROL]:mt.BEGINNER,[pe.STEEL_VANGUARD]:mt.NORMAL,[pe.HELLFIRE_HORIZON]:mt.VETERAN};return W($t[Lt]),me.playMenuSelect(),Lt})),D.state===te.STORY&&((Ra.RIGHT.includes(F.key)||Ra.FIRE.includes(F.key)||F.code==="Space")&&(Q<4?j(Xe=>Xe+1):D.startMission()),Ra.LEFT.includes(F.key)&&Q>0&&j(Xe=>Xe-1)),F.key==="Control"){const Xe=Date.now();Xe-Rl.current<300?(xi&&(D.state===te.PLAYING||D.state===te.BOSS_INTRO||D.state===te.BOSS_BATTLE||D.state===te.DESIGN_MODE)&&(D.state===te.DESIGN_MODE&&V.hasUnsavedChanges()?Zn(!0):(D.toggleDesignMode(),s(D.state))),Rl.current=0):Rl.current=Xe}if((F.key==="d"||F.key==="D")&&(D.debugMode=!D.debugMode,console.log(`[DEBUG] Debug mode: ${D.debugMode?"ON":"OFF"}`)),F.code==="Space"||F.key===" "){const Xe=Date.now();Xe-Tl.current<250?(vl.current=!0,Tl.current=0):Tl.current=Xe}},[C,Q]),Jn=Z.useCallback(F=>{Wa.current[F.key]=!1},[]),es=Z.useCallback(F=>{if(Bt.getSettings().controlScheme==="wasd"&&F.target===o.current)if(F.button===0){gn.current=!0;const p=Date.now();p-mn.current<Kn?(Oi.current=!0,mn.current=0):mn.current=p}else F.button===2&&(pn.current=!0)},[]),Ps=Z.useCallback(F=>{F.button===0?gn.current=!1:F.button===2&&(pn.current=!1)},[]),Cs=Z.useCallback(F=>{Bt.getSettings().controlScheme==="wasd"&&F.target===o.current&&F.preventDefault()},[]);Z.useEffect(()=>{D.setDifficulty(G)},[G]),Z.useEffect(()=>{const F=async p=>{const Ae=o.current;if(!Ae)return console.error("[TERRAIN CAPTURE] Canvas not available"),null;if(!Ae.getContext("2d"))return console.error("[TERRAIN CAPTURE] Canvas context not available"),null;try{const Xe=V.getState(),Ct=Xe.designScrollX,yt=Xe.designScrollY,Lt=gt.getTotalMapHeight()||Ot.TOTAL_MAP_HEIGHT,$t=V.getLevelInfo(),Ft=ga($t.campaign,$t.level),It=Math.floor((Ft.mapWidthExtended-P)/2),Ht=V.getTerrainHorizontalOffset(),qe=Lt-yt,We=p.x-It-Ct+Ht,li=Y-(qe-p.y),Xa=Y-(qe-(p.y+p.height)),Yt=Math.min(li,Xa);console.log(`[TERRAIN CAPTURE] World coords: (${p.x}, ${p.y}) ${p.width}x${p.height}`),console.log(`[TERRAIN CAPTURE] Screen coords: (${We}, ${Yt})`);const sa=document.createElement("canvas");sa.width=P,sa.height=Y;const Oa=sa.getContext("2d");if(!Oa)return console.error("[TERRAIN CAPTURE] Failed to create terrain context"),null;D.tilemapEnabled&&Wh()?(Cp(Oa,yt,P/2,!0),Ip(Oa,yt,P/2,!0)):(console.warn("[TERRAIN CAPTURE] Tilemap not ready, capturing from main canvas as fallback"),Oa.drawImage(Ae,0,0));const vt=document.createElement("canvas");vt.width=p.width,vt.height=p.height;const De=vt.getContext("2d");if(!De)return console.error("[TERRAIN CAPTURE] Failed to create offscreen context"),null;De.drawImage(sa,We,Yt,p.width,p.height,0,0,p.width,p.height);const Fe=vt.toDataURL("image/png").replace(/^data:image\/png;base64,/,"");return console.log(`[TERRAIN CAPTURE] Captured ${p.width}x${p.height} area, base64 length: ${Fe.length}`),Fe}catch(Xe){return console.error("[TERRAIN CAPTURE] Error capturing terrain:",Xe),null}};V.setTerrainCaptureCallback(F),console.log("[TERRAIN CAPTURE] Callback registered")},[]),Z.useEffect(()=>{const F=()=>{const Ae=_a.current;Ae&&(Ae.turretBaseAA&&Ae.turretCannonAA&&!gt.hasTurretSprites("aa")&&(gt.setTurretSprites("aa",Ae.turretBaseAA,Ae.turretCannonAA),console.log("[TURRETS] Connected AA turret sprites")),Ae.turretBaseFortress&&Ae.turretCannonFortress&&!gt.hasTurretSprites("fortress")&&(gt.setTurretSprites("fortress",Ae.turretBaseFortress,Ae.turretCannonFortress),console.log("[TURRETS] Connected Fortress turret sprites")),Ae.turretBaseNaval&&Ae.turretCannonNaval&&!gt.hasTurretSprites("naval")&&(gt.setTurretSprites("naval",Ae.turretBaseNaval,Ae.turretCannonNaval),console.log("[TURRETS] Connected Naval turret sprites")))};F();const p=setInterval(F,1e3);return()=>clearInterval(p)},[C]),Z.useEffect(()=>(window.addEventListener("keydown",ws),window.addEventListener("keyup",Jn),()=>{window.removeEventListener("keydown",ws),window.removeEventListener("keyup",Jn)}),[ws,Jn]),Z.useEffect(()=>(window.addEventListener("mousedown",es),window.addEventListener("mouseup",Ps),window.addEventListener("contextmenu",Cs),()=>{window.removeEventListener("mousedown",es),window.removeEventListener("mouseup",Ps),window.removeEventListener("contextmenu",Cs)}),[es,Ps,Cs]),Z.useEffect(()=>{const F=t.current;if(!F)return;const p=()=>{Sr(F.clientWidth)};p();const Ae=new ResizeObserver(p);return Ae.observe(F),()=>Ae.disconnect()},[]),Z.useEffect(()=>Bt.subscribe(p=>{Tr(p.miniMapEnabled)}),[]),Z.useEffect(()=>{const F=o.current;if(!F)return;const p=F.getContext("2d");if(!p)return;let Ae,ct=0;const Xe=1e3/Fy;let Ct=performance.now(),yt=0,Lt=0,$t=performance.now();const Ft=It=>{if(Lt++,It-$t>5e3){const De=Lt/5;console.log(`[FREEZE DEBUG] FPS: ${De.toFixed(1)}, Entities: ${D.entities.length}, Particles: ${ve.getCount()}`),De<30&&console.warn(`[FREEZE DEBUG] LOW FPS WARNING! ${De.toFixed(1)} fps with ${D.entities.length} entities`),Lt=0,$t=It}jo.startFrame();let Ht=It-Ct;Ct=It,Ht>250&&(Ht=250),yt+=Ht;const qe=_a.current;if(!qe){requestAnimationFrame(Ft);return}const li=qe.ocean,Xa=Math.max(0,D.level-1)%5,Yt=li[Xa];if(C||le){if(p.fillStyle="#000000",p.fillRect(0,0,P,Y),le){p.font='18px "Black Ops One"',p.fillStyle=lt.RED,p.textAlign="center",p.fillText("LOADING ERROR",P/2,Y/2-60),p.font='12px "Black Ops One"',p.fillStyle=lt.WHITE;const De=le.split(" ");let je="",Fe=Y/2-20;De.forEach(Me=>{const be=je+Me+" ";p.measureText(be).width>P-40&&je.length>0?(p.fillText(je,P/2,Fe),je=Me+" ",Fe+=20):je=be}),p.fillText(je,P/2,Fe),p.fillStyle=lt.YELLOW,p.font='14px "Black Ops One"';const He=.5+Math.sin(Date.now()/500)*.5;p.globalAlpha=He,p.fillText("PRESS F5 TO RETRY",P/2,Y/2+80),p.globalAlpha=1}Ae=requestAnimationFrame(Ft);return}let sa=0;const Oa=5;for(;yt>=Xe&&sa<Oa;){const De=Bt.getSettings().controlScheme==="wasd",je={left:Ra.LEFT.some(Me=>Wa.current[Me]),right:Ra.RIGHT.some(Me=>Wa.current[Me]),up:Ra.UP.some(Me=>Wa.current[Me]),down:Ra.DOWN.some(Me=>Wa.current[Me]),fire:Ra.FIRE.some(Me=>Wa.current[Me])||De&&gn.current,evade:Ra.EVADE.some(Me=>Wa.current[Me]),bomb:Ra.BOMB.some(Me=>Wa.current[Me])||vl.current||De&&(pn.current||Oi.current)};vl.current=!1,Oi.current=!1;const Fe=gl.getInputState(),He=gl.mergeWithKeyboardInput(je,Fe);D.handleInput(He),D.update(),yt-=Xe,sa++}sa>=Oa&&(yt=0),s(D.state),c(D.score),d(D.highScore),m(D.lives),E(D.credits),v(D.totalCreditsRemaining),O(D.bombCount),N(D.level),ta(D.combo),Os(D.playerHealth),si(D.maxPlayerHealth);const vt=jo.getSettings();if(ve.setPerformanceSettings(vt.enableParticles,vt.particleMultiplier,vt.maxParticles),ve.update(),p.imageSmoothingEnabled=!1,p.fillStyle="#000",p.fillRect(0,0,P,Y),D.state===te.PLAYING||D.state===te.PAUSED||D.state===te.DESIGN_MODE||D.state===te.BOSS_INTRO||D.state===te.BOSS_BATTLE||D.state===te.LEVEL_COMPLETE||D.state===te.GAME_OVER){ct=(ct+2)%256,p.save();const De=D.camera,Fe=1+(De.zoom-1)*ei.PARALLAX_SEA_LEVEL,He=De.zoom;if(p.translate(P/2,Y/2),p.scale(Fe,Fe),p.rotate(De.rotation),p.translate(-P/2+De.x,-Y/2+De.y),D.screenShake>0){const T=(Math.random()-.5)*D.screenShake,ge=(Math.random()-.5)*D.screenShake,ie=At.SCREEN_SHAKE_ROTATION,oe=(Math.random()-.5)*ie*(D.screenShake/30);p.translate(P/2,Y/2),p.rotate(oe),p.translate(-P/2,-Y/2),p.translate(T,ge)}const Me=D.entities.find(T=>T.type===S.PLAYER),be=(Me==null?void 0:Me.pos.x)??P/2,Je=(Me==null?void 0:Me.pos.y)??Y-100;Ns({x:be,y:Je});const Ie=D.state===te.DESIGN_MODE;if(D.tilemapEnabled&&Wh())Cp(p,D.getEffectiveScrollY(),be,Ie);else if(Yt&&(Yt instanceof HTMLCanvasElement||Yt instanceof HTMLImageElement)&&Yt.width>0&&Yt.height>0){const T=Yt.width;ct=(ct+1)%T,p.save();const ge=Math.ceil(P/T)+1,ie=Math.ceil(Y/T)+1,oe=ct%T-T;for(let he=0;he<ge;he++)for(let Se=0;Se<ie;Se++)p.drawImage(Yt,he*T,oe+Se*T);p.restore()}else p.fillStyle="#000033",p.fillRect(0,0,F.width,F.height);const rt=D.getDynamicTerrainParallaxOffset(be);if(Ie||D.entities.forEach(T=>{if(T.type===S.WAKE){p.save(),p.globalAlpha=T.hp/120*.4,p.strokeStyle="rgba(255, 255, 255, 0.5)",p.lineWidth=2;const ge=T.pos.x-rt,ie=T.pos.y,oe=T.size.width,he=T.size.height*2;p.beginPath(),p.moveTo(ge,ie),p.lineTo(ge-oe,ie-he),p.moveTo(ge,ie),p.lineTo(ge+oe,ie-he),p.stroke(),p.fillStyle="rgba(255, 255, 255, 0.3)",p.beginPath(),p.arc(ge,ie,3+T.size.width*.1,0,Math.PI*2),p.fill(),p.restore()}}),Ie||D.entities.forEach(T=>{if(T.type===S.ENEMY_BATTLESHIP){const ge=pr(T,qe),ie=T.pos.x-rt;p.save(),p.filter="none",p.globalAlpha=.3;const oe=document.createElement("canvas");oe.width=T.size.width,oe.height=T.size.height;const he=oe.getContext("2d");he&&(he.drawImage(ge,0,0,T.size.width,T.size.height),he.globalCompositeOperation="source-in",he.fillStyle="#000000",he.fillRect(0,0,T.size.width,T.size.height),p.drawImage(oe,ie+3,T.pos.y+3)),p.restore(),T.hitFlash&&T.hitFlash>0?(p.save(),p.filter="brightness(2.0)",p.drawImage(ge,ie,T.pos.y,T.size.width,T.size.height),p.restore()):p.drawImage(ge,ie,T.pos.y,T.size.width,T.size.height),T.turrets&&qe.turret&&T.turrets.forEach(Se=>{const Ne=ie+Se.relPos.x,Ye=T.pos.y+Se.relPos.y;p.save(),p.translate(Ne,Ye),p.rotate(Se.angle),(T.hitFlash&&T.hitFlash>0||Se.hitFlash&&Se.hitFlash>0)&&(p.filter="brightness(10) grayscale(1)"),p.drawImage(qe.turret,-18,-18,37,37),p.restore()})}}),D.tilemapEnabled&&Wh()&&Ip(p,D.getEffectiveScrollY(),be,Ie),Ie||(Er.update(16),Er.render(p,D.getEffectiveScrollY(),be)),Ie||D.entities.forEach(T=>{if(T.type===S.ENEMY_TANK||T.type===S.ENEMY_LARGE_TANK){const ge=pr(T,qe),oe=T.pos.x-rt+T.size.width/2,he=T.pos.y+T.size.height/2;p.save(),p.filter="none",p.globalAlpha=.3;const Se=document.createElement("canvas");Se.width=T.size.width,Se.height=T.size.height;const Ne=Se.getContext("2d");Ne&&(Ne.drawImage(ge,0,0,T.size.width,T.size.height),Ne.globalCompositeOperation="source-in",Ne.fillStyle="#000000",Ne.fillRect(0,0,T.size.width,T.size.height),p.translate(oe+2,he+2),T.rotation!==void 0&&p.rotate(T.rotation),p.drawImage(Se,-T.size.width/2,-T.size.height/2)),p.restore(),p.save(),p.translate(oe,he),T.rotation!==void 0&&p.rotate(T.rotation),T.hitFlash&&T.hitFlash>0&&(p.filter="brightness(2.0)"),p.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.restore(),T.turrets&&qe.turret&&T.turrets.forEach(Ye=>{let Pe=Ye.relPos.x-T.size.width/2,$e=Ye.relPos.y-T.size.height/2;if(T.rotation!==void 0){const ha=Math.cos(T.rotation),Kt=Math.sin(T.rotation),Ha=Pe*ha-$e*Kt,Ya=Pe*Kt+$e*ha;Pe=Ha,$e=Ya}const ze=oe+Pe,Ce=he+$e;p.save(),p.translate(ze,Ce),p.rotate(Ye.angle),(T.hitFlash&&T.hitFlash>0||Ye.hitFlash&&Ye.hitFlash>0)&&(p.filter="brightness(10) grayscale(1)");const Gt=T.type===S.ENEMY_LARGE_TANK?32:28;p.drawImage(qe.turret,-Gt/2,-Gt/2,Gt,Gt),p.restore()})}}),D.state!==te.LEVEL_COMPLETE&&(gt.render(p,D.getEffectiveScrollY(),be,Ie),ea.renderCrosshairs(p,D.getEffectiveScrollY(),be)),p.fillStyle="rgba(0, 10, 30, 0.3)",p.fillRect(0,0,P,Y),vt.enableClouds?(Math.random()<.005&&Va.current.push({id:Fa.current++,x:Math.random()*(P-100),y:-100,type:"CLOUD",scale:.8+Math.random()*.4,opacity:.4+Math.random()*.3}),Va.current.forEach(T=>{T.y+=2.5;const ge=qe.cloud;p.globalAlpha=.3,p.drawImage(ge,Math.round(T.x),Math.round(T.y),ge.width*T.scale,ge.height*T.scale),p.globalAlpha=1}),Va.current=Va.current.filter(T=>T.y<Y+100)):Va.current=[],vt.enableClouds&&Vn.isEnabled()&&!V.isEnabled()&&(Vn.setPerformanceMultiplier(vt.particleMultiplier),Vn.render(p)),p.restore(),p.save(),p.translate(P/2,Y/2),p.scale(He,He),p.rotate(De.rotation),p.translate(-P/2+De.x,-Y/2+De.y),D.screenShake>0){const T=(Math.random()-.5)*D.screenShake,ge=(Math.random()-.5)*D.screenShake,ie=At.SCREEN_SHAKE_ROTATION,oe=(Math.random()-.5)*ie*(D.screenShake/30);p.translate(P/2,Y/2),p.rotate(oe),p.translate(-P/2,-Y/2),p.translate(T,ge)}const it=D.getDynamicTerrainParallaxOffset(be);if(!Ie&&vt.enableShadows&&vt.shadowQuality!=="none"&&(p.save(),p.filter="none",p.globalAlpha=vt.shadowQuality==="full"?.5:.3,vt.shadowQuality==="simple"?(p.fillStyle="#000000",D.entities.forEach(T=>{if(T.type===S.EXPLOSION||T.type===S.ENEMY_BATTLESHIP||T.type===S.ENEMY_TANK||T.type===S.ENEMY_LARGE_TANK||T.type===S.PARTICLE||T.type===S.BULLET_CANNON||T.type===S.BULLET_TURRET||T.type===S.BLAST_WAVE||T.type===S.SMOKE||T.type===S.WAKE)return;const ge=T.type===S.PLAYER&&T.isLooping?60:20,ie=T.type===S.PLAYER||T.type===S.BULLET_PLAYER?0:-it;p.fillRect(T.pos.x+ge+ie,T.pos.y+ge,T.size.width,T.size.height)})):D.entities.forEach(T=>{if(T.type===S.EXPLOSION||T.type===S.ENEMY_BATTLESHIP||T.type===S.ENEMY_TANK||T.type===S.ENEMY_LARGE_TANK||T.type===S.PARTICLE||T.type===S.BULLET_CANNON||T.type===S.BULLET_TURRET||T.type===S.BLAST_WAVE||T.type===S.SMOKE||T.type===S.WAKE)return;const ge=pr(T,qe),ie=T.type===S.PLAYER&&T.isLooping,oe=ie?60:20,he=T.type===S.ENEMY_BATTLESHIP?5:oe,Se=T.type===S.PLAYER||T.type===S.BULLET_PLAYER?0:-it,Ne=T.pos.x+he+Se,Ye=T.pos.y+he,Pe=Math.ceil(T.size.width*(ie?1.2:1)),$e=Math.ceil(T.size.height*(ie?1.2:1)),ze=jo.getShadowCanvas(Pe,$e),Ce=ze.getContext("2d");if(!Ce)return;if(Ce.clearRect(0,0,Pe,$e),Ce.filter="none",Ce.globalCompositeOperation="source-over",ie){const Kt=Pe/2,Ha=$e/2;Ce.translate(Kt,Ha),Ce.rotate(D.frameCount*.2),Ce.scale(1.1,1.1),Ce.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),Ce.setTransform(1,0,0,1,0,0)}else if(T.type===S.PLAYER&&T.bankAngle){const Kt=Pe/2,Ha=$e/2;Ce.translate(Kt,Ha),Ce.rotate(T.bankAngle),Ce.drawImage(ge,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),Ce.setTransform(1,0,0,1,0,0)}else Ce.drawImage(ge,0,0,T.size.width,T.size.height);Ce.globalCompositeOperation="source-in",Ce.fillStyle="#000000",Ce.fillRect(0,0,Pe,$e),Ce.globalCompositeOperation="source-over";const Gt=ie?Ne-(Pe-T.size.width)/2:Ne,ha=ie?Ye-($e-T.size.height)/2:Ye;p.drawImage(ze,Gt,ha)}),p.restore()),Ie||D.entities.forEach(T=>{if(T.type===S.PARTICLE||T.type===S.SMOKE||T.type===S.WAKE||T.type===S.BULLET_CANNON||T.type===S.BLAST_WAVE||T.type===S.EXPLOSION||T.type===S.EXPLOSION_SMALL||T.type===S.EXPLOSION_MEDIUM||T.type===S.EXPLOSION_LARGE||T.type===S.EXPLOSION_MASSIVE)return;const ge=T.type===S.PLAYER||T.type===S.BULLET_PLAYER?0:-it;if(T.type===S.BOMB_DROPPED){const ie=qe.bombDropped;if(ie){const oe=T.scale!==void 0?T.scale:1,he=T.shadowScale!==void 0?T.shadowScale:0;he>0&&(p.save(),p.globalAlpha=At.SHADOW_MAX_ALPHA*he,p.fillStyle="#000000",p.beginPath(),p.ellipse(T.pos.x+T.size.width/2+ge,T.pos.y+T.size.height+40,24*he,10*he,0,0,Math.PI*2),p.fill(),p.restore()),p.save(),p.translate(T.pos.x+T.size.width/2+ge,T.pos.y+T.size.height/2),p.scale(oe,oe),p.drawImage(ie,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.restore()}return}if(T.type!==S.ENEMY_BATTLESHIP&&T.type!==S.ENEMY_TANK&&T.type!==S.ENEMY_LARGE_TANK){const ie=pr(T,qe),oe=T.type===S.ENEMY_SMALL||T.type===S.ENEMY_RED||T.type===S.ENEMY_HELICOPTER,he=T.type===S.CRASHING_AIRCRAFT,Se=oe&&T.rotation!==void 0;if(T.type===S.PLAYER&&(T.isEvading||T.bankAngle)||oe&&(T.bankAngle||Se)||T.type===S.POWERUP&&T.rotation||T.type===S.BOSS&&T.scale||he){p.save();const Ye=T.pos.x+T.size.width/2+ge,Pe=T.pos.y+T.size.height/2;if(p.translate(Ye,Pe),oe&&T.rotation!==void 0?(p.rotate(T.rotation),T.bankAngle&&p.rotate(T.bankAngle*.3)):T.bankAngle&&p.rotate(T.bankAngle),he){const ze=T.scale||1;p.scale(ze,ze),p.filter="brightness(0.85) saturate(0.9)"}T.type===S.POWERUP&&T.rotation&&p.rotate(T.rotation),T.type===S.POWERUP&&(T.powerupType===ma.SPREAD||T.isSpecial)&&Math.floor(D.frameCount/10)%2===0&&(p.filter="brightness(1.8) saturate(1.5)"),T.type===S.SUPPORT_FIGHTER&&(p.rotate(Math.PI/2),p.filter="hue-rotate(180deg) saturate(1.5) brightness(1.2)"),T.isEvading&&T.evasiveScale!==void 0&&p.scale(T.evasiveScale,T.evasiveScale),T.type===S.BOSS&&T.scale&&p.scale(T.scale,T.scale),T.hitFlash&&T.hitFlash>0&&T.type!==S.BOSS&&(p.filter="brightness(10) grayscale(1)"),D.playerInvincible>0&&Math.floor(D.frameCount/6)%2===0&&(p.globalAlpha=.5);const $e=D.playerHealth/D.maxPlayerHealth*100;$e<33&&$e>0&&Math.floor(D.frameCount/15)%2===0&&(p.filter="brightness(1.5) hue-rotate(0deg) saturate(2)"),p.drawImage(ie,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.globalAlpha=1,p.restore()}else{const Ye=D.playerHealth/D.maxPlayerHealth*100,Pe=T.hitFlash&&T.hitFlash>0&&T.type!==S.BOSS||T.type===S.PLAYER&&D.playerInvincible>0||T.type===S.PLAYER&&Ye<33&&Ye>0;Pe&&p.save(),T.hitFlash&&T.hitFlash>0&&T.type!==S.BOSS&&(p.filter="brightness(10) grayscale(1)"),T.type===S.PLAYER&&D.playerInvincible>0&&Math.floor(D.frameCount/6)%2===0&&(p.globalAlpha=.5),T.type===S.PLAYER&&Ye<33&&Ye>0&&Math.floor(D.frameCount/15)%2===0&&(p.filter="brightness(1.5) hue-rotate(0deg) saturate(2)"),p.drawImage(ie,T.pos.x+ge,T.pos.y,T.size.width,T.size.height),Pe&&p.restore()}}if(T.type===S.BOSS&&T.bossType){let ie=1;const oe=T;if(oe.hp!==void 0&&oe.maxHP!==void 0){const he=oe.hp/oe.maxHP;he<.25?ie=2.5:he<.5&&(ie=2)}U2(p,T.bossType,T.pos.x+ge,T.pos.y,T.size.width,T.size.height,D.frameCount,ie)}T.turrets&&qe.turret&&T.type!==S.ENEMY_BATTLESHIP&&T.type!==S.ENEMY_TANK&&T.type!==S.ENEMY_LARGE_TANK&&T.turrets.forEach(ie=>{p.save();const oe=T.pos.x+ie.relPos.x+ge,he=T.pos.y+ie.relPos.y;p.translate(oe,he),p.rotate(ie.angle),(T.hitFlash&&T.hitFlash>0||ie.hitFlash&&ie.hitFlash>0)&&(ie.hp<=3?p.filter="brightness(2) sepia(1) saturate(10) hue-rotate(-30deg)":p.filter="brightness(10) grayscale(1)"),p.drawImage(qe.turret,-18,-18,37,37),p.restore()})}),D.activeBoss&&D.activeBoss.active){const T=D.activeBoss,ge=-it,ie=80,oe=6,he=T.pos.x+T.size.width/2-ie/2+ge,Se=T.pos.y-15,Ne=Math.max(0,T.hp/T.maxHP),Ye=T.introPlayed?Math.min(D.frameCount-(D.bossIntroStartFrame||0),180):0,Pe=T.variantName&&Ye<120?Math.max(0,1-Ye/120):0;if(Pe>0&&T.variantName){p.save(),p.globalAlpha=Pe,p.font='bold 10px "Black Ops One", monospace',p.textAlign="center";const ze=T.pos.x+T.size.width/2+ge,Ce=Se-10;p.strokeStyle="rgba(0, 0, 0, 0.8)",p.lineWidth=3,p.strokeText(T.variantName.toUpperCase(),ze,Ce),p.fillStyle="#FF6600",p.fillText(T.variantName.toUpperCase(),ze,Ce),p.restore()}p.fillStyle="rgba(0, 0, 0, 0.7)",p.fillRect(he-1,Se-1,ie+2,oe+2),p.strokeStyle="#444444",p.lineWidth=1,p.strokeRect(he-1,Se-1,ie+2,oe+2);let $e;Ne>.6?$e="#22CC44":Ne>.3?$e="#CCAA22":$e="#CC3322",p.fillStyle=$e,p.fillRect(he,Se,ie*Ne,oe),p.fillStyle="rgba(255, 255, 255, 0.2)",p.fillRect(he,Se,ie*Ne,oe/2)}if(D.crashingBoss){const T=D.crashingBoss,ge=-it,ie=T.scale||1,oe=pr(T,qe);if(oe){p.save();const he=T.pos.x+T.size.width/2+ge,Se=T.pos.y+T.size.height/2;p.translate(he,Se),p.rotate(D.bossCrashRotation),p.scale(ie,ie),p.filter="brightness(0.7) sepia(0.3) saturate(1.5)",p.drawImage(oe,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.restore(),p.save(),p.globalCompositeOperation="lighter",p.globalAlpha=(.4+Math.random()*.2)*ie,p.fillStyle="#FF4400";const Ne=(30+Math.random()*20)*ie;p.beginPath(),p.ellipse(he+(Math.random()-.5)*T.size.width*.5*ie,Se+(Math.random()-.5)*T.size.height*.3*ie,Ne,Ne*.7,0,0,Math.PI*2),p.fill(),p.restore()}}if(Ie||D.entities.forEach(T=>{if(T.type!==S.BLAST_WAVE)return;const ge=T.maxFrames||30,ie=T.frame/ge,he=(T.blastRadius||200)*ie,Se=Math.max(8,40*(1-ie)),Ne=.4*(1-ie*ie),Ye=T.pos.x-it,Pe=T.pos.y;p.save(),p.globalAlpha=Ne,p.strokeStyle="#FF8800",p.lineWidth=Se,p.beginPath(),p.arc(Ye,Pe,he,0,Math.PI*2),p.stroke(),p.strokeStyle="#FFDD44",p.lineWidth=Se*.5,p.beginPath(),p.arc(Ye,Pe,he,0,Math.PI*2),p.stroke(),p.globalAlpha=Ne*.15,p.fillStyle="#FFAA00",p.beginPath(),p.arc(Ye,Pe,he,0,Math.PI*2),p.fill(),p.restore(),T.frame++,T.frame>ge&&(T.active=!1)}),!Ie){p.save(),p.globalCompositeOperation="lighter",D.entities.forEach(T=>{var ie;const ge=T.type===S.PLAYER||T.type===S.BULLET_PLAYER?0:-it;if(T.type===S.PARTICLE)if((ie=T.id)!=null&&ie.startsWith("turret_debris")){p.save(),p.globalCompositeOperation="source-over",p.globalAlpha=Math.min(1,T.hp/40),p.fillStyle=T.color||"#718096";const oe=T.pos.x+T.size.width/2+ge,he=T.pos.y+T.size.height/2;p.translate(oe,he),T.rotation!==void 0&&p.rotate(T.rotation),p.fillRect(-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.strokeStyle="rgba(0,0,0,0.7)",p.lineWidth=2,p.strokeRect(-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.restore()}else p.globalAlpha=T.hp/40,p.fillStyle=T.color||lt.WHITE,p.fillRect(T.pos.x+ge,T.pos.y,T.size.width,T.size.height);else if(T.type===S.BULLET_CANNON){const oe=T.pos.x+T.size.width/2+ge,he=T.pos.y+T.size.height/2,Se=p.createRadialGradient(oe,he,2,oe,he,10);Se.addColorStop(0,"#FFFFFF"),Se.addColorStop(.3,"#FFFF00"),Se.addColorStop(.6,"#FF4400"),Se.addColorStop(1,"rgba(204, 0, 0, 0)"),p.fillStyle=Se,p.beginPath(),p.arc(oe,he,10,0,Math.PI*2),p.fill()}else if(T.type===S.EXPLOSION||T.type===S.EXPLOSION_SMALL||T.type===S.EXPLOSION_MEDIUM||T.type===S.EXPLOSION_LARGE||T.type===S.EXPLOSION_MASSIVE){const oe=qe.explosion,he=T.maxFrames||20,Se=T.frame/he,Ne=.5+Se*2;p.save();const Ye=T.pos.x+T.size.width/2+ge,Pe=T.pos.y+T.size.height/2;p.translate(Ye,Pe),p.rotate(T.frame*.5),p.scale(Ne,Ne),p.globalAlpha=1-Se*Se,p.drawImage(oe,-T.size.width/2,-T.size.height/2,T.size.width,T.size.height),p.restore(),T.frame++,T.frame>he&&(T.active=!1)}}),vt.enableParticles&&ve.render(p,!0),ea.renderFloatingScores(p);for(const T of D.floatingScores){const ge=T.frame/T.maxFrames,ie=Math.sin(ge*Math.PI)*60,oe=1+Math.sin(ge*Math.PI*2)*.15,he=ge>.6?1-(ge-.6)/.4:1;let Se=14;T.points>=1e4?Se=32:T.points>=5e3?Se=26:T.points>=1e3?Se=22:T.points>=500&&(Se=18);const Ne=Math.floor(Se*oe);let Ye="#ffffff",Pe="rgba(255, 255, 255, 0.4)";T.entityType==="bomber"?(Ye="#22d3ee",Pe="rgba(34, 211, 238, 0.6)"):T.entityType==="turret"?(Ye="#4ade80",Pe="rgba(74, 222, 128, 0.6)"):T.heatLevel==="BLAZING"?(Ye="#e879f9",Pe="rgba(232, 121, 249, 0.6)"):T.heatLevel==="ON_FIRE"?(Ye="#ef4444",Pe="rgba(239, 68, 68, 0.5)"):T.heatLevel==="HOT"?(Ye="#f97316",Pe="rgba(249, 115, 22, 0.5)"):T.heatLevel==="WARM"&&(Ye="#facc15",Pe="rgba(250, 204, 21, 0.5)");const $e=T.x-it,ze=T.y-ie;p.save(),p.globalAlpha=he,p.font=`bold ${Ne}px "Black Ops One", monospace`,p.textAlign="center",p.shadowColor=Pe,p.shadowBlur=15,p.strokeStyle="#000000",p.lineWidth=4,p.strokeText(`+${T.points}`,$e,ze),p.fillStyle=Ye,p.fillText(`+${T.points}`,$e,ze);const Ce=T.multiplier?Math.round(T.multiplier):0;if(Ce>=2){p.font=`bold ${Math.floor(Ne*.6)}px "Black Ops One", monospace`,p.fillStyle=Ye;const Gt=`${Ce}`;p.strokeText(Gt,$e,ze+Ne+2),p.fillText(Gt,$e,ze+Ne+2)}p.restore()}p.restore()}Ie||D.entities.forEach(T=>{if(T.type===S.SMOKE){const ge=-it;p.globalAlpha=T.hp/60*.5,p.fillStyle="#555",p.beginPath(),p.arc(T.pos.x+ge,T.pos.y,T.size.width,0,Math.PI*2),p.fill()}}),p.globalAlpha=1,p.restore()}if(D.frameCount-D.bombActiveFrame<15&&D.frameCount>15&&(p.fillStyle=`rgba(255, 255, 255, ${1-(D.frameCount-D.bombActiveFrame)/15})`,p.fillRect(0,0,P,Y)),D.postProcessing.renderWhiteFlash(p,P,Y),D.postProcessing.renderDamageVignette(p,P,Y,vt.enablePostProcessing),D.postProcessing.renderPrecisionVignette(p,P,Y,vt.enablePostProcessing),D.postProcessing.renderScanlines(p,P,Y,Bt.getScanlinesIntensity(),vt.enablePostProcessing),D.state===te.ATTRACT){p.save(),p.beginPath(),p.roundRect(0,0,P,Y,20),p.clip(),p.drawImage(qe.titleScreen,0,0,P,Y),p.fillStyle="rgba(0, 0, 0, 0.6)",p.fillRect(0,0,P,Y),p.restore(),p.fillStyle="rgba(180, 180, 180, 0.7)",p.font="10px monospace",p.textAlign="center",p.fillText(" 2025-2026, Rodrigo Geve, All Rights Reserved",P/2,105);const je=(T,ge,ie=5)=>{const oe=p.createRadialGradient(T-1,ge-1,0,T,ge,ie);oe.addColorStop(0,"#999"),oe.addColorStop(.5,"#666"),oe.addColorStop(1,"#333"),p.beginPath(),p.arc(T,ge,ie,0,Math.PI*2),p.fillStyle=oe,p.fill(),p.strokeStyle="#222",p.lineWidth=1,p.stroke()},Fe=115,He=130,Me=15,be=20;p.fillStyle="rgba(30, 30, 30, 0.5)",p.beginPath(),p.roundRect(be,Fe,P-be*2,He,Me),p.fill(),p.strokeStyle="#555",p.lineWidth=2,p.beginPath(),p.roundRect(be,Fe,P-be*2,He,Me),p.stroke();const Je=70,Ie=55;for(let T=0;T<7;T++)je(Ie+T*Je,Fe+10,5),je(Ie+T*Je,Fe+He-10,5);p.save(),p.shadowColor="#000000",p.shadowBlur=25,p.fillStyle="#000000",p.font='50px "Black Ops One"',p.textAlign="center",p.fillText("WORLD WAR II",P/2+5,165),p.fillText("WORLD WAR II",P/2+3,163);const rt=p.createLinearGradient(0,110,0,210);rt.addColorStop(0,"#D4A574"),rt.addColorStop(.3,"#C8C8C8"),rt.addColorStop(.7,"#B8B8B8"),rt.addColorStop(1,"#8B7355"),p.fillStyle=rt,p.strokeStyle="#2a2a2a",p.lineWidth=2,p.strokeText("WORLD WAR II",P/2,160),p.fillText("WORLD WAR II",P/2,160),p.restore(),p.save(),p.shadowColor="#000000",p.shadowBlur=30,p.fillStyle="#000000",p.font='58px "Black Ops One"',p.textAlign="center",p.fillText("SKY ACE",P/2+5,225),p.fillText("SKY ACE",P/2+3,223);const it=p.createLinearGradient(0,180,0,240);it.addColorStop(0,"#D4A574"),it.addColorStop(.3,"#C8C8C8"),it.addColorStop(.7,"#B8B8B8"),it.addColorStop(1,"#8B7355"),p.fillStyle=it,p.strokeStyle="#2a2a2a",p.lineWidth=2,p.strokeText("SKY ACE",P/2,220),p.fillText("SKY ACE",P/2,220),p.restore(),p.fillStyle="rgba(0, 0, 0, 0.1)";for(let T=0;T<Y;T+=3)p.fillRect(0,T,P,1)}if(D.state===te.STORY){p.fillStyle="#2B3A12",p.fillRect(0,0,P,Y);const je=Np(D.campaign)[Q]||`storyPanel${Q+1}`,Fe=Dp(je),He=Fe||re[Q]||qe.storyPanels[Q],Me=sc(je);let be=0,Je=0,Ie=0,rt=0;const it=80,T=30,ge=30,ie=15,oe=120,he=P-ge*2,Se=Y-T-it;if(He){const Ze=He.naturalWidth||He.width,zt=He.naturalHeight||He.height,mi=Ze/zt||1.33,yi=Se-oe-ie;Ie=he,rt=Ie/mi,rt>yi&&(rt=yi,Ie=rt*mi),be=(P-Ie)/2,Je=T,!Me&&Fe&&(p.imageSmoothingEnabled=!1),p.drawImage(He,be,Je,Ie,rt),p.imageSmoothingEnabled=!0,p.strokeStyle=lt.WHITE,p.lineWidth=3,p.beginPath(),p.roundRect(be,Je,Ie,rt,10),p.stroke(),!Me&&Fe&&(p.fillStyle="rgba(0, 0, 0, 0.5)",p.fillRect(be+Ie-100,Je+10,90,24),p.fillStyle=lt.GREEN,p.font='12px "Black Ops One"',p.textAlign="right",p.fillText("LOADING...",be+Ie-15,Je+27),p.textAlign="left")}const Pe=cm(D.campaign)[Q].split(" "),$e=Math.min(20,Math.max(16,Math.floor(Ie/30)));p.fillStyle=lt.GREEN,p.font=`${$e}px "Black Ops One"`,p.textAlign="left";const ze=[];let Ce="";const Gt=20,ha=Ie-Gt*2;for(let Ze=0;Ze<Pe.length;Ze++){const zt=Ce+Pe[Ze]+" ";p.measureText(zt).width>ha&&Ze>0?(ze.push(Ce),Ce=Pe[Ze]+" "):Ce=zt}ze.push(Ce);const Kt=Je+rt+ie,Ha=Math.max(oe,Y-it-Kt),Ya=Math.floor($e*2.2);p.fillStyle="rgba(43, 58, 18, 0.85)",p.beginPath(),p.roundRect(be,Kt,Ie,Ha,10),p.fill(),p.strokeStyle="#5A6D33",p.lineWidth=2,p.beginPath(),p.roundRect(be,Kt,Ie,Ha,10),p.stroke();const La=ze.length*Ya,St=Kt+(Ha-La)/2+$e;p.save(),p.shadowColor="rgba(0, 0, 0, 0.8)",p.shadowBlur=4,p.shadowOffsetX=2,p.shadowOffsetY=2,p.fillStyle="#c9a961",p.font=`${$e}px "Black Ops One"`;let Ut=St;ze.forEach(Ze=>{p.fillText(Ze,be+Gt,Ut),Ut+=Ya}),p.restore(),p.fillStyle="rgba(0, 0, 0, 0.1)";for(let Ze=0;Ze<Y;Ze+=3)p.fillRect(0,Ze,P,1)}if(D.powerupLegendTimer>0){p.fillStyle="rgba(0, 0, 0, 0.4)",p.fillRect(0,0,P,Y),p.fillStyle=lt.YELLOW,p.font='20px "Black Ops One"',p.textAlign="center",p.fillText("POWER-UPS",P/2,120);const De=[],je=D.difficulty;De.push({icon:qe.powerupFirepower,name:"FIRE",desc:"QUAD SHOT"}),je!==mt.BEGINNER&&De.push({icon:qe.powerupFirepowerEnhanced,name:"FIRE+",desc:"6-SHOT 2X DMG"}),De.push({icon:qe.bombTier1,name:"BOMB I",desc:"STANDARD"}),De.push({icon:qe.bombTier2,name:"BOMB II",desc:"HEAVY"}),je!==mt.BEGINNER&&De.push({icon:qe.bombTier3,name:"BOMB III",desc:"CLUSTER"}),je===mt.VETERAN&&De.push({icon:qe.bombTier4,name:"BOMB IV",desc:"MEGA"}),De.push({icon:qe.powerupInvincibility,name:"SHIELD",desc:"7 SECONDS"});const Fe=42,He=52,Me=308,be=60+De.length*He,Je=P/2-Me/2,Ie=150;p.fillStyle="rgba(0, 0, 0, 0.7)",p.beginPath(),p.roundRect(Je,Ie,Me,be,8),p.fill(),p.strokeStyle=lt.YELLOW,p.lineWidth=3,p.beginPath(),p.roundRect(Je,Ie,Me,be,8),p.stroke();const rt=Ie+40;De.forEach((T,ge)=>{const ie=rt+ge*He,oe=Je+30;T.icon&&p.drawImage(T.icon,oe,ie-18,Fe,Fe),p.fillStyle=lt.WHITE,p.font='12px "Black Ops One"',p.textAlign="left",p.fillText(T.name,oe+Fe+16,ie),p.fillStyle=lt.GREY,p.font='10px "Black Ops One"',p.fillText(T.desc,oe+Fe+16,ie+16)});const it=Math.ceil(D.powerupLegendTimer/60);p.fillStyle=lt.GREEN,p.font='12px "Black Ops One"',p.textAlign="center",p.fillText(`STARTING IN ${it}...`,P/2,Ie+be+25)}if(D.state===te.LEVEL_COMPLETE)if(D.intermissionPhase==="fadeIn")D.intermissionFadeAlpha>0&&(p.fillStyle=`rgba(0, 0, 0, ${D.intermissionFadeAlpha})`,p.fillRect(0,0,P,Y));else{const je=D.intermissionScrollY%64,Fe=Math.floor(-je/32)-1,He=Math.ceil(Y/32)+2,Me=Math.ceil(P/32);for(let ze=Fe;ze<He;ze++)for(let Ce=0;Ce<Me;Ce++){const ha=(ze+Ce)%2===0?.5:.9;p.fillStyle=`rgba(0, 0, 0, ${ha})`,p.fillRect(Ce*32,ze*32+je,32,32)}p.fillStyle="rgba(0, 0, 0, 0.1)",p.fillRect(0,0,P,Y);const be=D.intermissionCachedProgress||ea.getLevelProgress(),Je=420,Ie=360,rt=(P-Je)/2,it=(Y-Ie)/2,T=p.createLinearGradient(rt,it,rt,it+Ie);T.addColorStop(0,"rgba(59, 74, 28, 0.95)"),T.addColorStop(1,"rgba(43, 58, 18, 0.95)"),p.fillStyle=T,p.beginPath(),p.roundRect(rt,it,Je,Ie,10),p.fill(),p.save(),p.shadowColor="#5A6D33",p.shadowBlur=15,p.strokeStyle="#5A6D33",p.lineWidth=3,p.beginPath(),p.roundRect(rt,it,Je,Ie,10),p.stroke(),p.restore(),p.save(),p.shadowColor=lt.YELLOW,p.shadowBlur=20,p.fillStyle=lt.YELLOW,p.font=D.intermissionIsFinalLevel?'22px "Black Ops One"':'26px "Black Ops One"',p.textAlign="center";const ge=D.intermissionIsFinalLevel?"CAMPAIGN COMPLETE!":`STAGE ${D.level} COMPLETE!`;p.fillText(ge,P/2,it+60),p.restore(),p.font='16px "Black Ops One"',p.textAlign="center";const ie=it+110;p.fillStyle=lt.WHITE,p.fillText("SCORE",P/2,ie),p.fillStyle=lt.YELLOW,p.font='20px "Black Ops One"',p.fillText(`${D.score.toString().padStart(6,"0")}`,P/2,ie+22),p.font='16px "Black Ops One"',p.fillStyle=lt.WHITE,p.fillText("TARGETS DESTROYED",P/2,ie+55),p.fillStyle="#00ffff",p.font='18px "Black Ops One"',p.fillText(`${be.destroyedGameTargets} / ${be.totalGameTargets}`,P/2,ie+75),be.pointsEarned>0&&(p.font='16px "Black Ops One"',p.fillStyle=lt.GREEN,p.fillText(`TARGET BONUS: +${be.pointsEarned}`,P/2,ie+105)),p.font='16px "Black Ops One"',p.fillStyle=lt.WHITE,p.fillText(`LIVES: ${D.lives}`,P/2,ie+135);const oe=300,he=10,Se=(P-oe)/2,Ne=it+Ie-75,Ye=1-D.intermissionTimer/D.INTERMISSION_DURATION;if(p.fillStyle="#333",p.beginPath(),p.roundRect(Se,Ne,oe,he,5),p.fill(),Ye>0){const ze=p.createLinearGradient(Se,Ne,Se+oe*Ye,Ne);ze.addColorStop(0,"#5A6D33"),ze.addColorStop(1,"#4A5D23"),p.fillStyle=ze,p.beginPath(),p.roundRect(Se,Ne,oe*Ye,he,5),p.fill()}p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.roundRect(Se,Ne,oe,he,5),p.stroke();const Pe=Math.ceil(D.intermissionTimer/60);p.font='16px "Black Ops One"',p.fillStyle="#5A6D33",p.textAlign="center";const $e=D.intermissionIsFinalLevel?`CONTINUING IN ${Pe}`:`NEXT STAGE IN ${Pe}`;p.fillText($e,P/2,Ne+he+20),p.fillStyle="rgba(0, 0, 0, 0.1)";for(let ze=0;ze<Y;ze+=3)p.fillRect(0,ze,P,1);D.intermissionFadeAlpha>0&&(p.fillStyle=`rgba(0, 0, 0, ${D.intermissionFadeAlpha})`,p.fillRect(0,0,P,Y))}if(D.state===te.PAUSED){p.fillStyle="rgba(0, 0, 0, 0.7)",p.fillRect(0,0,P,Y);const De=220,je=360,Fe=(P-De)/2,He=(Y-je)/2;p.save(),p.beginPath(),p.roundRect(Fe,He,De,je,12),p.clip(),X2(p,Fe,He,De,je,{palette:"pacific",seed:12345,numClusters:25,pointDensity:.08}),p.restore(),p.strokeStyle="#5A6D33",p.lineWidth=3,p.beginPath(),p.roundRect(Fe,He,De,je,12),p.stroke(),p.fillStyle="#c9a961",p.font="bold 24px monospace",p.textAlign="center",p.fillText("PAUSED",P/2,He+35);const Me=160,be=32,Je=Fe+(De-Me)/2,Ie=40,rt=He+55,it=rt;p.fillStyle=D.pauseSelection===0?"#4A5D23":"#2B3A12",p.beginPath(),p.roundRect(Je,it,Me,be,6),p.fill(),p.strokeStyle=D.pauseSelection===0?"#5A6D33":"#3B4A1C",p.lineWidth=2,p.beginPath(),p.roundRect(Je,it,Me,be,6),p.stroke(),p.fillStyle=D.pauseSelection===0?"#FFFFFF":"#AAAAAA",p.font="bold 14px monospace",p.fillText("RESUME",P/2,it+21);const T=rt+Ie;p.fillStyle=D.pauseSelection===1?"#4A5D23":"#2B3A12",p.beginPath(),p.roundRect(Je,T,Me,be,6),p.fill(),p.strokeStyle=D.pauseSelection===1?"#5A6D33":"#3B4A1C",p.lineWidth=2,p.beginPath(),p.roundRect(Je,T,Me,be,6),p.stroke(),p.fillStyle=D.pauseSelection===1?"#FFFFFF":"#AAAAAA",p.fillText("SETTINGS",P/2,T+21);const ge=rt+Ie*2,ie=me.isMutedState();ie?(p.fillStyle=D.pauseSelection===2?"#6B2A2A":"#4A1C1C",p.beginPath(),p.roundRect(Je,ge,Me,be,6),p.fill(),p.strokeStyle=D.pauseSelection===2?"#8B3A3A":"#5A2A2A"):(p.fillStyle=D.pauseSelection===2?"#4A5D23":"#2B3A12",p.beginPath(),p.roundRect(Je,ge,Me,be,6),p.fill(),p.strokeStyle=D.pauseSelection===2?"#5A6D33":"#3B4A1C"),p.lineWidth=2,p.beginPath(),p.roundRect(Je,ge,Me,be,6),p.stroke(),p.fillStyle=D.pauseSelection===2?"#FFFFFF":ie?"#CC8888":"#AAAAAA",p.fillText(ie?"AUDIO: OFF":"AUDIO: ON",P/2,ge+21);const oe=rt+Ie*3;p.fillStyle=D.pauseSelection===3?"#4A5D23":"#2B3A12",p.beginPath(),p.roundRect(Je,oe,Me,be,6),p.fill(),p.strokeStyle=D.pauseSelection===3?"#5A6D33":"#3B4A1C",p.lineWidth=2,p.beginPath(),p.roundRect(Je,oe,Me,be,6),p.stroke(),p.fillStyle=D.pauseSelection===3?"#FFFFFF":"#AAAAAA",p.fillText("QUIT",P/2,oe+21);const he=oe+be+12;p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.moveTo(Fe+20,he),p.lineTo(Fe+De-20,he),p.stroke();const Se=he+12,Ne=50,Ye=Fe+15,Pe=Se,$e=me.getCurrentArtworkImage();$e?(p.drawImage($e,Ye,Pe,Ne,Ne),p.strokeStyle="#5A6D33",p.lineWidth=1,p.strokeRect(Ye,Pe,Ne,Ne)):(p.fillStyle="#2B3A12",p.fillRect(Ye,Pe,Ne,Ne),p.strokeStyle="#5A6D33",p.lineWidth=1,p.strokeRect(Ye,Pe,Ne,Ne),p.fillStyle="#5A6D33",p.font="20px sans-serif",p.textAlign="center",p.fillText("",Ye+Ne/2,Pe+Ne/2+7));const ze=Ye+Ne+10,Ce=De-Ne-40,Gt=Se+10,ha=6,Kt=me.getDuration(),Ha=me.getCurrentTime(),Ya=Kt>0?Ha/Kt:0;p.fillStyle="#2B3A12",p.beginPath(),p.roundRect(ze,Gt,Ce,ha,3),p.fill(),Ya>0&&(p.fillStyle="#c9a961",p.beginPath(),p.roundRect(ze,Gt,Ce*Ya,ha,3),p.fill()),p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.roundRect(ze,Gt,Ce,ha,3),p.stroke();const La=yi=>{const br=Math.floor(yi/60),ts=Math.floor(yi%60);return`${br}:${ts.toString().padStart(2,"0")}`};p.fillStyle="#9AAF7A",p.font="9px monospace",p.textAlign="left",p.fillText(`${La(Ha)} / ${La(Kt)}`,ze,Gt+20);const St=24,Ut=Se+35,Ze=ze+Ce-St*2-8,zt=ze+Ce-St;p.fillStyle="#2B3A12",p.beginPath(),p.roundRect(Ze,Ut,St,St,4),p.fill(),p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.roundRect(Ze,Ut,St,St,4),p.stroke(),p.fillStyle="#c9a961",p.fillRect(Ze+6,Ut+6,2,St-12),p.beginPath(),p.moveTo(Ze+St-6,Ut+6),p.lineTo(Ze+St-6,Ut+St-6),p.lineTo(Ze+10,Ut+St/2),p.closePath(),p.fill();const mi=me.isPlaying();p.fillStyle="#2B3A12",p.beginPath(),p.roundRect(zt,Ut,St,St,4),p.fill(),p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.roundRect(zt,Ut,St,St,4),p.stroke(),p.fillStyle="#c9a961",mi?(p.fillRect(zt+7,Ut+6,3,St-12),p.fillRect(zt+14,Ut+6,3,St-12)):(p.beginPath(),p.moveTo(zt+7,Ut+6),p.lineTo(zt+7,Ut+St-6),p.lineTo(zt+St-6,Ut+St/2),p.closePath(),p.fill()),D.audioControlBounds={slider:{x:ze,y:Gt,width:Ce,height:ha+10},restart:{x:Ze,y:Ut,width:St,height:St},playPause:{x:zt,y:Ut,width:St,height:St}},p.fillStyle="#9AAF7A",p.font="10px monospace",p.textAlign="center",p.fillText(" to select, Enter to confirm",P/2,He+je-12)}if(D.state===te.DESIGN_MODE&&Qh.render(p),D.state===te.VICTORY){p.fillStyle="#2B3A12",p.fillRect(0,0,P,Y);const je=J_(D.campaign)[q],Fe=Dp(je),He=Fe||Te[q],Me=sc(je),be=30,Je=30,Ie=30,rt=15,it=150,T=P-Ie*2,ge=Y-Je-be;let ie=0,oe=0,he=0,Se=0;if(He){const Ze=He.naturalWidth||He.width,zt=He.naturalHeight||He.height,mi=Ze/zt||1.33,yi=ge-it-rt;he=T,Se=he/mi,Se>yi&&(Se=yi,he=Se*mi),ie=(P-he)/2,oe=Je,!Me&&Fe&&(p.imageSmoothingEnabled=!1),p.drawImage(He,ie,oe,he,Se),p.imageSmoothingEnabled=!0,p.strokeStyle=lt.WHITE,p.lineWidth=3,p.beginPath(),p.roundRect(ie,oe,he,Se,10),p.stroke(),!Me&&Fe&&(p.fillStyle="rgba(0, 0, 0, 0.5)",p.fillRect(ie+he-100,oe+10,90,24),p.fillStyle=lt.GREEN,p.font='12px "Black Ops One"',p.textAlign="right",p.fillText("LOADING...",ie+he-15,oe+27),p.textAlign="left")}else he=T,Se=ge-it-rt,ie=Ie,oe=Je,p.fillStyle="rgba(74, 93, 35, 0.8)",p.beginPath(),p.roundRect(ie,oe,he,Se,10),p.fill(),p.strokeStyle="#5A6D33",p.lineWidth=1,p.beginPath(),p.roundRect(ie,oe,he,Se,10),p.stroke(),p.fillStyle=lt.GREY,p.font='12px "Black Ops One"',p.textAlign="center",p.fillText("LOADING IMAGE...",P/2,oe+Se/2);const Pe=(wy(D.campaign)[q]||"VICTORY!").split(" "),$e=Math.min(20,Math.max(16,Math.floor(he/30)));p.fillStyle=lt.GREEN,p.font=`${$e}px "Black Ops One"`,p.textAlign="left";const ze=[];let Ce="";const Gt=35,ha=he-Gt*2;for(let Ze=0;Ze<Pe.length;Ze++){const zt=Ce+Pe[Ze]+" ";p.measureText(zt).width>ha&&Ze>0?(ze.push(Ce),Ce=Pe[Ze]+" "):Ce=zt}ze.push(Ce);const Kt=oe+Se+rt,Ya=Math.max(it+25,Y-be-Kt),La=Math.floor($e*2.2);p.fillStyle="rgba(43, 58, 18, 0.85)",p.beginPath(),p.roundRect(ie,Kt,he,Ya,10),p.fill(),p.strokeStyle="#5A6D33",p.lineWidth=2,p.beginPath(),p.roundRect(ie,Kt,he,Ya,10),p.stroke();let Ut=Kt+30+$e;p.save(),p.shadowColor="rgba(0, 0, 0, 0.8)",p.shadowBlur=4,p.shadowOffsetX=2,p.shadowOffsetY=2,p.fillStyle="#c9a961";for(let Ze=0;Ze<ze.length;Ze++)p.fillText(ze[Ze],ie+Gt,Ut),Ut+=La;p.restore(),p.fillStyle="rgba(0, 0, 0, 0.1)";for(let Ze=0;Ze<Y;Ze+=3)p.fillRect(0,Ze,P,1)}if(D.state===te.ENDING){p.fillStyle="#000",p.fillRect(0,0,P,Y);for(let T=0;T<50;T++){const ge=T*37%P,ie=T*73%Y,oe=Math.sin(D.frameCount/10+T)*.5+.5;p.globalAlpha=oe,p.fillStyle="#fff",p.fillRect(ge,ie,2,2)}p.globalAlpha=1,p.fillStyle="rgba(0, 20, 40, 0.9)";const De=100,je=350;p.beginPath(),p.roundRect(40,De,P-80,je,10),p.fill(),p.strokeStyle=lt.YELLOW,p.lineWidth=3,p.beginPath(),p.roundRect(40,De,P-80,je,10),p.stroke(),p.fillStyle=lt.GREY,p.font='12px "Black Ops One"',p.textAlign="center",p.fillText(`${ye+1} / ${pl.length}`,P/2,De+25),p.fillStyle=lt.WHITE,p.font='16px "Black Ops One"',p.textAlign="center";const He=um(D.campaign)[ye],Me=P-120,be=He.split(" ");let Je="",Ie=De+100;const rt=30;be.forEach((T,ge)=>{const ie=Je+T+" ";p.measureText(ie).width>Me&&ge>0?(p.fillText(Je,P/2,Ie),Je=T+" ",Ie+=rt):Je=ie}),p.fillText(Je,P/2,Ie);const it=.5+Math.sin(D.frameCount/15)*.5;p.globalAlpha=it,p.fillStyle=lt.GREEN,p.font='12px "Black Ops One"',p.textAlign="center",ye<pl.length-1?p.fillText("CLICK NEXT >",P/2,De+je-20):p.fillText("CLICK FINISH TO RETURN",P/2,De+je-20),p.globalAlpha=1}D.state===te.GAME_OVER&&(p.fillStyle="rgba(0,0,0,0.6)",p.fillRect(0,0,P,Y),p.fillStyle=lt.RED,p.font='42px "Black Ops One"',p.textAlign="center",p.fillText("GAME OVER",P/2,Y/2)),jo.endFrame(),Ae=requestAnimationFrame(Ft)};return Ae=requestAnimationFrame(Ft),()=>{cancelAnimationFrame(Ae)}},[C,G,Q,q]);const Ii=n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE||n===te.GAME_OVER;return M.jsxs("div",{className:"relative w-full h-dvh flex flex-col bg-black text-white overflow-hidden",children:[M.jsxs("div",{ref:t,className:"relative flex-1 flex items-center justify-center bg-black overflow-hidden",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},children:[M.jsx("canvas",{ref:o,width:P,height:Y,className:"block bg-black w-full h-full",style:{objectFit:"contain",borderRadius:"20px"},onMouseDown:F=>{if(D.state===te.DESIGN_MODE){const p=Qn(F);p&&V.onMouseDown(p.x,p.y,F.ctrlKey||F.metaKey)}},onMouseMove:F=>{if(D.state===te.DESIGN_MODE){const p=Qn(F);p&&V.onMouseMove(p.x,p.y)}},onMouseUp:()=>{D.state===te.DESIGN_MODE&&V.onMouseUp()},onMouseLeave:()=>{D.state===te.DESIGN_MODE&&V.onMouseUp()},onWheel:F=>{D.state===te.DESIGN_MODE&&(F.preventDefault(),V.onWheel(F.deltaY))},onClick:F=>{if(D.state===te.PAUSED){const p=Qn(F);if(!p)return;const{x:Ae,y:ct}=p,Xe=220,Ct=360,yt=(P-Xe)/2,Lt=(Y-Ct)/2,$t=160,Ft=32,It=yt+(Xe-$t)/2,Ht=40,qe=Lt+55;if(Ae>=It&&Ae<=It+$t){const li=qe;if(ct>=li&&ct<=li+Ft){D.resume();return}const Xa=qe+Ht;if(ct>=Xa&&ct<=Xa+Ft){Al(!0),fn(!0);return}const Yt=qe+Ht*2;if(ct>=Yt&&ct<=Yt+Ft){const Oa=!me.isMutedState();me.setMuted(Oa),Ea(Oa),Oa||me.playLevelMusic(D.level,D.campaign);return}const sa=qe+Ht*3;if(ct>=sa&&ct<=sa+Ft){D.quitToTitle(),v(D.totalCreditsRemaining);return}}const We=D.audioControlBounds;if(We){if(Ae>=We.slider.x&&Ae<=We.slider.x+We.slider.width&&ct>=We.slider.y&&ct<=We.slider.y+We.slider.height){const li=(Ae-We.slider.x)/We.slider.width,Xa=me.getDuration();Xa>0&&me.seekTo(li*Xa);return}if(Ae>=We.restart.x&&Ae<=We.restart.x+We.restart.width&&ct>=We.restart.y&&ct<=We.restart.y+We.restart.height){me.restartTrack();return}if(Ae>=We.playPause.x&&Ae<=We.playPause.x+We.playPause.width&&ct>=We.playPause.y&&ct<=We.playPause.y+We.playPause.height){me.togglePlayPause();return}}}}}),Ii&&M.jsx("div",{className:"absolute z-20 pointer-events-none",style:{left:Ds.offsetLeft+8,top:Ds.offsetTop+8},children:M.jsx("div",{className:"bg-black/75 rounded-lg px-3 sm:px-4 py-1.5 sm:py-2",children:M.jsxs("span",{className:"text-yellow-500 font-bold text-sm sm:text-base tracking-widest",children:["1UP ",M.jsx("span",{className:"text-white",children:r.toString().padStart(6,"0")})]})})}),C&&!le&&M.jsx("div",{className:"absolute inset-0 z-50",children:M.jsx(A2,{progress:Le,width:P,height:Y})}),et.isTouchDevice&&(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE)&&M.jsx(E2,{onMove:(F,p)=>{gl.setJoystickPosition(F,p)},onFire:F=>{gl.setFirePressed(F)},onEvade:()=>{gl.triggerEvade()},onBomb:()=>{gl.triggerBomb()},onFirstTouch:()=>{me.unlockAudio()}}),M.jsx(C2,{campaign:x,level:L,scrollY:D.getEffectiveScrollY(),playerX:Sl.x,playerY:Sl.y,visible:mc&&(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE),containerWidth:pc,canvasBounds:Ds}),M.jsx(v2,{gameState:n,onSave:Rr,onLoad:Mr}),$n.show&&n===te.DESIGN_MODE&&M.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:M.jsxs("div",{style:{backgroundColor:"#1a1a2e",border:"2px solid #ffcc00",borderRadius:"8px",padding:"24px",maxWidth:"400px",textAlign:"center",color:"#ffffff",fontFamily:'"Black Ops One", monospace'},children:[M.jsx("h3",{style:{color:"#ffcc00",marginBottom:"16px",fontSize:"14px"},children:"UNSAVED CHANGES"}),M.jsxs("p",{style:{marginBottom:"20px",fontSize:"10px",lineHeight:"1.6"},children:["You have unsaved changes that will be lost if you switch to Level ",$n.targetLevel,"."]}),M.jsx("p",{style:{marginBottom:"24px",fontSize:"10px",color:"#aaaaaa"},children:"Press S to save before switching, or choose an option below:"}),M.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[M.jsx("button",{onClick:()=>{qn({show:!1,targetLevel:0}),D.switchDesignModeLevel($n.targetLevel)},style:{backgroundColor:"#cc3333",color:"#ffffff",border:"none",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"DISCARD & SWITCH"}),M.jsx("button",{onClick:()=>qn({show:!1,targetLevel:0}),style:{backgroundColor:"#333366",color:"#ffffff",border:"1px solid #6666aa",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"CANCEL"})]})]})}),gc&&n===te.DESIGN_MODE&&M.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:M.jsxs("div",{style:{backgroundColor:"#1a1a2e",border:"2px solid #ffcc00",borderRadius:"8px",padding:"24px",maxWidth:"400px",textAlign:"center",color:"#ffffff",fontFamily:'"Black Ops One", monospace'},children:[M.jsx("h3",{style:{color:"#ffcc00",marginBottom:"16px",fontSize:"14px"},children:"DISCARD CHANGES?"}),M.jsx("p",{style:{marginBottom:"20px",fontSize:"10px",lineHeight:"1.6"},children:"You have unsaved changes that will be lost if you exit Design Mode."}),M.jsx("p",{style:{marginBottom:"24px",fontSize:"10px",color:"#aaaaaa"},children:"Press S to save before exiting, or choose an option below:"}),M.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[M.jsx("button",{onClick:()=>{Zn(!1),D.toggleDesignMode(),s(D.state)},style:{backgroundColor:"#cc3333",color:"#ffffff",border:"none",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"DISCARD & EXIT"}),M.jsx("button",{onClick:()=>Zn(!1),style:{backgroundColor:"#333366",color:"#ffffff",border:"1px solid #6666aa",padding:"10px 16px",borderRadius:"4px",cursor:"pointer",fontFamily:'"Black Ops One", monospace',fontSize:"8px"},children:"CANCEL"})]})]})}),(n===te.PLAYING||n===te.BOSS_INTRO||n===te.BOSS_BATTLE||n===te.POWERUP_LEGEND)&&Wi&&M.jsx(m2,{score:r,highScore:h,lives:g,bombs:b,level:L,combo:Ue,activeBoss:D.activeBoss,playerHealth:xa,maxPlayerHealth:jn,firepowerCount:D.firepowerCount,bombCount:D.bombCount,invincibilityCount:D.invincibilityCount,firepowerSprite:Wi.firepower,firepowerEnhancedSprite:Wi.firepowerEnhanced,bombSprite:Wi.bomb,invincibilitySprite:Wi.invincibility,firepowerBullets:D.firepowerBullets,firepowerStacks:D.firepowerStacks,activeFirepowerTier:D.activeFirepowerTier,spreadBullets:D.spreadBullets,spreadStacks:D.spreadStacks,enemyFighterSprite:Wi.enemyFighter,playerInvincible:D.playerInvincible,gameEngine:D,canvasBounds:Ds}),n===te.ATTRACT&&!C&&M.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",style:{fontFamily:'"Black Ops One"'},children:M.jsxs("div",{className:"flex flex-col items-center rounded-lg py-6 sm:py-8 px-4 sm:px-8 relative",style:{width:"85%",maxWidth:"420px",minWidth:"300px",marginTop:"15%",background:"rgba(15, 15, 15, 0.4)",border:"3px solid #444",boxShadow:"inset 0 0 20px rgba(0,0,0,0.4), 0 0 0 1px #222, 0 4px 20px rgba(0,0,0,0.5)"},children:[M.jsx("div",{className:"rivet absolute",style:{top:"8px",left:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{top:"8px",right:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{bottom:"8px",left:"8px"}}),M.jsx("div",{className:"rivet absolute",style:{bottom:"8px",right:"8px"}}),M.jsx("div",{className:"text-yellow-400 text-[14px] sm:text-base mb-5 sm:mb-6 leading-none whitespace-nowrap",style:{textShadow:"0 0 10px rgba(255,255,0,0.5)"},children:"SELECT DIFFICULTY"}),M.jsx("div",{className:"flex flex-col items-center gap-1 sm:gap-2 pointer-events-auto w-full",children:zn.map(F=>{const p=ml(F),Ae=x===F;return M.jsxs("button",{onClick:()=>{me.playTitleMusic(),x!==F&&me.playMenuSelect(),I(F),D.setCampaign(F);const ct={[pe.DAWN_PATROL]:mt.BEGINNER,[pe.STEEL_VANGUARD]:mt.NORMAL,[pe.HELLFIRE_HORIZON]:mt.VETERAN};W(ct[F])},className:`leading-none cursor-pointer transition-all outline-none focus:outline-none py-1.5 px-2 w-full text-center whitespace-nowrap ${Ae?"text-[19px] sm:text-lg text-red-500 drop-shadow-[0_0_10px_rgba(255,0,0,0.8)]":"text-[13px] sm:text-sm text-gray-500 hover:text-gray-300"}`,children:[M.jsx("span",{className:Ae?"visible":"invisible",children:"> "}),p.displayName.toUpperCase(),M.jsx("span",{className:Ae?"visible":"invisible",children:" <"})]},F)})}),M.jsxs("div",{className:"text-[12px] sm:text-[14px] text-gray-400 mt-3 text-center pointer-events-none leading-relaxed whitespace-nowrap",children:[M.jsx("div",{children:ml(x).subtitle}),M.jsxs("div",{className:"mt-1",children:[ml(x).levelCount," Levels"]})]}),M.jsx("div",{className:"mt-5 sm:mt-6",children:y>0?M.jsx("div",{className:"text-white text-[14px] sm:text-base leading-none animate-pulse whitespace-nowrap",children:"PRESS START"}):M.jsx("div",{className:"text-orange-400 text-[14px] sm:text-base leading-none animate-pulse whitespace-nowrap",children:"INSERT COIN"})}),M.jsxs("div",{className:"mt-3 text-center whitespace-nowrap",children:[M.jsxs("div",{className:"text-white text-[13px] sm:text-sm leading-none",children:["CREDITS: ",y]}),M.jsxs("div",{className:"text-gray-500 text-[12px] sm:text-[14px] leading-none mt-1",children:["REMAINING: ",A,"/10"]})]})]})}),n===te.VICTORY&&M.jsx("div",{className:"absolute inset-0 z-50 pointer-events-none",children:M.jsxs("div",{className:"absolute bottom-16 left-0 right-0 flex justify-between px-8 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{q>0&&Ee(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${q===0?"opacity-0 pointer-events-none":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("button",{onClick:()=>{q<1?Ee(F=>F+1):(D.state=te.ATTRACT,Ee(0),j(0))},className:"px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 animate-pulse",style:{fontFamily:'"Black Ops One"',background:q===1?"#c9a961":"#4A5D23",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:q===1?"#2B3A12":"white"},children:q<1?"NEXT >":"FINISH"})]})}),n===te.ENDING&&M.jsx("div",{className:"absolute inset-0 z-50 pointer-events-none",children:M.jsxs("div",{className:"absolute bottom-16 left-0 right-0 flex justify-between px-8 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{ye>0&&fe(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${ye===0?"opacity-0 pointer-events-none":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("button",{onClick:()=>{ye<pl.length-1?fe(F=>F+1):(D.state=te.ATTRACT,fe(0),j(0))},className:"px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 animate-pulse",style:{fontFamily:'"Black Ops One"',background:ye===pl.length-1?"#c9a961":"#4A5D23",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:ye===pl.length-1?"#2B3A12":"white"},children:ye===pl.length-1?"FINISH":"NEXT >"})]})}),n===te.STORY&&M.jsx("div",{className:"absolute inset-0 flex items-end justify-center pointer-events-none",style:{paddingBottom:"15px"},children:M.jsxs("div",{className:"flex items-center gap-4 pointer-events-auto",children:[M.jsx("button",{onClick:()=>{Q>0&&j(F=>F-1)},className:`px-4 py-2 text-[15px] text-white rounded transition-all hover:brightness-110 active:scale-95 ${Q===0?"invisible":""}`,style:{fontFamily:'"Black Ops One"',background:"#3B4A1C",border:"2px solid #5A6D33",boxShadow:"0 0 8px rgba(90, 109, 51, 0.4)"},children:"< PREV"}),M.jsx("span",{className:"text-[14px] min-w-[50px] text-center",style:{fontFamily:'"Black Ops One"',color:"#c9a961"},children:U?`${Q+1}/5`:"LOADING..."}),M.jsx("button",{onClick:()=>{U&&(Q<4?j(F=>F+1):D.startMission())},disabled:!U,className:"px-4 py-2 text-[15px] text-white rounded transition-all active:scale-95",style:{fontFamily:'"Black Ops One"',background:U?Q===4?"#c9a961":"#4A5D23":"#2B3A12",border:"2px solid #5A6D33",boxShadow:"0 0 10px rgba(90, 109, 51, 0.5)",color:U?Q===4?"#2B3A12":"white":"#5A6D33",cursor:U?"pointer":"wait",animation:U?"pulse 2s infinite":"none"},children:Q===4?"GO!":"NEXT >"})]})}),M.jsx("div",{className:"absolute inset-0 pointer-events-none scanlines opacity-20"})]}),le&&M.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-30 bg-red-900/90 border border-red-600 px-4 py-3 rounded-lg max-w-sm",children:[M.jsx("p",{className:"text-red-200 text-xs mb-2",children:le}),M.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-500 text-white font-bold text-xs py-1.5 px-4 rounded",children:"RELOAD"})]}),(n===te.ATTRACT||n===te.GAME_OVER)&&M.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20 flex justify-center items-center gap-3 px-3 py-3 bg-gradient-to-t from-black/90 via-black/60 to-transparent",children:[M.jsx("button",{onClick:()=>{const F=!Ls;me.setMuted(F),Ea(F),F||me.playTitleMusic()},className:`p-[7px] rounded transition-all active:scale-95 border ${Ls?"bg-red-900/80 hover:bg-red-800 text-red-400 hover:text-red-300 border-red-700":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300 hover:text-white border-zinc-600"}`,title:Ls?"Unmute Audio":"Mute Audio",children:Ls?M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),M.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),M.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}):M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),M.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),M.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})}),M.jsx("button",{onClick:()=>{me.playMenuSelect(),fn(!0)},className:"p-[7px] rounded transition-all bg-zinc-700 hover:bg-zinc-600 text-zinc-300 hover:text-white active:scale-95 border border-zinc-600",title:"Game Settings",children:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("circle",{cx:"12",cy:"12",r:"3"}),M.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),M.jsx("button",{onTouchStart:()=>{me.unlockAudio()},onClick:()=>{me.unlockAudio(),me.playTitleMusic(),D.insertCoin(),E(D.credits),v(D.totalCreditsRemaining)},className:`font-bold text-[12px] py-[7px] px-[14px] rounded transition-all ${A===0?"bg-zinc-800 text-zinc-600 cursor-not-allowed":"bg-yellow-600 hover:bg-yellow-500 text-black active:scale-95"}`,disabled:A===0,children:"INSERT COIN"}),M.jsx("span",{className:"text-zinc-400 text-[13px] font-mono",children:y>0?`CREDITS: ${y}`:`${A}/10`}),M.jsx("button",{onTouchStart:()=>{me.unlockAudio()},onClick:async()=>{if(me.unlockAudio(),le){alert("Cannot start game: "+le+`

Please refresh the page.`);return}if(C||xe){alert("Please wait for assets to finish loading...");return}if(!_a.current){alert("Game assets failed to load. Please refresh the page.");return}if(console.log(`[START] engine.state=${D.state}, GameState.ATTRACT=${te.ATTRACT}`),D.state!==te.ATTRACT){console.log("[START] Skipping - not in ATTRACT state");return}const F=parseInt("0",10),p=F>0?F:1;console.log(`[START] About to load terrain for campaign: ${x}, startLevel: ${p}`),de(!0);try{console.log(`[LOAD] Loading terrain for campaign: ${x}, level: ${p}...`),await o2(x,p),console.log("[LOAD] Terrain loaded successfully!")}catch(Ae){console.error("[LOAD] Failed to load terrain:",Ae),ue("Failed to load terrain. Please refresh."),de(!1);return}de(!1),D.startGame(),E(D.credits),v(D.totalCreditsRemaining),j(0),me.init(),se(!1),Lp(x).then(Ae=>{console.log(`[LAZY] ${x} story panels loaded for story mode`),ce(Ae),se(!0)}).catch(Ae=>console.error("[LAZY] Failed to load campaign story panels:",Ae))},disabled:C||xe||le!==null,className:`font-bold text-[12px] py-[7px] px-[14px] rounded transition-all ${C||xe||le?"bg-zinc-800 text-zinc-500 cursor-wait":"bg-red-600 hover:bg-red-500 text-white active:scale-95"}`,children:C?"LOADING...":xe?"LOADING TERRAIN...":le?"ERROR":"START GAME"})]}),M.jsx(R2,{isOpen:_l,onClose:()=>{fn(!1),Al(!1)}})]})};function $2(){return Z.useEffect(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("SW registered:",s)}).catch(s=>{console.log("SW registration failed:",s)})}),document.body.style.overscrollBehavior="none",document.documentElement.style.overscrollBehavior="none";const o=s=>{s.preventDefault()};document.addEventListener("contextmenu",o);const t=s=>{s.touches.length>1&&s.preventDefault()};document.addEventListener("touchmove",t,{passive:!1});const n=()=>{const s=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${s}px`)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{document.removeEventListener("contextmenu",o),document.removeEventListener("touchmove",t),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),M.jsx("div",{className:"w-full h-dvh bg-black",style:{overflow:"hidden"},children:M.jsx(j2,{})})}const hm=document.getElementById("root");if(!hm)throw new Error("Could not find root element to mount to");const q2=My.createRoot(hm);q2.render(M.jsx(yy.StrictMode,{children:M.jsx($2,{})}));export{Z2 as c,Vp as g};
